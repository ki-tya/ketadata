<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KETADATA // LOBBY</title>
  <style>
    :root{
      --bg:#000;
      --ink:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --line:rgba(255,255,255,.12);
      --line2:rgba(255,255,255,.20);
      --panel:rgba(255,255,255,.04);

      --r:0px;
      --pad:14px;

      --font: Arial, Helvetica, sans-serif;
    }

    *{ box-sizing:border-box; font-family: var(--font) !important; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      overflow:hidden;
    }

    /* Ambient canvas */
    #c{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      display:block;
      opacity:.55; /* keep it calm */
      filter: contrast(1.05);
    }

    /* Layout */
    .wrap{
      position:relative;
      z-index:5;
      height:100%;
      display:grid;
      grid-template-columns: minmax(320px, 560px) 1fr;
      gap: 18px;
      padding: 18px;
    }

    /* Desk panel */
    .desk{
      border:1px solid var(--line);
      background: rgba(0,0,0,.55);
      border-radius: var(--r);
      padding: var(--pad);
      display:flex;
      flex-direction:column;
      gap: 12px;
      backdrop-filter: blur(6px);
      box-shadow: 0 18px 80px rgba(0,0,0,.65);
      align-self: start;
    }

    .hdr{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:12px;
      padding-bottom:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }

    .brand{
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:700;
      color:rgba(255,255,255,.92);
      white-space:nowrap;
    }

    .where{
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(255,255,255,.55);
      text-align:right;
    }

    .facts{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
    }

    .fact{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding:10px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
    }

    .k{
      font-size:11px;
      color:rgba(255,255,255,.62);
      letter-spacing:.08em;
      text-transform:uppercase;
      white-space:nowrap;
    }
    .v{
      font-size:12px;
      color:rgba(255,255,255,.90);
      letter-spacing:.02em;
      text-transform:none;
      text-align:right;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width: 320px;
    }

    .actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      padding-top: 2px;
    }

    .btn{
      appearance:none;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--ink);
      padding:10px 12px;
      font-size:12px;
      cursor:pointer;
      border-radius: var(--r);
      text-transform:uppercase;
      letter-spacing:.12em;
      font-weight:700;
      user-select:none;
    }
    .btn:hover{ border-color: var(--line2); background: rgba(255,255,255,.06); }
    .btn:active{ transform: translateY(1px); }

    .btn.secondary{
      font-weight:600;
      letter-spacing:.10em;
      text-transform:uppercase;
      color: rgba(255,255,255,.82);
      background: rgba(255,255,255,.02);
    }

    /* Directory */
    .dir{
      border:1px solid var(--line);
      background: rgba(0,0,0,.45);
      border-radius: var(--r);
      padding: var(--pad);
      backdrop-filter: blur(6px);
      box-shadow: 0 18px 80px rgba(0,0,0,.55);
      display:flex;
      flex-direction:column;
      min-width: 260px;
    }

    .dirHdr{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:12px;
      padding-bottom:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      margin-bottom: 10px;
    }
    .dirTitle{
      font-size:12px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:700;
      color:rgba(255,255,255,.92);
    }
    .dirHint{
      font-size:11px;
      color:rgba(255,255,255,.55);
      letter-spacing:.02em;
      text-align:right;
    }

    .list{
      display:flex;
      flex-direction:column;
      gap:8px;
      overflow:auto;
      padding-right: 6px;
    }

    .item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
      text-decoration:none;
      color: var(--ink);
      cursor:pointer;
    }
    .item:hover{ border-color: rgba(255,255,255,.18); background: rgba(255,255,255,.04); }

    .name{
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-weight:700;
      white-space:nowrap;
    }
    .role{
      font-size:11px;
      color: rgba(255,255,255,.62);
      letter-spacing:.10em;
      text-transform:uppercase;
      white-space:nowrap;
    }

    /* Bottom rules */
    .rules{
      position:fixed;
      left:18px;
      bottom:18px;
      z-index:6;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.50);
      padding:10px 12px;
      font-size:11px;
      color:rgba(255,255,255,.62);
      letter-spacing:.02em;
      border-radius: var(--r);
      backdrop-filter: blur(6px);
      pointer-events:none;
      max-width: min(520px, calc(100vw - 36px));
      line-height: 1.35;
    }
    .rules b{ color: rgba(255,255,255,.88); font-weight:700; }

    /* Veil transition */
    .veil{
      position:fixed;
      inset:0;
      background:#000;
      opacity:0;
      pointer-events:none;
      transition: opacity 520ms ease;
      z-index:50;
    }
    .veil.on{ opacity:1; }

    /* Responsive */
    @media (max-width: 980px){
      .wrap{
        grid-template-columns: 1fr;
      }
      .dir{ min-height: 42vh; }
      .v{ max-width: 100%; }
    }

    /* Accessibility focus */
    .btn:focus, .item:focus{
      outline: 2px solid rgba(255,255,255,.18);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <canvas id="c" aria-hidden="true"></canvas>

  <div class="wrap">
    <!-- DESK -->
    <section class="desk" aria-label="Reception Desk">
      <div class="hdr">
        <div class="brand">KETADATA</div>
        <div class="where">LOBBY // RECEPTION</div>
      </div>

      <div class="facts">
        <div class="fact">
          <div class="k">STATUS</div>
          <div class="v" id="statusVal">GUEST</div>
        </div>
        <div class="fact">
          <div class="k">LAST ROOM</div>
          <div class="v" id="lastRoomVal">—</div>
        </div>
        <div class="fact">
          <div class="k">RESUME URL</div>
          <div class="v" id="resumeUrlVal">—</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="enterBtn">ENTER SYSTEM</button>
        <button class="btn secondary" id="directoryBtn">OPEN ELEVATOR</button>
        <button class="btn secondary" id="clearBtn">CLEAR SESSION</button>
      </div>
    </section>

    <!-- DIRECTORY -->
    <aside class="dir" aria-label="Directory">
      <div class="dirHdr">
        <div class="dirTitle">DIRECTORY</div>
        <div class="dirHint">click = route</div>
      </div>

      <div class="list" id="dirList">
        <!-- populated by JS -->
      </div>
    </aside>
  </div>

  <div class="rules">
    <b>RULES:</b>
    LOBBY routes only. Tools live in STUDIO. Unstable experiments live in BASEMENT.
    <br />
    <b>KEYS:</b> ESC clears focus · CMD/CTRL+I inverts (if enabled elsewhere) · sandbox strobe keys do not run here.
  </div>

  <div class="veil" id="veil"></div>

  <script>
    (() => {
      // -----------------------------
      // CONFIG (edit these once)
      // -----------------------------
      const ROOMS = [
        { id:"elevator", name:"ELEVATOR", role:"ROUTER", url:"https://ketadata.com/elevator1.html", tip:"Primary navigation kernel." },
        { id:"studio", name:"STUDIO", role:"WORK", url:"https://ketadata.com/studio.html", tip:"Tools, transforms, control surfaces." },
        { id:"observatory", name:"OBSERVATORY", role:"DASHBOARD", url:"https://ketadata.com/map.html", tip:"Macro view: maps, funding, CCTV." },
        { id:"cinema", name:"CINEMA", role:"PLAY", url:"https://ketadata.com/kdtv1.html", tip:"Video modes, playback, curation." },
        { id:"library", name:"LIBRARY", role:"CATALOG", url:"https://ketadata.com/library.html", tip:"Member library, coat-of-arms assets." },
        { id:"temple", name:"TEMPLE", role:"CALIBRATE", url:"https://ketadata.com/mandala.html", tip:"Calm engines: mandala, chakra, breath." },
        { id:"room", name:"ROOM", role:"PROFILE", url:"https://ketadata.com/room.html", tip:"User profile, presets, in-suite hub." },
        { id:"vault", name:"VAULT", role:"STRUCTURE", url:"https://ketadata.com/system.html", tip:"System maps, indices, schemas." },
        { id:"lab", name:"LAB", role:"COGNITION", url:"https://ketadata.com/prompt3.html", tip:"Prompting, circles, cognitive tools." },
        { id:"basement", name:"BASEMENT", role:"SANDBOX", url:"https://ketadata.com/1.html", tip:"Unstable experiments. No guarantees." }
      ];

      const KEY_LAST = "ketadata_last_url";
      const KEY_LAST_NAME = "ketadata_last_room";
      const KEY_STATUS = "ketadata_access_status"; // "GUEST" | "MEMBER"
      const DEFAULT_ENTRY = "https://ketadata.com/elevator1.html";

      // -----------------------------
      // DOM
      // -----------------------------
      const dirList = document.getElementById("dirList");
      const enterBtn = document.getElementById("enterBtn");
      const directoryBtn = document.getElementById("directoryBtn");
      const clearBtn = document.getElementById("clearBtn");
      const veil = document.getElementById("veil");

      const statusVal = document.getElementById("statusVal");
      const lastRoomVal = document.getElementById("lastRoomVal");
      const resumeUrlVal = document.getElementById("resumeUrlVal");

      // -----------------------------
      // SESSION STATE
      // -----------------------------
      function getStatus(){
        return (localStorage.getItem(KEY_STATUS) || "GUEST").toUpperCase();
      }
      function getLast(){
        return {
          name: localStorage.getItem(KEY_LAST_NAME) || "—",
          url: localStorage.getItem(KEY_LAST) || DEFAULT_ENTRY
        };
      }
      function setLast(roomName, url){
        try{
          localStorage.setItem(KEY_LAST_NAME, roomName);
          localStorage.setItem(KEY_LAST, url);
        }catch(_){}
      }
      function clearSession(){
        try{
          localStorage.removeItem(KEY_LAST_NAME);
          localStorage.removeItem(KEY_LAST);
          // keep status unless you want to wipe it too:
          // localStorage.removeItem(KEY_STATUS);
        }catch(_){}
      }

      function updateDesk(){
        const s = getStatus();
        const last = getLast();
        statusVal.textContent = s;
        lastRoomVal.textContent = last.name;
        resumeUrlVal.textContent = last.url.replace(/^https?:\/\//, "");
      }

      // -----------------------------
      // NAV
      // -----------------------------
      let navLock = false;

      function route(roomName, url){
        if(navLock) return;
        navLock = true;

        setLast(roomName, url);

        veil.classList.add("on");
        setTimeout(() => {
          window.location.href = url;
        }, 520);
      }

      function buildDirectory(){
        dirList.innerHTML = "";
        for(const r of ROOMS){
          const a = document.createElement("a");
          a.className = "item";
          a.href = r.url;
          a.title = r.tip || "";
          a.innerHTML = `
            <div class="name">${r.name}</div>
            <div class="role">${r.role}</div>
          `;
          a.addEventListener("click", (e) => {
            e.preventDefault();
            route(r.name, r.url);
          });
          dirList.appendChild(a);
        }
      }

      enterBtn.addEventListener("click", () => {
        const last = getLast();
        route(last.name === "—" ? "ELEVATOR" : last.name, last.url || DEFAULT_ENTRY);
      });

      directoryBtn.addEventListener("click", () => {
        const elev = ROOMS.find(x => x.id === "elevator");
        route(elev?.name || "ELEVATOR", elev?.url || DEFAULT_ENTRY);
      });

      clearBtn.addEventListener("click", () => {
        if(navLock) return;
        clearSession();
        updateDesk();
      });

      // Escape: drop veil if needed
      window.addEventListener("keydown", (e) => {
        if(e.key === "Escape"){
          veil.classList.remove("on");
          navLock = false;
        }
      });

      // -----------------------------
      // AMBIENT BACKGROUND (LOCKED)
      // Minimal lotus-like drift: no controls, no heavy UI.
      // -----------------------------
      const canvas = document.getElementById("c");
      const ctx = canvas.getContext("2d", { alpha: false });

      let W=0, H=0, DPR=1;

      function resize(){
        DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
        W = Math.floor(window.innerWidth * DPR);
        H = Math.floor(window.innerHeight * DPR);
        canvas.width = W;
        canvas.height = H;
        canvas.style.width = window.innerWidth + "px";
        canvas.style.height = window.innerHeight + "px";
      }

      window.addEventListener("resize", resize, { passive:true });
      resize();

      function clamp(x,a,b){ return Math.max(a, Math.min(b, x)); }
      function lerp(a,b,t){ return a + (b-a)*t; }
      function smoothstep(t){ return t*t*(3-2*t); }

      // tiny value noise
      function hash2(ix, iy){
        let h = ix * 374761393 + iy * 668265263;
        h = (h ^ (h >> 13)) >>> 0;
        h = (h * 1274126177) >>> 0;
        return (h ^ (h >> 16)) >>> 0;
      }
      function vnoise(x, y){
        const ix = Math.floor(x), iy = Math.floor(y);
        const fx = x - ix, fy = y - iy;
        const a = (hash2(ix,iy) & 1023)/1023;
        const b = (hash2(ix+1,iy) & 1023)/1023;
        const c = (hash2(ix,iy+1) & 1023)/1023;
        const d = (hash2(ix+1,iy+1) & 1023)/1023;
        const ux = smoothstep(fx), uy = smoothstep(fy);
        return lerp(lerp(a,b,ux), lerp(c,d,ux), uy);
      }

      function lotusI(x,y,t){
        // x,y in -1..1
        const r = Math.hypot(x,y);
        const a = Math.atan2(y,x);

        const petals = 12;     // locked
        const layers = 5;      // locked
        const spin = 0.22;     // locked
        const breath = 0.35;   // locked

        let mod = 0, amp = 0.42, freq = petals, phase = t*0.5*spin;
        for(let i=0;i<layers;i++){
          mod += amp * Math.cos(freq*a + phase + i*0.65);
          amp *= 0.62;
          freq += petals * 0.35;
          phase *= 1.02;
        }

        const n = vnoise(x*2.2 + Math.sin(t*0.11)*1.7, y*2.2 + Math.cos(t*0.09)*1.7) - 0.5;
        const breathe = 1.0 + 0.06*breath*Math.sin(t*0.55 + r*7.0);
        const boundary = 0.50*breathe + 0.20*mod + 0.07*n;

        const d = boundary - r;
        const edge = smoothstep(clamp((d + 0.02) / 0.08, 0, 1));
        const core = Math.exp(-r*r*18.0);

        let I = edge + 0.55*core;
        I += 0.06 * Math.exp(-Math.max(0, r-0.45)*10.0);
        return clamp(I, 0, 1);
      }

      function frame(){
        // pure black base
        ctx.fillStyle = "#000";
        ctx.fillRect(0,0,W,H);

        const t = performance.now()/1000;
        const cx = W*0.5, cy = H*0.5;
        const R = Math.min(W,H)*0.42;

        // draw a restrained field of strokes
        ctx.save();
        ctx.translate(cx, cy);

        const strokes = 640;
        ctx.lineWidth = 1 * DPR;

        for(let i=0;i<strokes;i++){
          const u = i / strokes;
          const a = u * Math.PI*2;

          const steps = 26;
          ctx.beginPath();

          for(let s=0;s<=steps;s++){
            const v = s/steps;
            const r = v * R * (0.96 + 0.04*Math.sin(t*0.2 + a*3.0));
            const x = Math.cos(a) * r;
            const y = Math.sin(a) * r;

            const lx = x / R;
            const ly = y / R;
            const I = lotusI(lx, ly, t);

            // subtle bend only
            const bend = 0.10*I*Math.sin(a*12 + t*0.3) * (0.25 + 0.75*v);
            const xx = Math.cos(a + bend) * r;
            const yy = Math.sin(a + bend) * r;

            if(s===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);
          }

          const alpha = 0.04 + 0.12*Math.pow(Math.sin(t*0.15 + a*0.7)*0.5+0.5, 1.6);
          ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
          ctx.stroke();
        }

        // vignette
        ctx.restore();
        const grd = ctx.createRadialGradient(W*0.5,H*0.5,0, W*0.5,H*0.5, Math.max(W,H)*0.65);
        grd.addColorStop(0, "rgba(0,0,0,0)");
        grd.addColorStop(1, "rgba(0,0,0,0.70)");
        ctx.fillStyle = grd;
        ctx.fillRect(0,0,W,H);

        requestAnimationFrame(frame);
      }

      // init
      buildDirectory();
      updateDesk();
      requestAnimationFrame(frame);
    })();
  </script>
</body>
</html>
