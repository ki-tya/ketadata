import React, { useState, useEffect, useRef } from 'react';

const SmokeBubbleUI = () => {
  const canvasRef = useRef(null);
  const ripplesRef = useRef([]);
  const timeRef = useRef(0);
  const animationFrameRef = useRef(null);

  class Ripple {
    constructor(x, y, delay = 0) {
      this.x = x;
      this.y = y;
      this.radius = 0;
      this.maxRadius = Math.random() * 150 + 200;
      this.speed = Math.random() * 0.5 + 0.8;
      this.delay = delay;
      this.age = 0;
      this.opacity = Math.random() * 0.4 + 0.6;
    }
    
    update() {
      if (this.delay > 0) {
        this.delay--;
        return;
      }
      this.age++;
      this.radius += this.speed;
    }
    
    draw(ctx) {
      if (this.delay > 0 || this.radius > this.maxRadius || this.radius < 1) return;
      
      let progress = this.radius / this.maxRadius;
      let alpha = (1 - progress) * this.opacity;
      let heatGlow = Math.sin(this.age * 0.1) * 0.5 + 0.5;
      
      // Outer heat distortion rings
      for (let i = 0; i < 6; i++) {
        let offset = i * 5;
        let ringRadius = this.radius - offset;
        if (ringRadius < 1) continue;
        
        let r = 245 + i * 2;
        let g = 245 + i * 2;
        let b = 250 + i * 2;
        
        if (i < 2) {
          r = 255;
          g = 250 - i * 5;
          b = 240 - i * 10;
        }
        
        ctx.strokeStyle = `rgba(${r}, ${g}, ${b}, ${alpha * (0.95 - i * 0.12)})`;
        ctx.lineWidth = 5 - i * 0.6;
        ctx.beginPath();
        ctx.arc(this.x, this.y, ringRadius, 0, Math.PI * 2);
        ctx.stroke();
      }
      
      // Intense liquid metal glow
      if (this.radius >= 5) {
        ctx.shadowBlur = 40;
        ctx.shadowColor = `rgba(220, 235, 255, ${alpha * 0.9})`;
        ctx.strokeStyle = `rgba(255, 255, 255, ${alpha * 0.9})`;
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.stroke();
        
        let midRadius = this.radius + 4;
        if (midRadius >= 1) {
          ctx.shadowBlur = 25;
          ctx.shadowColor = `rgba(255, 255, 255, ${alpha * 0.8})`;
          ctx.strokeStyle = `rgba(255, 252, 245, ${alpha * 0.7})`;
          ctx.lineWidth = 2.5;
          ctx.beginPath();
          ctx.arc(this.x, this.y, midRadius, 0, Math.PI * 2);
          ctx.stroke();
        }
        
        let innerRadius = this.radius - 3;
        if (innerRadius >= 1) {
          ctx.shadowBlur = 20;
          ctx.shadowColor = `rgba(255, 248, 240, ${alpha * heatGlow})`;
          ctx.strokeStyle = `rgba(255, 250, 240, ${alpha * 0.6})`;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.arc(this.x, this.y, innerRadius, 0, Math.PI * 2);
          ctx.stroke();
        }
        
        ctx.shadowBlur = 0;
      }
    }
    
    isDead() {
      return this.radius > this.maxRadius;
    }
  }

  const createRipplePattern = (canvas) => {
    if (Math.random() > 0.85) {
      let x = Math.random() * canvas.width;
      let y = Math.random() * canvas.height;
      ripplesRef.current.push(new Ripple(x, y));
    }
    
    if (timeRef.current % 80 === 0) {
      for (let i = 0; i < 5; i++) {
        let x = (canvas.width / 6) * (i + 1);
        let y = canvas.height / 2 + Math.sin(timeRef.current * 0.02 + i) * 150;
        ripplesRef.current.push(new Ripple(x, y, i * 10));
      }
    }
    
    if (timeRef.current % 150 === 0) {
      let centerX = canvas.width / 2;
      let centerY = canvas.height / 2;
      for (let i = 0; i < 8; i++) {
        let angle = (Math.PI * 2 / 8) * i;
        let distance = 150;
        let x = centerX + Math.cos(angle) * distance;
        let y = centerY + Math.sin(angle) * distance;
        ripplesRef.current.push(new Ripple(x, y, i * 8));
      }
    }
  };

  const animate = () => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    
    ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    timeRef.current++;
    
    createRipplePattern(canvas);
    
    ripplesRef.current.forEach(ripple => {
      ripple.update();
      ripple.draw(ctx);
    });
    
    ripplesRef.current = ripplesRef.current.filter(ripple => !ripple.isDead());
    
    // Metallic droplets
    if (Math.random() > 0.8) {
      let x = Math.random() * canvas.width;
      let y = Math.random() * canvas.height;
      let size = Math.random() * 3 + 1.5;
      
      ctx.shadowBlur = 15;
      ctx.shadowColor = 'rgba(255, 255, 255, 0.9)';
      ctx.fillStyle = `rgba(255, 252, 245, ${Math.random() * 0.7 + 0.3})`;
      ctx.beginPath();
      ctx.arc(x, y, size, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;
    }
    
    // Streaming reflections
    if (Math.random() > 0.95) {
      let x = Math.random() * canvas.width;
      let y = Math.random() * canvas.height;
      
      ctx.shadowBlur = 20;
      ctx.shadowColor = 'rgba(240, 245, 255, 0.6)';
      ctx.strokeStyle = `rgba(255, 255, 255, ${Math.random() * 0.5 + 0.3})`;
      ctx.lineWidth = Math.random() * 2 + 1;
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(x + Math.random() * 40 - 20, y + Math.random() * 40 - 20);
      ctx.stroke();
      ctx.shadowBlur = 0;
    }
    
    animationFrameRef.current = requestAnimationFrame(animate);
  };

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    const handleResize = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };
    
    const handleClick = (e) => {
      ripplesRef.current.push(new Ripple(e.clientX, e.clientY));
    };
    
    window.addEventListener('resize', handleResize);
    canvas.addEventListener('click', handleClick);
    
    animate();
    
    return () => {
      window.removeEventListener('resize', handleResize);
      canvas.removeEventListener('click', handleClick);
      if (animationFrameRef.current) {
        cancelAnimationFrame(animationFrameRef.current);
      }
    };
  }, []);

  return (
    <div style={{
      position: 'fixed',
      top: 0,
      left: 0,
      width: '100vw',
      height: '100vh',
      backgroundColor: '#000',
      overflow: 'hidden',
    }}>
      <canvas 
        ref={canvasRef}
        style={{
          display: 'block',
          cursor: 'crosshair',
        }}
      />

      {/* Logo */}
      <div style={{
        position: 'absolute',
        top: '50%',
        left: '50%',
        transform: 'translate(-50%, -50%)',
        marginTop: '-250px',
        zIndex: 10,
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        pointerEvents: 'none',
      }}>
        <h1 style={{
          fontSize: '48px',
          fontWeight: 'bold',
          color: '#fff',
          letterSpacing: '4px',
          marginBottom: '8px',
          fontFamily: 'monospace',
        }}>
          VAPE-DRIVE
        </h1>
        <p style={{
          fontSize: '14px',
          color: '#888',
          letterSpacing: '2px',
          fontFamily: 'monospace',
        }}>
          open vape database
        </p>
      </div>

      {/* Login Form */}
      <div style={{
        position: 'absolute',
        top: '50%',
        left: '50%',
        transform: 'translate(-50%, -50%)',
        width: '90%',
        maxWidth: '400px',
        padding: '24px',
        pointerEvents: 'auto',
        zIndex: 10,
      }}>
        <input
          type="text"
          placeholder="username"
          style={{
            width: '100%',
            padding: '16px',
            marginBottom: '12px',
            backgroundColor: '#fff',
            border: 'none',
            borderRadius: '4px',
            fontSize: '14px',
            fontFamily: 'monospace',
            outline: 'none',
          }}
        />
        <input
          type="text"
          placeholder="phone number"
          style={{
            width: '100%',
            padding: '16px',
            marginBottom: '12px',
            backgroundColor: '#fff',
            border: 'none',
            borderRadius: '4px',
            fontSize: '14px',
            fontFamily: 'monospace',
            outline: 'none',
          }}
        />
        <button
          style={{
            width: '100%',
            padding: '16px',
            backgroundColor: '#fff',
            border: 'none',
            borderRadius: '4px',
            fontSize: '14px',
            fontWeight: 'bold',
            fontFamily: 'monospace',
            cursor: 'pointer',
            letterSpacing: '2px',
            transition: 'transform 0.1s',
          }}
          onMouseDown={(e) => e.currentTarget.style.transform = 'scale(0.98)'}
          onMouseUp={(e) => e.currentTarget.style.transform = 'scale(1)'}
        >
          SEND CODE
        </button>
        <p style={{
          textAlign: 'center',
          marginTop: '16px',
          fontSize: '12px',
          color: '#666',
          fontFamily: 'monospace',
        }}>
          returning user? login
        </p>
      </div>

      {/* Tap instruction */}
      <div style={{
        position: 'absolute',
        top: '50%',
        left: '50%',
        transform: 'translate(-50%, -50%)',
        marginTop: '200px',
        zIndex: 5,
        pointerEvents: 'none',
      }}>
        <p style={{
          fontSize: '13px',
          color: '#555',
          fontStyle: 'italic',
          fontFamily: 'monospace',
          textAlign: 'center',
          animation: 'pulse 2s ease-in-out infinite',
        }}>
          tap the ripples
        </p>
        <style>
          {`
            @keyframes pulse {
              0%, 100% { opacity: 0.4; }
              50% { opacity: 0.8; }
            }
          `}
        </style>
      </div>

      {/* Footer */}
      <div style={{
        position: 'absolute',
        bottom: '20px',
        left: '50%',
        transform: 'translateX(-50%)',
        fontSize: '11px',
        color: '#444',
        fontStyle: 'italic',
        fontFamily: 'monospace',
        pointerEvents: 'none',
      }}>
        powered by ketadata
      </div>
    </div>
  );
};

export default SmokeBubbleUI;
