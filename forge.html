<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>KETADATA // FORGE v0</title>

<style>
/* ===============================
   KETADATA FORGE v0
   Mechanical / constrained UI
   =============================== */

:root{
  --bg:#000;
  --fg:#fff;
  --muted:rgba(255,255,255,.55);
  --line:rgba(255,255,255,.14);
  --panel:rgba(255,255,255,.03);

  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  --ui: Arial, Helvetica, sans-serif;

  --pad:12px;
  --gap:12px;
}

/* Reset */
*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; }
body{
  background:var(--bg);
  color:var(--fg);
  font-family:var(--ui);
  overflow:hidden;
}

/* Grid background (structural, not decorative) */
body::before{
  content:"";
  position:fixed; inset:0;
  background:
    linear-gradient(rgba(255,255,255,.08) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,.08) 1px, transparent 1px);
  background-size: 36px 36px;
  opacity:.28;
  pointer-events:none;
}

/* Layout */
.app{
  height:100%;
  display:grid;
  grid-template-rows:auto 1fr;
}

/* Top bar */
.top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 12px;
  border-bottom:1px solid var(--line);
  background:#000;
}

.brand{
  font-weight:900;
  font-size:11px;
  letter-spacing:.22em;
  text-transform:uppercase;
}

.topRight{
  display:flex;
  align-items:center;
  gap:10px;
}

/* System note icon */
.noteIcon{
  width:14px;
  height:14px;
  border:1px solid #fff;
  background:#fff;
  cursor:pointer;
}
.noteIcon.open{ background:transparent; }

.btn{
  border:1px solid var(--line);
  background:transparent;
  color:#fff;
  font-size:10px;
  letter-spacing:.18em;
  text-transform:uppercase;
  padding:6px 10px;
  cursor:pointer;
}
.btn:hover{ border-color:#fff; }

/* Main layout */
.main{
  height:100%;
  display:grid;
  grid-template-columns:320px 1fr 420px;
}

/* Panels */
.panel{
  height:100%;
  display:flex;
  flex-direction:column;
  border-right:1px solid var(--line);
}
.panel:last-child{ border-right:none; }

.panelHead{
  padding:var(--pad);
  border-bottom:1px solid var(--line);
  font-size:10px;
  letter-spacing:.18em;
  text-transform:uppercase;
  font-weight:900;
}

.panelBody{
  padding:var(--pad);
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:var(--gap);
}

/* Inputs */
label{
  font-size:10px;
  letter-spacing:.14em;
  text-transform:uppercase;
  color:var(--muted);
}

input, textarea, select{
  width:100%;
  background:transparent;
  color:#fff;
  border:1px solid var(--line);
  padding:8px;
  font-family:var(--mono);
  font-size:11px;
}
textarea{ resize:vertical; min-height:80px; }

/* Lists */
.list{
  border:1px solid var(--line);
}
.item{
  padding:8px;
  border-bottom:1px solid var(--line);
  cursor:pointer;
  font-family:var(--mono);
  font-size:11px;
}
.item:last-child{ border-bottom:none; }
.item.active{
  background:rgba(255,255,255,.08);
}

/* Output */
.output{
  border:1px solid var(--line);
  background:rgba(255,255,255,.02);
  padding:10px;
  font-family:var(--mono);
  font-size:11px;
  white-space:pre-wrap;
}

/* System note modal */
.note{
  position:fixed;
  top:120px;
  right:120px;
  width:360px;
  height:360px;
  border:1px solid #fff;
  background:#000;
  display:none;
  z-index:10;
}
.note.open{ display:block; }

.noteHead{
  padding:8px;
  border-bottom:1px solid var(--line);
  font-size:10px;
  letter-spacing:.18em;
  text-transform:uppercase;
  cursor:move;
}
.noteBody{
  height:calc(100% - 34px);
}
.noteBody textarea{
  height:100%;
  border:none;
}
</style>
</head>

<body>
<div class="app">

  <!-- TOP BAR -->
  <div class="top">
    <div class="brand">KETADATA // FORGE v0</div>
    <div class="topRight">
      <button class="btn" id="exportJSON">export.json</button>
      <button class="btn" id="exportRoom">export room</button>
      <div class="noteIcon" id="noteIcon" title="SYSTEM NOTE"></div>
    </div>
  </div>

  <!-- MAIN -->
  <div class="main">

    <!-- LEFT: DEFINITIONS -->
    <div class="panel">
      <div class="panelHead">Definitions</div>
      <div class="panelBody">

        <label>Mode</label>
        <select id="mode">
          <option value="rooms">Rooms</option>
          <option value="primitives">Primitives</option>
        </select>

        <label>ID</label>
        <input id="idField" />

        <label>Title</label>
        <input id="titleField" />

        <label>Tags (comma)</label>
        <input id="tagsField" />

        <label>Notes</label>
        <textarea id="notesField"></textarea>

        <button class="btn" id="saveItem">save</button>
        <button class="btn" id="newItem">new</button>

      </div>
    </div>

    <!-- CENTER: REGISTRY -->
    <div class="panel">
      <div class="panelHead">Registry</div>
      <div class="panelBody">
        <div class="list" id="registry"></div>
      </div>
    </div>

    <!-- RIGHT: OUTPUT -->
    <div class="panel">
      <div class="panelHead">Output</div>
      <div class="panelBody">
        <label>Generated Output</label>
        <div class="output" id="output">(select a room)</div>
      </div>
    </div>

  </div>
</div>

<!-- SYSTEM NOTE -->
<div class="note" id="note">
  <div class="noteHead">SYSTEM NOTE</div>
  <div class="noteBody">
    <textarea id="systemNote"></textarea>
  </div>
</div>

<script>
/* ===============================
   KETADATA FORGE v0 LOGIC
   =============================== */

const LS_KEY = "KETADATA_FORGE_V0";

let state = load() || {
  rooms: [],
  primitives: [],
  systemNote: ""
};

let mode = "rooms";
let selectedIndex = null;

/* Elements */
const registryEl = document.getElementById("registry");
const outputEl = document.getElementById("output");

const idField = document.getElementById("idField");
const titleField = document.getElementById("titleField");
const tagsField = document.getElementById("tagsField");
const notesField = document.getElementById("notesField");

const modeSelect = document.getElementById("mode");
const systemNoteEl = document.getElementById("systemNote");
const noteIcon = document.getElementById("noteIcon");
const note = document.getElementById("note");

/* Load/save */
function save(){
  localStorage.setItem(LS_KEY, JSON.stringify(state,null,2));
}
function load(){
  try{
    return JSON.parse(localStorage.getItem(LS_KEY));
  }catch(e){ return null; }
}

/* Render registry */
function renderRegistry(){
  registryEl.innerHTML = "";
  const list = state[mode];
  list.forEach((item,i)=>{
    const d = document.createElement("div");
    d.className = "item" + (i===selectedIndex ? " active":"");
    d.textContent = item.id || "(unnamed)";
    d.onclick = ()=>selectItem(i);
    registryEl.appendChild(d);
  });
}

/* Select */
function selectItem(i){
  selectedIndex = i;
  const item = state[mode][i];
  idField.value = item.id || "";
  titleField.value = item.title || "";
  tagsField.value = (item.tags||[]).join(",");
  notesField.value = item.notes || "";
  renderOutput(item);
  renderRegistry();
}

/* Output generation (room only, v0) */
function renderOutput(item){
  if(mode !== "rooms"){
    outputEl.textContent = "(no output for primitives yet)";
    return;
  }
  outputEl.textContent =
`ROOM PAGE OUTPUT (DETERMINISTIC)

id: ${item.id}
title: ${item.title}
tags: ${(item.tags||[]).join(", ")}

imports:
- ketadata-core.css
- ketadata-core.js

includes:
- grid layers
- header
- note icon
- rails

status: scaffold only`;
}

/* Save */
document.getElementById("saveItem").onclick = ()=>{
  if(selectedIndex === null) return;
  const item = state[mode][selectedIndex];
  item.id = idField.value.trim();
  item.title = titleField.value.trim();
  item.tags = tagsField.value.split(",").map(s=>s.trim()).filter(Boolean);
  item.notes = notesField.value;
  save();
  renderRegistry();
};

/* New */
document.getElementById("newItem").onclick = ()=>{
  state[mode].push({ id:"", title:"", tags:[], notes:"" });
  save();
  renderRegistry();
};

/* Mode switch */
modeSelect.onchange = ()=>{
  mode = modeSelect.value;
  selectedIndex = null;
  idField.value = titleField.value = tagsField.value = notesField.value = "";
  outputEl.textContent = "(select an item)";
  renderRegistry();
};

/* Export */
document.getElementById("exportJSON").onclick = ()=>{
  const blob = new Blob([JSON.stringify(state,null,2)],{type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "ketadata.forge.json";
  a.click();
};

/* Export room */
document.getElementById("exportRoom").onclick = ()=>{
  if(selectedIndex===null || mode!=="rooms") return;
  const r = state.rooms[selectedIndex];
  const text =
`<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="/ketadata-core.css">
<script src="/ketadata-core.js"></script>
</head>
<body>
<h1>${r.title}</h1>
</body>
</html>`;
  outputEl.textContent = text;
};

/* System note */
systemNoteEl.value = state.systemNote || "";
noteIcon.onclick = ()=>{
  note.classList.toggle("open");
  noteIcon.classList.toggle("open");
};
systemNoteEl.oninput = ()=>{
  state.systemNote = systemNoteEl.value;
  save();
};

/* Init */
renderRegistry();
</script>
</body>
</html>
