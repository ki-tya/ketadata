<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KETA_MONO // GROTTO</title>
<style>
  :root{
    --bg:#000;
    --ink:rgba(255,255,255,.88);
    --muted:rgba(255,255,255,.54);
    --line:rgba(255,255,255,.14);
    --line2:rgba(255,255,255,.22);

    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;

    --top:44px;
    --pad:10px;
    --r:18px;

    --glow: 0 0 26px rgba(255,255,255,.10), 0 0 90px rgba(255,255,255,.06);
    --grainA:.055;
  }

  *{box-sizing:border-box}
  html,body{height:100%; margin:0; background:var(--bg); overflow:hidden; color:var(--ink); font-family:var(--mono)}
  #root{position:fixed; inset:0; background:#000}

  /* ===== TOP BAR (KETA_MONO) ===== */
  #top{
    position:fixed; left:0; right:0; top:0; height:var(--top);
    display:flex; align-items:center; justify-content:space-between;
    padding:0 var(--pad);
    background: linear-gradient(to bottom, rgba(0,0,0,.92), rgba(0,0,0,.30));
    border-bottom:1px solid var(--line);
    z-index:50;
    user-select:none;
  }
  .rail{
    display:flex; align-items:center; gap:10px;
    font-size:12px; line-height:1;
    white-space:nowrap;
  }
  .tag{
    padding:6px 8px;
    border:1px solid var(--line);
    background: rgba(0,0,0,.22);
  }
  .sep{opacity:.55}
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 8px;
    border:1px solid var(--line);
    background: rgba(0,0,0,.22);
  }
  .sq{
    width:10px;height:10px;
    border:1px solid rgba(255,255,255,.65);
    background: rgba(255,255,255,.08);
  }
  button.m{
    font:inherit; font-size:12px;
    padding:6px 8px;
    border:1px solid var(--line);
    background: rgba(0,0,0,.22);
    color:var(--ink);
    cursor:pointer;
  }
  button.m:active{transform: translateY(1px)}
  button.m[aria-pressed="true"]{border-color:rgba(255,255,255,.45); background: rgba(255,255,255,.06)}
  .readout{opacity:.78}

  /* ===== SCENE ===== */
  #scene{
    position:fixed; inset:var(--top) 0 0 0;
    display:grid; place-items:center;
  }
  #grotto{
    position:relative;
    width:min(1180px, calc(100vw - 28px));
    height:min(650px, calc(100vh - var(--top) - 22px));
    border-radius: var(--r);
    overflow:hidden;
    box-shadow: 0 18px 120px rgba(0,0,0,.72), var(--glow);
    background:#000;
  }

  /* Vignette */
  #grotto:before{
    content:"";
    position:absolute; inset:-1px;
    background:
      radial-gradient(1200px 700px at 60% 45%, transparent 55%, rgba(0,0,0,.55) 78%, rgba(0,0,0,.90) 100%),
      radial-gradient(900px 900px at 20% 110%, rgba(0,0,0,.60), rgba(0,0,0,.95));
    pointer-events:none;
    z-index:40;
    mix-blend-mode:multiply;
  }

  /* Cave mass (mono coral texture, but monochrome) */
  .cave{
    position:absolute;
    inset:-80px -120px -140px -120px;
    background:
      radial-gradient(520px 420px at 12% 18%, rgba(255,255,255,.10), transparent 72%),
      radial-gradient(680px 540px at 86% 30%, rgba(255,255,255,.06), transparent 74%),
      radial-gradient(980px 700px at 55% 0%, rgba(255,255,255,.05), transparent 70%),
      radial-gradient(900px 820px at 50% 100%, rgba(255,255,255,.05), transparent 75%),
      conic-gradient(from 40deg at 70% 35%,
        rgba(255,255,255,.10), rgba(255,255,255,.04), rgba(255,255,255,.08), rgba(255,255,255,.10));
    opacity:.95;
    z-index:6;
    mask-image:
      radial-gradient(1100px 650px at 55% 58%, rgba(0,0,0,0) 0%, rgba(0,0,0,0) 58%, rgba(0,0,0,1) 72%),
      radial-gradient(900px 560px at 20% 50%, rgba(0,0,0,0) 0%, rgba(0,0,0,0) 55%, rgba(0,0,0,1) 70%);
    mask-composite:add;
  }

  /* Underwater window (mono) */
  #water{
    position:absolute;
    left:-6%;
    top:-6%;
    width:56%;
    height:80%;
    border-radius: 40% 60% 58% 42% / 55% 45% 55% 45%;
    background:
      radial-gradient(900px 600px at 30% 20%, rgba(255,255,255,.12), transparent 70%),
      radial-gradient(900px 700px at 40% 60%, rgba(255,255,255,.06), transparent 70%),
      linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04) 60%, rgba(0,0,0,0) 100%);
    box-shadow:
      inset 0 0 70px rgba(0,0,0,.45),
      inset 0 0 120px rgba(255,255,255,.05),
      0 0 70px rgba(255,255,255,.05);
    z-index:8;
    overflow:hidden;
  }
  #water:before{
    content:"";
    position:absolute; inset:-30%;
    background:
      repeating-linear-gradient(120deg,
        rgba(255,255,255,.16) 0 6px,
        rgba(255,255,255,0) 6px 18px);
    opacity:.12;
    filter: blur(2px);
    animation: caustics 9s linear infinite;
    mix-blend-mode: screen;
  }
  #water:after{
    content:"";
    position:absolute; inset:0;
    background:
      radial-gradient(600px 420px at 52% 30%, rgba(255,255,255,.16), transparent 70%),
      radial-gradient(800px 500px at 35% 60%, rgba(255,255,255,.10), transparent 75%),
      radial-gradient(900px 700px at 60% 90%, rgba(0,0,0,.12), transparent 75%);
    opacity:.9;
    pointer-events:none;
  }
  @keyframes caustics{
    0%{transform: translate(-8%, -6%) rotate(0.5deg) scale(1.02)}
    50%{transform: translate(6%, 2%) rotate(-0.4deg) scale(1.05)}
    100%{transform: translate(-8%, -6%) rotate(0.5deg) scale(1.02)}
  }

  /* Plants silhouettes (mono) */
  .plant{
    position:absolute;
    bottom:6%;
    left:3%;
    width:34%;
    height:48%;
    opacity:.26;
    z-index:10;
    mix-blend-mode: overlay;
    filter: blur(.4px);
  }
  .plant:before,.plant:after{content:"";position:absolute;inset:0}
  .plant:before{
    background:
      radial-gradient(90px 260px at 15% 100%, rgba(0,0,0,.86), rgba(0,0,0,0) 70%),
      radial-gradient(120px 320px at 28% 100%, rgba(0,0,0,.78), rgba(0,0,0,0) 72%),
      radial-gradient(130px 340px at 45% 100%, rgba(0,0,0,.70), rgba(0,0,0,0) 74%),
      radial-gradient(130px 360px at 62% 100%, rgba(0,0,0,.62), rgba(0,0,0,0) 75%),
      radial-gradient(140px 380px at 80% 100%, rgba(0,0,0,.56), rgba(0,0,0,0) 76%);
  }
  .plant:after{
    background:
      radial-gradient(240px 240px at 22% 85%, rgba(255,255,255,.06), transparent 70%),
      radial-gradient(300px 280px at 68% 80%, rgba(255,255,255,.05), transparent 70%);
  }

  /* Glitter floor base (mono) */
  #floor{
    position:absolute;
    left:0; right:0; bottom:-14%;
    height:52%;
    background:
      radial-gradient(900px 420px at 60% 30%, rgba(255,255,255,.09), transparent 70%),
      radial-gradient(900px 520px at 40% 40%, rgba(255,255,255,.06), transparent 75%),
      linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.62));
    z-index:16;
    transform: perspective(900px) rotateX(58deg);
    transform-origin: 50% 0%;
  }

  /* FX canvases */
  canvas{position:absolute; inset:0; width:100%; height:100%; display:block; pointer-events:none;}
  #fxA{z-index:12; mix-blend-mode: screen; filter: blur(.15px);}
  #fxB{z-index:18; mix-blend-mode: screen;}
  #fxC{z-index:30; mix-blend-mode: screen; opacity:.9;}

  /* Furniture (mono, glossy) */
  #lounge{
    position:absolute;
    right:6%;
    bottom:12%;
    width:54%;
    height:52%;
    z-index:22;
    pointer-events:none;
    opacity:.95;
  }

  #couch{
    position:absolute;
    right:0;
    bottom:0;
    width:70%;
    height:48%;
    border-radius: 18px 18px 22px 22px;
    background:
      radial-gradient(140px 120px at 25% 35%, rgba(255,255,255,.14), transparent 70%),
      radial-gradient(220px 160px at 80% 35%, rgba(255,255,255,.10), transparent 72%),
      linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,.10));
    box-shadow:
      inset 0 0 0 1px rgba(255,255,255,.18),
      inset 0 -22px 40px rgba(0,0,0,.28),
      0 12px 70px rgba(255,255,255,.06);
  }
  #couch:before{
    content:"";
    position:absolute; inset:12% 8% 18% 8%;
    background:
      radial-gradient(10px 10px at 12% 40%, rgba(255,255,255,.18), transparent 70%),
      radial-gradient(10px 10px at 26% 48%, rgba(255,255,255,.14), transparent 70%),
      radial-gradient(10px 10px at 40% 40%, rgba(255,255,255,.16), transparent 70%),
      radial-gradient(10px 10px at 54% 50%, rgba(255,255,255,.12), transparent 70%),
      radial-gradient(10px 10px at 68% 42%, rgba(255,255,255,.14), transparent 70%),
      radial-gradient(10px 10px at 82% 50%, rgba(255,255,255,.12), transparent 70%);
    opacity:.55;
    filter: blur(.2px);
  }
  #table{
    position:absolute;
    right:16%;
    bottom:8%;
    width:36%;
    height:18%;
    border-radius: 14px;
    background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    box-shadow:
      inset 0 0 0 1px rgba(255,255,255,.14),
      0 10px 50px rgba(255,255,255,.05);
    backdrop-filter: blur(3px);
  }
  #glass1,#glass2{
    position:absolute;
    bottom:11%;
    width:20px;height:38px;border-radius: 6px 6px 10px 10px;
    background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.04));
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.16), 0 0 26px rgba(255,255,255,.05);
    opacity:.78;
  }
  #glass1{right:30%;}
  #glass2{right:24%; height:34px; opacity:.65;}

  .lamp{
    position:absolute;
    width:14%;
    height:46%;
    bottom:8%;
    opacity:.86;
  }
  .lamp .shade{
    position:absolute; left:18%; right:18%; top:0;
    height:36%;
    border-radius: 10px;
    background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.05));
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.14), 0 0 70px rgba(255,255,255,.06);
  }
  .lamp .stem{
    position:absolute; left:48%; top:34%; width:4%;
    height:40%;
    background: rgba(255,255,255,.10);
  }
  .lamp .base{
    position:absolute; left:24%; right:24%; bottom:0;
    height:16%;
    border-radius: 10px;
    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.12);
  }
  .lamp .shade:after{
    content:"";
    position:absolute; inset:-30%;
    background: radial-gradient(circle, rgba(255,255,255,.12), rgba(255,255,255,0) 65%);
    filter: blur(10px);
  }
  #lampL{left:14%;}
  #lampR{right:0%;}

  /* Frames (mono) */
  #frames{
    position:absolute;
    right:6%;
    top:10%;
    width:56%;
    height:42%;
    z-index:20;
    opacity:.85;
    pointer-events:none;
  }
  .frame{
    position:absolute;
    border:1px solid rgba(255,255,255,.22);
    background: rgba(0,0,0,.12);
    box-shadow: 0 0 34px rgba(255,255,255,.05);
    backdrop-filter: blur(2px);
  }
  .frame:before{
    content:"";
    position:absolute; inset:8px;
    background:
      radial-gradient(110px 90px at 30% 40%, rgba(255,255,255,.08), transparent 70%),
      radial-gradient(120px 110px at 70% 60%, rgba(255,255,255,.06), transparent 75%),
      radial-gradient(140px 120px at 40% 70%, rgba(255,255,255,.05), transparent 70%);
    opacity:.9;
    filter: blur(1px);
  }
  .f1{right:0; top:6%; width:22%; height:52%;}
  .f2{right:26%; top:24%; width:14%; height:36%;}
  .f3{right:44%; top:14%; width:16%; height:42%;}
  .f4{right:62%; top:32%; width:12%; height:28%;}

  /* Candles (mono) */
  #candles{
    position:absolute;
    left:8%;
    bottom:14%;
    width:40%;
    height:24%;
    z-index:24;
    pointer-events:none;
  }
  .candle{
    position:absolute; bottom:0;
    width:18px; height:56px;
    border-radius: 8px;
    background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.12), 0 0 22px rgba(255,255,255,.04);
    opacity:.86;
  }
  .candle .flame{
    position:absolute; left:50%; top:-18px;
    width:10px; height:18px;
    transform: translateX(-50%);
    border-radius: 9px;
    background: radial-gradient(circle at 50% 30%, rgba(255,255,255,.90), rgba(255,255,255,.45) 45%, rgba(255,255,255,0) 72%);
    animation: flicker 900ms infinite ease-in-out;
    mix-blend-mode: screen;
  }
  .candle .halo{
    position:absolute; left:50%; top:-42px;
    width:70px; height:70px;
    transform: translateX(-50%);
    background: radial-gradient(circle, rgba(255,255,255,.12), rgba(255,255,255,0) 70%);
    filter: blur(3px);
    opacity:.9;
    animation: breathe 3.2s infinite ease-in-out;
  }
  @keyframes flicker{
    0%,100%{transform: translateX(-50%) scaleY(1) rotate(-1deg); opacity:.95}
    30%{transform: translateX(-50%) scaleY(.92) rotate(1deg); opacity:.70}
    55%{transform: translateX(-50%) scaleY(1.08) rotate(-2deg); opacity:.92}
    80%{transform: translateX(-50%) scaleY(.96) rotate(2deg); opacity:.80}
  }
  @keyframes breathe{
    0%,100%{opacity:.85; transform: translateX(-50%) scale(1)}
    50%{opacity:.55; transform: translateX(-50%) scale(1.08)}
  }

  /* Grain */
  #grain{
    position:absolute; inset:-20%;
    background-image:
      radial-gradient(circle at 20% 30%, rgba(255,255,255,var(--grainA)) 0 1px, transparent 2px),
      radial-gradient(circle at 70% 40%, rgba(255,255,255,var(--grainA)) 0 1px, transparent 2px),
      radial-gradient(circle at 40% 70%, rgba(255,255,255,var(--grainA)) 0 1px, transparent 2px);
    background-size: 120px 120px;
    opacity:.5;
    filter: blur(0.6px);
    z-index:38;
    mix-blend-mode: overlay;
    animation: grainMove 6s linear infinite;
    pointer-events:none;
  }
  @keyframes grainMove{
    0%{transform: translate3d(0,0,0)}
    100%{transform: translate3d(-80px, 60px, 0)}
  }

  /* Stamp (KETA_MONO law) */
  #stamp{
    position:absolute;
    left:10px; right:10px; bottom:10px;
    display:flex; justify-content:space-between; gap:10px;
    padding:8px 10px;
    border:1px solid var(--line);
    background: rgba(0,0,0,.22);
    z-index:60;
    font-size:12px;
    line-height:1.2;
    opacity:.92;
    user-select:none;
    backdrop-filter: blur(6px);
  }
  #stamp .right{opacity:.72; text-align:right}

  /* reduced motion */
  body.rm *{animation:none !important}
</style>
</head>
<body>
<div id="root">

  <div id="top">
    <div class="rail">
      <span class="tag">KETA_MONO</span>
      <span class="sep">::</span>
      <span class="tag">GROTTO</span>
      <span class="sep">::</span>
      <span class="pill"><span class="sq"></span><span id="lux">LUX=56</span></span>
    </div>

    <div class="rail">
      <button class="m" id="rm" aria-pressed="false">MOTION</button>
      <span class="sep">::</span>
      <span class="readout" id="sig">AE/EE/WB</span>
    </div>
  </div>

  <div id="scene">
    <div id="grotto">
      <div class="cave"></div>

      <div id="water"></div>
      <div class="plant"></div>

      <div id="floor"></div>

      <canvas id="fxA"></canvas>
      <canvas id="fxB"></canvas>
      <canvas id="fxC"></canvas>

      <div id="frames">
        <div class="frame f1"></div>
        <div class="frame f2"></div>
        <div class="frame f3"></div>
        <div class="frame f4"></div>
      </div>

      <div id="candles"></div>

      <div id="lounge">
        <div class="lamp" id="lampL"><div class="shade"></div><div class="stem"></div><div class="base"></div></div>
        <div id="couch"></div>
        <div id="table"></div>
        <div id="glass1"></div><div id="glass2"></div>
        <div class="lamp" id="lampR"><div class="shade"></div><div class="stem"></div><div class="base"></div></div>
      </div>

      <div id="grain"></div>

      <div id="stamp">
        <div>AE-KETA_MONO_GROTTO :: FILE_ID=KM_GROTTO_01 :: ROOM_ID=GROTTO</div>
        <div class="right">VERSION=1 :: UPDATED_AT=<span id="ts"></span> :: CHANGELOG=INIT</div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const $ = (id)=>document.getElementById(id);
  const grotto = $("grotto");

  // timestamp
  const iso = new Date().toISOString();
  $("ts").textContent = iso;

  // candles
  const candles = $("candles");
  const slots = [
    {x: 6,  h: 52},{x: 12, h: 62},{x: 18, h: 46},{x: 26, h: 58},
    {x: 34, h: 44},{x: 44, h: 54},{x: 54, h: 48},{x: 64, h: 60},
    {x: 76, h: 46}
  ];
  slots.forEach((s)=>{
    const c=document.createElement("div");
    c.className="candle";
    c.style.left = s.x+"%";
    c.style.height = s.h+"px";
    c.style.opacity = (0.72 + Math.random()*0.22).toFixed(2);
    const halo=document.createElement("div");
    halo.className="halo";
    halo.style.animationDelay = (-Math.random()*2.5)+"s";
    const flame=document.createElement("div");
    flame.className="flame";
    flame.style.animationDelay = (-Math.random()*0.9)+"s";
    c.appendChild(halo);
    c.appendChild(flame);
    candles.appendChild(c);
  });

  // motion toggle
  const rmBtn = $("rm");
  rmBtn.addEventListener("click", ()=>{
    const on = document.body.classList.toggle("rm");
    rmBtn.setAttribute("aria-pressed", on ? "true":"false");
  });

  // canvas fit
  function fitCanvas(c){
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio||1));
    const r = grotto.getBoundingClientRect();
    c.width = Math.floor(r.width * dpr);
    c.height = Math.floor(r.height * dpr);
    const ctx = c.getContext("2d");
    ctx.setTransform(dpr,0,0,dpr,0,0);
    return {ctx, w:r.width, h:r.height};
  }

  const A = $("fxA"), B = $("fxB"), C = $("fxC");
  let a=fitCanvas(A), b=fitCanvas(B), c=fitCanvas(C);

  window.addEventListener("resize", ()=>{
    a=fitCanvas(A); b=fitCanvas(B); c=fitCanvas(C);
  }, {passive:true});

  const rand = (n=1)=>Math.random()*n;
  const clamp = (x,lo,hi)=>Math.max(lo,Math.min(hi,x));

  // mono spark layers (all white)
  function makeSpark(count, layer){
    const arr=[];
    for(let i=0;i<count;i++){
      arr.push({
        x: rand(a.w),
        y: rand(a.h),
        r: layer===0 ? (0.6+rand(1.2)) : layer===1 ? (0.8+rand(1.6)) : (1.0+rand(2.4)),
        vx: (rand(1)-0.5) * (layer===2 ? 0.10 : 0.06),
        vy: (rand(1)-0.5) * (layer===2 ? 0.08 : 0.05),
        tw: 0.6 + rand(1.6),
        ph: rand(Math.PI*2),
        a: layer===0 ? (0.08+rand(0.18)) : layer===1 ? (0.10+rand(0.24)) : (0.14+rand(0.30)),
        z: layer
      });
    }
    return arr;
  }
  const dust = makeSpark(420,0);
  const floor = makeSpark(900,1);
  const twk  = makeSpark(120,2);

  // orbs (mono)
  const orbs = Array.from({length:10}, ()=>({
    x: rand(a.w),
    y: rand(a.h),
    r: 60+rand(180),
    vx: (rand(1)-0.5)*0.03,
    vy: (rand(1)-0.5)*0.02,
    a: 0.04+rand(0.07),
    t: 2+rand(3),
    ph: rand(Math.PI*2)
  }));

  function drawOrbs(ctx, w, h, t){
    for(const o of orbs){
      o.x += o.vx*16; o.y += o.vy*16;
      if(o.x<-200) o.x=w+200; if(o.x>w+200) o.x=-200;
      if(o.y<-200) o.y=h+200; if(o.y>h+200) o.y=-200;

      const pulse = 0.55 + 0.45*Math.sin((t/1000)*(1/o.t) + o.ph);
      const a0 = o.a * pulse;
      const g = ctx.createRadialGradient(o.x,o.y,0,o.x,o.y,o.r);
      g.addColorStop(0, `rgba(255,255,255,${a0})`);
      g.addColorStop(0.55, `rgba(255,255,255,${a0*0.22})`);
      g.addColorStop(1, `rgba(255,255,255,0)`);
      ctx.fillStyle=g;
      ctx.fillRect(o.x-o.r, o.y-o.r, o.r*2, o.r*2);
    }
  }

  function drawSparks(ctx, w, h, t, arr, floorBias){
    ctx.globalCompositeOperation="lighter";
    for(const p of arr){
      p.x += p.vx*16;
      p.y += p.vy*16;
      if(p.x<0) p.x+=w; if(p.x>w) p.x-=w;
      if(p.y<0) p.y+=h; if(p.y>h) p.y-=h;

      let yy = p.y;
      if(floorBias){
        const k = 0.35 + 0.65*Math.pow(clamp((p.y/h),0,1), 1.6);
        yy = p.y*(0.55) + (h*(0.62 + 0.38*k))*0.45;
      }

      const tw = 0.35 + 0.65*Math.sin((t/1000)*p.tw + p.ph);
      const alpha = clamp(p.a * (0.35 + 0.85*tw), 0, 1);

      const rr = p.r * (0.75 + 0.85*tw);
      const g = ctx.createRadialGradient(p.x,yy,0,p.x,yy,rr*2.2);
      g.addColorStop(0, `rgba(255,255,255,${alpha})`);
      g.addColorStop(0.35, `rgba(255,255,255,${alpha*0.45})`);
      g.addColorStop(1, `rgba(255,255,255,0)`);
      ctx.fillStyle=g;
      ctx.beginPath();
      ctx.arc(p.x,yy,rr*2.0,0,Math.PI*2);
      ctx.fill();

      if(alpha>0.34 && Math.random()<0.016){
        ctx.fillStyle = `rgba(255,255,255,${alpha*0.45})`;
        ctx.fillRect(p.x-0.5, yy-0.5, 1, 1);
      }
    }
    ctx.globalCompositeOperation="source-over";
  }

  // caustic shimmer overlay (mono)
  function drawCaustic(ctx, w, h, t){
    const tt = t/1000;
    ctx.globalCompositeOperation="lighter";
    ctx.lineWidth = 1.2;
    ctx.strokeStyle = "rgba(255,255,255,0.06)";
    for(let i=0;i<28;i++){
      const y = (h*0.10) + i*(h*0.018) + Math.sin(tt*0.9 + i)*6;
      ctx.beginPath();
      for(let x=-40;x<w+40;x+=16){
        const yy = y + Math.sin(tt*1.6 + x*0.01 + i*0.5)*6 + Math.cos(tt*1.1 + x*0.02)*4;
        ctx.lineTo(x,yy);
      }
      ctx.stroke();
    }
    const g = ctx.createRadialGradient(w*0.26,h*0.18,0,w*0.26,h*0.18,Math.min(w,h)*0.6);
    g.addColorStop(0, "rgba(255,255,255,0.08)");
    g.addColorStop(0.55, "rgba(255,255,255,0.03)");
    g.addColorStop(1, "rgba(255,255,255,0)");
    ctx.fillStyle=g;
    ctx.fillRect(0,0,w,h);
    ctx.globalCompositeOperation="source-over";
  }

  function loop(t){
    // A: ambient glow + dust
    a.ctx.clearRect(0,0,a.w,a.h);
    drawOrbs(a.ctx, a.w, a.h, t);
    drawSparks(a.ctx, a.w, a.h, t, dust, false);

    // B: floor glitter
    b.ctx.clearRect(0,0,b.w,b.h);
    drawSparks(b.ctx, b.w, b.h, t, floor, true);

    // C: caustic + twinkles
    c.ctx.clearRect(0,0,c.w,c.h);
    drawCaustic(c.ctx, c.w, c.h, t);

    c.ctx.globalCompositeOperation="lighter";
    for(const p of twk){
      p.x += p.vx*22; p.y += p.vy*18;
      if(p.x<0) p.x+=c.w; if(p.x>c.w) p.x-=c.w;
      if(p.y<0) p.y+=c.h; if(p.y>c.h) p.y-=c.h;

      const tw = 0.3 + 0.7*Math.sin((t/1000)*p.tw + p.ph);
      const alpha = clamp(0.10 + tw*0.42, 0, 1);

      const rr = 1.2 + tw*2.8;
      const g = c.ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,rr*6);
      g.addColorStop(0, `rgba(255,255,255,${alpha})`);
      g.addColorStop(0.28, `rgba(255,255,255,${alpha*0.28})`);
      g.addColorStop(1, `rgba(255,255,255,0)`);
      c.ctx.fillStyle=g;
      c.ctx.beginPath();
      c.ctx.arc(p.x,p.y,rr*5,0,Math.PI*2);
      c.ctx.fill();

      if(alpha>0.50){
        c.ctx.fillStyle=`rgba(255,255,255,${alpha*0.45})`;
        c.ctx.fillRect(p.x-0.5,p.y-0.5,1,1);
      }
    }
    c.ctx.globalCompositeOperation="source-over";

    // readouts
    const lux = (Math.sin((t/1000)*0.75)*0.5+0.5);
    $("lux").textContent = "LUX=" + (lux*100).toFixed(0);
    $("sig").textContent = "AE/EE/WB :: KM_GROTTO_01 :: " + iso.slice(0,10);

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
})();
</script>

<!--
AE :: KETA_MONO GROTTO (MONOCHROME GLITTER CAVE)
EE :: 3-LAYER CANVAS (AMBIENT / FLOOR / CAUSTIC+TWINKLE)
WB :: SINGLE-FILE / NO NETWORK

FILE_ID: KM_GROTTO_01
ROOM_ID: GROTTO
VERSION: 1
UPDATED_AT: 2026-01-08
CHANGELOG:
- INIT: MONO GROTTO + WATER WINDOW + GLITTER FLOOR + FURNITURE SILHOUETTE
-->
</body>
</html>
