<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KETADATA // KDTV CINEMA (SHELL8)</title>
  <style>
    :root{
      --bg:#000;
      --panel: rgba(255,255,255,.035);
      --panel2: rgba(255,255,255,.02);
      --line: rgba(255,255,255,.08);
      --line2: rgba(255,255,255,.14);
      --text:#f2f2f2;
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.42);
      --red: #ff2a2a;
      --red2: rgba(255,42,42,.55);
      --radius: 14px;
      --radius2: 10px;
      --shadow: 0 12px 40px rgba(0,0,0,.55);
      --shadow2: 0 10px 28px rgba(0,0,0,.45);
      --gridCols: 3;
      --gridGap: 10px;
      --tileMinH: 220px;
    }
    html,body{
      width:100%;
      height:100%;
      margin:0;
      background: var(--bg);
      color: var(--text);
      font-family: Arial, Helvetica, sans-serif;
      overflow:hidden;
    }
    *{ box-sizing:border-box; }
    button, input, select, textarea{ font-family:inherit; }
    a{ color: inherit; }

    .wrap{
      position:fixed;
      inset:0;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap: 12px;
      padding: 12px;
      background: radial-gradient(120% 90% at 50% 50%, rgba(0,0,0,0) 0%, rgba(0,0,0,.88) 72%);
    }
    .left{
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: var(--panel);
      box-shadow: var(--shadow2);
      padding: 12px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      gap: 10px;
      min-height: 0;
    }
    .right{
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,255,255,.02);
      box-shadow: var(--shadow2);
      overflow:hidden;
      position:relative;
      min-height: 0;
    }

    .topbar{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      background: rgba(0,0,0,.35);
    }
    .brand{
      font-size: 12px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .dot{
      width:8px;
      height:8px;
      border-radius:50%;
      background: var(--red);
      box-shadow: 0 0 22px rgba(255,42,42,.65);
    }
    .modePills{ margin-left:auto; display:flex; gap:8px; }
    .pill{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 11px;
      letter-spacing: .12em;
      text-transform: uppercase;
      cursor:pointer;
      user-select:none;
    }
    .pill.active{
      border-color: var(--line2);
      background: rgba(255,42,42,.08);
      color: var(--text);
    }

    .hero{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      background:#000;
    }
    .heroHead{
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      gap: 10px;
      background: rgba(0,0,0,.35);
    }
    .heroTitle{
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      flex: 1;
    }
    .heroBody{
      position:relative;
      flex:1;
      min-height:0;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .playerFrame{
      width: 100%;
      height: 100%;
      border:0;
      background:#000;
    }
    .localVideo{
      width:100%;
      height:100%;
      object-fit: cover;
      background:#000;
      display:block;
    }
    .fx{
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(70% 60% at 50% 40%, rgba(255,255,255,.04) 0%, rgba(0,0,0,0) 58%),
        radial-gradient(120% 90% at 50% 50%, rgba(0,0,0,0) 0%, rgba(0,0,0,.88) 72%);
      mix-blend-mode: screen;
      opacity: .55;
    }

    .section{
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      background: rgba(0,0,0,.22);
      overflow:hidden;
    }
    .sectionHead{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 10px;
      border-bottom: 1px solid var(--line);
      user-select:none;
    }
    .sectionTitle{
      font-size: 11px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted);
      flex:1;
    }
    .sectionBody{ padding: 10px; }
    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap: 8px; }
    .row{ display:flex; gap:8px; align-items:center; margin: 8px 0; }
    .row label{
      width: 100px;
      font-size: 11px;
      letter-spacing: .10em;
      color: var(--muted2);
      text-transform: uppercase;
    }
    input[type="text"], select{
      flex: 1;
      background: rgba(0,0,0,.35);
      border: 1px solid var(--line);
      border-radius: 10px;
      color: var(--text);
      padding: 9px 10px;
      font-size: 12px;
      outline:none;
    }
    input[type="text"]::placeholder{ color: rgba(255,255,255,.35); }
    .btnRow{ display:flex; gap: 8px; flex-wrap:wrap; }
    .btn{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 11px;
      letter-spacing: .12em;
      text-transform: uppercase;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{ border-color: var(--line2); }
    .btn.red{
      border-color: rgba(255,42,42,.25);
      background: rgba(255,42,42,.10);
    }
    .hint{
      font-size: 11px;
      color: var(--muted2);
      letter-spacing: .06em;
      line-height: 1.35;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap: 6px;
    }
    .chip{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 11px;
      letter-spacing: .08em;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      border-color: var(--line2);
      background: rgba(255,42,42,.08);
      color: var(--text);
    }

    .cards{
      display:grid;
      grid-template-columns: 1fr;
      gap: 8px;
      max-height: 240px;
      overflow:auto;
      padding-right: 4px;
    }
    .card{
      border: 1px solid var(--line);
      border-radius: 12px;
      background: rgba(0,0,0,.25);
      padding: 10px;
      cursor:pointer;
      user-select:none;
    }
    .card:hover{ border-color: var(--line2); }
    .card .t{
      font-size: 11px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: var(--text);
      margin-bottom: 6px;
    }
    .card .m{
      font-size: 11px;
      color: var(--muted2);
      letter-spacing: .06em;
      line-height:1.25;
    }

    .multi{
      position:absolute;
      inset:0;
      display:none;
      flex-direction:column;
      background:#000;
    }
    .multiHead{
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      gap: 10px;
      background: rgba(0,0,0,.35);
    }
    .multiTitle{
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted);
      flex:1;
    }
    .multiBody{
      position:relative;
      flex:1;
      min-height:0;
      overflow:auto;
      padding: 10px;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(var(--gridCols), 1fr);
      gap: var(--gridGap);
      align-items:stretch;
    }
    .tile{
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(0,0,0,.28);
      overflow:hidden;
      min-height: var(--tileMinH);
      display:flex;
      flex-direction:column;
    }
    .tileHead{
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-bottom: 1px solid var(--line);
      background: rgba(0,0,0,.35);
      user-select:none;
    }
    .tileHead .name{
      flex:1;
      font-size: 10px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--muted);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .tileHead .miniBtn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      padding: 6px 8px;
      border-radius: 999px;
      font-size: 10px;
      letter-spacing:.12em;
      cursor:pointer;
      user-select:none;
    }
    .tileHead .miniBtn:hover{ border-color: var(--line2); }
    .tileBody{
      position:relative;
      flex:1;
      min-height:0;
      background:#000;
    }
    .tileBody iframe{
      width:100%;
      height:100%;
      border:0;
      background:#000;
    }
    .tileBody video{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      background:#000;
    }
    .drawer{
      border-top: 1px solid var(--line);
      background: rgba(0,0,0,.25);
      padding: 10px;
      display:none;
    }
    .drawer.open{ display:block; }
    .sliders{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .srow{
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .srow span{
      width: 90px;
      font-size: 10px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: var(--muted2);
    }
    .srow input[type="range"]{ width: 100%; }

    .footerNote{
      margin-top:auto;
      padding: 10px;
      font-size: 11px;
      color: var(--muted2);
      letter-spacing: .06em;
      border-top: 1px solid var(--line);
      background: rgba(0,0,0,.22);
    }

    /* scrollbars */
    ::-webkit-scrollbar{ width: 10px; height: 10px; }
    ::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.10); border-radius: 999px; border: 2px solid rgba(0,0,0,.35);}
    ::-webkit-scrollbar-track{ background: rgba(0,0,0,.25); }

    /* === SHELL8 UNIVERSALS (MEMBRANE) === */
    body.keta_invert{
      filter: invert(1);
    }
    /* lights overlay (1–6) */
    .keta_lights{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:55;
      opacity:0;
      transition: opacity 80ms linear;
      mix-blend-mode: screen;
    }
    .keta_lights::before{
      content:"";
      position:absolute; inset:-20%;
      background:
        radial-gradient(70% 60% at 50% 40%, rgba(255,255,255,.05) 0%, rgba(0,0,0,0) 58%),
        radial-gradient(circle at 18% 22%, rgba(255,255,255,.12), rgba(0,0,0,0) 48%),
        radial-gradient(circle at 72% 34%, rgba(255,255,255,.09), rgba(0,0,0,0) 52%),
        radial-gradient(circle at 44% 78%, rgba(255,255,255,.08), rgba(0,0,0,0) 56%),
        linear-gradient(90deg, rgba(255,255,255,.05) 1px, rgba(0,0,0,0) 1px),
        linear-gradient(0deg,  rgba(255,255,255,.05) 1px, rgba(0,0,0,0) 1px);
      background-size: auto, auto, auto, auto, 140px 140px, 140px 140px;
      filter: blur(.6px);
      transform: translateZ(0);
    }
    .keta_lights[data-lvl="0"]{ opacity:0; }
    .keta_lights[data-lvl="1"]{ opacity:.14; }
    .keta_lights[data-lvl="2"]{ opacity:.28; }
    .keta_lights[data-lvl="3"]{ opacity:.42; }
    .keta_lights[data-lvl="4"]{ opacity:.56; }
    .keta_lights[data-lvl="5"]{ opacity:.70; }
    .keta_lights[data-lvl="6"]{ opacity:.84; }

  </style>
</head>
<body>

  <div class="wrap">

    <div class="left">
      <div class="topbar">
        <div class="brand"><span class="dot"></span> KETADATA // KDTV CINEMA</div>
        <div class="modePills">
          <div class="pill active" id="pillHero">HERO</div>
          <div class="pill" id="pillMulti">MULTI</div>
        </div>
      </div>

      <div class="section">
        <div class="sectionHead">
          <div class="sectionTitle">HERO SOURCE</div>
        </div>
        <div class="sectionBody">
          <div class="row">
            <label>YT ID</label>
            <input type="text" id="ytId" placeholder="YouTube video id (e.g. M7lc1UVf-VE)" />
          </div>
          <div class="row">
            <label>TITLE</label>
            <input type="text" id="heroTitle" placeholder="Optional label" />
          </div>
          <div class="btnRow">
            <button class="btn red" id="loadYT">LOAD YT</button>
            <button class="btn" id="pickLocalHero">LOAD LOCAL</button>
            <button class="btn" id="stopHero">STOP</button>
          </div>
          <div class="hint" style="margin-top:8px;">
            NOTE: Local video works per-session. Exports will drop blob URLs.
          </div>
        </div>
      </div>

      <div class="section">
        <div class="sectionHead">
          <div class="sectionTitle">HERO FX</div>
        </div>
        <div class="sectionBody">
          <div class="sliders" id="heroFxSliders"></div>
          <div class="btnRow" style="margin-top:8px;">
            <button class="btn" id="resetHeroFx">RESET</button>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="sectionHead">
          <div class="sectionTitle">LIBRARY FILTER</div>
        </div>
        <div class="sectionBody">
          <div class="row">
            <label>SEARCH</label>
            <input type="text" id="search" placeholder="type to filter..." />
          </div>
          <div class="grid2">
            <div class="row" style="margin:0;">
              <label>CATEGORY</label>
              <select id="category"></select>
            </div>
            <div class="row" style="margin:0;">
              <label>TAG</label>
              <select id="tag"></select>
            </div>
          </div>
          <div class="chips" id="chips" style="margin-top:8px;"></div>
        </div>
      </div>

      <div class="section" style="min-height:0;">
        <div class="sectionHead">
          <div class="sectionTitle">LIBRARY</div>
        </div>
        <div class="sectionBody" style="min-height:0;">
          <div class="cards" id="cards"></div>
        </div>
      </div>

      <div class="section">
        <div class="sectionHead">
          <div class="sectionTitle">EXPORT / IMPORT</div>
        </div>
        <div class="sectionBody">
          <div class="btnRow">
            <button class="btn" id="exportBtn">EXPORT HERO/FILTER</button>
            <button class="btn" id="importBtn">IMPORT HERO/FILTER</button>
          </div>
          <div class="sep" style="height:1px;background:var(--line);margin:10px 0;"></div>
          <div class="btnRow">
            <button class="btn" id="exportMulti">EXPORT MULTI</button>
            <button class="btn" id="importMulti">IMPORT MULTI</button>
          </div>
          <div class="hint" style="margin-top:8px;">
            Exports include SHELL8 membrane (LIGHTS + INVERT).
          </div>
        </div>
      </div>

      <div class="footerNote">
        UNIVERSALS: 1–6 = LIGHTS. SHIFT+I = INVERT.
      </div>
    </div>

    <div class="right">
      <div class="hero" id="heroView">
        <div class="heroHead">
          <div class="heroTitle" id="heroTitleLive">NO SOURCE</div>
          <div class="btnRow">
            <button class="btn" id="toggleFx">FX</button>
          </div>
        </div>
        <div class="heroBody">
          <div id="heroMount" style="position:absolute;inset:0;"></div>
          <div class="fx"></div>

          <!-- SHELL8 LIGHTS MEMBRANE -->
          <div class="keta_lights" id="keta_lights" data-lvl="0" aria-hidden="true"></div>

        </div>
      </div>

      <div class="multi" id="multiView">
        <div class="multiHead">
          <div class="multiTitle">KDTV MULTI</div>
          <div class="btnRow">
            <button class="btn" id="addTile">ADD TILE</button>
            <button class="btn" id="clearTiles">CLEAR</button>
          </div>
        </div>
        <div class="multiBody">
          <div class="section" style="margin-bottom:10px;">
            <div class="sectionBody">
              <div class="grid2">
                <div class="row" style="margin:0;">
                  <label>COLS</label>
                  <input type="text" id="cols" value="3" />
                </div>
                <div class="row" style="margin:0;">
                  <label>GAP</label>
                  <input type="text" id="gap" value="10" />
                </div>
                <div class="row" style="margin:0;">
                  <label>MINH</label>
                  <input type="text" id="minh" value="220" />
                </div>
                <div class="row" style="margin:0;">
                  <label>SEARCH</label>
                  <input type="text" id="search2" placeholder="filter library..." />
                </div>
              </div>
              <div class="btnRow" style="margin-top:8px;">
                <button class="btn" id="applyGrid">APPLY GRID</button>
              </div>
            </div>
          </div>

          <div class="grid" id="grid"></div>
        </div>
      </div>
    </div>

  </div>

<script>
    /* ============================================================
       SHELL8 UNIVERSALS (INJECTED)
       - Hotkeys: 1–6 LIGHTS, SHIFT+I INVERT
       - Export/Import: bridges existing buttons to Shell8 hooks
       ============================================================ */

    const __SHELL8_SYSTEM__ = {
      SHELL: "SHELL8",
      FILE_ID: "KDTV_CINEMA_V1",
      ROOM_ID: "CINEMA",
      VERSION: "kdtv.cinema.shell8.v1",
      UPDATED_AT: "2025-12-24T00:00:00-05:00",
      AE: {
        palette: "BLACK/WHITE/GRAY",
        geometry: "ROUND-SHARP HYBRID (PILLS + HARD LINES)",
        overlays: ["FX_VIGNETTE_GRAIN", "LIGHTS_1-6", "INVERT_MEMBRANE"]
      },
      EE: {
        hero: ["YT_IFRAME", "LOCAL_MEDIA"],
        multi: ["GRID_COLS/GAP/MINH", "RESIZABLE_TILES", "PER_TILE_EFFECTS_DRAWER"],
        effects: ["CSS_FILTER_CHAIN", "PRESETS"],
        io: ["EXPORT_JSON", "IMPORT_JSON"]
      },
      WB: {
        command_map: {
          LIGHTS_1_6: "Digit1..Digit6",
          INVERT_TOGGLE: "Shift+KeyI"
        }
      }
    };

    const __SHELL8_STATE__ = { lightsLevel: 0, invert: false };

    function SHELL8_SET_LIGHTS(level){
      const lvl = Math.max(0, Math.min(6, Number(level)||0));
      __SHELL8_STATE__.lightsLevel = lvl;
      const el = document.getElementById("keta_lights");
      if(el) el.setAttribute("data-lvl", String(lvl));
    }

    function SHELL8_TOGGLE_INVERT(force){
      const next = (typeof force === "boolean") ? force : !__SHELL8_STATE__.invert;
      __SHELL8_STATE__.invert = next;
      document.body.classList.toggle("keta_invert", next);
    }

    function SHELL8_EXPORT(){
      const payload = {
        shell8: {
          membrane: { lightsLevel: __SHELL8_STATE__.lightsLevel, invert: __SHELL8_STATE__.invert },
          system: __SHELL8_SYSTEM__
        },
        kdtv: (typeof state !== "undefined") ? { hero: state.hero, filter: state.filter, multi: state.multi } : {}
      };
      return payload;
    }

    function SHELL8_IMPORT(obj){
      if(!obj || typeof obj !== "object") return false;
      try {
        const mem = obj.shell8?.membrane;
        if(mem) {
          if(typeof mem.lightsLevel !== "undefined") SHELL8_SET_LIGHTS(mem.lightsLevel);
          if(typeof mem.invert !== "undefined") SHELL8_TOGGLE_INVERT(!!mem.invert);
        }
        if(obj.kdtv) {
          if(obj.kdtv.hero) {
            state.hero = { ...state.hero, ...obj.kdtv.hero };
            if(state.hero.mode === "local") state.hero.mode = "yt";
            renderHeroFxUI();
            renderHeroPlayer({autoplay:false});
          }
          if(obj.kdtv.filter) {
            state.filter = { ...state.filter, ...obj.kdtv.filter };
            search.value = state.filter.q || "";
            search2.value = state.filter.q || "";
            renderChips();
            renderCards();
          }
          if(obj.kdtv.multi) {
            state.multi.cols = Number(obj.kdtv.multi.cols || state.multi.cols);
            state.multi.gap  = Number(obj.kdtv.multi.gap  || state.multi.gap);
            state.multi.minh = Number(obj.kdtv.multi.minh || state.multi.minh);
            state.multi.tiles = Array.isArray(obj.kdtv.multi.tiles) ? obj.kdtv.multi.tiles : state.multi.tiles;
            applyMultiVars();
            renderMulti();
          }
        }
        return true;
      } catch(e) {
        return false;
      }
    }

    Object.defineProperty(window, "__KETADATA__", {
      value: Object.freeze({
        SYSTEM: Object.freeze(__SHELL8_SYSTEM__),
        EXPORT: SHELL8_EXPORT,
        IMPORT: SHELL8_IMPORT,
        SET_LIGHTS: SHELL8_SET_LIGHTS,
        TOGGLE_INVERT: SHELL8_TOGGLE_INVERT
      }),
      writable:false, configurable:false, enumerable:false
    });

    window.addEventListener("keydown", (e)=>{
      if(e.repeat) return;
      if(/^Digit[1-6]$/.test(e.code)) {
        SHELL8_SET_LIGHTS(parseInt(e.code.slice(-1), 10));
        return;
      }
      if(e.code === "KeyI" && e.shiftKey) {
        SHELL8_TOGGLE_INVERT();
        return;
      }
    }, { passive:true });

    // ================= KDTV ORIGINAL SCRIPT (UNCHANGED) =================

    const heroMount = document.getElementById("heroMount");
    const heroTitleLive = document.getElementById("heroTitleLive");

    const pillHero = document.getElementById("pillHero");
    const pillMulti = document.getElementById("pillMulti");
    const heroView = document.getElementById("heroView");
    const multiView = document.getElementById("multiView");

    const ytId = document.getElementById("ytId");
    const heroTitle = document.getElementById("heroTitle");
    const loadYT = document.getElementById("loadYT");
    const pickLocalHero = document.getElementById("pickLocalHero");
    const stopHero = document.getElementById("stopHero");

    const search = document.getElementById("search");
    const search2 = document.getElementById("search2");
    const category = document.getElementById("category");
    const tag = document.getElementById("tag");
    const chips = document.getElementById("chips");
    const cards = document.getElementById("cards");

    const heroFxSliders = document.getElementById("heroFxSliders");
    const resetHeroFx = document.getElementById("resetHeroFx");
    const toggleFx = document.getElementById("toggleFx");

    const exportBtn = document.getElementById("exportBtn");
    const importBtn = document.getElementById("importBtn");
    const exportMulti = document.getElementById("exportMulti");
    const importMulti = document.getElementById("importMulti");

    const addTile = document.getElementById("addTile");
    const clearTiles = document.getElementById("clearTiles");
    const cols = document.getElementById("cols");
    const gap = document.getElementById("gap");
    const minh = document.getElementById("minh");
    const applyGrid = document.getElementById("applyGrid");
    const grid = document.getElementById("grid");

    const LIB = [
      { title:"BOOT / DEFAULT", yt:"M7lc1UVf-VE", cat:"Core", tag:"Boot", desc:"Default boot video id." },
      { title:"SYSTEM / SCREENS", yt:"dQw4w9WgXcQ", cat:"Core", tag:"System", desc:"Swap with your own." },
      { title:"OBS / MULTI", yt:"aqz-KE-bpKQ", cat:"Tools", tag:"Multi", desc:"Multi viewing reference." },
      { title:"VISUAL / TEST", yt:"5qap5aO4i9A", cat:"Visual", tag:"Ambient", desc:"Ambient stream placeholder." }
    ];

    const CATS = ["All", ...Array.from(new Set(LIB.map(x=>x.cat)))];
    const TAGS = ["All", ...Array.from(new Set(LIB.map(x=>x.tag)))];

    const state = {
      hero: {
        mode: "yt",
        ytId: "M7lc1UVf-VE",
        localUrl: null,
        title: "BOOT / DEFAULT",
        fx: {
          brightness: 1.0,
          contrast: 1.0,
          saturate: 1.0,
          hue: 0,
          blur: 0,
          grayscale: 0,
          invert: 0,
          sepia: 0
        }
      },
      filter: { q:"", category:"All", tag:"All" },
      ui: { fxOpen: false },
      multi: {
        cols: 3,
        gap: 10,
        minh: 220,
        tiles: []
      }
    };

    function applyHeroFx(el){
      const f = state.hero.fx;
      el.style.filter =
        `brightness(${f.brightness}) contrast(${f.contrast}) saturate(${f.saturate}) hue-rotate(${f.hue}deg) blur(${f.blur}px) grayscale(${f.grayscale}) invert(${f.invert}) sepia(${f.sepia})`;
    }

    function renderHeroPlayer({autoplay=false}={}){
      heroMount.innerHTML = "";
      if(state.hero.mode === "yt"){
        const src = `https://www.youtube.com/embed/${encodeURIComponent(state.hero.ytId)}?autoplay=${autoplay?1:0}&mute=0&controls=1&modestbranding=1&rel=0`;
        const iframe = document.createElement("iframe");
        iframe.className = "playerFrame";
        iframe.src = src;
        iframe.allow = "autoplay; encrypted-media; picture-in-picture";
        iframe.referrerPolicy = "no-referrer";
        heroMount.appendChild(iframe);
      } else {
        const v = document.createElement("video");
        v.className = "localVideo";
        v.src = state.hero.localUrl || "";
        v.controls = true;
        v.autoplay = autoplay;
        v.loop = true;
        v.playsInline = true;
        heroMount.appendChild(v);
        applyHeroFx(v);
      }
      heroTitleLive.textContent = state.hero.title || "UNTITLED";
      ytId.value = state.hero.ytId || "";
      heroTitle.value = state.hero.title || "";
      renderHeroFxUI();
    }

    function renderHeroFxUI(){
      heroFxSliders.innerHTML = "";
      const defs = [
        ["brightness", 0, 2, 0.01],
        ["contrast", 0, 2, 0.01],
        ["saturate", 0, 3, 0.01],
        ["hue", -180, 180, 1],
        ["blur", 0, 12, 0.1],
        ["grayscale", 0, 1, 0.01],
        ["invert", 0, 1, 0.01],
        ["sepia", 0, 1, 0.01]
      ];
      defs.forEach(([k,min,max,step])=>{
        const wrap = document.createElement("div");
        wrap.className = "srow";
        const label = document.createElement("span");
        label.textContent = k.toUpperCase();
        const slider = document.createElement("input");
        slider.type = "range";
        slider.min = min;
        slider.max = max;
        slider.step = step;
        slider.value = state.hero.fx[k];
        slider.addEventListener("input", ()=>{
          state.hero.fx[k] = Number(slider.value);
          // apply to hero
          const heroEl = heroMount.querySelector("video");
          if(heroEl) applyHeroFx(heroEl);
          // apply to all tiles
          renderMulti();
        });
        wrap.appendChild(label);
        wrap.appendChild(slider);
        heroFxSliders.appendChild(wrap);
      });
    }

    function resetHeroFxAll(){
      state.hero.fx = {
        brightness: 1.0,
        contrast: 1.0,
        saturate: 1.0,
        hue: 0,
        blur: 0,
        grayscale: 0,
        invert: 0,
        sepia: 0
      };
      renderHeroFxUI();
      const heroEl = heroMount.querySelector("video");
      if(heroEl) applyHeroFx(heroEl);
      renderMulti();
    }

    function renderChips(){
      chips.innerHTML = "";
      const pills = ["All", ...CATS.filter(x=>x!=="All")];
      pills.forEach(c=>{
        const b = document.createElement("div");
        b.className = "chip" + (state.filter.category===c ? " active":"");
        b.textContent = c;
        b.addEventListener("click", ()=>{
          state.filter.category = c;
          category.value = c;
          renderChips();
          renderCards();
        });
        chips.appendChild(b);
      });
    }

    function renderCards(){
      cards.innerHTML = "";
      const q = (state.filter.q || "").toLowerCase().trim();
      const cat = state.filter.category;
      const tg = state.filter.tag;

      LIB.filter(item=>{
        if(cat!=="All" && item.cat!==cat) return false;
        if(tg!=="All" && item.tag!==tg) return false;
        if(q && !(item.title.toLowerCase().includes(q) || item.desc.toLowerCase().includes(q))) return false;
        return true;
      }).forEach(item=>{
        const c = document.createElement("div");
        c.className = "card";
        c.innerHTML = `<div class="t">${item.title}</div><div class="m">${item.cat} / ${item.tag} — ${item.desc}</div>`;
        c.addEventListener("click", ()=>{
          state.hero.mode = "yt";
          state.hero.ytId = item.yt;
          state.hero.localUrl = null;
          state.hero.title = item.title;
          renderHeroPlayer({autoplay:false});
        });
        cards.appendChild(c);
      });
    }

    function applyMultiVars(){
      document.documentElement.style.setProperty("--gridCols", String(state.multi.cols));
      document.documentElement.style.setProperty("--gridGap", `${state.multi.gap}px`);
      document.documentElement.style.setProperty("--tileMinH", `${state.multi.minh}px`);
      cols.value = state.multi.cols;
      gap.value = state.multi.gap;
      minh.value = state.multi.minh;
    }

    function tileFilterStyle(fx){
      const f = fx || state.hero.fx;
      return `brightness(${f.brightness}) contrast(${f.contrast}) saturate(${f.saturate}) hue-rotate(${f.hue}deg) blur(${f.blur}px) grayscale(${f.grayscale}) invert(${f.invert}) sepia(${f.sepia})`;
    }

    function renderTile(tile, idx){
      const wrap = document.createElement("div");
      wrap.className = "tile";

      const head = document.createElement("div");
      head.className = "tileHead";
      const name = document.createElement("div");
      name.className = "name";
      name.textContent = tile.title || `TILE ${idx+1}`;
      const btnFx = document.createElement("div");
      btnFx.className = "miniBtn";
      btnFx.textContent = "FX";
      const btnDel = document.createElement("div");
      btnDel.className = "miniBtn";
      btnDel.textContent = "X";

      head.appendChild(name);
      head.appendChild(btnFx);
      head.appendChild(btnDel);

      const body = document.createElement("div");
      body.className = "tileBody";

      // mount
      if(tile.mode === "yt"){
        const iframe = document.createElement("iframe");
        iframe.src = `https://www.youtube.com/embed/${encodeURIComponent(tile.ytId)}?autoplay=0&mute=0&controls=1&modestbranding=1&rel=0`;
        iframe.allow = "autoplay; encrypted-media; picture-in-picture";
        iframe.referrerPolicy = "no-referrer";
        iframe.style.filter = tileFilterStyle(tile.fx || state.hero.fx);
        body.appendChild(iframe);
      } else {
        const v = document.createElement("video");
        v.src = tile.localUrl || "";
        v.controls = true;
        v.loop = true;
        v.playsInline = true;
        v.style.filter = tileFilterStyle(tile.fx || state.hero.fx);
        body.appendChild(v);
      }

      const drawer = document.createElement("div");
      drawer.className = "drawer" + (tile.fxOpen ? " open":"");

      // per-tile fx
      const defs = [
        ["brightness", 0, 2, 0.01],
        ["contrast", 0, 2, 0.01],
        ["saturate", 0, 3, 0.01],
        ["hue", -180, 180, 1],
        ["blur", 0, 12, 0.1],
        ["grayscale", 0, 1, 0.01],
        ["invert", 0, 1, 0.01],
        ["sepia", 0, 1, 0.01]
      ];
      const sliders = document.createElement("div");
      sliders.className = "sliders";
      const fx = tile.fx || JSON.parse(JSON.stringify(state.hero.fx));
      tile.fx = fx;

      defs.forEach(([k,min,max,step])=>{
        const srow = document.createElement("div");
        srow.className = "srow";
        const sp = document.createElement("span");
        sp.textContent = k.toUpperCase();
        const r = document.createElement("input");
        r.type = "range";
        r.min = min; r.max = max; r.step = step;
        r.value = fx[k];
        r.addEventListener("input", ()=>{
          fx[k] = Number(r.value);
          renderMulti();
        });
        srow.appendChild(sp);
        srow.appendChild(r);
        sliders.appendChild(srow);
      });

      const btnRow = document.createElement("div");
      btnRow.className = "btnRow";
      btnRow.style.marginTop = "8px";

      const reset = document.createElement("button");
      reset.className = "btn";
      reset.textContent = "RESET";
      reset.addEventListener("click", ()=>{
        tile.fx = JSON.parse(JSON.stringify(state.hero.fx));
        renderMulti();
      });

      const loadLocal = document.createElement("button");
      loadLocal.className = "btn";
      loadLocal.textContent = "LOCAL";
      loadLocal.addEventListener("click", ()=>{
        const input = document.createElement("input");
        input.type = "file";
        input.accept = "video/*";
        input.onchange = ()=>{
          const file = input.files && input.files[0];
          if(!file) return;
          tile.mode = "local";
          tile.localUrl = URL.createObjectURL(file);
          tile.ytId = "";
          tile.title = file.name;
          renderMulti();
        };
        input.click();
      });

      btnRow.appendChild(reset);
      btnRow.appendChild(loadLocal);

      drawer.appendChild(sliders);
      drawer.appendChild(btnRow);

      btnFx.addEventListener("click", ()=>{
        tile.fxOpen = !tile.fxOpen;
        renderMulti();
      });
      btnDel.addEventListener("click", ()=>{
        state.multi.tiles.splice(idx,1);
        renderMulti();
      });

      wrap.appendChild(head);
      wrap.appendChild(body);
      wrap.appendChild(drawer);
      return wrap;
    }

    function renderMulti(){
      grid.innerHTML = "";
      state.multi.tiles.forEach((t,i)=>{
        grid.appendChild(renderTile(t,i));
      });
    }

    function downloadJSON(obj, filename){
      const blob = new Blob([JSON.stringify(obj, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
      setTimeout(()=>URL.revokeObjectURL(a.href), 500);
    }

    function pickJSONFile(cb){
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "application/json";
      input.onchange = ()=>{
        const file = input.files && input.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = ()=>{
          try{
            const obj = JSON.parse(String(reader.result || "{}"));
            cb(obj);
          }catch(e){}
        };
        reader.readAsText(file);
      };
      input.click();
    }

    // UI wiring
    pillHero.addEventListener("click", ()=>{
      pillHero.classList.add("active");
      pillMulti.classList.remove("active");
      heroView.style.display = "flex";
      multiView.style.display = "none";
    });
    pillMulti.addEventListener("click", ()=>{
      pillMulti.classList.add("active");
      pillHero.classList.remove("active");
      multiView.style.display = "flex";
      heroView.style.display = "none";
    });

    loadYT.addEventListener("click", ()=>{
      const id = (ytId.value || "").trim();
      if(!id) return;
      state.hero.mode = "yt";
      state.hero.ytId = id;
      state.hero.localUrl = null;
      state.hero.title = (heroTitle.value || "").trim() || id;
      renderHeroPlayer({autoplay:false});
    });

    pickLocalHero.addEventListener("click", ()=>{
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "video/*";
      input.onchange = ()=>{
        const file = input.files && input.files[0];
        if(!file) return;
        state.hero.mode = "local";
        state.hero.localUrl = URL.createObjectURL(file);
        state.hero.title = (heroTitle.value || "").trim() || file.name;
        renderHeroPlayer({autoplay:true});
      };
      input.click();
    });

    stopHero.addEventListener("click", ()=>{
      heroMount.innerHTML = "";
      heroTitleLive.textContent = "STOPPED";
    });

    resetHeroFx.addEventListener("click", ()=> resetHeroFxAll());

    toggleFx.addEventListener("click", ()=>{
      state.ui.fxOpen = !state.ui.fxOpen;
      heroFxSliders.parentElement.style.display = state.ui.fxOpen ? "block" : "none";
    });
    // start closed by default
    heroFxSliders.parentElement.style.display = "none";

    search.addEventListener("input", ()=>{
      state.filter.q = search.value || "";
      renderCards();
    });
    search2.addEventListener("input", ()=>{
      state.filter.q = search2.value || "";
      search.value = state.filter.q;
      renderCards();
    });

    category.innerHTML = CATS.map(c=>`<option value="${c}">${c}</option>`).join("");
    tag.innerHTML = TAGS.map(t=>`<option value="${t}">${t}</option>`).join("");

    category.addEventListener("change", ()=>{
      state.filter.category = category.value;
      renderChips();
      renderCards();
    });
    tag.addEventListener("change", ()=>{
      state.filter.tag = tag.value;
      renderCards();
    });

    exportBtn.addEventListener("click", ()=>{ downloadJSON(window.__KETADATA__.EXPORT(), "kdtv_cinema_shell8.json"); });

    importBtn.addEventListener("click", ()=>{ pickJSONFile((obj)=>{ window.__KETADATA__.IMPORT(obj); }); });

    exportMulti.addEventListener("click", ()=>{
      // note: local blob URLs won't be portable across sessions
      const safeTiles = state.multi.tiles.map(t=>({
        ...t,
        localUrl: null,
        mode: t.mode === "local" ? "yt" : t.mode
      }));
      const payload = window.__KETADATA__.EXPORT();
      payload.kdtv = payload.kdtv || {};
      payload.kdtv.multi = { ...state.multi, tiles: safeTiles };
      downloadJSON(payload, "kdtv_multi_shell8.json");
    });

    importMulti.addEventListener("click", ()=>{ pickJSONFile((obj)=>{ window.__KETADATA__.IMPORT(obj); }); });

    addTile.addEventListener("click", ()=>{
      state.multi.tiles.push({
        mode:"yt",
        ytId: "M7lc1UVf-VE",
        localUrl: null,
        title: `TILE ${state.multi.tiles.length+1}`,
        fx: JSON.parse(JSON.stringify(state.hero.fx)),
        fxOpen: false
      });
      renderMulti();
    });
    clearTiles.addEventListener("click", ()=>{
      state.multi.tiles = [];
      renderMulti();
    });

    applyGrid.addEventListener("click", ()=>{
      state.multi.cols = Math.max(1, Math.min(6, parseInt(cols.value,10)||3));
      state.multi.gap  = Math.max(0, Math.min(40, parseInt(gap.value,10)||10));
      state.multi.minh = Math.max(120, Math.min(1000, parseInt(minh.value,10)||220));
      applyMultiVars();
      renderMulti();
    });

    // boot
    applyMultiVars();
    category.value = state.filter.category;
    tag.value = state.filter.tag;
    renderChips();
    renderCards();
    renderHeroPlayer({autoplay:false});
    renderMulti();
</script>

</body>

<!--
============================================================
KETADATA HTML SERIALIZATION STAMP

SHELL: SHELL8
MODE: VISUAL_OBJECT

FILE_ID: KDTV_CINEMA_V1
ROOM_ID: CINEMA
VERSION: kdtv.cinema.shell8.v1
UPDATED_AT: 2025-12-24T00:00:00-05:00

AE: BLACK FIELD + MINIMAL RED ACCENTS + SOFT FX VIGNETTE
EE: HERO PLAYER + MULTI GRID + EFFECTS DRAWERS + EXPORT/IMPORT
WB: SHELL8 UNIVERSALS (__KETADATA__) + UNIVERSAL HOTKEYS (1–6 LIGHTS, SHIFT+I INVERT)

CHANGELOG:
- 2025-12-24: SHELL8 UNIVERSALS ADDED WITHOUT CHANGING UI
============================================================
-->
</html>
