<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>KETADATA</title>

  <style>
    html, body{
      height:100%;
      margin:0;
      padding:0;
      overflow:hidden;
      background:black;
      color:white;
    }

    body{
      font-family: Arial, sans-serif;
      text-align:center;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: calc(10px + env(safe-area-inset-top)) calc(12px + env(safe-area-inset-right))
               calc(12px + env(safe-area-inset-bottom)) calc(12px + env(safe-area-inset-left));
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    h1{
      margin:0;
      font-weight:800;
      letter-spacing:0.02em;
      line-height:0.9;
      position:relative;
      z-index:10;
      width:100%;
    }

    /* KETADATA spans horizontal */
    #ketaWord{
      display:inline-flex;
      justify-content:center;
      align-items:baseline;
      width:96vw;
      max-width:1800px;
      font-size:clamp(7rem, 14vw, 17rem);
      cursor:pointer;
      position:relative;
    }

    /* fixed-width cells so "/" never shifts neighbors */
    #ketaWord .cell{
      flex:1 1 0;
      display:flex;
      justify-content:center;
      align-items:baseline;
      min-width:0;
    }
    #ketaWord .ch{
      display:inline-block;
      width:1ch;
      text-align:center;
      line-height:1;
      will-change: contents;
    }

    /* SINGLE-LINE SUBTITLE */
    .subtitle{
      margin-top:0.8rem;
      letter-spacing:0.32em;
      text-transform:uppercase;
      user-select:none;
      color:rgba(255,255,255,.26);
      font-size:clamp(0.55rem, 2.6vw, 0.9rem);
      line-height:1;
      margin-bottom:0;
      white-space:nowrap;
    }

    /* warning */
    #warning{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom: calc(18px + env(safe-area-inset-bottom));
      width:min(96vw, 1400px);
      pointer-events:none;
      z-index:10;
      color:rgba(255,255,255,.16);
      font-size:1.0rem;
      line-height:1.25;
      letter-spacing:0.20em;
      text-transform:uppercase;
    }

    /* ticker: invisible baseline, becomes visible during strobe via JS */
    .meow-ticker{
      position:fixed;
      bottom:40px;
      left:0;
      width:100%;
      background:none;
      color:transparent;          /* IMPORTANT */
      padding:12px 0;
      overflow:hidden;
      white-space:nowrap;
      font-family: Arial, Helvetica, sans-serif;
      font-size:18px;
      font-weight:600;
      letter-spacing:2px;
      z-index:10;
      pointer-events:none;
      border-top:none !important;
      box-shadow:none !important;
      outline:none !important;
    }
    .meow-content{
      display:inline-block;
      animation:ticker 40s linear infinite;
    }
    @keyframes ticker{
      0%{transform:translateX(0);}
      100%{transform:translateX(-100%);}
    }

    /* If you want ticker visible on mobile ONLY during strobe, we allow it: */
    @media (max-width: 760px){
      #ketaWord{
        width:92vw;
        max-width:720px;
        font-size:clamp(2.2rem, 11.5vw, 4.4rem);
      }
      #warning{
        width:min(92vw, 720px);
        font-size:0.85rem;
        letter-spacing:0.18em;
      }
      /* hide ticker normally on mobile... */
      .meow-ticker{ display:none; }
      /* ...but show it during strobe */
      body.strobing .meow-ticker{ display:block; bottom: calc(10px + env(safe-area-inset-bottom)); }
    }

    /* ISOLATED SLASH: NO JITTER, NO ANIMATION */
    #isolatedSlash{
      position:fixed;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      color:#fff;
      font-family: Arial, sans-serif;
      font-weight:800;
      line-height:1;
      opacity:0;
      z-index:999;
      pointer-events:none;
      text-shadow:none;
    }

    /* entering: hide everything else cleanly */
    body.entering #ketaWord,
    body.entering .subtitle,
    body.entering #warning,
    body.entering .meow-ticker{
      opacity:0;
      transition:opacity 120ms linear;
    }

    /* hard black overlay so we don't rely on "everything hidden" */
    #blackout{
      position:fixed;
      inset:0;
      background:#000;
      opacity:0;
      z-index:998;
      pointer-events:none;
    }
    body.blacked #blackout{ opacity:1; transition:opacity 80ms linear; }

    /* ===== ADD: TOP TICKER (SAME BEHAVIOR) ===== */
    .meow-ticker.top{
      top:40px;
      bottom:auto;
    }
    @media (max-width: 760px){
      /* keep same mobile behavior, just position at top when strobing */
      body.strobing .meow-ticker.top{
        display:block;
        top: calc(10px + env(safe-area-inset-top));
        bottom:auto;
      }
    }
  </style>
</head>

<body>
  <div id="blackout"></div>
  <div id="isolatedSlash">/</div>

  <h1>
    <div id="ketaWord" aria-label="KETADATA"></div>
    <p class="subtitle"></p>
  </h1>

  <p id="warning">
    B A D&nbsp;&nbsp;G A T E W A Y<br/>
    MAY TRIGGER SEIZURES IN PHOTOSENSITIVE INDIVIDUALS
  </p>

  <!-- ADD: TOP TICKER (invisible baseline, visible during strobe via JS) -->
  <div class="meow-ticker top" aria-hidden="true">
    <div class="meow-content">
      MEOW — MIAOU — MIAU — MIAO — MIAUW — MJAU — MJAV — MIAV — MIJAV — MIJAU — MIYAV — MIYAO — MIAAO — MIAOO — MIAOOO — МЯУ — МЯУУ — MYAU — МЬЯУ — МЯУМ — НЯВ — МИЙАУ — МИЙАВ — NIAOU — NYA — NYAA — NYAN — にゃー — ニャー — にゃお — にゃーー — 야옹 — 냐아옹 — 냥 — 喵 — 喵喵 —
    </div>
    <div class="meow-content">
      MEOW — MIAOU — MIAU — MIAO — MIAUW — MJAU — MJAV — MIAV — MIJAV — MIJAU — MIYAV — MIYAO — MIAAO — MIAOO — MIAOOO — МЯУ — МЯУУ — MYAU — МЬЯУ — МЯУМ — НЯВ — МИЙАУ — МИЙАВ — NIAOU — NYA — NYAA — NYAN — にゃー — ニャー — にゃお — にゃーー — 야옹 — 냐아옹 — 냥 — 喵 — 喵喵 —
    </div>
  </div>

  <!-- EXISTING: BOTTOM TICKER -->
  <div class="meow-ticker" aria-hidden="true">
    <div class="meow-content">
      MEOW — MIAOU — MIAU — MIAO — MIAUW — MJAU — MJAV — MIAV — MIJAV — MIJAU — MIYAV — MIYAO — MIAAO — MIAOO — MIAOOO — МЯУ — МЯУУ — MYAU — МЬЯУ — МЯУМ — НЯВ — МИЙАУ — МИЙАВ — NIAOU — NYA — NYAA — NYAN — にゃー — ニャー — にゃお — にゃーー — 야옹 — 냐아옹 — 냥 — 喵 — 喵喵 —
    </div>
    <div class="meow-content">
      MEOW — MIAOU — MIAU — MIAO — MIAUW — MJAU — MJAV — MIAV — MIJAV — MIJAU — MIYAV — MIYAO — MIAAO — MIAOO — MIAOOO — МЯУ — МЯУУ — MYAU — МЬЯУ — МЯУМ — НЯВ — МИЙАУ — МИЙАВ — NIAOU — NYA — NYAA — NYAN — にゃー — ニャー — にゃお — にゃーー — 야옹 — 냐아옹 — 냥 — 喵 — 喵喵 —
    </div>
  </div>

  <script>
    const ketaWord = document.getElementById("ketaWord");
    const isolated = document.getElementById("isolatedSlash");
    const tickerEls = Array.from(document.querySelectorAll(".meow-ticker"));

    // ROUTE: landing -> mobile base
    const MOBILE_TARGET = "base_mobile.html"; // set to your mobile base file
    const DESKTOP_TARGET = MOBILE_TARGET;

    const word = "KETADATA";
    const letters = [];
    let entering = false;
    let hoverIdx = Math.floor(word.length / 2);
    let introDone = false;

    // --- Build fixed-width cells (start empty for intro) ---
    for (let i = 0; i < word.length; i++) {
      const cell = document.createElement("span");
      cell.className = "cell";

      const s = document.createElement("span");
      s.className = "ch";
      s.textContent = "";
      s.dataset.orig = word[i];

      // desktop hover -> "/"
      s.addEventListener("mouseenter", () => {
        if (!introDone) return;
        if (ketaWord.dataset.locked === "1") return;
        hoverIdx = i;
        s.textContent = "/";
      });

      s.addEventListener("mouseleave", () => {
        if (!introDone) return;
        if (ketaWord.dataset.locked === "1") return;
        s.textContent = s.dataset.orig;
      });

      cell.appendChild(s);
      ketaWord.appendChild(cell);
      letters.push(s);
    }

    function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }

    function renderOneSlashAt(idx){
      letters.forEach((s, i) => { s.textContent = (i === idx) ? "/" : s.dataset.orig; });
    }

    // --- Mobile touch: drag across word chooses index, shows one "/" (after intro) ---
    function setIdxFromClientX(clientX){
      const rect = ketaWord.getBoundingClientRect();
      const rel = (clientX - rect.left) / Math.max(1, rect.width);
      const idx = Math.round(rel * (letters.length - 1));
      hoverIdx = clamp(idx, 0, letters.length - 1);
      if (!introDone) return;
      if (ketaWord.dataset.locked === "1") return;
      renderOneSlashAt(hoverIdx);
    }

    ketaWord.addEventListener("pointerdown", (ev) => {
      if (entering) return;
      if (ev.pointerType === "touch") setIdxFromClientX(ev.clientX);
    }, {passive:true});

    ketaWord.addEventListener("pointermove", (ev) => {
      if (ev.pointerType !== "touch") return;
      if (entering) return;
      setIdxFromClientX(ev.clientX);
    }, {passive:true});

    function placeIsolatedAtLetter(idx){
      const el = letters[clamp(idx, 0, letters.length - 1)];
      const r = el.getBoundingClientRect();
      const cx = r.left + r.width / 2;
      const cy = r.top + r.height / 2;

      isolated.style.left = cx + "px";
      isolated.style.top  = cy + "px";

      const fs = parseFloat(window.getComputedStyle(ketaWord).fontSize) || 200;
      isolated.style.fontSize = Math.max(64, fs) + "px";
    }

    function enter(){
      if (!introDone) return;
      if (entering) return;
      entering = true;

      // lock + convert word to slashes
      ketaWord.dataset.locked = "1";
      letters.forEach(s => (s.textContent = "/"));

      // isolate selected slash
      placeIsolatedAtLetter(hoverIdx);

      // hide everything else
      document.body.classList.add("entering");

      // show isolated slash
      isolated.style.opacity = "1";

      const SLASH_HOLD_MS = 850;
      const BLACK_HOLD_MS = 650;

      setTimeout(() => {
        isolated.style.opacity = "0";
        document.body.classList.add("blacked");
      }, SLASH_HOLD_MS);

      setTimeout(() => {
        const isMobile = window.matchMedia && window.matchMedia("(max-width: 760px)").matches;
        window.location.href = isMobile ? MOBILE_TARGET : DESKTOP_TARGET;
      }, SLASH_HOLD_MS + BLACK_HOLD_MS);
    }

    // single-tap/click on word enters (after intro)
    ketaWord.addEventListener("click", enter);

    // --- INTRO (NO JITTER): moving single glyph, then full word -> slashes -> full word ---
    function intro(){
      const STEP_MS = 70;        // speed of the moving glyph
      const HOLD_WORD_MS = 220;  // hold full word before slashes
      const HOLD_SLASH_MS = 220; // hold slashes
      const END_SETTLE_MS = 120; // then enable interaction

      letters.forEach(s => (s.textContent = ""));

      let i = 0;       // character index in word
      let active = 0;  // cell index that hosts the glyph

      const tick = () => {
        if (i >= letters.length){
          letters.forEach(s => (s.textContent = s.dataset.orig));

          setTimeout(() => {
            letters.forEach(s => (s.textContent = "/"));

            setTimeout(() => {
              letters.forEach(s => (s.textContent = s.dataset.orig));

              setTimeout(() => {
                introDone = true;
                hoverIdx = Math.floor(letters.length / 2);
              }, END_SETTLE_MS);

            }, HOLD_SLASH_MS);

          }, HOLD_WORD_MS);

          return;
        }

        letters.forEach((s, j) => {
          s.textContent = (j === active) ? word[i] : "";
        });

        i++;
        active = (active + 1) % letters.length;
        setTimeout(tick, STEP_MS);
      };

      tick();
    }

    intro();

    // --- STROBE: SPACE (desktop) + DOUBLE TAP (mobile), tickers become visible with contrast ---
    let isFlashing = false;
    let flashInterval = null;

    function applyStrobeFrame(isWhite){
      document.body.style.backgroundColor = isWhite ? "white" : "black";
      const c = isWhite ? "black" : "white";
      tickerEls.forEach(el => { el.style.color = c; });
    }

    function startStrobe(){
      if (flashInterval) clearInterval(flashInterval);
      document.body.classList.add("strobing");

      let white = false;
      applyStrobeFrame(white);

      flashInterval = setInterval(() => {
        white = !white;
        applyStrobeFrame(white);
      }, 50);
    }

    function stopStrobe(){
      if (flashInterval) clearInterval(flashInterval);
      flashInterval = null;

      document.body.classList.remove("strobing");
      document.body.style.backgroundColor = "black";

      tickerEls.forEach(el => { el.style.color = "transparent"; });
    }

    function toggleStrobe(){
      if (isFlashing) stopStrobe(); else startStrobe();
      isFlashing = !isFlashing;
    }

    // SPACE toggles strobe (desktop)
    document.addEventListener("keydown", (event) => {
      if (event.key === " " || event.code === "Space") {
        event.preventDefault();
        toggleStrobe();
      }
    });

    // Double tap toggles strobe (mobile)
    let lastTapAt = 0;
    const DBL_MS = 280;

    document.addEventListener("pointerdown", (ev) => {
      if (ev.pointerType !== "touch") return;
      const now = performance.now();
      if (now - lastTapAt < DBL_MS){
        ev.preventDefault();
        toggleStrobe();
        lastTapAt = 0;
      } else {
        lastTapAt = now;
      }
    }, {passive:false});

    // HOTKEYS — preserved
    document.addEventListener("keydown", (event) => {
      if (event.key >= "1" && event.key <= "6") window.location.href = event.key + ".html";
      if (event.key.toLowerCase() === "m") window.location.href = "map.html";
      if (event.key.toLowerCase() === "r") window.location.href = "room.html";
    });
  </script>

  <!--
  AE:
  - Added TOP ticker only (same invisible baseline behavior; visible during strobe via JS).
  - No other layout/logic changes.

  WB:
  FILE_ID: landing_mobile
  ROOM_ID: ENTRY
  VERSION: v1.1.1
  UPDATED_AT: 2026-01-15
  CHANGELOG:
  - Added a top meow ticker (inherits strobe visibility behavior).
  -->
</body>
</html>
