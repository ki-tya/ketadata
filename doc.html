<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KETADATA DOC</title>

  <style>
    :root{
      --bg:#000;
      --fg:#fff;
      --muted:rgba(255,255,255,0.35);
      --hair:rgba(255,255,255,0.12);
      --hair2:rgba(255,255,255,0.18);
      --panel:rgba(255,255,255,0.04);
      --panel2:rgba(255,255,255,0.06);
      --focus:rgba(255,255,255,0.55);
      --maxw: 980px;
      --pad: 28px;
      --radius: 0px; /* sharp */
    }

    html, body{
      height:100%;
      margin:0;
      padding:0;
      background:var(--bg);
      color:var(--fg);
      font-family: Arial, Helvetica, sans-serif;
      overflow:hidden;
    }

    /* ====== Top Bar ====== */
    .topbar{
      position:fixed;
      top:0; left:0; right:0;
      height:64px;
      display:flex;
      align-items:center;
      gap:14px;
      padding:0 18px;
      background:linear-gradient(to bottom, rgba(0,0,0,0.92), rgba(0,0,0,0.78));
      border-bottom:1px solid var(--hair);
      z-index:20;
      user-select:none;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 220px;
    }

    .sq{
      width:14px; height:14px;
      background:#fff;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.2) inset;
      flex:0 0 auto;
    }

    .title-wrap{
      display:flex;
      flex-direction:column;
      line-height:1.05;
      gap:3px;
      min-width: 0;
    }

    .doc-title{
      font-size:14px;
      letter-spacing:0.28em;
      text-transform:uppercase;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 260px;
    }

    .doc-sub{
      font-size:11px;
      letter-spacing:0.18em;
      color:var(--muted);
      text-transform:uppercase;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 260px;
    }

    .toolbar{
      display:flex;
      align-items:center;
      gap:10px;
      flex:1 1 auto;
      min-width:0;
      overflow:hidden;
      mask-image: linear-gradient(to right, rgba(0,0,0,1) 85%, rgba(0,0,0,0));
    }

    .btn{
      border:1px solid var(--hair);
      background:var(--panel);
      color:var(--fg);
      padding:8px 10px;
      font-size:12px;
      letter-spacing:0.14em;
      text-transform:uppercase;
      border-radius:var(--radius);
      cursor:pointer;
      white-space:nowrap;
    }
    .btn:hover{ border-color:var(--hair2); background:var(--panel2); }
    .btn:active{ transform: translateY(1px); }

    .btn.ghost{
      background:transparent;
      border-color:transparent;
      color:var(--muted);
    }
    .btn.ghost:hover{
      border-color:var(--hair);
      color:var(--fg);
    }

    .sep{
      width:1px; height:26px;
      background:var(--hair);
      margin:0 2px;
      flex:0 0 auto;
    }

    .right{
      display:flex;
      align-items:center;
      gap:10px;
      flex:0 0 auto;
    }

    .status{
      font-size:11px;
      letter-spacing:0.2em;
      color:var(--muted);
      text-transform:uppercase;
      white-space:nowrap;
    }

    /* ====== Layout ====== */
    .wrap{
      position:fixed;
      top:64px; bottom:0; left:0; right:0;
      display:grid;
      grid-template-columns: 240px 1fr 280px; /* left nav, doc, right panel */
      gap:0;
    }

    /* Left: Outline / Files */
    .left{
      border-right:1px solid var(--hair);
      background:rgba(255,255,255,0.02);
      overflow:auto;
      padding:16px 12px;
    }

    .panel-h{
      font-size:11px;
      letter-spacing:0.24em;
      text-transform:uppercase;
      color:var(--muted);
      margin:10px 6px 8px;
    }

    .item{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 10px;
      border:1px solid transparent;
      cursor:pointer;
      user-select:none;
    }
    .item:hover{ border-color:var(--hair); background:var(--panel); }
    .item.active{ border-color:var(--hair2); background:var(--panel2); }

    .dot{
      width:10px; height:10px;
      border:1px solid var(--hair2);
      background:transparent;
      flex:0 0 auto;
    }

    .item .label{
      font-size:12px;
      letter-spacing:0.12em;
      text-transform:uppercase;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Center: Doc */
    .center{
      overflow:auto;
      padding: 26px 20px 40px;
      background:
        radial-gradient(circle at 50% 0%, rgba(255,255,255,0.05), transparent 52%),
        linear-gradient(to bottom, rgba(255,255,255,0.02), rgba(0,0,0,0) 80%);
    }

    .page{
      width:min(var(--maxw), 100%);
      margin:0 auto;
      background:rgba(0,0,0,0.0);
      border:1px solid var(--hair);
      outline:1px solid rgba(255,255,255,0.06);
      box-shadow: 0 0 0 1px rgba(0,0,0,0.6) inset;
      border-radius:var(--radius);
    }

    .page-inner{
      padding: var(--pad);
      min-height: 1200px;
    }

    .doc-head{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:16px;
      border-bottom:1px solid var(--hair);
      padding-bottom:14px;
      margin-bottom:18px;
    }

    .doc-h1{
      font-size:22px;
      letter-spacing:0.22em;
      text-transform:uppercase;
      margin:0;
      line-height:1.1;
      max-width: 70%;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .meta{
      font-size:11px;
      letter-spacing:0.2em;
      text-transform:uppercase;
      color:var(--muted);
      text-align:right;
      white-space:nowrap;
    }

    /* Editor */
    .editor{
      font-size:16px;
      line-height:1.55;
      letter-spacing:0.02em;
      outline:none;
      caret-color:#fff;
    }

    .editor p{ margin: 0 0 14px; }
    .editor h2{
      margin: 26px 0 10px;
      font-size:14px;
      letter-spacing:0.24em;
      text-transform:uppercase;
      font-weight:700;
    }
    .editor h3{
      margin: 20px 0 8px;
      font-size:13px;
      letter-spacing:0.18em;
      text-transform:uppercase;
      font-weight:700;
      color:rgba(255,255,255,0.85);
    }
    .editor code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 13px;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.10);
      padding: 2px 6px;
      border-radius: 0;
    }
    .editor pre{
      margin: 14px 0 18px;
      padding: 14px;
      background: rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.10);
      overflow:auto;
    }
    .editor blockquote{
      margin: 16px 0;
      padding: 10px 14px;
      border-left: 2px solid rgba(255,255,255,0.25);
      color: rgba(255,255,255,0.78);
      background: rgba(255,255,255,0.03);
    }

    /* Selection feel */
    ::selection{
      background: rgba(255,255,255,0.18);
      color: #fff;
    }

    /* Right: Inspector */
    .rightpanel{
      border-left:1px solid var(--hair);
      background:rgba(255,255,255,0.02);
      overflow:auto;
      padding:16px 12px;
    }

    .kv{
      border:1px solid var(--hair);
      background:rgba(0,0,0,0.25);
      padding:12px;
      margin: 8px 6px 14px;
    }
    .kv .k{
      font-size:11px;
      letter-spacing:0.2em;
      text-transform:uppercase;
      color:var(--muted);
      margin-bottom:6px;
    }
    .kv .v{
      font-size:12px;
      letter-spacing:0.08em;
      color:rgba(255,255,255,0.85);
      word-break:break-word;
    }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size:12px;
      line-height:1.45;
      white-space:pre-wrap;
    }

    /* Floating command palette hint */
    .hint{
      position:fixed;
      right:16px;
      top:74px;
      z-index:30;
      font-size:11px;
      letter-spacing:0.22em;
      color:var(--muted);
      text-transform:uppercase;
      user-select:none;
      pointer-events:none;
      background:rgba(0,0,0,0.55);
      border:1px solid var(--hair);
      padding:8px 10px;
    }

    /* Responsive: collapse side panels */
    @media (max-width: 1100px){
      .wrap{ grid-template-columns: 1fr; }
      .left, .rightpanel{ display:none; }
      .hint{ display:none; }
      body{ padding-top:28vh; }
      .topbar{ height:58px; }
      .wrap{ top:58px; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <div class="sq" title="INVARIANT"></div>
      <div class="title-wrap">
        <div class="doc-title" id="docTitleTop">KETADATA DOC</div>
        <div class="doc-sub">SOVEREIGN PAGE · LOCAL STATE</div>
      </div>
    </div>

    <div class="toolbar">
      <button class="btn" id="btnBold" title="BOLD (CTRL+B)">B</button>
      <button class="btn" id="btnItalic" title="ITALIC (CTRL+I)">I</button>
      <button class="btn" id="btnUnderline" title="UNDERLINE (CTRL+U)">U</button>
      <div class="sep"></div>
      <button class="btn" id="btnH2" title="HEADING 2">H2</button>
      <button class="btn" id="btnH3" title="HEADING 3">H3</button>
      <button class="btn" id="btnQuote" title="QUOTE">QUOTE</button>
      <button class="btn" id="btnCode" title="CODE">CODE</button>
      <div class="sep"></div>
      <button class="btn" id="btnExport" title="EXPORT JSON (CTRL+E)">EXPORT</button>
      <button class="btn ghost" id="btnImport" title="IMPORT JSON (CTRL+SHIFT+E)">IMPORT</button>
      <button class="btn ghost" id="btnClear" title="CLEAR (CTRL+SHIFT+X)">CLEAR</button>
    </div>

    <div class="right">
      <div class="status" id="status">LOCAL</div>
      <button class="btn" id="btnFocus" title="TOGGLE FOCUS (F)">FOCUS</button>
    </div>
  </div>

  <div class="hint">CTRL+E EXPORT · CTRL+SHIFT+E IMPORT · F FOCUS</div>

  <div class="wrap">
    <aside class="left">
      <div class="panel-h">OUTLINE</div>
      <div class="item active"><div class="dot"></div><div class="label">KETA_NOTE</div></div>
      <div class="item"><div class="dot"></div><div class="label">ROOM TRANSFORM</div></div>
      <div class="item"><div class="dot"></div><div class="label">VAULT ENTRY</div></div>
      <div class="item"><div class="dot"></div><div class="label">EXPORT STATE</div></div>
      <div class="panel-h">FILES</div>
      <div class="item"><div class="dot"></div><div class="label">DOC_0001</div></div>
      <div class="item"><div class="dot"></div><div class="label">DOC_0002</div></div>
      <div class="item"><div class="dot"></div><div class="label">DOC_0003</div></div>
    </aside>

    <main class="center">
      <div class="page">
        <div class="page-inner">
          <div class="doc-head">
            <h1 class="doc-h1" id="docTitle">KETADATA DOC</h1>
            <div class="meta" id="meta">
              FILE_ID: DOC<br/>
              ROOM_ID: BASE<br/>
              VERSION: v1
            </div>
          </div>

          <div id="editor" class="editor" contenteditable="true" spellcheck="false">
            <p><span style="color:rgba(255,255,255,0.85); letter-spacing:0.08em;">THIS PAGE IS A SOVEREIGN DOC OBJECT.</span></p>
            <p><span style="color:rgba(255,255,255,0.65);">TYPE. EXPORT. RELOAD. CONTINUITY HOLDS.</span></p>
            <h2>NOTES</h2>
            <p>—</p>
          </div>
        </div>
      </div>
    </main>

    <aside class="rightpanel">
      <div class="panel-h">INSPECTOR</div>

      <div class="kv">
        <div class="k">FILE_ID</div>
        <div class="v mono" id="fileId">DOC</div>
      </div>

      <div class="kv">
        <div class="k">ROOM_ID</div>
        <div class="v mono" id="roomId">BASE</div>
      </div>

      <div class="kv">
        <div class="k">STATE_ID</div>
        <div class="v mono" id="stateId">LOCAL_0000</div>
      </div>

      <div class="kv">
        <div class="k">UPDATED_AT</div>
        <div class="v mono" id="updatedAt">—</div>
      </div>

      <div class="kv">
        <div class="k">EXPORT (JSON)</div>
        <div class="v mono" id="exportBox">{}</div>
      </div>
    </aside>
  </div>

  <script>
    const editor = document.getElementById("editor");
    const exportBox = document.getElementById("exportBox");
    const updatedAtEl = document.getElementById("updatedAt");
    const statusEl = document.getElementById("status");

    const docTitleTop = document.getElementById("docTitleTop");
    const docTitle = document.getElementById("docTitle");

    const fileIdEl = document.getElementById("fileId");
    const roomIdEl = document.getElementById("roomId");
    const stateIdEl = document.getElementById("stateId");

    const metaEl = document.getElementById("meta");

    const DEFAULT = {
      fileId: "DOC",
      roomId: "BASE",
      version: "v1",
      stateId: "LOCAL_0000",
      updatedAt: "",
      title: "KETADATA DOC",
      html: ""
    };

    const STORAGE_KEY = "KETADATA_DOC_STATE_v1";

    function nowISO(){
      return new Date().toISOString();
    }

    function setStatus(s){
      statusEl.textContent = s;
    }

    function applyState(s){
      const st = { ...DEFAULT, ...s };
      docTitleTop.textContent = st.title || DEFAULT.title;
      docTitle.textContent = st.title || DEFAULT.title;

      fileIdEl.textContent = st.fileId;
      roomIdEl.textContent = st.roomId;
      stateIdEl.textContent = st.stateId;

      updatedAtEl.textContent = st.updatedAt ? st.updatedAt : "—";

      metaEl.innerHTML =
        `FILE_ID: ${escapeHtml(st.fileId)}<br/>`+
        `ROOM_ID: ${escapeHtml(st.roomId)}<br/>`+
        `VERSION: ${escapeHtml(st.version)}`;

      if (st.html) editor.innerHTML = st.html;
      renderExport(st);
    }

    function gatherState(){
      const st = {
        fileId: fileIdEl.textContent.trim() || "DOC",
        roomId: roomIdEl.textContent.trim() || "BASE",
        version: "v1",
        stateId: stateIdEl.textContent.trim() || "LOCAL_0000",
        updatedAt: nowISO(),
        title: docTitle.textContent.trim() || "KETADATA DOC",
        html: editor.innerHTML
      };
      return st;
    }

    function persist(){
      const st = gatherState();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(st));
      updatedAtEl.textContent = st.updatedAt;
      setStatus("SAVED");
      renderExport(st);
      setTimeout(()=>setStatus("LOCAL"), 550);
    }

    function renderExport(st){
      exportBox.textContent = JSON.stringify(st, null, 2);
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // Load
    (function init(){
      try{
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) applyState(JSON.parse(saved));
        else applyState({ ...DEFAULT, updatedAt: "" });
      }catch(e){
        applyState({ ...DEFAULT, updatedAt: "" });
      }
    })();

    // Autosave (debounced)
    let t = null;
    editor.addEventListener("input", () => {
      setStatus("…");
      clearTimeout(t);
      t = setTimeout(persist, 450);
    });

    // === Formatting helpers ===
    function cmd(name, val=null){
      document.execCommand(name, false, val);
      editor.focus();
    }

    document.getElementById("btnBold").onclick = () => cmd("bold");
    document.getElementById("btnItalic").onclick = () => cmd("italic");
    document.getElementById("btnUnderline").onclick = () => cmd("underline");

    document.getElementById("btnH2").onclick = () => cmd("formatBlock", "h2");
    document.getElementById("btnH3").onclick = () => cmd("formatBlock", "h3");
    document.getElementById("btnQuote").onclick = () => cmd("formatBlock", "blockquote");
    document.getElementById("btnCode").onclick = () => {
      // inline code: wrap selection
      const sel = window.getSelection();
      if (!sel || sel.rangeCount === 0) return;
      const range = sel.getRangeAt(0);
      const text = range.toString();
      if (!text) return;
      const span = document.createElement("code");
      span.textContent = text;
      range.deleteContents();
      range.insertNode(span);
      sel.removeAllRanges();
    };

    // Export / Import / Clear
    document.getElementById("btnExport").onclick = () => {
      const st = gatherState();
      renderExport(st);
      navigator.clipboard?.writeText(JSON.stringify(st, null, 2));
      setStatus("EXPORTED");
      setTimeout(()=>setStatus("LOCAL"), 650);
    };

    document.getElementById("btnImport").onclick = () => {
      const raw = prompt("PASTE JSON STATE:");
      if (!raw) return;
      try{
        const st = JSON.parse(raw);
        applyState(st);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(gatherState()));
        setStatus("IMPORTED");
        setTimeout(()=>setStatus("LOCAL"), 650);
      }catch(e){
        setStatus("ERROR");
        setTimeout(()=>setStatus("LOCAL"), 650);
      }
    };

    document.getElementById("btnClear").onclick = () => {
      if (!confirm("CLEAR DOC?")) return;
      localStorage.removeItem(STORAGE_KEY);
      applyState({ ...DEFAULT, updatedAt: "" });
      setStatus("CLEARED");
      setTimeout(()=>setStatus("LOCAL"), 650);
    };

    // Focus mode (kill side panels)
    let focus = false;
    function setFocus(on){
      focus = on;
      document.querySelector(".left").style.display = on ? "none" : "block";
      document.querySelector(".rightpanel").style.display = on ? "none" : "block";
      document.querySelector(".wrap").style.gridTemplateColumns = on ? "1fr" : "240px 1fr 280px";
    }
    document.getElementById("btnFocus").onclick = () => setFocus(!focus);

    // Hotkeys
    document.addEventListener("keydown", (e) => {
      const k = e.key.toLowerCase();

      if (e.ctrlKey && !e.shiftKey && k === "e"){ e.preventDefault(); document.getElementById("btnExport").click(); }
      if (e.ctrlKey && e.shiftKey && k === "e"){ e.preventDefault(); document.getElementById("btnImport").click(); }
      if (e.ctrlKey && e.shiftKey && k === "x"){ e.preventDefault(); document.getElementById("btnClear").click(); }
      if (k === "f" && !e.ctrlKey && !e.metaKey){ setFocus(!focus); }
    });

    // Persist on unload
    window.addEventListener("beforeunload", () => {
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(gatherState())); }catch(e){}
    });
  </script>

  <!--
  AE:
  - BLACK FIELD, WHITE TYPE, SHARP EDGES, HAIRLINES ONLY.
  - TOP BAR ALL CAPS + LETTERSPACING. WHITE SQUARE INVARIANT.
  - "GOOGLE DOC" FEEL WITHOUT FRIENDLINESS.

  EE:
  - SINGLE-PAGE DOC OBJECT WITH LOCAL STATE (LOCALSTORAGE).
  - EXPORT/IMPORT JSON STATE.
  - INSPECTOR SHOWS FILE_ID / ROOM_ID / STATE_ID / UPDATED_AT.
  - FOCUS MODE HIDES PANELS.

  WB:
  FILE_ID: ketadata_doc
  ROOM_ID: BASE
  VERSION: v1.0.0
  UPDATED_AT: 2025-12-24
  CHANGELOG:
  - Initial sovereign doc object with exportable state + inspector.
  -->
</body>
</html>
