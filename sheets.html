<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KETADATA_SHEETS_v1</title>
    <style>
        :root {
            --bg: #050505;
            --surface: #111;
            --border: #222;
            --text: #888;
            --accent: #fff;
            --highlight: #1a1a1a;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* SHELL LAYER: TOP NAV */
        #shell-nav {
            padding: 10px;
            background: #000;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .brand { color: var(--accent); font-weight: bold; letter-spacing: 2px; }

        .io-group button {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 5px 12px;
            cursor: pointer;
            font-size: 11px;
            margin-left: 5px;
        }

        .io-group button:hover {
            background: var(--accent);
            color: #000;
        }

        /* GRID LAYER */
        #stage {
            flex-grow: 1;
            overflow: auto;
            position: relative;
        }

        table {
            border-collapse: collapse;
            table-layout: fixed;
            min-width: 100%;
        }

        th, td {
            border: 1px solid var(--border);
            width: 150px;
            height: 30px;
            padding: 0;
            position: relative;
        }

        th {
            background: var(--surface);
            font-size: 10px;
            font-weight: normal;
            color: #444;
            text-align: center;
        }

        td input {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: var(--accent);
            padding: 0 8px;
            box-sizing: border-box;
            outline: none;
            font-family: inherit;
            font-size: 13px;
        }

        td input:focus {
            background: var(--highlight);
        }

        /* KETA_NOTE ATOM */
        #keta-note-atom {
            position: fixed;
            top: 60px;
            right: 20px;
            width: 200px;
            background: #000;
            border: 1px solid var(--border);
            padding: 10px;
            font-size: 11px;
            z-index: 50;
        }

        #keta-note-atom textarea {
            width: 100%;
            background: transparent;
            border: none;
            color: #666;
            resize: none;
            outline: none;
            height: 80px;
        }

        /* UNIVERSALS */
        .intensity-low { opacity: 0.3; }
        .intensity-high { opacity: 1; }
    </style>
</head>
<body id="keta-body">

    <nav id="shell-nav">
        <div class="brand">KETADATA // SHEETS</div>
        <div class="io-group">
            <button onclick="exportState()">EXPORT JSON</button>
            <button onclick="triggerImport()">IMPORT JSON</button>
            <input type="file" id="file-input" style="display:none" onchange="importState(event)">
        </div>
    </nav>

    <div id="stage">
        <table id="grid-table">
            <thead>
                <tr id="grid-header"></tr>
            </thead>
            <tbody id="grid-body"></tbody>
        </table>
    </div>

    <div id="keta-note-atom">
        <div style="font-size: 9px; margin-bottom: 5px; color: #444;">KETA_NOTE</div>
        <textarea id="keta-note" placeholder="META-COG..."></textarea>
    </div>

    <script>
        const ROWS = 50;
        const COLS = 20;

        // INITIALIZE GRID
        function initGrid() {
            const header = document.getElementById('grid-header');
            const body = document.getElementById('grid-body');

            // Header labels (A, B, C...)
            header.appendChild(document.createElement('th')); // Corner
            for (let c = 0; c < COLS; c++) {
                const th = document.createElement('th');
                th.innerText = String.fromCharCode(65 + c);
                header.appendChild(th);
            }

            // Body rows
            for (let r = 0; r < ROWS; r++) {
                const tr = document.createElement('tr');
                const th = document.createElement('th');
                th.innerText = r + 1;
                tr.appendChild(th);

                for (let c = 0; c < COLS; c++) {
                    const td = document.createElement('td');
                    const input = document.createElement('input');
                    input.id = `cell-${r}-${c}`;
                    input.setAttribute('data-r', r);
                    input.setAttribute('data-c', c);
                    td.appendChild(input);
                    tr.appendChild(td);
                }
                body.appendChild(tr);
            }
        }

        // UNIVERSALS: LIGHTS (SPACEBAR)
        let lightsOn = true;
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                lightsOn = !lightsOn;
                document.getElementById('keta-body').className = lightsOn ? 'intensity-high' : 'intensity-low';
            }
        });

        // STATE LITERALISM: IO
        function exportState() {
            const cells = {};
            document.querySelectorAll('td input').forEach(input => {
                if (input.value) cells[input.id] = input.value;
            });

            const state = {
                version: "KETADATA_SHEETS_v1",
                timestamp: new Date().toISOString(),
                ketaNote: document.getElementById('keta-note').value,
                data: cells,
                config: { lights: lightsOn }
            };

            const blob = new Blob([JSON.stringify(state, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ketadata_sheet_${Date.now()}.json`;
            a.click();
        }

        function triggerImport() {
            document.getElementById('file-input').click();
        }

        function importState(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const state = JSON.parse(e.target.result);
                
                // Clear current
                document.querySelectorAll('td input').forEach(input => input.value = '');
                
                // Hydrate
                document.getElementById('keta-note').value = state.ketaNote || '';
                for (const id in state.data) {
                    const cell = document.getElementById(id);
                    if (cell) cell.value = state.data[id];
                }
                
                if (state.config && state.config.lights !== undefined) {
                    lightsOn = state.config.lights;
                    document.getElementById('keta-body').className = lightsOn ? 'intensity-high' : 'intensity-low';
                }
            };
            reader.readAsText(file);
        }

        initGrid();
    </script>
</body>
</html>
