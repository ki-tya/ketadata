<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KETADATA // STUDIO</title>

  <style>
    :root{
      /* DEFAULT: PURPLE MOVING GRADIENT */
      --bg1:#0a0010;
      --bg2:#2a0066;
      --bg3:#5a00ff;
      --bg4:#24002f;

      /* motion */
      --motionSpeed: 0.55; /* visible by default */
      --angle: 145deg;

      /* blob centers (animated) */
      --aX: 18%; --aY: 20%;
      --bX: 78%; --bY: 28%;
      --cX: 28%; --cY: 86%;
      --dX: 86%; --dY: 82%;

      /* blob alpha */
      --aA: 0.22;
      --bA: 0.18;
      --cA: 0.16;
      --dA: 0.14;

      /* ui */
      --txt:#ffffff;
      --uiFont: Arial, Helvetica, sans-serif;
      --uiSize: 12px;
      --hudOpacity: 1;

      --linkRest:#7a7a7a;
      --linkHover:#ffffff;

      /* TYPOGRAPHY CONTROLS */
      --titleMaxPx: 180px;  /* max in clamp() */
      --titleMinPx: 56px;   /* min in clamp() */
      --linkSizePx: 11px;   /* directory/link font size */

      /* LANDING POSITION (RELATIVE SCREEN POSITION, CENTERED, SMALL MARGINS) */
      --titleX: 50vw;   /* centered */
      --titleY: 55vh;   /* like screenshot (slightly above mid) */
      --titleMaxWidth: calc(100vw - 88px); /* small margins, keeps inside screen */
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    html{ scroll-behavior:auto; }
    body{
      margin:0;
      font-family: var(--uiFont);
      font-size: var(--uiSize);
      color: var(--txt);
      background:#000;
      overflow-x:hidden;

      /* SNAP */
      scroll-snap-type: y mandatory;
      scroll-snap-stop: always;
    }
    section{
      height:100vh;
      scroll-snap-align:start;
      position:relative;
      z-index: 30;
      overflow:hidden;
    }

    /* ===== LAYERS ===== */
    #bgLayer{
      position:fixed;
      inset:0;
      z-index: 1;
      pointer-events:none;

      background:
        radial-gradient(1100px 680px at var(--aX) var(--aY), rgba(90,0,255,var(--aA)), transparent 70%),
        radial-gradient(900px 620px at var(--bX) var(--bY), rgba(180,0,255,var(--bA)), transparent 72%),
        radial-gradient(1000px 720px at var(--cX) var(--cY), rgba(40,120,255,var(--cA)), transparent 74%),
        radial-gradient(900px 640px at var(--dX) var(--dY), rgba(255,0,120,var(--dA)), transparent 72%),
        linear-gradient(var(--angle), var(--bg1), var(--bg2), var(--bg3), var(--bg4));
      background-size: auto, auto, auto, auto, cover;
      filter: saturate(1.2) contrast(1.1);
      transition: filter .25s ease;
    }
    #bgLayer.off{ filter: saturate(.85) contrast(1); opacity:.75; }

    #motionLayer{
      position:fixed;
      inset:0;
      z-index: 2;
      pointer-events:none;
      opacity: 0.9;
      mix-blend-mode: screen;
      filter: blur(0px);
      transform: translateZ(0);
    }

    /* subtle grain */
    #grain{
      position:fixed;
      inset:0;
      z-index: 3;
      pointer-events:none;
      opacity:.22;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='90' height='90'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='90' height='90' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      background-size: 140px 140px;
      mix-blend-mode: overlay;
    }

    /* ===== HUD ===== */
    #hud{
      position:fixed;
      left:12px;
      top:12px;
      z-index: 50;
      width: 278px;
      opacity: var(--hudOpacity);
      pointer-events:auto;
    }
    #hud.collapsed{
      width:auto;
    }
    .panel{
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(8px);
      padding:10px 10px 12px;
    }
    .row{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:8px;
    }
    .row:last-child{ margin-bottom:0; }
    .mini{
      font-size:11px; letter-spacing:.14em; text-transform:uppercase;
      color: rgba(255,255,255,.70);
      user-select:none;
    }
    .mini b{ color:#fff; font-weight:600; }

    .btn{
      height:28px;
      padding:0 10px;
      border:1px solid rgba(255,255,255,0.24);
      background: rgba(0,0,0,0.45);
      color: rgba(255,255,255,0.86);
      font-size:11px;
      letter-spacing:.16em;
      text-transform:uppercase;
      cursor:pointer;
    }
    .btn:hover{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.42); }
    .btn.on{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.52); }

    /* KETA_NOTE ICON: WHITE SQUARE ONLY */
    .noteIconBtn{
      width:28px;height:28px;
      display:inline-flex;align-items:center;justify-content:center;
      border:1px solid rgba(255,255,255,0.24);
      background: rgba(0,0,0,0.45);
      cursor:pointer;
    }
    .noteIconBtn:hover{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.42); }
    .ketaSquare{ width:10px;height:10px;background:#fff;display:inline-block; }

    /* ===== landing (CENTERED; SMALL MARGINS; FIT INSIDE SCREEN) ===== */
    .landing{ position:relative; }
    .landingTitleWrap{
      position:absolute;
      left: var(--titleX);
      top: var(--titleY);
      transform: translate(-50%, -50%);
      text-align:center;
      width: var(--titleMaxWidth);
      max-width: var(--titleMaxWidth);
    }
    .title{
      margin:0;
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;

      /* now controllable min + max */
      font-size: clamp(var(--titleMinPx), 8.8vw, var(--titleMaxPx));
      line-height:.92;
      white-space:normal; /* allow wrap instead of clipping */
      user-select:none;
      text-shadow: 0 0 30px rgba(255,255,255,.06);

      /* guarantee it never spills horizontally */
      max-width: 100%;
      overflow:hidden;
      text-overflow: clip;
    }
    .sub{
      margin-top: 12px;
      font-size: 11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: rgba(255,255,255,.35);
      font-weight:900;
    }

    /* ===== directory ===== */
    .directory{
      border-top: 1px solid rgba(255,255,255,12);
      display:flex;
      align-items:stretch;
      justify-content:center;
      padding: 84px 22px 72px;
    }
    .dirBox{
      width: min(1100px, 100%);
      border: 1px solid rgba(255,255,255,12);
      background: rgba(0,0,0,46);
      backdrop-filter: blur(8px);
      padding: 16px 16px 10px;
    }
    .dirHead{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255,255,255,12);
      margin-bottom: 12px;
    }
    .dirHead .t{
      font-size:12px;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-weight:900;
      color: rgba(255,255,255,.88);
    }
    .dirHead .mini{
      font-size:11px;
      letter-spacing:.12em;
      color: rgba(255,255,255,.38);
    }

    .dirGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media(max-width:860px){
      .dirGrid{ grid-template-columns: 1fr; }
      #hud{ width: 252px; }
    }

    .group{
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.35);
      padding: 12px 12px 10px;
    }
    .groupTitle{
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:900;
      color: rgba(255,255,255,.68);
      margin-bottom: 10px;
    }
    .links{
      display:flex;
      flex-direction:column;
      gap: 6px;
      font-size: var(--linkSizePx);
      letter-spacing:.14em;
      text-transform:uppercase;
      font-weight:700;
    }
    a{
      color: var(--linkRest);
      text-decoration:none;
      cursor:pointer;
      transition: color .15s ease;
    }
    a:hover{ color: var(--linkHover); }

    /* ===== KETA NOTE (GLOBAL) ===== */
    .ketaNote{
      position:fixed;
      right:12px;
      bottom:12px;
      z-index:60;
      width: min(520px, calc(100vw - 24px));
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(10px);
      display:none;
    }
    .ketaNote.show{ display:block; }
    .ketaHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 8px 10px;
      border-bottom:1px solid rgba(255,255,255,.14);
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-weight:900;
      user-select:none;
    }
    .ketaBody{
      display:flex;
      gap:10px;
      padding:10px;
    }
    .ketaIconCol{
      padding-top:3px;
    }
    textarea{
      width:100%;
      min-height: 150px;
      background: transparent;
      border:none;
      outline:none;
      resize: vertical;
      color: #fff;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 14px;
      line-height: 1.25;
    }
    .hbtn{
      width:28px;height:22px;
      display:inline-flex;align-items:center;justify-content:center;
      border:1px solid rgba(255,255,255,0.22);
      background: rgba(0,0,0,0.35);
      color: rgba(255,255,255,0.85);
      cursor:pointer;
      font-weight:900;
    }
    .hbtn:hover{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,0.42); }

    /* ===== utility ===== */
    .lbl{ display:block; margin-top:10px; margin-bottom:6px; font-size:10px; letter-spacing:.18em; text-transform:uppercase; color:rgba(255,255,255,.55); }
    input[type="range"]{ width:100%; }
    input[type="color"]{
      width:100%;
      height:30px;
      border:1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.4);
      padding:0;
    }
    input[type="number"], input[type="text"]{
      width:100%;
      height:30px;
      border:1px solid rgba(255,255,255,0.2);
      background: rgba(0,0,0,0.35);
      color:#fff;
      padding:0 8px;
      outline:none;
    }
    .twoCol{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    /* invert */
    body.invert{
      filter: invert(1) hue-rotate(180deg);
      background:#fff;
    }

    /* null mode: hide hud + note (but page still exists) */
    body.nullMode #hud,
    body.nullMode .ketaNote{
      display:none !important;
    }
  </style>
</head>

<body>
  <div id="bgLayer"></div>
  <div id="motionLayer"></div>
  <div id="grain"></div>

  <!-- HUD -->
  <div id="hud">
    <div class="panel" id="panel">
      <div class="row">
        <div class="mini"><b>STUDIO</b> / CONTROLS</div>
        <div style="display:flex; gap:8px; align-items:center;">
          <button class="btn" id="btnMotion" type="button">MOTION</button>
          <button class="btn" id="btnInvert" type="button">INVERT</button>
          <button class="btn" id="btnNull" type="button">NULL</button>
          <button class="noteIconBtn" id="btnNote" type="button" title="KETA_NOTE"><span class="ketaSquare"></span></button>
          <button class="hbtn" id="btnCollapse" type="button" title="Collapse">—</button>
        </div>
      </div>

      <span class="lbl">MOTION SPEED</span>
      <input id="motionSpeed" type="range" min="0" max="1.2" step="0.01" value="0.55" />

      <span class="lbl">PURPLE GRADIENT</span>
      <div class="twoCol">
        <div>
          <div class="mini2">BG 1</div>
          <input id="bg1" type="color" value="#0a0010" />
        </div>
        <div>
          <div class="mini2">BG 2</div>
          <input id="bg2" type="color" value="#2a0066" />
        </div>
      </div>
      <div class="twoCol" style="margin-top:8px;">
        <div>
          <div class="mini2">BG 3</div>
          <input id="bg3" type="color" value="#5a00ff" />
        </div>
        <div>
          <div class="mini2">BG 4</div>
          <input id="bg4" type="color" value="#24002f" />
        </div>
      </div>

      <span class="lbl">ANGLE</span>
      <input id="angle" type="range" min="0" max="360" step="1" value="145" />

      <span class="lbl">TEXT</span>
      <div class="twoCol">
        <div>
          <div class="mini2">COLOR</div>
          <input id="txt" type="color" value="#ffffff" />
        </div>
        <div>
          <div class="mini2">UI SIZE</div>
          <input id="uiSize" type="number" min="10" max="18" step="1" value="12" />
        </div>
      </div>

      <!-- TEXT SIZE CONTROLS -->
      <div class="twoCol" style="margin-top:8px;">
        <div>
          <div class="mini2">TITLE MIN</div>
          <input id="titleMin" type="range" min="36" max="120" step="1" value="56" />
        </div>
        <div>
          <div class="mini2">TITLE MAX</div>
          <input id="titleMax" type="range" min="120" max="260" step="1" value="180" />
        </div>
      </div>

      <div class="twoCol" style="margin-top:8px;">
        <div>
          <div class="mini2">LINK SIZE</div>
          <input id="linkSize" type="range" min="10" max="18" step="1" value="11" />
        </div>
        <div></div>
      </div>
    </div>
  </div>

  <!-- GLOBAL KETA_NOTE -->
  <div class="ketaNote" id="ketaNote">
    <div class="ketaHead" id="ketaHead">
      <div>KETA_NOTE</div>
      <button class="hbtn" id="btnHideNote" type="button">-</button>
    </div>
    <div class="ketaBody">
      <div class="ketaIconCol"><span class="ketaSquare"></span></div>
      <textarea id="ketaText" placeholder="GLOBAL NOTE" spellcheck="false"></textarea>
    </div>
  </div>

  <!-- LANDING -->
  <section class="landing" id="top">
    <div class="landingTitleWrap">
      <h1 class="title">KETADATA [STUDIO]</h1>
      <div class="sub">[DIRECTORY]</div>
    </div>
  </section>

  <!-- DIRECTORY -->
  <section class="directory" id="directory">
    <div class="dirBox">
      <div class="dirHead">
        <div class="t">STUDIO DIRECTORY</div>
        <div class="mini">LINKS ONLY</div>
      </div>
      <div class="dirGrid" id="dirGrid"></div>
    </div>
  </section>

  <script>
    const SHELL_HOME_URL = "system.html";
    const LANDING_URL = "index11.html";
    const GLOBAL_KETA_NOTE_KEY = "KDT_GLOBAL_KETA_NOTE_V1";

    const FILE_ID = "KETADATA_STUDIO";
    const ROOM_ID = "STUDIO";
    const VERSION_ID = "studio.v6_centered_small_margins";
    const STORAGE_KEY = `KDT::STATE::${FILE_ID}::${ROOM_ID}::${VERSION_ID}`;

    const DIRECTORY = [
      { group:"INTERFACE DESIGN", items:[
        ["[CONTROLLER1.HTML]","controller1.html"],
        ["[COLOR1.HTML]","color1.html"],
        ["[COLOR3.HTML]","color3.html"],
        ["[FONT.HTML]","font.html"],
        ["[PROMPT.HTML → 6.HTML]","prompt.html"],
        ["[REF.HTML]","ref.html"],
        ["[COLOR5.HTML]","color5.html"],
        ["[CONTROLLER3.HTML]","controller3.html"]
      ]},
      { group:"MOOD-BOARDS", items:[
        ["[STUDIO.HTML]","studio.html"],
        ["[BOARD3.HTML]","board3.html"]
      ]},
      { group:"UGLY DUCKLINGS & VARIANTS", items:[
        ["[DARKROOM.HTML]","darkroom.html"],
        ["[CONTROLLER2.HTML]","controller2.html"],
        ["[CONTROLLER.HTML]","controller.html"]
      ]},
      { group:"DATA PRODUCTION", items:[
        ["[STUDIO.HTML]","studio.html"],
        ["[STUDIOV1.HTML]","studiov1.html"],
        ["[EDITOR.HTML]","editor.html"]
      ]}
    ];

    const DEFAULT = {
      ui:{ invert:false, nullMode:false, lightPreset:1, lightRunning:false, panelVisible:true, panelCollapsed:true, noteVisible:false },
      motion:{ on:true, speed:0.55 },
      colors:{ bg1:"#0a0010", bg2:"#2a0066", bg3:"#5a00ff", bg4:"#24002f", angle:145, txt:"#ffffff", uiSize:12 },
      type:{ titleMin:56, titleMax:180, linkSize:11 }
    };

    const $=(id)=>document.getElementById(id);
    const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));

    function loadState(){
      try{ const raw=localStorage.getItem(STORAGE_KEY); return raw?JSON.parse(raw):null; }catch(e){ return null; }
    }
    function mergeDefault(s){
      const out=structuredClone(DEFAULT);
      s=s||{};
      out.ui = Object.assign(structuredClone(DEFAULT.ui), s.ui||{});
      out.motion = Object.assign(structuredClone(DEFAULT.motion), s.motion||{});
      out.colors = Object.assign(structuredClone(DEFAULT.colors), s.colors||{});
      out.type = Object.assign(structuredClone(DEFAULT.type), s.type||{});
      return out;
    }
    let STATE = mergeDefault(loadState());

    function persist(){
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(STATE)); }catch(e){}
      renderHud();
    }

    function loadGlobalNote(){ try{ return localStorage.getItem(GLOBAL_KETA_NOTE_KEY)||""; }catch(e){ return ""; } }
    function saveGlobalNote(v){ try{ localStorage.setItem(GLOBAL_KETA_NOTE_KEY, String(v||"")); }catch(e){} }

    const ui = {
      hud:$("hud"),
      panel:$("panel"),
      btnMotion:$("btnMotion"),
      btnInvert:$("btnInvert"),
      btnNull:$("btnNull"),
      btnNote:$("btnNote"),
      btnCollapse:$("btnCollapse"),
      motionSpeed: $("motionSpeed"),
      bg1: $("bg1"), bg2:$("bg2"), bg3:$("bg3"), bg4:$("bg4"),
      angle:$("angle"), txt:$("txt"), uiSize:$("uiSize"),
      titleMin:$("titleMin"),
      titleMax:$("titleMax"),
      linkSize:$("linkSize"),
      ketaNote:$("ketaNote"),
      btnHideNote:$("btnHideNote"),
      ketaText:$("ketaText"),
      bgLayer:$("bgLayer")
    };

    function syncInputs(){
      const c = STATE.colors;
      ui.bg1.value=c.bg1; ui.bg2.value=c.bg2; ui.bg3.value=c.bg3; ui.bg4.value=c.bg4;
      ui.angle.value=String(c.angle||145);
      ui.txt.value=c.txt;
      ui.uiSize.value=String(c.uiSize||12);

      ui.titleMin.value = String((STATE.type && STATE.type.titleMin) ?? 56);
      ui.titleMax.value = String((STATE.type && STATE.type.titleMax) ?? 180);
      ui.linkSize.value = String((STATE.type && STATE.type.linkSize) ?? 11);

      ui.btnMotion.classList.toggle("on", !!STATE.motion.on);
      ui.btnInvert.classList.toggle("on", !!STATE.ui.invert);
      ui.btnNull.classList.toggle("on", !!STATE.ui.nullMode);

      if(STATE.ui.panelCollapsed) ui.hud.classList.add("collapsed"); else ui.hud.classList.remove("collapsed");
      ui.panel.style.display = STATE.ui.panelCollapsed ? "none" : "block";

      if(STATE.ui.noteVisible) ui.ketaNote.classList.add("show"); else ui.ketaNote.classList.remove("show");
    }

    function applyVars(){
      const c = STATE.colors;
      document.documentElement.style.setProperty("--bg1", c.bg1);
      document.documentElement.style.setProperty("--bg2", c.bg2);
      document.documentElement.style.setProperty("--bg3", c.bg3);
      document.documentElement.style.setProperty("--bg4", c.bg4);
      document.documentElement.style.setProperty("--angle", (c.angle||145) + "deg");
      document.documentElement.style.setProperty("--txt", c.txt || "#fff");
      document.documentElement.style.setProperty("--uiSize", (c.uiSize||12) + "px");

      const t = STATE.type || {};
      document.documentElement.style.setProperty("--titleMinPx", clamp(parseInt(t.titleMin,10)||56, 36, 120) + "px");
      document.documentElement.style.setProperty("--titleMaxPx", clamp(parseInt(t.titleMax,10)||180, 120, 260) + "px");
      document.documentElement.style.setProperty("--linkSizePx", clamp(parseInt(t.linkSize,10)||11, 10, 18) + "px");

      document.body.classList.toggle("invert", !!STATE.ui.invert);
      document.body.classList.toggle("nullMode", !!STATE.ui.nullMode);

      ui.bgLayer.classList.toggle("off", !STATE.motion.on);
    }

    function renderDirectory(){
      const grid = $("dirGrid");
      grid.innerHTML = "";
      DIRECTORY.forEach(block=>{
        const wrap = document.createElement("div");
        wrap.className="group";
        const h = document.createElement("div");
        h.className="groupTitle";
        h.textContent = block.group;
        wrap.appendChild(h);

        const links = document.createElement("div");
        links.className="links";
        block.items.forEach(([label,url])=>{
          const a = document.createElement("a");
          a.textContent = label;
          a.href = url;
          a.addEventListener("click",(e)=>{
            // allow navigation normally
          });
          links.appendChild(a);
        });
        wrap.appendChild(links);
        grid.appendChild(wrap);
      });
    }

    function renderHud(){
      // minimal: nothing fancy; state already applied
    }

    function togglePanel(){
      STATE.ui.panelCollapsed = !STATE.ui.panelCollapsed;
      persist(); syncInputs(); applyVars();
    }
    function toggleNote(){
      STATE.ui.noteVisible = !STATE.ui.noteVisible;
      persist(); syncInputs(); applyVars();
    }
    function toggleInvert(){
      STATE.ui.invert = !STATE.ui.invert;
      persist(); syncInputs(); applyVars();
    }
    function toggleNull(){
      STATE.ui.nullMode = !STATE.ui.nullMode;
      persist(); syncInputs(); applyVars();
    }
    function toggleMotion(){
      STATE.motion.on = !STATE.motion.on;
      persist(); syncInputs(); applyVars();
    }

    function updateColorsFromInputs(){
      STATE.colors.bg1 = ui.bg1.value;
      STATE.colors.bg2 = ui.bg2.value;
      STATE.colors.bg3 = ui.bg3.value;
      STATE.colors.bg4 = ui.bg4.value;
      STATE.colors.angle = parseInt(ui.angle.value,10)||145;
      STATE.colors.txt = ui.txt.value;
      STATE.colors.uiSize = parseInt(ui.uiSize.value,10)||12;
      persist(); applyVars();
    }

    function updateTypeFromInputs(){
      STATE.type = STATE.type || { titleMin:56, titleMax:180, linkSize:11 };
      STATE.type.titleMin = parseInt(ui.titleMin.value,10)||56;
      STATE.type.titleMax = parseInt(ui.titleMax.value,10)||180;
      STATE.type.linkSize = parseInt(ui.linkSize.value,10)||11;
      persist(); applyVars();
    }

    // ===== events =====
    ui.btnCollapse.addEventListener("click", togglePanel);
    ui.btnNote.addEventListener("click", toggleNote);
    ui.btnInvert.addEventListener("click", toggleInvert);
    ui.btnNull.addEventListener("click", toggleNull);
    ui.btnMotion.addEventListener("click", toggleMotion);

    ui.btnHideNote.addEventListener("click", ()=>{
      STATE.ui.noteVisible = false;
      persist(); syncInputs(); applyVars();
    });

    ui.ketaText.value = loadGlobalNote();
    ui.ketaText.addEventListener("input", ()=>{
      saveGlobalNote(ui.ketaText.value);
    });

    [ui.motionSpeed].forEach(el=>{
      el.addEventListener("input", ()=>{
        STATE.motion.speed = parseFloat(ui.motionSpeed.value)||0.55;
        persist();
      });
    });

    [ui.bg1, ui.bg2, ui.bg3, ui.bg4, ui.angle, ui.txt, ui.uiSize].forEach(el=>{
      el.addEventListener("input", updateColorsFromInputs);
      el.addEventListener("change", updateColorsFromInputs);
    });

    [ui.titleMin, ui.titleMax, ui.linkSize].forEach(el=>{
      el.addEventListener("input", updateTypeFromInputs);
      el.addEventListener("change", updateTypeFromInputs);
    });

    // ===== hotkeys (kept simple; existing behavior preserved) =====
    window.addEventListener("keydown", (e)=>{
      if(e.repeat) return;

      const k = e.key.toLowerCase();
      const shift = e.shiftKey;

      if(shift && k === "i"){ e.preventDefault(); toggleInvert(); }
      if(k === " "){ e.preventDefault(); toggleMotion(); }

      if(shift && k === "0"){ e.preventDefault(); toggleNull(); }

      // Note toggle: n
      if(k === "n" && !shift){ toggleNote(); }
    });

    // ===== motion layer (simple drifting blobs) =====
    let t0 = performance.now();
    let intent = 0;
    let lastDir = 0;
    function tick(now){
      const dt = (now - t0) / 1000;
      t0 = now;

      const on = STATE.motion.on;
      const sp = (STATE.motion.speed ?? 0.55) * 0.35;

      if(on){
        intent += dt * sp;
        const ax = 18 + Math.sin(intent*0.9) * 6;
        const ay = 20 + Math.cos(intent*1.1) * 6;
        const bx = 78 + Math.cos(intent*0.7) * 7;
        const by = 28 + Math.sin(intent*0.8) * 6;
        const cx = 28 + Math.sin(intent*0.6) * 7;
        const cy = 86 + Math.cos(intent*0.7) * 5;
        const dx = 86 + Math.cos(intent*0.9) * 6;
        const dy = 82 + Math.sin(intent*0.6) * 5;

        document.documentElement.style.setProperty("--aX", ax.toFixed(2) + "%");
        document.documentElement.style.setProperty("--aY", ay.toFixed(2) + "%");
        document.documentElement.style.setProperty("--bX", bx.toFixed(2) + "%");
        document.documentElement.style.setProperty("--bY", by.toFixed(2) + "%");
        document.documentElement.style.setProperty("--cX", cx.toFixed(2) + "%");
        document.documentElement.style.setProperty("--cY", cy.toFixed(2) + "%");
        document.documentElement.style.setProperty("--dX", dx.toFixed(2) + "%");
        document.documentElement.style.setProperty("--dY", dy.toFixed(2) + "%");
      }
      requestAnimationFrame(tick);
    }

    // ===== boot =====
    renderDirectory();
    syncInputs();
    applyVars();
    requestAnimationFrame(tick);

    /* =========================================================
       AE: brutal minimal title; centered; wraps safely; sharp HUD
       EE: stateful typography controls (TITLE MIN/MAX + LINK SIZE)
       WB: global note continuity separate from studio state
    ========================================================= */
  </script>
</body>
</html>

<!--
============================================================
KETADATA HTML SERIALIZATION STAMP
AE/EE/WB: AE+EE+WB
FILE_ID: KETADATA_STUDIO
ROOM_ID: STUDIO
VERSION: studio.v6_centered_small_margins.titleMinMax
UPDATED_AT: 2025-12-27T00:00:00-05:00
CHANGELOG:
- ADD TITLE MIN CONTROL (clamp min) + PERSIST
- REMOVE TITLE NOWRAP TO PREVENT CLIP ON SMALL SCREENS
============================================================
-->

