<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KETADATA_SURFACE_WALL // 4 COL</title>
<style>
:root{
  --bg:#000;
  --ink:rgba(255,255,255,.86);
  --muted:rgba(255,255,255,.52);
  --line:rgba(255,255,255,.14);
  --line2:rgba(255,255,255,.24);

  --mono: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
  --sans: Arial, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

  --t:44px;
  --pad:10px;
  --gap:10px;

  /* wall geometry */
  --tileH: 260px;
  --radius:0px;
}
*{box-sizing:border-box}
html,body{height:100%; margin:0}
body{
  background:var(--bg);
  color:var(--ink);
  font-family:var(--sans);
  overflow:hidden;
  font-size:14px; /* uniform size law */
  letter-spacing:.2px;
}
a{color:inherit; text-decoration:none}
button,input,textarea{font:inherit; color:inherit; background:transparent; border-radius:var(--radius)}
textarea{resize:none}

/* top */
#top{
  position:fixed; inset:0 0 auto 0; height:var(--t);
  display:flex; align-items:center; justify-content:space-between;
  padding:0 var(--pad);
  border-bottom:1px solid var(--line);
  background:rgba(0,0,0,.82);
  backdrop-filter: blur(8px);
  z-index:50;
}
#top .left,#top .right{display:flex; align-items:center; gap:8px; min-width:0}
.badge{
  padding:4px 8px;
  border:1px solid var(--line2);
  opacity:.92;
  white-space:nowrap;
}
.small{opacity:.72}
.sep{width:1px; height:18px; background:var(--line); margin:0 4px}
.btn{
  padding:6px 10px;
  border:1px solid var(--line2);
  cursor:pointer;
  user-select:none;
}
.btn:hover{border-color:rgba(255,255,255,.46)}
.btn:active{transform: translateY(1px)}
.btn.danger{border-color:rgba(255,255,255,.32); opacity:.92}
.btn.danger:hover{border-color:rgba(255,255,255,.62)}
input[type="text"]{
  padding:6px 8px;
  border:1px solid var(--line2);
  min-width: 260px;
}

/* wrap */
#wrap{
  position:fixed; inset:var(--t) 0 0 0;
  overflow:auto;
  padding:var(--gap);
}

/* 4-col wall */
#grid{
  display:grid;
  grid-template-columns: repeat(4, minmax(320px, 1fr));
  gap:var(--gap);
  align-items:start;
}
@media (max-width: 1680px){ #grid{ grid-template-columns: repeat(3, minmax(320px, 1fr)); } }
@media (max-width: 1280px){ #grid{ grid-template-columns: repeat(2, minmax(320px, 1fr)); } }
@media (max-width: 860px){  #grid{ grid-template-columns: 1fr; } }

/* tile */
.tile{
  border:1px solid var(--line);
  background:rgba(255,255,255,.02);
}
.tHead{
  display:flex; align-items:center; justify-content:space-between;
  gap:8px;
  padding:8px 10px;
  border-bottom:1px solid var(--line);
}
.tHead .left{
  display:flex; align-items:center; gap:8px; min-width:0; flex:1;
}
.name{
  border:1px solid transparent;
  padding:4px 6px;
  min-width:120px;
  max-width: 260px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.name[contenteditable="true"]{border-color:var(--line2); outline:none}
.meta{opacity:.62; white-space:nowrap}
.tools{display:flex; gap:6px; align-items:center}
.pill{
  padding:4px 8px;
  border:1px solid var(--line2);
  opacity:.86;
}

.tBody{
  height:var(--tileH);
  display:flex;
  flex-direction:column;
}
.preview{
  position:relative;
  flex:1;
  background:#000;
}
.preview iframe{
  position:absolute; inset:0;
  width:100%; height:100%;
  border:0;
  background:#000;
}
.foot{
  display:flex;
  gap:8px;
  padding:8px 10px;
  border-top:1px solid var(--line);
  align-items:center;
  justify-content:space-between;
}
.url{
  flex:1;
  min-width:0;
  padding:6px 8px;
  border:1px solid var(--line2);
}
.url::placeholder{color:rgba(255,255,255,.35)}
.stat{opacity:.62; white-space:nowrap}

/* overlay */
#overlay{
  position:fixed; inset:0;
  background:rgba(0,0,0,.92);
  display:none;
  z-index:80;
}
#overlay.open{display:block}
#ovTop{
  position:absolute; inset:0 0 auto 0; height:var(--t);
  display:flex; align-items:center; justify-content:space-between;
  padding:0 var(--pad);
  border-bottom:1px solid var(--line);
  background:rgba(0,0,0,.82);
}
#ovFrame{
  position:absolute; inset:var(--t) 0 0 0;
  width:100%; height:calc(100% - var(--t));
  border:0;
  background:#000;
}
</style>
</head>
<body>

<div id="top">
  <div class="left">
    <div class="badge">KETADATA_SURFACE_WALL</div>
    <div class="badge small" id="sig">LOCAL</div>
    <div class="sep"></div>
    <div class="small">PASTE/TYPE URLS → WALL PREVIEW</div>
  </div>
  <div class="right">
    <input id="filter" type="text" placeholder="FILTER (name or url)"/>
    <div class="small" id="count">0</div>
    <button class="btn" id="addBtn" title="Add tile (A)">ADD</button>
    <button class="btn" id="exportBtn">EXPORT</button>
    <button class="btn" id="importBtn">IMPORT</button>
    <button class="btn danger" id="wipeBtn">WIPE</button>
  </div>
</div>

<div id="wrap"><div id="grid"></div></div>

<div id="overlay">
  <div id="ovTop">
    <div class="left">
      <div class="badge" id="ovTitle">FULL</div>
      <div class="badge small" id="ovMeta">—</div>
    </div>
    <div class="right">
      <button class="btn" id="ovClose" title="Close (ESC)">CLOSE</button>
    </div>
  </div>
  <iframe id="ovFrame"></iframe>
</div>

<script>
const KEY = "KETADATA_SURFACE_WALL_V1";
const DEFAULT_TILES = 12;

const $ = (id)=>document.getElementById(id);

function nowISO(){
  const d=new Date();
  const z=(n)=>String(n).padStart(2,"0");
  return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())} ${z(d.getHours())}:${z(d.getMinutes())}:${z(d.getSeconds())}`;
}
function uid(){
  return Math.random().toString(16).slice(2)+Math.random().toString(16).slice(2);
}

let STATE = { version: 1, updatedAt: nowISO(), tiles: [] };
let FILTER = "";

function mkTile(name){
  return {
    id: uid(),
    name: name || "SURFACE",
    url: "",
    createdAt: nowISO(),
    updatedAt: nowISO()
  };
}

function load(){
  try{
    const raw = localStorage.getItem(KEY);
    if(raw){
      const j = JSON.parse(raw);
      if(j && Array.isArray(j.tiles)) STATE = j;
    }
  }catch(e){}
  if(!STATE.tiles.length){
    for(let i=1;i<=DEFAULT_TILES;i++){
      STATE.tiles.push(mkTile("SURFACE "+String(i).padStart(2,"0")));
    }
  }
  save(false);
}

function save(doRender=true){
  STATE.updatedAt = nowISO();
  try{ localStorage.setItem(KEY, JSON.stringify(STATE)); }catch(e){}
  if(doRender) render();
}

function escapeHtml(s){
  return (s||"")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");
}

function updateTile(id, patch){
  const idx = STATE.tiles.findIndex(t=>t.id===id);
  if(idx<0) return;
  STATE.tiles[idx] = {...STATE.tiles[idx], ...patch, updatedAt: nowISO()};
  save();
}

function removeTile(id){
  const idx = STATE.tiles.findIndex(t=>t.id===id);
  if(idx<0) return;
  STATE.tiles.splice(idx,1);
  save();
}

function moveTile(id, dir){
  const i = STATE.tiles.findIndex(t=>t.id===id);
  if(i<0) return;
  const j = i + dir;
  if(j<0 || j>=STATE.tiles.length) return;
  const tmp = STATE.tiles[i];
  STATE.tiles[i] = STATE.tiles[j];
  STATE.tiles[j] = tmp;
  save();
}

function download(filename, text){
  const blob = new Blob([text], {type:"application/json;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
}

function promptImport(){
  const raw = prompt("PASTE JSON EXPORT HERE:");
  if(!raw) return;
  try{
    const j = JSON.parse(raw);
    if(!j || !Array.isArray(j.tiles)) throw new Error("bad");
    STATE = {
      version: Number(j.version)||1,
      updatedAt: nowISO(),
      tiles: j.tiles.map(t=>({
        id: t.id || uid(),
        name: (t.name||"SURFACE").slice(0,120),
        url: String(t.url||""),
        createdAt: t.createdAt || nowISO(),
        updatedAt: nowISO()
      }))
    };
    save();
  }catch(e){
    alert("IMPORT FAILED");
  }
}

/* overlay */
function openOverlay(tile){
  $("overlay").classList.add("open");
  $("ovTitle").textContent = tile.name || "FULL";
  $("ovMeta").textContent = tile.url ? tile.url : "—";
  // if blank, show empty page
  $("ovFrame").src = tile.url || "about:blank";
}
function closeOverlay(){
  $("ovFrame").src = "about:blank";
  $("overlay").classList.remove("open");
}

/* render */
function render(){
  $("sig").textContent = `LOCAL // ${STATE.updatedAt}`;

  const q = (FILTER||"").trim().toLowerCase();
  const tiles = !q ? STATE.tiles : STATE.tiles.filter(t=>{
    const a = (t.name||"").toLowerCase();
    const b = (t.url||"").toLowerCase();
    return a.includes(q) || b.includes(q);
  });

  $("count").textContent = `${tiles.length}/${STATE.tiles.length}`;

  const grid = $("grid");
  grid.innerHTML = "";

  tiles.forEach((tile, n)=>{
    const el = document.createElement("div");
    el.className = "tile";
    el.dataset.id = tile.id;

    el.innerHTML = `
      <div class="tHead">
        <div class="left">
          <div class="name" contenteditable="true" spellcheck="false">${escapeHtml(tile.name||"SURFACE")}</div>
          <div class="meta">#${String(STATE.tiles.findIndex(x=>x.id===tile.id)+1).padStart(2,"0")}</div>
        </div>
        <div class="tools">
          <button class="btn" data-act="full">FULL</button>
          <button class="btn" data-act="up">UP</button>
          <button class="btn" data-act="down">DOWN</button>
          <button class="btn danger" data-act="del">DEL</button>
        </div>
      </div>

      <div class="tBody">
        <div class="preview">
          <iframe sandbox="allow-scripts allow-forms allow-popups allow-modals allow-downloads allow-pointer-lock" loading="lazy"></iframe>
        </div>
        <div class="foot">
          <input class="url" type="text" placeholder="file:///... or http(s)://... or ./relative.html" value="${escapeHtml(tile.url||"")}"/>
          <div class="stat">${tile.url ? "ON" : "—"}</div>
        </div>
      </div>
    `;

    /* rename */
    const name = el.querySelector(".name");
    name.addEventListener("blur", ()=>{
      const v = name.textContent.trim() || "SURFACE";
      updateTile(tile.id, {name: v});
    });

    /* url */
    const url = el.querySelector(".url");
    const fr = el.querySelector("iframe");
    function paint(u){
      fr.src = u || "about:blank";
      el.querySelector(".stat").textContent = u ? "ON" : "—";
    }
    paint(tile.url||"");

    let debounce=null;
    url.addEventListener("input", ()=>{
      if(debounce) clearTimeout(debounce);
      debounce=setTimeout(()=>{
        updateTile(tile.id, {url: url.value.trim()});
      }, 180);
    });

    /* tools */
    el.querySelectorAll("button[data-act]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const act = btn.dataset.act;
        if(act==="full") return openOverlay(tile);
        if(act==="up") return moveTile(tile.id, -1);
        if(act==="down") return moveTile(tile.id, +1);
        if(act==="del"){
          if(confirm("DELETE THIS TILE?")) removeTile(tile.id);
          return;
        }
      });
    });

    grid.appendChild(el);
  });
}

/* top controls */
$("filter").addEventListener("input", ()=>{
  FILTER = $("filter").value || "";
  render();
});
$("addBtn").addEventListener("click", ()=>{
  STATE.tiles.push(mkTile("SURFACE "+String(STATE.tiles.length+1).padStart(2,"0")));
  save();
});
$("exportBtn").addEventListener("click", ()=>{
  download(`KETADATA_SURFACE_WALL_EXPORT_${new Date().toISOString().slice(0,10)}.json`, JSON.stringify(STATE));
});
$("importBtn").addEventListener("click", promptImport);
$("wipeBtn").addEventListener("click", ()=>{
  if(confirm("WIPE ALL TILES?")){
    STATE.tiles = [];
    for(let i=1;i<=DEFAULT_TILES;i++){
      STATE.tiles.push(mkTile("SURFACE "+String(i).padStart(2,"0")));
    }
    save();
  }
});

/* overlay controls */
$("ovClose").addEventListener("click", closeOverlay);
$("overlay").addEventListener("click", (e)=>{
  if(e.target.id==="overlay") closeOverlay();
});
window.addEventListener("keydown", (e)=>{
  if(e.key==="Escape"){
    if($("overlay").classList.contains("open")){ e.preventDefault(); closeOverlay(); }
  }
  if((e.key==="a"||e.key==="A") && !e.metaKey && !e.ctrlKey && !e.altKey){
    const tag=(document.activeElement && document.activeElement.tagName || "").toLowerCase();
    if(tag!=="input" && tag!=="textarea"){
      e.preventDefault();
      $("addBtn").click();
    }
  }
});

/* boot */
load();
render();
</script>

<!--
AE: KETA_MONO (black wall; uniform text size; minimal chrome)
EE: SURFACE_WALL_V1 (4-col wall; url→preview; filter; reorder; fullscreen; export/import; localStorage)
WB: DOM_BINDINGS + LOCAL_STORAGE_KEY (KEY=KETADATA_SURFACE_WALL_V1)

FILE_ID: KETADATA_SURFACE_WALL.html
ROOM_ID: BASE_UTIL
VERSION: 1
UPDATED_AT: 2026-01-10
CHANGELOG:
- v1: wall of URL surfaces with iframe preview + fullscreen + filter + reorder.
-->
</body>
</html>
