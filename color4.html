<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KETADATA — COLOR CONTROLLER</title>
  <style>
    :root{
      --void:#000;
      --panel:#0b0b0b;
      --line: rgba(255,255,255,.10);
      --hair: rgba(255,255,255,.14);
      --txt: rgba(255,255,255,.88);
      --muted: rgba(255,255,255,.55);
      --steel:#666;

      /* “Aggressive light” accents */
      --signal:#ff2a2a;     /* hot red */
      --uv:#7a00ff;         /* UV violet */
      --cyan:#00eaff;       /* xray-cyan */

      --ui: Arial, Helvetica, sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(circle at 20% 20%, rgba(122,0,255,.12), transparent 55%),
                  radial-gradient(circle at 80% 20%, rgba(0,234,255,.10), transparent 55%),
                  radial-gradient(circle at 50% 90%, rgba(255,42,42,.10), transparent 55%),
                  #000;
      color:var(--txt);
      font-family:var(--ui);
      overflow-x:hidden;
    }

    /* decluttered top */
    header{
      position:sticky; top:0;
      z-index:10;
      background: linear-gradient(to bottom, rgba(0,0,0,.88), rgba(0,0,0,.55));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding: 10px 14px;
      max-width: 1260px;
      margin: 0 auto;
    }
    .brand{
      display:flex; align-items:baseline; gap:10px;
      font-family:var(--mono);
      letter-spacing:.18em;
      text-transform:uppercase;
      font-size:12px;
      color: rgba(255,255,255,.78);
      white-space:nowrap;
    }
    .brand b{ color:#fff; letter-spacing:.22em; }
    .nav{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
    }
    .nav a{
      color:#666;
      text-decoration:none;
      padding:6px 8px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.02);
    }
    .nav a:hover{ color:#fff; border-color: rgba(255,255,255,.28); background: rgba(255,255,255,.04); }

    main{
      max-width: 1260px;
      margin: 0 auto;
      padding: 14px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 14px;
      min-height: calc(100vh - 54px);
    }
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
    }

    .panel{
      background: linear-gradient(to bottom, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border: 1px solid var(--hair);
      box-shadow: 0 0 0 1px rgba(0,0,0,.9) inset;
      overflow:hidden;
    }
    .ph{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      background: rgba(0,0,0,.40);
    }
    .ph .t{
      font-family:var(--mono);
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size:11px;
      color: rgba(255,255,255,.85);
    }
    .ph .s{
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.12em;
      color: rgba(255,255,255,.50);
      white-space:nowrap;
    }
    .body{
      padding: 12px;
    }

    /* controls */
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 680px){
      .grid{ grid-template-columns: 1fr; }
    }
    .row{
      display:flex; flex-direction:column; gap:6px;
      padding: 10px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.30);
    }
    label{
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color: rgba(255,255,255,.70);
      display:flex; justify-content:space-between; gap:10px;
    }
    label span{ color: rgba(255,255,255,.45); }
    input[type="range"]{ width:100%; }
    input[type="text"], input[type="number"], select{
      width:100%;
      padding: 10px 10px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.35);
      color: rgba(255,255,255,.92);
      outline:none;
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.12em;
    }
    input[type="text"]::placeholder{ color: rgba(255,255,255,.28); }
    .btns{ display:flex; gap:10px; flex-wrap:wrap; }
    button{
      cursor:pointer;
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      padding: 9px 10px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color: #666;
    }
    button:hover{ color:#fff; border-color: rgba(255,255,255,.28); background: rgba(255,255,255,.06); }
    button.danger{ border-color: rgba(255,42,42,.35); }
    button.danger:hover{ color:#fff; background: rgba(255,42,42,.12); }

    /* preview */
    .preview{
      height: 320px;
      border: 1px solid var(--line);
      background: #000;
      position:relative;
      overflow:hidden;
    }
    .preview::before{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle at var(--gx) var(--gy), var(--ga), var(--gb), rgba(0,0,0,1) 70%);
      filter: contrast(1.15) saturate(1.1);
      transform: rotate(var(--rot));
    }
    .preview::after{
      content:"";
      position:absolute; inset:0;
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset;
      pointer-events:none;
    }
    .previewText{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      text-align:center;
      padding: 18px;
      font-weight: 900;
      letter-spacing: .08em;
      text-transform:uppercase;
      line-height: .95;
      color: var(--tx);
      text-shadow: 0 0 24px rgba(0,0,0,.65);
      user-select:none;
    }
    .previewText small{
      display:block;
      margin-top: 10px;
      font-family: var(--mono);
      font-weight: 800;
      letter-spacing: .16em;
      font-size: 11px;
      color: rgba(255,255,255,.55);
      text-transform:none;
    }
    .big{
      font-size: clamp(48px, 6vw, 92px);
      font-family: var(--nameFont, Arial);
    }

    /* swatch strip */
    .swatches{
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    @media (max-width: 680px){
      .swatches{ grid-template-columns: repeat(3, 1fr); }
    }
    .sw{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.35);
      padding: 8px;
      min-height: 72px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap:8px;
    }
    .chip{
      height: 26px;
      border: 1px solid rgba(255,255,255,.10);
      background: var(--c);
    }
    .meta{
      font-family:var(--mono);
      font-size:10px;
      letter-spacing:.12em;
      color: rgba(255,255,255,.68);
      display:flex; justify-content:space-between; gap:10px;
      align-items:center;
    }
    .meta button{ padding:6px 8px; font-size:10px; }

    /* collapsible tester */
    details.tester{
      border: 1px solid var(--hair);
      background: rgba(0,0,0,.32);
    }
    details.tester > summary{
      list-style:none;
      cursor:pointer;
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color: rgba(255,255,255,.80);
    }
    details.tester > summary::-webkit-details-marker{ display:none; }
    .kbd{
      font-family:var(--mono);
      border: 1px solid rgba(255,255,255,.18);
      padding: 2px 6px;
      color: rgba(255,255,255,.80);
      background: rgba(255,255,255,.03);
    }

    /* accessibility note */
    .note{
      margin-top:10px;
      font-family:var(--mono);
      font-size:11px;
      letter-spacing:.12em;
      color: rgba(255,255,255,.45);
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="brand"><b>KETA /// DATA</b><span>COLOR CONTROLLER</span></div>
      <nav class="nav" aria-label="site">
        <a href="#top">[TOP]</a>
        <a href="#vault">[VAULT]</a>
        <a href="#pal">[PALETTES]</a>
        <a href="#export">[EXPORT]</a>
      </nav>
    </div>
  </header>

  <main id="top">
    <!-- LEFT: CONTROLLER -->
    <section class="panel" id="vault">
      <div class="ph">
        <div class="t">[COLOR SELECTOR + HEX GENERATOR]</div>
        <div class="s">INPUT HEX • PICK • TUNE • EXPORT</div>
      </div>

      <div class="body">
        <div class="grid">
          <div class="row">
            <label>BASE COLOR <span>picker</span></label>
            <input id="picker" type="color" value="#ff2a2a" />
            <div class="btns">
              <button id="setBg">[SET BG]</button>
              <button id="setText">[SET TEXT]</button>
              <button id="setA">[SET GRAD A]</button>
              <button id="setB">[SET GRAD B]</button>
            </div>
          </div>

          <div class="row">
            <label>HEX INPUT <span>#RRGGBB / #RRGGBBAA</span></label>
            <input id="hexIn" type="text" placeholder="#7A00FF or #FF2A2A80" />
            <div class="btns">
              <button id="applyHex">[APPLY]</button>
              <button id="copyHex">[COPY HEX]</button>
              <button id="rand">[RANDOM]</button>
              <button class="danger" id="reset">[RESET]</button>
            </div>
          </div>

          <div class="row">
            <label>RGB <span>0–255</span></label>
            <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
              <input id="r" type="number" min="0" max="255" value="255" />
              <input id="g" type="number" min="0" max="255" value="42" />
              <input id="b" type="number" min="0" max="255" value="42" />
            </div>
            <div class="btns">
              <button id="fromRgb">[RGB → HEX]</button>
              <button id="copyRgb">[COPY RGB]</button>
            </div>
          </div>

          <div class="row">
            <label>HSL TUNING <span>hue/sat/light</span></label>
            <div>
              <label style="margin-top:2px">HUE <span id="hVal">0</span></label>
              <input id="h" type="range" min="0" max="360" value="0" />
              <label>SAT <span id="sVal">100</span></label>
              <input id="s" type="range" min="0" max="100" value="100" />
              <label>LIGHT <span id="lVal">50</span></label>
              <input id="l" type="range" min="0" max="100" value="50" />
            </div>
            <div class="btns">
              <button id="fromHsl">[HSL → HEX]</button>
              <button id="snapDarkroom">[DARKROOM RED]</button>
              <button id="snapUV">[UV]</button>
              <button id="snapMed">[MED]</button>
            </div>
          </div>

          <div class="row">
            <label>ALPHA <span id="aVal">1.00</span></label>
            <input id="a" type="range" min="0" max="1" value="1" step="0.01" />
            <div class="btns">
              <button id="copyHexA">[COPY HEXA]</button>
              <button id="copyCss">[COPY CSS]</button>
            </div>
          </div>

          <div class="row">
            <label>GRADIENT MOTION <span>radial angle</span></label>
            <label>ANGLE SPEED <span id="spdVal">0.35</span></label>
            <input id="spd" type="range" min="0" max="3" step="0.01" value="0.35" />
            <label>RADIUS SWELL <span id="swVal">0.55</span></label>
            <input id="sw" type="range" min="0" max="3" step="0.01" value="0.55" />
            <div class="btns">
              <button id="toggleMotion">[MOTION: ON]</button>
              <button id="freeze">[FREEZE]</button>
            </div>
          </div>
        </div>

        <div style="margin-top:12px;">
          <div class="preview" id="preview" style="--ga:#ff2a2a; --gb:#7a00ff; --gx:40%; --gy:40%; --rot:0deg; --tx:#ffffff;">
            <div class="previewText">
              <div>
                <div class="big" id="bigText">KETA /// DATA</div>
                <small id="metaLine">HEX: <span id="hexOut">#FF2A2A</span> • RGB: <span id="rgbOut">255, 42, 42</span></small>
              </div>
            </div>
          </div>

          <div class="swatches" aria-label="quick swatches">
            <div class="sw" style="--c:#000000">
              <div class="chip"></div>
              <div class="meta"><span>VOID</span><button data-pick="#000000">[USE]</button></div>
            </div>
            <div class="sw" style="--c:#ffffff">
              <div class="chip"></div>
              <div class="meta"><span>MIND</span><button data-pick="#ffffff">[USE]</button></div>
            </div>
            <div class="sw" style="--c:#666666">
              <div class="chip"></div>
              <div class="meta"><span>STEEL</span><button data-pick="#666666">[USE]</button></div>
            </div>
            <div class="sw" style="--c:#ff2a2a">
              <div class="chip"></div>
              <div class="meta"><span>RECORD</span><button data-pick="#ff2a2a">[USE]</button></div>
            </div>
            <div class="sw" style="--c:#4a0000">
              <div class="chip"></div>
              <div class="meta"><span>DARKROOM</span><button data-pick="#4a0000">[USE]</button></div>
            </div>
            <div class="sw" style="--c:#7a00ff">
              <div class="chip"></div>
              <div class="meta"><span>UV</span><button data-pick="#7a00ff">[USE]</button></div>
            </div>
          </div>

          <p class="note">
            SPACE = TOGGLE STROBE (if enabled in the tester) • THIS PAGE IS A COLOR/HEX TOOL (NO STORAGE).
          </p>
        </div>
      </div>
    </section>

    <!-- RIGHT: TESTER (COLLAPSIBLE) + EXPORT -->
    <section style="display:flex; flex-direction:column; gap:14px;">
      <details class="tester" open id="pal">
        <summary>
          <span>[TESTER]</span>
          <span style="display:flex; gap:10px; align-items:center;">
            <span class="kbd">SPACE</span><span style="color:rgba(255,255,255,.45);">toggle light</span>
          </span>
        </summary>
        <div class="body">
          <div class="grid">
            <div class="row">
              <label>PHRASE <span>max 11 symbols</span></label>
              <input id="phrase" type="text" maxlength="11" value="KETADATA" />
              <div class="btns">
                <button id="applyPhrase">[APPLY]</button>
                <button id="clearPhrase">[CLEAR]</button>
                <button id="centerWord">[CENTER]</button>
              </div>
            </div>

            <div class="row">
              <label>TEXT SIZE <span id="szVal">1.00</span></label>
              <input id="sz" type="range" min="0.6" max="1.6" step="0.01" value="1.00" />
              <label>NAME FONT <span>system</span></label>
              <select id="nameFont">
                <option value="Arial, Helvetica, sans-serif" selected>Arial</option>
                <option value="Helvetica Neue, Helvetica, Arial, sans-serif">Helvetica Neue</option>
                <option value="Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif">Impact</option>
                <option value="'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Franklin Gothic</option>
                <option value="'Trebuchet MS', Arial, sans-serif">Trebuchet</option>
                <option value="system-ui, -apple-system, Segoe UI, Roboto, sans-serif">System UI</option>
                <option value="'Arial Black', Arial, sans-serif">Arial Black</option>
              </select>
            </div>

            <div class="row">
              <label>LIGHT MODE <span>1–6</span></label>
              <select id="lightMode">
                <option value="1">1 / STROBE</option>
                <option value="2">2 / EMDR</option>
                <option value="3">3 / NYAN</option>
                <option value="4">4 / HEARTBEAT</option>
                <option value="5" selected>5 / UV (REAL)</option>
                <option value="6">6 / PAPARAZZI</option>
                <option value="med">[MED] / CHROMATIC</option>
              </select>
              <div class="btns">
                <button id="arm">[ARM SPACE TOGGLE]</button>
                <button id="stopLight" class="danger">[STOP]</button>
              </div>
            </div>

            <div class="row">
              <label>STROBE SPEED <span id="lsVal">25ms</span></label>
              <input id="ls" type="range" min="10" max="200" step="1" value="25" />
              <div class="btns">
                <button id="testPulse">[TEST PULSE]</button>
                <button id="safeMode">[SAFE MODE]</button>
              </div>
            </div>
          </div>

          <p class="note">
            Light effects are driven by intervals; SPACE toggles only when “ARM SPACE TOGGLE” is on.
          </p>
        </div>
      </details>

      <section class="panel" id="export">
        <div class="ph">
          <div class="t">[EXPORT]</div>
          <div class="s">COPY VALUES</div>
        </div>
        <div class="body">
          <div class="row">
            <label>CSS VARIABLES <span>clipboard</span></label>
            <input id="cssOut" type="text" readonly />
            <div class="btns">
              <button id="copyVars">[COPY VARS]</button>
              <button id="copyAll">[COPY ALL]</button>
            </div>
          </div>

          <div class="row">
            <label>BACKGROUND GRADIENT <span>css</span></label>
            <input id="gradOut" type="text" readonly />
            <div class="btns">
              <button id="copyGrad">[COPY GRAD]</button>
            </div>
          </div>

          <p class="note">
            If something doesn’t respond: check your browser allows clipboard + that this file is saved as .html and opened directly.
          </p>
        </div>
      </section>
    </section>
  </main>

  <script>
    // ---------- helpers ----------
    const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));
    const hex2 = (n)=>n.toString(16).padStart(2,"0").toUpperCase();
    function isHex(s){
      const t=(s||"").trim();
      return /^#([0-9a-fA-F]{6}|[0-9a-fA-F]{8}|[0-9a-fA-F]{3}|[0-9a-fA-F]{4})$/.test(t);
    }
    function expandHexShort(h){
      // #RGB/#RGBA -> #RRGGBB/#RRGGBBAA
      const s=h.replace("#","");
      if(s.length===3) return "#"+s.split("").map(ch=>ch+ch).join("");
      if(s.length===4) return "#"+s.split("").map(ch=>ch+ch).join("");
      return h;
    }
    function hexToRgba(hex){
      let h=expandHexShort(hex).replace("#","");
      if(h.length===6) h += "FF";
      const r=parseInt(h.slice(0,2),16);
      const g=parseInt(h.slice(2,4),16);
      const b=parseInt(h.slice(4,6),16);
      const a=parseInt(h.slice(6,8),16)/255;
      return {r,g,b,a};
    }
    function rgbaToHex(r,g,b,a=1){
      const aa = Math.round(clamp(a,0,1)*255);
      return "#"+hex2(clamp(r,0,255))+hex2(clamp(g,0,255))+hex2(clamp(b,0,255)) + (aa===255 ? "" : hex2(aa));
    }
    function rgbToHex(r,g,b){ return "#"+hex2(r)+hex2(g)+hex2(b); }

    // HSL <-> RGB (standard)
    function hslToRgb(h,s,l){
      s/=100; l/=100;
      const c=(1-Math.abs(2*l-1))*s;
      const x=c*(1-Math.abs((h/60)%2-1));
      const m=l-c/2;
      let r1=0,g1=0,b1=0;
      if(h<60){r1=c;g1=x;}
      else if(h<120){r1=x;g1=c;}
      else if(h<180){g1=c;b1=x;}
      else if(h<240){g1=x;b1=c;}
      else if(h<300){r1=x;b1=c;}
      else {r1=c;b1=x;}
      return {
        r: Math.round((r1+m)*255),
        g: Math.round((g1+m)*255),
        b: Math.round((b1+m)*255)
      };
    }
    function rgbToHsl(r,g,b){
      r/=255; g/=255; b/=255;
      const max=Math.max(r,g,b), min=Math.min(r,g,b);
      let h=0,s=0;
      const l=(max+min)/2;
      const d=max-min;
      if(d!==0){
        s = d/(1-Math.abs(2*l-1));
        switch(max){
          case r: h=60*(((g-b)/d)%6); break;
          case g: h=60*(((b-r)/d)+2); break;
          case b: h=60*(((r-g)/d)+4); break;
        }
      }
      if(h<0) h+=360;
      return { h: Math.round(h), s: Math.round(s*100), l: Math.round(l*100) };
    }

    async function copyText(t){
      try{ await navigator.clipboard.writeText(t); }
      catch(e){
        // fallback
        const ta=document.createElement("textarea");
        ta.value=t; document.body.appendChild(ta);
        ta.select(); document.execCommand("copy"); ta.remove();
      }
    }

    // ---------- elements ----------
    const picker = document.getElementById("picker");
    const hexIn = document.getElementById("hexIn");
    const hexOut = document.getElementById("hexOut");
    const rgbOut = document.getElementById("rgbOut");
    const cssOut = document.getElementById("cssOut");
    const gradOut = document.getElementById("gradOut");

    const rEl=document.getElementById("r");
    const gEl=document.getElementById("g");
    const bEl=document.getElementById("b");

    const hEl=document.getElementById("h");
    const sEl=document.getElementById("s");
    const lEl=document.getElementById("l");
    const aEl=document.getElementById("a");

    const hVal=document.getElementById("hVal");
    const sVal=document.getElementById("sVal");
    const lVal=document.getElementById("lVal");
    const aVal=document.getElementById("aVal");

    const preview=document.getElementById("preview");
    const bigText=document.getElementById("bigText");
    const metaLine=document.getElementById("metaLine");

    // gradient A/B + bg/text
    let bg = "#000000";
    let tx = "#FFFFFF";
    let ga = "#FF2A2A";
    let gb = "#7A00FF";

    function setPreview(){
      preview.style.setProperty("--tx", tx);
      preview.style.setProperty("--ga", ga);
      preview.style.setProperty("--gb", gb);
      // also push css output lines
      const {r,g,b,a} = hexToRgba(currentHex());
      hexOut.textContent = currentHex().toUpperCase();
      rgbOut.textContent = `${r}, ${g}, ${b}`;
      cssOut.value = `--void:${bg}; --mind:${tx}; --gradA:${ga}; --gradB:${gb};`;
      gradOut.value = `radial-gradient(circle at var(--gx) var(--gy), ${ga}, ${gb}, #000 70%)`;
    }

    function currentHex(){
      // current “selected” color is picker value + alpha
      const base = picker.value;
      const {r,g,b} = hexToRgba(base);
      const a = parseFloat(aEl.value);
      const hx = rgbaToHex(r,g,b,a);
      return hx.length===7 ? hx : hx; // allow hexa
    }

    function syncFromHex(hex){
      const h = expandHexShort(hex);
      const rgba = hexToRgba(h);
      // set picker to RGB only
      picker.value = rgbToHex(rgba.r, rgba.g, rgba.b);
      rEl.value = rgba.r; gEl.value = rgba.g; bEl.value = rgba.b;
      aEl.value = rgba.a.toFixed(2);
      aVal.textContent = parseFloat(aEl.value).toFixed(2);
      const hsl = rgbToHsl(rgba.r, rgba.g, rgba.b);
      hEl.value = hsl.h; sEl.value = hsl.s; lEl.value = hsl.l;
      hVal.textContent = hsl.h; sVal.textContent = hsl.s; lVal.textContent = hsl.l;
      setPreview();
    }

    function syncFromPicker(){
      const rgba = hexToRgba(picker.value);
      rEl.value = rgba.r; gEl.value = rgba.g; bEl.value = rgba.b;
      const hsl = rgbToHsl(rgba.r, rgba.g, rgba.b);
      hEl.value = hsl.h; sEl.value = hsl.s; lEl.value = hsl.l;
      hVal.textContent = hsl.h; sVal.textContent = hsl.s; lVal.textContent = hsl.l;
      setPreview();
    }

    function syncFromRgb(){
      const r=+rEl.value, g=+gEl.value, b=+bEl.value;
      picker.value = rgbToHex(r,g,b);
      const hsl = rgbToHsl(r,g,b);
      hEl.value = hsl.h; sEl.value = hsl.s; lEl.value = hsl.l;
      hVal.textContent = hsl.h; sVal.textContent = hsl.s; lVal.textContent = hsl.l;
      setPreview();
    }

    function syncFromHsl(){
      const h=+hEl.value, s=+sEl.value, l=+lEl.value;
      const rgb = hslToRgb(h,s,l);
      rEl.value = rgb.r; gEl.value = rgb.g; bEl.value = rgb.b;
      picker.value = rgbToHex(rgb.r,rgb.g,rgb.b);
      hVal.textContent = h; sVal.textContent = s; lVal.textContent = l;
      setPreview();
    }

    // ---------- wire inputs ----------
    picker.addEventListener("input", syncFromPicker);

    document.getElementById("applyHex").addEventListener("click", ()=>{
      const v=(hexIn.value||"").trim();
      if(!isHex(v)) return;
      syncFromHex(v);
    });

    document.getElementById("copyHex").addEventListener("click", ()=>copyText(currentHex().toUpperCase()));
    document.getElementById("copyHexA").addEventListener("click", ()=>copyText(currentHex().toUpperCase()));
    document.getElementById("copyRgb").addEventListener("click", ()=>{
      const {r,g,b} = hexToRgba(picker.value);
      copyText(`rgb(${r}, ${g}, ${b})`);
    });

    document.getElementById("fromRgb").addEventListener("click", syncFromRgb);
    document.getElementById("fromHsl").addEventListener("click", syncFromHsl);

    [rEl,gEl,bEl].forEach(el=> el.addEventListener("input", ()=>{ el.value=clamp(+el.value,0,255); syncFromRgb(); }));
    [hEl,sEl,lEl].forEach(el=> el.addEventListener("input", ()=>{
      hVal.textContent = hEl.value;
      sVal.textContent = sEl.value;
      lVal.textContent = lEl.value;
      syncFromHsl();
    }));
    aEl.addEventListener("input", ()=>{ aVal.textContent = parseFloat(aEl.value).toFixed(2); setPreview(); });

    document.getElementById("rand").addEventListener("click", ()=>{
      const r = Math.floor(Math.random()*256);
      const g = Math.floor(Math.random()*256);
      const b = Math.floor(Math.random()*256);
      syncFromHex(rgbToHex(r,g,b));
    });

    document.getElementById("reset").addEventListener("click", ()=>{
      bg="#000000"; tx="#FFFFFF"; ga="#FF2A2A"; gb="#7A00FF";
      syncFromHex("#FF2A2A");
      setPreview();
      applyTheme();
    });

    // quick swatches [USE]
    document.querySelectorAll("button[data-pick]").forEach(btn=>{
      btn.addEventListener("click", ()=> syncFromHex(btn.getAttribute("data-pick")));
    });

    // apply current color to roles
    document.getElementById("setBg").addEventListener("click", ()=>{ bg = picker.value; applyTheme(); setPreview(); });
    document.getElementById("setText").addEventListener("click", ()=>{ tx = picker.value; setPreview(); });
    document.getElementById("setA").addEventListener("click", ()=>{ ga = picker.value; setPreview(); applyTheme(); });
    document.getElementById("setB").addEventListener("click", ()=>{ gb = picker.value; setPreview(); applyTheme(); });

    function applyTheme(){
      // update page background using ga/gb
      document.body.style.background =
        `radial-gradient(circle at 20% 20%, ${gb}22, transparent 55%),
         radial-gradient(circle at 80% 20%, ${ga}22, transparent 55%),
         radial-gradient(circle at 50% 90%, ${ga}1a, transparent 55%),
         ${bg}`;
      // keep preview background consistent too
      setPreview();
    }

    // snaps
    document.getElementById("snapDarkroom").addEventListener("click", ()=> syncFromHex("#4A0000"));
    document.getElementById("snapUV").addEventListener("click", ()=> syncFromHex("#7A00FF"));
    document.getElementById("snapMed").addEventListener("click", ()=> syncFromHex("#00FF66"));

    // export
    document.getElementById("copyVars").addEventListener("click", ()=>copyText(cssOut.value));
    document.getElementById("copyGrad").addEventListener("click", ()=>copyText(gradOut.value));
    document.getElementById("copyCss").addEventListener("click", ()=>{
      const {r,g,b} = hexToRgba(picker.value);
      const a = parseFloat(aEl.value);
      copyText(`color: ${tx}; background: ${bg}; --gradA:${ga}; --gradB:${gb}; --picked:${rgbaToHex(r,g,b,a)};`);
    });
    document.getElementById("copyAll").addEventListener("click", ()=>{
      const out =
`KETADATA COLOR CONTROLLER
picked: ${currentHex().toUpperCase()}
bg:     ${bg.toUpperCase()}
text:   ${tx.toUpperCase()}
gradA:  ${ga.toUpperCase()}
gradB:  ${gb.toUpperCase()}
css:    ${cssOut.value}
grad:   ${gradOut.value}`;
      copyText(out);
    });

    // ---------- gradient motion ----------
    let motionOn = true;
    let frozen = false;
    const spd = document.getElementById("spd");
    const sw = document.getElementById("sw");
    const spdVal=document.getElementById("spdVal");
    const swVal=document.getElementById("swVal");
    spd.addEventListener("input", ()=> spdVal.textContent = (+spd.value).toFixed(2));
    sw.addEventListener("input", ()=> swVal.textContent = (+sw.value).toFixed(2));
    spdVal.textContent = (+spd.value).toFixed(2);
    swVal.textContent = (+sw.value).toFixed(2);

    document.getElementById("toggleMotion").addEventListener("click", (e)=>{
      motionOn = !motionOn;
      e.target.textContent = motionOn ? "[MOTION: ON]" : "[MOTION: OFF]";
    });
    document.getElementById("freeze").addEventListener("click", ()=>{
      frozen = true;
      setTimeout(()=> frozen=false, 1200);
    });

    let t=0;
    function tick(){
      requestAnimationFrame(tick);
      if(!motionOn || frozen) return;
      t += 0.008 * (+spd.value);
      const x = 50 + Math.sin(t)*28;
      const y = 50 + Math.cos(t*0.9)*28;
      const rot = (t*70) % 360;
      preview.style.setProperty("--gx", x.toFixed(2)+"%");
      preview.style.setProperty("--gy", y.toFixed(2)+"%");
      preview.style.setProperty("--rot", rot.toFixed(2)+"deg");
    }
    tick();

    // ---------- tester ----------
    const phrase = document.getElementById("phrase");
    const applyPhrase = ()=> {
      const v = (phrase.value||"").slice(0,11);
      phrase.value = v;
      bigText.textContent = v || "WHATEVER";
    };
    document.getElementById("applyPhrase").addEventListener("click", applyPhrase);
    document.getElementById("clearPhrase").addEventListener("click", ()=>{ phrase.value=""; applyPhrase(); });
    document.getElementById("centerWord").addEventListener("click", ()=>{ bigText.scrollIntoView({block:"center", behavior:"smooth"}); });

    const sz=document.getElementById("sz");
    const szVal=document.getElementById("szVal");
    sz.addEventListener("input", ()=>{
      szVal.textContent = (+sz.value).toFixed(2);
      bigText.style.transform = `scale(${(+sz.value).toFixed(2)})`;
    });
    szVal.textContent = (+sz.value).toFixed(2);
    bigText.style.transform = `scale(${(+sz.value).toFixed(2)})`;

    const nameFont=document.getElementById("nameFont");
    nameFont.addEventListener("change", ()=>{
      document.documentElement.style.setProperty("--nameFont", nameFont.value);
    });
    document.documentElement.style.setProperty("--nameFont", nameFont.value);

    // ---------- light controller (SPACE toggle) ----------
    const lightMode = document.getElementById("lightMode");
    const ls = document.getElementById("ls");
    const lsVal = document.getElementById("lsVal");
    ls.addEventListener("input", ()=> lsVal.textContent = `${ls.value}ms`);
    lsVal.textContent = `${ls.value}ms`;

    let armed = false;
    let running = false;
    let iv = null;

    function clearLight(){
      if(iv) clearInterval(iv);
      iv = null;
      running = false;
      document.body.style.filter = "none";
      // restore theme
      applyTheme();
    }

    function startLight(){
      clearLight();
      running = true;
      const mode = lightMode.value;
      let count = 0;
      let hue = 0;
      let pulse = 0;
      let angle = 0;
      let radius = 0;

      const step = ()=>{
        count++;

        // 1 STROBE
        if(mode === "1"){
          document.body.style.background = (count%2===0) ? "#000" : "#fff";
          return;
        }

        // 2 EMDR (left-right sweep light)
        if(mode === "2"){
          const pos = (Math.sin(count*0.25)+1)/2; // 0..1
          const x = (pos*100).toFixed(2)+"%";
          document.body.style.background = `radial-gradient(circle at ${x} 50%, rgba(255,255,255,.85), rgba(0,0,0,1) 45%)`;
          return;
        }

        // 3 NYAN (fast chroma banding)
        if(mode === "3"){
          hue = (hue + 12) % 360;
          document.body.style.background = `linear-gradient(90deg,
            hsl(${hue},100%,55%),
            hsl(${(hue+60)%360},100%,55%),
            hsl(${(hue+120)%360},100%,55%),
            hsl(${(hue+180)%360},100%,55%),
            hsl(${(hue+240)%360},100%,55%),
            hsl(${(hue+300)%360},100%,55%))`;
          document.body.style.filter = "contrast(1.4) saturate(2)";
          return;
        }

        // 4 HEARTBEAT (double-pulse)
        if(mode === "4"){
          const beat = count % 24;
          const on = (beat===0 || beat===1 || beat===6);
          document.body.style.background = on ? "#fff" : "#000";
          document.body.style.filter = on ? "brightness(2.8) contrast(2.2)" : "none";
          return;
        }

        // 5 UV (REAL) — your provided ultraviolet
        if(mode === "5"){
          angle += 15;
          radius = (radius + 2) % 100;

          let hueUV = 260 + Math.sin(angle * 0.1) * 40;
          let saturation = 80 + Math.cos(angle * 0.05) * 20;
          let lightness = 30 + Math.sin(radius * 0.1) * 30;

          let spiralBrightness = 1 + Math.abs(Math.sin(angle * 0.05)) * 0.8;
          let spiralContrast = 1.5 + Math.abs(Math.cos(angle * 0.08)) * 1;

          document.body.style.background = `hsl(${hueUV}, ${saturation}%, ${lightness}%)`;
          document.body.style.filter = `contrast(${spiralContrast}) saturate(2) brightness(${spiralBrightness}) hue-rotate(${angle * 0.5}deg)`;
          return;
        }

        // 6 PAPARAZZI
        if(mode === "6"){
          if(count % 50 === 0 || count % 50 === 2){
            document.body.style.background = "#fff";
            document.body.style.filter = "brightness(5) contrast(5)";
          } else {
            document.body.style.background = "#000";
            document.body.style.filter = "none";
          }
          return;
        }

        // [MED] chromatic (your provided 2.0)
        if(mode === "med"){
          hue = (hue + 30) % 360;
          pulse += 0.5;
          const lightness = 50 + Math.sin(pulse) * 40;
          document.body.style.background = `hsl(${hue}, 100%, ${lightness}%)`;
          document.body.style.filter = "contrast(1.4) saturate(2)";
          return;
        }
      };

      iv = setInterval(step, +ls.value);
    }

    document.getElementById("arm").addEventListener("click", (e)=>{
      armed = !armed;
      e.target.textContent = armed ? "[ARMED]" : "[ARM SPACE TOGGLE]";
      if(!armed) clearLight();
    });

    document.getElementById("stopLight").addEventListener("click", ()=>{
      clearLight();
    });

    document.getElementById("testPulse").addEventListener("click", ()=>{
      // quick 0.7s pulse without arming
      const prevArmed = armed;
      const prevRunning = running;
      const prevMode = lightMode.value;
      const prevLs = ls.value;

      armed = false;
      clearLight();

      lightMode.value = "4";
      ls.value = 35;
      lsVal.textContent = `${ls.value}ms`;
      startLight();
      setTimeout(()=>{
        clearLight();
        lightMode.value = prevMode;
        ls.value = prevLs;
        lsVal.textContent = `${ls.value}ms`;
        armed = prevArmed;
        running = prevRunning;
      }, 700);
    });

    document.getElementById("safeMode").addEventListener("click", ()=>{
      // slow down + reduce harshness by preferring EMDR
      lightMode.value = "2";
      ls.value = 45;
      lsVal.textContent = `${ls.value}ms`;
    });

    // Space toggles light if armed
    document.addEventListener("keydown", (e)=>{
      if((e.code === "Space" || e.key === " ") && armed){
        e.preventDefault();
        if(!running) startLight();
        else clearLight();
      }
    });

    // ---------- init ----------
    syncFromHex("#FF2A2A");
    applyTheme();
    setPreview();
    applyPhrase();
  </script>
</body>
</html>
