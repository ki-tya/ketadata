<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KETA_MONO // ICON STUDY</title>
<style>
:root{
  --bg:#000;
  --ink:rgba(255,255,255,.86);
  --muted:rgba(255,255,255,.52);
  --line:rgba(255,255,255,.14);
  --line2:rgba(255,255,255,.26);

  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  --sans: Arial, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

  --top:44px;
  --bot:34px;
  --pad:10px;

  /* intensifiers (0..1) */
  --I_INK: .82;     /* line/ink strength */
  --I_WASH: .30;    /* grayscale wash */
  --I_RAYS: .22;    /* rayburst */
  --I_CRACK: .22;   /* craquelure */
  --I_GRAIN: .18;   /* grain */
  --I_VIGN: .54;    /* vignette */
  --I_HALO: .22;    /* halos */
  --I_SCROLL: .20;  /* scroll panels */

  --motion: 1;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{background:var(--bg); color:var(--ink); font-family:var(--sans); overflow:hidden}
button,input,textarea{font:inherit}
a{color:inherit}

#root{position:fixed; inset:0; user-select:none}
#root.invert{filter:invert(1) hue-rotate(180deg)}
#root.null .bar, #root.null #botbar, #root.null #sig{display:none}
#root.null #stage{inset:0}

.bar{
  position:fixed; left:0; right:0; top:0;
  height:var(--top);
  display:flex; align-items:center;
  padding:0 var(--pad);
  background:rgba(0,0,0,.72);
  border-bottom:1px solid var(--line);
  z-index:40;
}
#botbar{
  position:fixed; left:0; right:0; bottom:0;
  height:var(--bot);
  display:flex; align-items:center;
  padding:0 var(--pad);
  background:rgba(0,0,0,.72);
  border-top:1px solid var(--line);
  z-index:40;
}
.left,.mid,.right{display:flex; align-items:center; gap:10px}
.left{min-width:420px}
.mid{flex:1; justify-content:center; overflow:hidden}
.right{min-width:420px; justify-content:flex-end}

.pip{width:10px; height:10px; border:1px solid var(--line2); background:rgba(255,255,255,.04)}
.brand{display:flex; flex-direction:column; line-height:1.05}
.brand div{font-family:var(--mono); font-size:11px; letter-spacing:.10em}
.brand .sub{opacity:.55}

.sep{width:1px; height:18px; background:var(--line)}

.btn{
  border:1px solid var(--line2);
  background:rgba(255,255,255,.04);
  color:var(--ink);
  font-family:var(--mono);
  font-size:11px;
  letter-spacing:.10em;
  padding:6px 8px;
  cursor:pointer;
}
.btn:active{transform:translateY(1px)}
.btn.tog.on{border-color:rgba(255,255,255,.46); box-shadow:0 0 0 1px rgba(255,255,255,.10) inset}

.kv{display:flex; align-items:center; gap:8px; font-family:var(--mono); font-size:11px; letter-spacing:.10em}
.kv .k{opacity:.55}
.kv .v{opacity:.92}

#stage{
  position:fixed;
  inset: var(--top) 0 var(--bot) 0;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* centered icon plate */
#plate{
  position:relative;
  width:min(86vmin, 980px);
  height:min(86vmin, 980px);
  border:1px solid var(--line);
  background:rgba(0,0,0,.32);
  padding:14px;
  display:grid;
  grid-template-rows: 1fr auto;
  gap:14px;
}
#icon{
  position:relative;
  border:1px solid var(--line);
  background:#000;
  overflow:hidden;
}
#icon svg{position:absolute; inset:0; width:100%; height:100%}

#dock{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  border:1px solid var(--line);
  background:rgba(255,255,255,.03);
  padding:10px;
}
#dock .leftDock{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
#dock .rightDock{display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end}

.row{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  font-family:var(--mono);
  font-size:11px;
  letter-spacing:.10em;
  min-width: 240px;
}
.row span{opacity:.62}
.row input[type="range"]{width:160px}

#sig{
  position:fixed;
  left:10px;
  bottom: calc(var(--bot) + 10px);
  font-family:var(--mono);
  font-size:11px;
  letter-spacing:.10em;
  opacity:.58;
  z-index:60;
  pointer-events:none;
}

/* motion */
@keyframes shimmer{0%,100%{filter:brightness(1) contrast(1)} 50%{filter:brightness(1.07) contrast(1.06)}}
@keyframes drift{0%,100%{transform:translate3d(0,0,0)} 50%{transform:translate3d(0,-6px,0)}}
#root.motion #icon svg{animation:shimmer 8s ease-in-out infinite}
#root.motion #plate{animation:drift 14s ease-in-out infinite}
</style>
</head>
<body>
<div id="root">
  <div class="bar">
    <div class="left">
      <div class="pip"></div>
      <div class="brand">
        <div>KETA_MONO // ICON STUDY</div>
        <div class="sub">MONOCHROME · CENTERED · LOCAL · SINGLE-FILE</div>
      </div>
      <div class="sep"></div>
      <button class="btn tog" id="invertBtn" title="Shift+I">INVERT</button>
      <button class="btn tog" id="nullBtn" title="Shift+N">NULL</button>
      <button class="btn tog on" id="motionBtn">MOTION</button>
    </div>

    <div class="mid">
      <div class="kv"><span class="k">INK</span><span class="v" id="inkLab">82</span></div>
      <div class="sep"></div>
      <div class="kv"><span class="k">RAYS</span><span class="v" id="raysLab">22</span></div>
      <div class="sep"></div>
      <div class="kv"><span class="k">CRACK</span><span class="v" id="crackLab">22</span></div>
      <div class="sep"></div>
      <div class="kv"><span class="k">VIGN</span><span class="v" id="vignLab">54</span></div>
    </div>

    <div class="right">
      <button class="btn" id="reinkBtn">RE-INK</button>
      <button class="btn" id="saveBtn">SAVE</button>
      <button class="btn" id="exportBtn">EXPORT TXT</button>
    </div>
  </div>

  <div id="stage">
    <div id="plate">
      <div id="icon" aria-label="Icon-inspired monochrome plate">
        <svg viewBox="0 0 1000 1000" role="img" aria-label="Monochrome icon study">
          <defs>
            <!-- soft halo gradient -->
            <radialGradient id="haloGrad" cx="50%" cy="45%" r="55%">
              <stop offset="0" stop-color="rgba(255,255,255,.14)"/>
              <stop offset="0.55" stop-color="rgba(255,255,255,.06)"/>
              <stop offset="1" stop-color="rgba(255,255,255,0)"/>
            </radialGradient>

            <!-- wash -->
            <radialGradient id="washGrad" cx="50%" cy="50%" r="80%">
              <stop offset="0" stop-color="rgba(255,255,255,.09)"/>
              <stop offset="1" stop-color="rgba(0,0,0,0)"/>
            </radialGradient>

            <!-- micro-grain -->
            <pattern id="grain" width="6" height="6" patternUnits="userSpaceOnUse">
              <circle cx="1" cy="1" r="1" fill="rgba(255,255,255,.06)"/>
              <circle cx="5" cy="2" r="1" fill="rgba(255,255,255,.04)"/>
              <circle cx="3" cy="5" r="1" fill="rgba(255,255,255,.03)"/>
            </pattern>

            <!-- craquelure (deterministic) -->
            <pattern id="crackle" width="56" height="56" patternUnits="userSpaceOnUse">
              <path d="M3 9 L52 3" stroke="rgba(0,0,0,.34)" stroke-width="2"/>
              <path d="M12 54 L54 12" stroke="rgba(0,0,0,.28)" stroke-width="2"/>
              <path d="M2 30 L30 54" stroke="rgba(0,0,0,.22)" stroke-width="2"/>
              <path d="M20 6 L54 40" stroke="rgba(0,0,0,.20)" stroke-width="2"/>
              <path d="M8 18 L40 52" stroke="rgba(0,0,0,.18)" stroke-width="2"/>
              <path d="M6 48 L48 22" stroke="rgba(0,0,0,.18)" stroke-width="2"/>
            </pattern>

            <!-- scroll text hatch -->
            <pattern id="hatch" width="14" height="14" patternUnits="userSpaceOnUse">
              <path d="M0 10 H14" stroke="rgba(0,0,0,.26)" stroke-width="2"/>
              <path d="M0 3 H14" stroke="rgba(0,0,0,.18)" stroke-width="2"/>
            </pattern>

            <!-- vignette mask -->
            <mask id="vignMask">
              <rect width="1000" height="1000" fill="white"/>
              <radialGradient id="vignGrad" cx="50%" cy="50%" r="62%">
                <stop offset="0.62" stop-color="white"/>
                <stop offset="0.82" stop-color="rgba(255,255,255,.35)"/>
                <stop offset="1" stop-color="rgba(255,255,255,0)"/>
              </radialGradient>
              <rect width="1000" height="1000" fill="url(#vignGrad)"/>
            </mask>

            <filter id="soft" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur stdDeviation="1.5" result="b"/>
              <feMerge>
                <feMergeNode in="b"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>

            <style>
              .frameA{ fill: rgba(255,255,255,.04); stroke: rgba(255,255,255,.14); stroke-width:2; }
              .frameB{ fill: rgba(0,0,0,.18); stroke: rgba(0,0,0,.40); stroke-width:8; }
              .ink{ fill: rgba(255,255,255,.10); stroke: rgba(255,255,255,.22); stroke-width:2; }
              .ink2{ fill: rgba(0,0,0,.22); stroke: rgba(255,255,255,.14); stroke-width:2; }
              .line{ stroke: rgba(255,255,255,.22); stroke-width:2; fill:none; }
              .txt{
                font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
                font-size: 18px;
                letter-spacing: 7px;
                fill: rgba(0,0,0,.50);
              }
              .txt2{
                font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
                font-size: 16px;
                letter-spacing: 7px;
                fill: rgba(0,0,0,.40);
              }
            </style>
          </defs>

          <!-- ground -->
          <rect width="1000" height="1000" fill="rgb(12,12,12)"/>
          <rect width="1000" height="1000" fill="url(#washGrad)" id="washRect" opacity="0.30"/>

          <!-- rayburst (behind halos) -->
          <g id="rays" transform="translate(500 425)" opacity="0.22"></g>

          <!-- double frame -->
          <rect x="34" y="34" width="932" height="932" class="frameB"/>
          <rect x="66" y="66" width="868" height="868" class="frameA"/>

          <!-- corner scroll panels (more intricate) -->
          <g id="scrolls" opacity="0.88">
            <g>
              <path d="M86 98 H390 Q412 98 412 120 V194 Q412 216 390 216 H86 Z" fill="rgba(0,0,0,.10)" stroke="rgba(0,0,0,.42)" stroke-width="5"/>
              <rect x="106" y="120" width="286" height="70" fill="url(#hatch)" opacity="0.55"/>
              <text x="118" y="154" class="txt">KETA</text>
              <text x="118" y="178" class="txt2">MONO</text>
              <!-- tiny “script” strokes -->
              <path d="M250 135 H372" stroke="rgba(0,0,0,.32)" stroke-width="3"/>
              <path d="M238 148 H360" stroke="rgba(0,0,0,.22)" stroke-width="3"/>
              <path d="M262 161 H378" stroke="rgba(0,0,0,.18)" stroke-width="3"/>
            </g>

            <g>
              <path d="M610 98 H914 V216 H610 Q588 216 588 194 V120 Q588 98 610 98 Z" fill="rgba(0,0,0,.10)" stroke="rgba(0,0,0,.42)" stroke-width="5"/>
              <rect x="608" y="120" width="286" height="70" fill="url(#hatch)" opacity="0.55"/>
              <text x="628" y="154" class="txt">DATA</text>
              <text x="628" y="178" class="txt2">ICON</text>
              <path d="M720 135 H888" stroke="rgba(0,0,0,.32)" stroke-width="3"/>
              <path d="M708 148 H876" stroke="rgba(0,0,0,.22)" stroke-width="3"/>
              <path d="M732 161 H900" stroke="rgba(0,0,0,.18)" stroke-width="3"/>
            </g>
          </g>

          <!-- halos -->
          <g id="halos" filter="url(#soft)" opacity="0.90">
            <circle cx="440" cy="430" r="214" fill="url(#haloGrad)"/>
            <circle cx="600" cy="520" r="152" fill="url(#haloGrad)"/>
            <!-- inner rings -->
            <circle cx="440" cy="430" r="160" class="line" opacity="0.38"/>
            <circle cx="600" cy="520" r="116" class="line" opacity="0.32"/>
            <!-- cross-in-halo abstraction -->
            <path d="M440 270 V590" class="line" opacity="0.34"/>
            <path d="M290 430 H590" class="line" opacity="0.34"/>
          </g>

          <!-- intricate garment geometry -->
          <g id="figure">
            <!-- outer cloak with pleat lines -->
            <path d="M154 900
                     Q130 720 194 606
                     Q260 492 342 466
                     Q372 402 404 352
                     Q440 294 510 292
                     Q598 290 660 362
                     Q712 420 740 512
                     Q774 620 770 740
                     Q768 840 742 900 Z" class="ink2"/>

            <!-- pleat lines (cloak) -->
            <g opacity="0.32">
              <path d="M206 872 Q214 730 260 636" class="line"/>
              <path d="M246 890 Q258 740 318 612" class="line"/>
              <path d="M292 900 Q306 760 372 604" class="line"/>
              <path d="M666 888 Q700 760 706 632" class="line"/>
              <path d="M710 872 Q744 748 744 612" class="line"/>
              <path d="M412 874 Q430 706 482 612" class="line" opacity="0.22"/>
              <path d="M520 882 Q536 720 574 648" class="line" opacity="0.22"/>
            </g>

            <!-- inner garment -->
            <path d="M238 900
                     Q224 764 266 664
                     Q314 552 396 526
                     Q446 502 488 448
                     Q526 398 582 398
                     Q650 398 686 476
                     Q728 566 720 684
                     Q710 804 668 900 Z" class="ink"/>

            <!-- inner garment pleats -->
            <g opacity="0.26">
              <path d="M302 880 Q302 740 360 610" class="line"/>
              <path d="M342 894 Q354 742 420 598" class="line"/>
              <path d="M618 892 Q664 748 664 620" class="line"/>
              <path d="M566 894 Q610 750 612 636" class="line" opacity="0.22"/>
            </g>

            <!-- head 1 -->
            <ellipse cx="440" cy="430" rx="108" ry="134" class="ink"/>
            <ellipse cx="440" cy="430" rx="82" ry="106" fill="rgba(0,0,0,.22)" stroke="rgba(255,255,255,.14)" stroke-width="2"/>

            <!-- head 2 -->
            <ellipse cx="600" cy="520" rx="80" ry="100" class="ink"/>
            <ellipse cx="600" cy="520" rx="58" ry="76" fill="rgba(0,0,0,.22)" stroke="rgba(255,255,255,.14)" stroke-width="2"/>

            <!-- facial marks -->
            <g opacity="0.92">
              <ellipse cx="408" cy="430" rx="14" ry="10" fill="rgba(255,255,255,.62)"/>
              <ellipse cx="472" cy="430" rx="14" ry="10" fill="rgba(255,255,255,.62)"/>
              <circle cx="408" cy="431" r="5.6" fill="rgba(0,0,0,.88)"/>
              <circle cx="472" cy="431" r="5.6" fill="rgba(0,0,0,.88)"/>
              <path d="M440 444 L430 482 L450 482" class="line"/>
              <path d="M410 510 Q440 526 470 510" class="line"/>

              <ellipse cx="576" cy="520" rx="11" ry="8" fill="rgba(255,255,255,.58)"/>
              <ellipse cx="624" cy="520" rx="11" ry="8" fill="rgba(255,255,255,.58)"/>
              <circle cx="576" cy="521" r="4.9" fill="rgba(0,0,0,.88)"/>
              <circle cx="624" cy="521" r="4.9" fill="rgba(0,0,0,.88)"/>
              <path d="M600 532 L592 560 L608 560" class="line"/>
              <path d="M580 578 Q600 590 620 578" class="line"/>
            </g>

            <!-- hands / embrace geometry (more intricate) -->
            <path d="M334 640
                     Q412 588 488 604
                     Q560 620 634 676
                     Q654 692 652 714
                     Q650 740 622 746
                     Q540 764 476 742
                     Q404 718 322 678 Z"
                  fill="rgba(0,0,0,.18)" stroke="rgba(255,255,255,.16)" stroke-width="2"/>

            <!-- micro-lines across hands -->
            <g opacity="0.22">
              <path d="M360 678 Q420 646 480 660" class="line"/>
              <path d="M392 706 Q450 682 512 696" class="line"/>
              <path d="M468 744 Q528 724 594 736" class="line"/>
            </g>
          </g>

          <!-- bottom seal -->
          <g id="seal" opacity="0.88">
            <rect x="120" y="810" width="760" height="110" fill="rgba(0,0,0,.12)" stroke="rgba(0,0,0,.42)" stroke-width="5"/>
            <path d="M140 846 H860" stroke="rgba(0,0,0,.40)" stroke-width="3"/>
            <text x="500" y="888" text-anchor="middle"
              font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace"
              font-size="22" letter-spacing="7" fill="rgba(0,0,0,.50)">KETA // MONO // ICON STUDY</text>
          </g>

          <!-- overlays -->
          <rect x="66" y="66" width="868" height="868" fill="url(#grain)" id="grainRect" opacity="0.18"/>
          <rect x="66" y="66" width="868" height="868" fill="url(#crackle)" id="crackRect" opacity="0.22"/>

          <rect width="1000" height="1000" fill="rgba(0,0,0,.88)" mask="url(#vignMask)" id="vignRect" opacity="0.54"/>
        </svg>
      </div>

      <div id="dock">
        <div class="leftDock">
          <div class="row"><span>INK</span><input id="inkR" type="range" min="0" max="100" value="82"></div>
          <div class="row"><span>WASH</span><input id="washR" type="range" min="0" max="100" value="30"></div>
          <div class="row"><span>HALO</span><input id="haloR" type="range" min="0" max="100" value="22"></div>
          <div class="row"><span>RAYS</span><input id="raysR" type="range" min="0" max="100" value="22"></div>
        </div>
        <div class="rightDock">
          <div class="row"><span>CRACK</span><input id="crackR" type="range" min="0" max="100" value="22"></div>
          <div class="row"><span>GRAIN</span><input id="grainR" type="range" min="0" max="100" value="18"></div>
          <div class="row"><span>VIGN</span><input id="vignR" type="range" min="0" max="100" value="54"></div>
          <div class="row"><span>SCROLL</span><input id="scrollR" type="range" min="0" max="100" value="20"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="botbar">
    <div class="left">
      <div class="kv"><span class="k">FILE</span><span class="v" id="fileId"></span></div>
      <div class="sep"></div>
      <div class="kv"><span class="k">UPDATED</span><span class="v" id="updatedAt"></span></div>
    </div>
    <div class="mid">
      <div class="kv"><span class="k">LIGHT</span><span class="v" id="lightLab">1</span></div>
      <div class="sep"></div>
      <div class="kv"><span class="k">MODE</span><span class="v">ICON</span></div>
    </div>
    <div class="right">
      <button class="btn" id="lDown">L-</button>
      <button class="btn" id="lUp">L+</button>
      <div class="sep"></div>
      <button class="btn" id="resetBtn">RESET</button>
    </div>
  </div>

  <div id="sig"></div>
</div>

<script>
const $ = (id)=>document.getElementById(id);
const clamp01 = (n)=>Math.max(0, Math.min(1, n));

const FILE_ID = (() => {
  const k="KETA_MONO_ICON_STUDY_FILE_ID_v1";
  let v=localStorage.getItem(k);
  if(!v){
    v="KETA-ICON-"+Math.random().toString(16).slice(2,10).toUpperCase();
    localStorage.setItem(k,v);
  }
  return v;
})();
const LS_KEY = "KETA_MONO_ICON_STUDY_STATE_v1::"+FILE_ID;

const DEFAULT = {
  ui:{ invert:false, null:false, fullscreen:false, motion:true, light:1 },
  intens:{ ink:.82, wash:.30, rays:.22, crack:.22, grain:.18, vign:.54, halo:.22, scroll:.20 },
  meta:{ createdAt:new Date().toISOString(), updatedAt:new Date().toISOString(), version:"v1" }
};

let STATE = load();

function load(){
  try{
    const raw=localStorage.getItem(LS_KEY);
    if(!raw) return structuredClone(DEFAULT);
    const p=JSON.parse(raw);
    return deepFill(structuredClone(DEFAULT), p);
  }catch(e){
    return structuredClone(DEFAULT);
  }
}
function deepFill(base, inc){
  if(!inc || typeof inc!=="object") return base;
  for(const k of Object.keys(inc)){
    if(!(k in base)){ base[k]=inc[k]; continue; }
    if(base[k] && typeof base[k]==="object" && !Array.isArray(base[k]) &&
       inc[k] && typeof inc[k]==="object" && !Array.isArray(inc[k])){
      base[k]=deepFill(base[k], inc[k]);
    }else base[k]=inc[k];
  }
  return base;
}
function isoShort(s){
  try{
    const d=new Date(s);
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,"0");
    const da=String(d.getDate()).padStart(2,"0");
    const hh=String(d.getHours()).padStart(2,"0");
    const mm=String(d.getMinutes()).padStart(2,"0");
    return `${y}-${m}-${da} ${hh}:${mm}`;
  }catch(e){ return String(s||""); }
}
function sigLine(){
  const updated = isoShort(STATE.meta.updatedAt);
  return `AE/EE/WB · FILE_ID=${FILE_ID} · ROOM_ID=KETA_MONO_ICON_STUDY · VERSION=${STATE.meta.version} · UPDATED_AT=${updated} · CHANGELOG=mono icon study centered intricate`;
}
function save(reason="save"){
  STATE.meta.updatedAt=new Date().toISOString();
  localStorage.setItem(LS_KEY, JSON.stringify(STATE));
  render();
}
function apply(){
  // main overlays
  $("grainRect").setAttribute("opacity", String(0.02 + 0.78*STATE.intens.grain));
  $("crackRect").setAttribute("opacity", String(0.02 + 0.78*STATE.intens.crack));
  $("vignRect").setAttribute("opacity",  String(0.08 + 0.92*STATE.intens.vign));
  $("washRect").setAttribute("opacity",  String(clamp01(STATE.intens.wash)));

  // ink strength: adjust strokes via a simple global filter on svg
  const svg = document.querySelector("#icon svg");
  const ink = clamp01(STATE.intens.ink);
  svg.style.filter = `contrast(${(1 + 0.65*ink).toFixed(3)}) brightness(${(0.90 + 0.20*ink).toFixed(3)})`;

  // halo + rays
  $("halos").setAttribute("opacity", String(0.10 + 0.90*STATE.intens.halo));
  $("rays").setAttribute("opacity",  String(0.00 + 1.00*STATE.intens.rays));

  // scroll panels
  $("scrolls").setAttribute("opacity", String(0.25 + 0.75*STATE.intens.scroll));

  // labels
  $("inkLab").textContent   = String(Math.round(STATE.intens.ink*100));
  $("raysLab").textContent  = String(Math.round(STATE.intens.rays*100));
  $("crackLab").textContent = String(Math.round(STATE.intens.crack*100));
  $("vignLab").textContent  = String(Math.round(STATE.intens.vign*100));
}
function render(){
  const root=$("root");
  root.classList.toggle("invert", !!STATE.ui.invert);
  root.classList.toggle("null", !!STATE.ui.null);
  root.classList.toggle("motion", !!STATE.ui.motion);

  $("invertBtn").classList.toggle("on", !!STATE.ui.invert);
  $("nullBtn").classList.toggle("on", !!STATE.ui.null);
  $("motionBtn").classList.toggle("on", !!STATE.ui.motion);

  $("fileId").textContent = FILE_ID;
  $("updatedAt").textContent = isoShort(STATE.meta.updatedAt);
  $("lightLab").textContent = String(STATE.ui.light||1);
  $("sig").textContent = sigLine();

  // sliders
  $("inkR").value   = String(Math.round(STATE.intens.ink*100));
  $("washR").value  = String(Math.round(STATE.intens.wash*100));
  $("haloR").value  = String(Math.round(STATE.intens.halo*100));
  $("raysR").value  = String(Math.round(STATE.intens.rays*100));
  $("crackR").value = String(Math.round(STATE.intens.crack*100));
  $("grainR").value = String(Math.round(STATE.intens.grain*100));
  $("vignR").value  = String(Math.round(STATE.intens.vign*100));
  $("scrollR").value= String(Math.round(STATE.intens.scroll*100));

  apply();
}
function reink(){
  const j=(v,a)=>clamp01(v + (Math.random()*2-1)*a);
  STATE.intens.ink   = j(STATE.intens.ink,   0.10);
  STATE.intens.wash  = j(STATE.intens.wash,  0.10);
  STATE.intens.halo  = j(STATE.intens.halo,  0.14);
  STATE.intens.rays  = j(STATE.intens.rays,  0.16);
  STATE.intens.crack = j(STATE.intens.crack, 0.12);
  STATE.intens.grain = j(STATE.intens.grain, 0.12);
  STATE.intens.vign  = j(STATE.intens.vign,  0.08);
  STATE.intens.scroll= j(STATE.intens.scroll,0.12);
  save("re-ink");
}
function toggleFullscreen(){
  const el=document.documentElement;
  if(!document.fullscreenElement){ el.requestFullscreen?.(); STATE.ui.fullscreen=true; }
  else{ document.exitFullscreen?.(); STATE.ui.fullscreen=false; }
  save("fullscreen");
}
function downloadText(filename, text){
  const blob=new Blob([text],{type:"text/plain;charset=utf-8"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download=filename;
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 500);
}
function buildRays(){
  const g=$("rays");
  while(g.firstChild) g.removeChild(g.firstChild);
  const N=64, inner=210, outer=460;
  for(let i=0;i<N;i++){
    const a=(Math.PI*2)*(i/N)+0.18;
    const x1=Math.cos(a)*inner, y1=Math.sin(a)*inner;
    const x2=Math.cos(a)*outer, y2=Math.sin(a)*outer;
    const ln=document.createElementNS("http://www.w3.org/2000/svg","line");
    ln.setAttribute("x1", x1.toFixed(2));
    ln.setAttribute("y1", y1.toFixed(2));
    ln.setAttribute("x2", x2.toFixed(2));
    ln.setAttribute("y2", y2.toFixed(2));
    ln.setAttribute("stroke", "rgba(0,0,0,.30)");
    ln.setAttribute("stroke-width", (i%2? 3:2));
    ln.setAttribute("opacity", (i%8===0? 0.55:0.28));
    g.appendChild(ln);
  }
}
function bind(){
  $("invertBtn").onclick=()=>{ STATE.ui.invert=!STATE.ui.invert; save("invert"); };
  $("nullBtn").onclick=()=>{ STATE.ui.null=!STATE.ui.null; save("null"); };
  $("motionBtn").onclick=()=>{ STATE.ui.motion=!STATE.ui.motion; save("motion"); };
  $("reinkBtn").onclick=()=>reink();
  $("saveBtn").onclick=()=>save("manual");

  $("exportBtn").onclick=()=>{
    const txt =
`KETA_MONO // ICON STUDY EXPORT
FILE_ID: ${FILE_ID}
UPDATED_AT: ${STATE.meta.updatedAt}

STAMP:
${sigLine()}
`;
    downloadText(`KETA_MONO_ICON_STUDY_${FILE_ID}.txt`, txt);
  };

  $("resetBtn").onclick=()=>{
    const keepLight=STATE.ui.light||1;
    const keepMotion=!!STATE.ui.motion;
    STATE=structuredClone(DEFAULT);
    STATE.ui.light=keepLight;
    STATE.ui.motion=keepMotion;
    save("reset");
  };

  const bindR=(id,key)=>{
    $(id).addEventListener("input",(e)=>{
      STATE.intens[key]=clamp01(Number(e.target.value)/100);
      render();
    });
    $(id).addEventListener("change",()=>save("intensity"));
  };
  bindR("inkR","ink");
  bindR("washR","wash");
  bindR("haloR","halo");
  bindR("raysR","rays");
  bindR("crackR","crack");
  bindR("grainR","grain");
  bindR("vignR","vign");
  bindR("scrollR","scroll");

  $("lDown").onclick=()=>{ STATE.ui.light=Math.max(1,(STATE.ui.light||1)-1); save("light"); };
  $("lUp").onclick=()=>{ STATE.ui.light=Math.min(6,(STATE.ui.light||1)+1); save("light"); };

  window.addEventListener("keydown",(e)=>{
    const tag=(e.target && e.target.tagName||"").toLowerCase();
    const typing=(tag==="textarea"||tag==="input");
    if(e.shiftKey && e.key.toLowerCase()==="i"){ e.preventDefault(); STATE.ui.invert=!STATE.ui.invert; save("invert(hk)"); return; }
    if(e.shiftKey && e.key.toLowerCase()==="n"){ e.preventDefault(); STATE.ui.null=!STATE.ui.null; save("null(hk)"); return; }
    if(e.shiftKey && e.key.toLowerCase()==="f"){ e.preventDefault(); toggleFullscreen(); return; }
    if(e.key>="1" && e.key<="6"){ STATE.ui.light=Number(e.key); save("light(hk)"); return; }
    if(!typing && e.code==="Space"){ e.preventDefault(); STATE.ui.motion=!STATE.ui.motion; save("motion(space)"); return; }
  });
}

/* init */
(function init(){
  buildRays();
  bind();
  render();
})();
</script>

<!--
AE/EE/WB · FILE_ID=KETA_MONO_ICON_STUDY_FILE_ID_v1 · ROOM_ID=KETA_MONO_ICON_STUDY · VERSION=v1 · UPDATED_AT=local · CHANGELOG=mono icon study centered intricate
-->
</body>
</html>
