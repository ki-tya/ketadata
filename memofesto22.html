<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KETADATA_MANIFESTO</title>

<style>
:root{
  --bg:#0b0b0b;
  --fg:#eaeaea;
  --mut:#9a9a9a;
  --line:#2a2a2a;
  --panel:rgba(12,12,12,0.96);
  --fs:12px;
}

*{box-sizing:border-box}
html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font: var(--fs)/1.25 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
}

button,input,textarea{
  font:inherit;
  color:inherit;
  background:transparent;
  border:1px solid var(--line);
  padding:6px 8px;
}

button{cursor:pointer}
button:hover{border-color:#444}

.row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.pill{border:1px solid var(--line); padding:6px 8px; background:rgba(16,16,16,.75)}
.dim{opacity:.65}

/* background */
.stage{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:0;
}
canvas{width:100%;height:100%;display:block}

/* chrome */
.topbar,.bottombar{
  position:fixed;
  left:0; right:0;
  background:rgba(10,10,10,.9);
  border-bottom:1px solid var(--line);
  padding:8px;
  z-index:10;
}
.bottombar{
  top:auto;
  bottom:0;
  border-bottom:0;
  border-top:1px solid var(--line);
}
body{padding-top:52px; padding-bottom:52px}

/* panels */
.surface{position:relative; z-index:1; height:100%}

.panel,.note{
  position:absolute;
  background:var(--panel);
  border:1px solid var(--line);
}

.panel{left:16px; top:16px; width:min(720px,calc(100% - 32px))}
.note{left:16px; top:620px; width:360px}

.header{
  padding:8px;
  border-bottom:1px solid var(--line);
  background:rgba(16,16,16,.8);
  cursor:move;
  display:flex;
  gap:8px;
}
.body{padding:8px}
.footer{
  padding:8px;
  border-top:1px solid var(--line);
  background:rgba(16,16,16,.6);
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

textarea{
  width:100%;
  resize:none;
  outline:none;
  background:rgba(0,0,0,.4);
}

#manifestText{height:480px}
#noteText{height:220px}
</style>
</head>

<body>

<div class="stage"><canvas id="bg"></canvas></div>

<div class="topbar">
  <div class="row">
    <div class="pill"><b>KETADATA</b> <span class="dim">MANIFESTO</span></div>
    <button id="exportBtn">EXPORT</button>
    <button id="importBtn">IMPORT</button>
    <input type="file" id="fileInput" accept="application/json" hidden>
    <div style="flex:1"></div>
    <div class="pill dim" id="metaTop"></div>
  </div>
</div>

<div class="surface">

  <div class="panel" id="manifest">
    <div class="header" id="manifestHeader">
      <div class="dim">MANIFESTO_SURFACE</div>
    </div>
    <div class="body">
<textarea id="manifestText" spellcheck="false">
KETADATA MANIFESTO

THE SURFACE IS THE STATE.
IMPORT / EXPORT IS NOT OPTIONAL.
NO ENFORCED ROLES.
NO HIDDEN WORKFLOWS.
STRUCTURE NEVER INTERPRETS EXPERIENCE.
EXPERIENCE NEVER ENFORCES STRUCTURE.

YOU DO NOT EXPLAIN KETADATA.
YOU REPRODUCE IT.
YOU LEAVE TRACES.
</textarea>
    </div>
    <div class="footer">
      <div class="pill dim" id="posPill"></div>
      <div style="flex:1"></div>
      <div class="pill dim">STATE = LITERAL UI</div>
    </div>
  </div>

  <div class="note" id="note">
    <div class="header" id="noteHeader">
      <div class="dim">KETA_NOTE</div>
    </div>
    <div class="body">
<textarea id="noteText" spellcheck="false"></textarea>
    </div>
  </div>

</div>

<div class="bottombar">
  <div class="row">
    <div class="pill dim" id="metaBottom"></div>
    <div style="flex:1"></div>
    <div class="pill dim">POINTER EVENTS: SAFE</div>
  </div>
</div>

<script>
/* ===============================
STATE
=============================== */
const META = {
  FILE_ID:"KETADATA_MANIFESTO_SURFACE",
  ROOM_ID:"BASE",
  VERSION:"V1"
};
const KEY = META.FILE_ID+"::STATE";

const DEFAULT = {
  updatedAt:new Date().toISOString(),
  manifestPos:{x:16,y:16},
  notePos:{x:16,y:620},
  manifestText:document.getElementById("manifestText").value,
  noteText:""
};

let STATE = (()=> {
  try{
    return Object.assign(structuredClone(DEFAULT),
      JSON.parse(localStorage.getItem(KEY)||"{}"));
  }catch{ return structuredClone(DEFAULT); }
})();

/* ===============================
RENDER
=============================== */
const el=id=>document.getElementById(id);

function render(){
  place(el("manifest"),STATE.manifestPos);
  place(el("note"),STATE.notePos);
  el("manifestText").value=STATE.manifestText;
  el("noteText").value=STATE.noteText;

  const meta=`FILE:${META.FILE_ID} ROOM:${META.ROOM_ID} VER:${META.VERSION} UPDATED:${STATE.updatedAt}`;
  el("metaTop").textContent=meta;
  el("metaBottom").textContent=meta;
  el("posPill").textContent=`X ${STATE.manifestPos.x} Y ${STATE.manifestPos.y}`;
}
function place(n,p){ n.style.left=p.x+"px"; n.style.top=p.y+"px"; }

/* ===============================
PERSIST
=============================== */
function persist(){
  STATE.updatedAt=new Date().toISOString();
  localStorage.setItem(KEY,JSON.stringify(STATE));
  render();
}

/* ===============================
DRAG
=============================== */
function drag(node,header,key){
  let on=false,sx,sy,bx,by;
  header.onpointerdown=e=>{
    on=true; sx=e.clientX; sy=e.clientY;
    bx=STATE[key].x; by=STATE[key].y;
    node.setPointerCapture(e.pointerId);
  };
  header.onpointermove=e=>{
    if(!on) return;
    STATE[key].x=Math.max(0,bx+e.clientX-sx);
    STATE[key].y=Math.max(0,by+e.clientY-sy);
    render();
  };
  header.onpointerup=()=>{ if(on){on=false;persist();} };
}

/* ===============================
IO
=============================== */
el("manifestText").oninput=()=>{STATE.manifestText=el("manifestText").value;persist();}
el("noteText").oninput=()=>{STATE.noteText=el("noteText").value;persist();}

el("exportBtn").onclick=()=>{
  const blob=new Blob([JSON.stringify(STATE,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=META.FILE_ID+".json";
  a.click();
};

el("importBtn").onclick=()=>el("fileInput").click();
el("fileInput").onchange=e=>{
  const f=e.target.files[0]; if(!f) return;
  f.text().then(t=>{
    STATE=Object.assign(structuredClone(DEFAULT),JSON.parse(t));
    persist();
  });
};

/* ===============================
BG
=============================== */
const bg=el("bg"),ctx=bg.getContext("2d");
function resize(){
  bg.width=innerWidth; bg.height=innerHeight;
}
addEventListener("resize",resize); resize();
(function tick(t){
  ctx.clearRect(0,0,bg.width,bg.height);
  ctx.globalAlpha=.15; ctx.strokeStyle="#fff";
  for(let i=0;i<12;i++){
    ctx.beginPath();
    ctx.arc(bg.width/2,bg.height/2,40+i*28,0,Math.PI*2);
    ctx.stroke();
  }
  requestAnimationFrame(tick);
})();

/* ===============================
BOOT
=============================== */
drag(el("manifest"),el("manifestHeader"),"manifestPos");
drag(el("note"),el("noteHeader"),"notePos");
render();
</script>

</body>
</html>
