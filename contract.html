<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>KETADATA — SYSTEM LAW CONTRACT</title>

<!-- =========================================================
 AE ▸ BLACK LAW ▸ EDGE SAFE ▸ NO RADIUS ▸ NO GRADIENT
========================================================= -->
<style>
:root{
  --bg:#000;
  --fg:#fff;
  --muted:#888;
  --line:#222;
  --accent:#fff;
  --note:#111;
}

*{box-sizing:border-box;}
html,body{
  margin:0;height:100%;
  background:var(--bg);
  color:var(--fg);
  font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
}

button,input,textarea{
  background:#000;
  color:#fff;
  border:1px solid var(--line);
  padding:6px 8px;
  font-family:inherit;
}

button:hover{background:#111;cursor:pointer}

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:6px 10px;
  border-bottom:1px solid var(--line);
}

.topbar .left{display:flex;gap:8px;align-items:center}
.topbar .right{display:flex;gap:8px}

.keta-note-icon{
  width:14px;height:14px;
  border:1px solid #fff;
}
.keta-note-icon.filled{background:#fff}

.main{
  display:grid;
  grid-template-columns: 1fr 360px;
  height:calc(100% - 42px);
}

.editor{
  padding:20px;
  overflow:auto;
}

.editor h1,h2,h3{
  margin-top:28px;
  border-bottom:1px solid var(--line);
  padding-bottom:6px;
}

.editor textarea{
  width:100%;
  min-height:80px;
  margin-top:6px;
}

.side{
  border-left:1px solid var(--line);
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

.preview{
  flex:1;
  border:1px solid var(--line);
  padding:10px;
  overflow:auto;
  background:#000;
  font-size:12px;
  white-space:pre;
}

.bottom{
  border-top:1px solid var(--line);
  padding:8px;
  font-size:11px;
  color:var(--muted);
}

.keta-note{
  position:fixed;
  top:60px;left:60px;
  width:260px;height:200px;
  background:var(--note);
  border:1px solid #fff;
  display:none;
  resize:both;
  overflow:auto;
}

.keta-note header{
  padding:4px 6px;
  border-bottom:1px solid var(--line);
  cursor:move;
  display:flex;
  justify-content:space-between;
}

.keta-note textarea{
  width:100%;
  height:calc(100% - 28px);
  border:none;
  resize:none;
}
</style>
</head>

<body>

<!-- =========================================================
 WB ▸ GLOBAL CONTROLS ▸ ICON + EXPORT ROUTES
========================================================= -->
<div class="topbar">
  <div class="left">
    <strong>KETADATA</strong>
    <span class="muted">SYSTEM LAW CONTRACT</span>
  </div>
  <div class="right">
    <div id="noteIcon" class="keta-note-icon filled"></div>
    <button onclick="exportJSON()">EXPORT JSON</button>
    <button onclick="exportMD()">EXPORT MD</button>
    <button onclick="window.print()">PRINT</button>
  </div>
</div>

<!-- =========================================================
 EE ▸ CORE CONTRACT EDITOR
========================================================= -->
<div class="main">
  <div class="editor" id="editor">

<h1>SYSTEM LAWS</h1>
<textarea data-key="system_laws">
Local-first.
Single-file tools.
Engine survives aesthetic failure.
State is exportable or invalid.
</textarea>

<h2>ATOMS</h2>
<textarea data-key="atoms">
Tool Atom: Local single-file HTML
Mental Atom: KETA_NOTE
Data Atom: Serializable STATE
</textarea>

<h2>NON-NEGOTIABLES</h2>
<textarea data-key="non_negotiables">
No hidden network calls.
No silent state loss.
No auto-mutation without record.
</textarea>

<h2>AE / EE / WB DOCTRINE</h2>
<textarea data-key="doctrine">
AE may change freely.
EE must remain deterministic.
WB changes require full retest.
</textarea>

<h2>NAMING LAW</h2>
<textarea data-key="naming">
lowercase
underscore
stable ids
padded digits
</textarea>

<h2>EXPORT LAW</h2>
<textarea data-key="export">
JSON is canonical.
Markdown is secondary.
HTML is executable truth.
</textarea>

  </div>

  <!-- =========================================================
  EE ▸ PREVIEW / VALIDATION
  ========================================================= -->
  <div class="side">
    <strong>PREVIEW</strong>
    <div id="preview" class="preview"></div>
    <div class="bottom">
      Contract is live. Exports snapshot current state.
    </div>
  </div>
</div>

<!-- =========================================================
 EE ▸ KETA NOTE (MENTAL ATOM)
========================================================= -->
<div id="ketaNote" class="keta-note">
  <header>
    <span>KETA NOTE</span>
    <button onclick="toggleNote()">×</button>
  </header>
  <textarea id="ketaNoteText">// decisions, deviations, next actions</textarea>
</div>

<!-- =========================================================
 EE ▸ STATE + EXPORT ENGINE
========================================================= -->
<script>
/* EE ▸ STATE CONTAINER */
function collectState(){
  const state = {};
  document.querySelectorAll('[data-key]').forEach(t=>{
    state[t.dataset.key]=t.value.trim();
  });
  state.keta_note = document.getElementById('ketaNoteText').value.trim();
  state.version = "ketadata-system-law-v1";
  state.updated = new Date().toISOString();
  return state;
}

/* EE ▸ PREVIEW RENDER */
function render(){
  document.getElementById('preview').textContent =
    JSON.stringify(collectState(),null,2);
}
document.addEventListener('input',render);
render();

/* EE ▸ EXPORTERS */
function exportJSON(){
  const blob = new Blob([JSON.stringify(collectState(),null,2)],{type:"application/json"});
  download(blob,"ketadata_system_laws.json");
}
function exportMD(){
  const s = collectState();
  let md = "# KETADATA SYSTEM LAWS\n";
  Object.entries(s).forEach(([k,v])=>{
    if(typeof v==="string") md += `\n## ${k}\n${v}\n`;
  });
  download(new Blob([md],{type:"text/markdown"}),"ketadata_system_laws.md");
}
function download(blob,name){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=name;
  a.click();
}

/* =========================================================
 WB ▸ KETA NOTE BEHAVIOR
========================================================= */
const note=document.getElementById('ketaNote');
const icon=document.getElementById('noteIcon');

function toggleNote(){
  const open = note.style.display==="block";
  note.style.display = open ? "none":"block";
  icon.classList.toggle("filled",open);
}
icon.onclick=toggleNote;

/* DRAG */
let drag=null;
note.querySelector('header').onmousedown=e=>{
  drag={x:e.clientX,y:e.clientY,
        ox:note.offsetLeft,oy:note.offsetTop};
};
window.onmousemove=e=>{
  if(!drag)return;
  note.style.left = drag.ox + e.clientX - drag.x + "px";
  note.style.top  = drag.oy + e.clientY - drag.y + "px";
};
window.onmouseup=()=>drag=null;
</script>

</body>
</html>
