<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KETADATA STUDIO</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #000000;
      --fg: #ffffff;
      --grid-border: #333333;
      --accent: #ff0000;
      --hover: #1a1a1a;
    }

    body {
      background: var(--bg);
      color: var(--fg);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 14px;
      line-height: 1.4;
      overflow-x: hidden;
    }

    .mono {
      font-family: 'Courier New', monospace;
      letter-spacing: 0.5px;
    }

    /* HEADER */
    .studio-header {
      padding: 20px;
      border-bottom: 1px solid var(--grid-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .studio-title {
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 2px;
    }

    .studio-info {
      font-size: 11px;
      opacity: 0.6;
    }

    /* CONTAINER */
    .studio-container {
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* INPUT ZONE */
    .studio-input {
      margin-bottom: 30px;
    }

    .drop-zone {
      border: 2px dashed var(--grid-border);
      padding: 60px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 12px;
      letter-spacing: 2px;
      font-weight: 600;
    }

    .drop-zone:hover {
      border-color: var(--fg);
      background: var(--hover);
    }

    .drop-zone.drag-over {
      border-color: var(--accent);
      background: rgba(255, 0, 0, 0.05);
    }

    /* GRID */
    .studio-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 30px;
    }

    .grid-slot {
      aspect-ratio: 1;
      border: 1px solid var(--grid-border);
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
    }

    .grid-slot:hover {
      border-color: var(--fg);
    }

    .grid-slot.selected {
      border-color: var(--accent);
      border-width: 2px;
    }

    .grid-slot.empty {
      background: var(--hover);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      opacity: 0.3;
    }

    .object-thumb {
      width: 100%;
      height: 100%;
      position: relative;
    }

    .object-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .metadata-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.9);
      padding: 8px;
      font-size: 10px;
      display: flex;
      justify-content: space-between;
    }

    .remove-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: var(--accent);
      color: var(--fg);
      border: none;
      width: 20px;
      height: 20px;
      cursor: pointer;
      font-size: 12px;
      line-height: 1;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .grid-slot:hover .remove-btn {
      opacity: 1;
    }

    /* TRANSFORM PANEL */
    .transform-panel {
      margin-bottom: 30px;
      border: 1px solid var(--grid-border);
      padding: 20px;
      display: none;
    }

    .transform-panel.active {
      display: block;
    }

    .panel-header {
      font-size: 11px;
      letter-spacing: 2px;
      margin-bottom: 20px;
      opacity: 0.6;
    }

    .transform-category {
      margin-bottom: 20px;
    }

    .transform-category h3 {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 1px;
      margin-bottom: 10px;
      opacity: 0.8;
    }

    .transform-category button {
      background: var(--bg);
      color: var(--fg);
      border: 1px solid var(--grid-border);
      padding: 10px 20px;
      margin-right: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      font-size: 11px;
      letter-spacing: 1px;
      transition: all 0.2s;
      font-weight: 500;
    }

    .transform-category button:hover {
      border-color: var(--fg);
      background: var(--hover);
    }

    .transform-category button:active {
      background: var(--accent);
    }

    /* CONSTRAINTS */
    .constraints {
      display: none;
      margin-top: 15px;
      padding: 15px;
      border: 1px solid var(--grid-border);
      background: var(--hover);
    }

    .constraints.active {
      display: block;
    }

    .constraints label {
      display: block;
      font-size: 10px;
      letter-spacing: 1px;
      margin-bottom: 5px;
      opacity: 0.8;
    }

    .constraints input {
      background: var(--bg);
      border: 1px solid var(--grid-border);
      color: var(--fg);
      padding: 8px;
      font-size: 12px;
      width: 100px;
      margin-bottom: 10px;
    }

    .execute-btn {
      background: var(--accent);
      color: var(--fg);
      border: none;
      padding: 10px 30px;
      cursor: pointer;
      font-size: 11px;
      letter-spacing: 2px;
      font-weight: 600;
      margin-top: 10px;
    }

    /* PREVIEW */
    .preview-zone {
      display: none;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
      border: 1px solid var(--grid-border);
      padding: 20px;
    }

    .preview-zone.active {
      display: grid;
    }

    .preview-pane h4 {
      font-size: 10px;
      letter-spacing: 2px;
      margin-bottom: 10px;
      opacity: 0.6;
    }

    .preview-pane img {
      width: 100%;
      border: 1px solid var(--grid-border);
    }

    /* OUTPUT */
    .output-panel {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
    }

    .output-panel button {
      background: var(--bg);
      color: var(--fg);
      border: 1px solid var(--grid-border);
      padding: 15px 30px;
      cursor: pointer;
      font-size: 11px;
      letter-spacing: 2px;
      font-weight: 600;
      flex: 1;
      transition: all 0.2s;
    }

    .output-panel button:hover {
      border-color: var(--fg);
      background: var(--hover);
    }

    .output-panel button.primary {
      background: var(--fg);
      color: var(--bg);
    }

    /* SESSION LOG */
    .session-log {
      border: 1px solid var(--grid-border);
      padding: 20px;
    }

    .session-log h4 {
      font-size: 11px;
      letter-spacing: 2px;
      margin-bottom: 15px;
      opacity: 0.6;
    }

    .transform-history {
      list-style: none;
    }

    .history-item {
      font-size: 11px;
      padding: 8px 0;
      border-bottom: 1px solid var(--grid-border);
      display: flex;
      justify-content: space-between;
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .timestamp {
      opacity: 0.5;
    }

    /* HIDDEN */
    #fileInput {
      display: none;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="studio-header">
    <div class="studio-title">KETADATA STUDIO / X-RAY</div>
    <div class="studio-info mono">MAX 16 OBJECTS</div>
  </div>

  <!-- MAIN CONTAINER -->
  <div class="studio-container">

    <!-- INPUT ZONE -->
    <div class="studio-input">
      <div class="drop-zone" id="dropZone">
        DROP OBJECTS OR CLICK TO SELECT [16 MAX]
      </div>
      <input type="file" id="fileInput" multiple accept="image/*">
    </div>

    <!-- GRID -->
    <div class="studio-grid" id="grid">
      <!-- Generated slots -->
    </div>

    <!-- TRANSFORM PANEL -->
    <div class="transform-panel" id="transformPanel">
      <div class="panel-header">SELECT TRANSFORMATION</div>

      <div class="transform-category">
        <h3>FORMAT</h3>
        <button data-transform="to-png">→ PNG</button>
        <button data-transform="to-jpg">→ JPG</button>
      </div>

      <div class="transform-category">
        <h3>OPERATIONS</h3>
        <button data-transform="resize">RESIZE</button>
        <button data-transform="invert">INVERT</button>
        <button data-transform="grayscale">GRAYSCALE</button>
        <button data-transform="rotate">ROTATE 90°</button>
      </div>

      <div class="transform-category">
        <h3>METADATA</h3>
        <button data-transform="view-info">INSPECT</button>
      </div>

      <!-- CONSTRAINTS (shown when needed) -->
      <div class="constraints" id="constraints">
        <label>WIDTH (PX)</label>
        <input type="number" id="resizeWidth" placeholder="800">
        <label>HEIGHT (PX)</label>
        <input type="number" id="resizeHeight" placeholder="600">
        <button class="execute-btn" id="executeBtn">EXECUTE</button>
      </div>
    </div>

    <!-- PREVIEW -->
    <div class="preview-zone" id="previewZone">
      <div class="preview-pane">
        <h4>ORIGINAL</h4>
        <img id="originalPreview" src="" alt="">
      </div>
      <div class="preview-pane">
        <h4>TRANSFORMED</h4>
        <img id="transformedPreview" src="" alt="">
      </div>
    </div>

    <!-- OUTPUT -->
    <div class="output-panel">
      <button id="downloadBtn">DOWNLOAD</button>
      <button id="downloadAllBtn">DOWNLOAD ALL</button>
      <button>→ VAULT</button>
      <button>→ ROOM</button>
    </div>

    <!-- SESSION LOG -->
    <div class="session-log">
      <h4>SESSION HISTORY</h4>
      <ul class="transform-history" id="history">
        <li class="history-item">
          <span>SESSION STARTED</span>
          <span class="timestamp mono" id="sessionStart"></span>
        </li>
      </ul>
    </div>

  </div>

  <script>
    // STATE
    let objects = [];
    let selectedIndex = null;
    let currentTransform = null;
    let transformedData = null;

    // INIT
    document.addEventListener('DOMContentLoaded', () => {
      initGrid();
      initDropZone();
      initTransforms();
      document.getElementById('sessionStart').textContent = new Date().toLocaleTimeString();
    });

    // CREATE GRID
    function initGrid() {
      const grid = document.getElementById('grid');
      for (let i = 0; i < 16; i++) {
        const slot = document.createElement('div');
        slot.className = 'grid-slot empty';
        slot.dataset.index = i;
        slot.innerHTML = `<span>${i + 1}</span>`;
        slot.addEventListener('click', () => selectSlot(i));
        grid.appendChild(slot);
      }
    }

    // DROP ZONE
    function initDropZone() {
      const dropZone = document.getElementById('dropZone');
      const fileInput = document.getElementById('fileInput');

      dropZone.addEventListener('click', () => fileInput.click());
      
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
      });

      dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('drag-over');
      });

      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        handleFiles(e.dataTransfer.files);
      });

      fileInput.addEventListener('change', (e) => {
        handleFiles(e.target.files);
      });
    }

    // HANDLE FILES
    function handleFiles(files) {
      const remaining = 16 - objects.length;
      const toAdd = Math.min(files.length, remaining);

      for (let i = 0; i < toAdd; i++) {
        const file = files[i];
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = (e) => {
            addObject(e.target.result, file);
          };
          reader.readAsDataURL(file);
        }
      }
    }

    // ADD OBJECT
    function addObject(dataUrl, file) {
      const index = objects.length;
      objects.push({ dataUrl, file, original: dataUrl });

      const slot = document.querySelector(`[data-index="${index}"]`);
      slot.classList.remove('empty');
      slot.innerHTML = `
        <div class="object-thumb">
          <img src="${dataUrl}" alt="">
          <div class="metadata-overlay">
            <span class="mono">${file.type.split('/')[1].toUpperCase()}</span>
            <span class="mono">${(file.size / 1024).toFixed(1)}KB</span>
          </div>
          <button class="remove-btn" onclick="removeObject(${index})">×</button>
        </div>
      `;

      logHistory(`OBJECT ${index + 1} ADDED`, file.name);
    }

    // REMOVE OBJECT
    function removeObject(index) {
      event.stopPropagation();
      objects[index] = null;
      const slot = document.querySelector(`[data-index="${index}"]`);
      slot.classList.add('empty');
      slot.innerHTML = `<span>${index + 1}</span>`;
      
      if (selectedIndex === index) {
        selectedIndex = null;
        document.getElementById('transformPanel').classList.remove('active');
      }
      
      logHistory(`OBJECT ${index + 1} REMOVED`);
    }

    // SELECT SLOT
    function selectSlot(index) {
      if (!objects[index]) return;

      // Deselect previous
      document.querySelectorAll('.grid-slot').forEach(s => s.classList.remove('selected'));
      
      // Select new
      selectedIndex = index;
      document.querySelector(`[data-index="${index}"]`).classList.add('selected');
      document.getElementById('transformPanel').classList.add('active');
      document.getElementById('constraints').classList.remove('active');
      document.getElementById('previewZone').classList.remove('active');
    }

    // TRANSFORMS
    function initTransforms() {
      document.querySelectorAll('[data-transform]').forEach(btn => {
        btn.addEventListener('click', () => {
          if (selectedIndex === null) return;
          
          const transform = btn.dataset.transform;
          currentTransform = transform;

          if (transform === 'resize') {
            document.getElementById('constraints').classList.add('active');
            return;
          }

          executeTransform(transform);
        });
      });

      document.getElementById('executeBtn').addEventListener('click', () => {
        executeTransform('resize');
      });

      document.getElementById('downloadBtn').addEventListener('click', downloadCurrent);
      document.getElementById('downloadAllBtn').addEventListener('click', downloadAll);
    }

    // EXECUTE TRANSFORM
    function executeTransform(transform) {
      if (selectedIndex === null) return;

      const obj = objects[selectedIndex];
      const img = new Image();
      img.src = obj.dataUrl;

      img.onload = () => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        switch(transform) {
          case 'to-png':
          case 'to-jpg':
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            const format = transform === 'to-png' ? 'image/png' : 'image/jpeg';
            transformedData = canvas.toDataURL(format);
            break;

          case 'resize':
            const width = parseInt(document.getElementById('resizeWidth').value) || img.width;
            const height = parseInt(document.getElementById('resizeHeight').value) || img.height;
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            transformedData = canvas.toDataURL();
            break;

          case 'invert':
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < imageData.data.length; i += 4) {
              imageData.data[i] = 255 - imageData.data[i];
              imageData.data[i + 1] = 255 - imageData.data[i + 1];
              imageData.data[i + 2] = 255 - imageData.data[i + 2];
            }
            ctx.putImageData(imageData, 0, 0);
            transformedData = canvas.toDataURL();
            break;

          case 'grayscale':
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            const grayData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < grayData.data.length; i += 4) {
              const avg = (grayData.data[i] + grayData.data[i + 1] + grayData.data[i + 2]) / 3;
              grayData.data[i] = avg;
              grayData.data[i + 1] = avg;
              grayData.data[i + 2] = avg;
            }
            ctx.putImageData(grayData, 0, 0);
            transformedData = canvas.toDataURL();
            break;

          case 'rotate':
            canvas.width = img.height;
            canvas.height = img.width;
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate(90 * Math.PI / 180);
            ctx.drawImage(img, -img.width / 2, -img.height / 2);
            transformedData = canvas.toDataURL();
            break;

          case 'view-info':
            alert(`FORMAT: ${obj.file.type}\nSIZE: ${(obj.file.size / 1024).toFixed(1)}KB\nNAME: ${obj.file.name}`);
            return;
        }

        // Show preview
        document.getElementById('originalPreview').src = obj.original;
        document.getElementById('transformedPreview').src = transformedData;
        document.getElementById('previewZone').classList.add('active');

        // Update object
        objects[selectedIndex].dataUrl = transformedData;
        document.querySelector(`[data-index="${selectedIndex}"] img`).src = transformedData;

        logHistory(`TRANSFORM: ${transform.toUpperCase()}`, `OBJECT ${selectedIndex + 1}`);
      };
    }

    // DOWNLOAD
    function downloadCurrent() {
      if (selectedIndex === null || !transformedData) return;
      
      const link = document.createElement('a');
      link.download = `ketadata-${Date.now()}.png`;
      link.href = transformedData;
      link.click();
      
      logHistory('DOWNLOAD', `OBJECT ${selectedIndex + 1}`);
    }

    function downloadAll() {
      objects.forEach((obj, i) => {
        if (obj) {
          const link = document.createElement('a');
          link.download = `ketadata-${i + 1}-${Date.now()}.png`;
          link.href = obj.dataUrl;
          link.click();
        }
      });
      
      logHistory('DOWNLOAD ALL', `${objects.filter(o => o).length} OBJECTS`);
    }

    // HISTORY
    function logHistory(action, detail = '') {
      const history = document.getElementById('history');
      const item = document.createElement('li');
      item.className = 'history-item';
      item.innerHTML = `
        <span>${action} ${detail ? '→ ' + detail : ''}</span>
        <span class="timestamp mono">${new Date().toLocaleTimeString()}</span>
      `;
      history.appendChild(item);
    }
  </script>

</body>
</html>
