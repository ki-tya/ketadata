<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>KETADATA // INTERFACE COMPARER</title>
  <style>
    :root{
      --bg:#07090c;
      --panel:#0b0f14;
      --panel2:#0a0d12;
      --line:#1a2330;
      --line2:#2a3647;
      --text:#e9edf4;
      --muted:rgba(233,237,244,.62);
      --faint:rgba(233,237,244,.35);
      --focus:rgba(120,180,255,.9);
      --warn:rgba(255,220,120,.9);
      --danger:rgba(255,90,90,.85);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --r:0px;
      --shadow: 0 22px 60px rgba(0,0,0,.55);
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(900px 600px at 50% 22%, rgba(255,255,255,.06), transparent 65%),
        radial-gradient(700px 400px at 18% 60%, rgba(255,255,255,.04), transparent 70%),
        radial-gradient(800px 500px at 82% 68%, rgba(255,255,255,.03), transparent 75%),
        var(--bg);
      color:var(--text);
      font-family: var(--sans);
      overflow:auto;
    }
    .topbar{
      position:sticky; top:0; z-index:50;
      background: linear-gradient(to bottom, rgba(0,0,0,.85), rgba(0,0,0,.55));
      border-bottom:1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(8px);
    }
    .topbar-inner{
      padding:14px 16px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:14px;
      max-width: 1400px;
      margin:0 auto;
    }
    .brand{
      display:flex; flex-direction:column; gap:4px;
      min-width: 320px;
    }
    .brand .title{
      font-weight:800;
      letter-spacing:.11em;
      text-transform:uppercase;
      font-size:14px;
    }
    .brand .sub{
      font-family: var(--mono);
      color:var(--muted);
      font-size:11px;
      line-height:1.3;
    }
    .controls{
      display:flex; flex-wrap:wrap; gap:8px;
      justify-content:flex-end;
      align-items:center;
    }
    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-family: var(--mono);
      font-size:11px;
      padding:8px 10px;
      cursor:pointer;
      border-radius: var(--r);
      text-transform:lowercase;
      letter-spacing:.02em;
    }
    .btn:hover{ border-color: rgba(255,255,255,.26); }
    .btn.primary{ border-color: rgba(255,255,255,.22); background: rgba(120,180,255,.10); }
    .btn.warn{ border-color: rgba(255,255,255,.22); background: rgba(255,220,120,.10); color: rgba(255,240,200,.95); }
    .btn.danger{ border-color: rgba(255,255,255,.18); background: rgba(255,90,90,.10); color: rgba(255,210,210,.95); }

    .wrap{
      max-width: 1400px;
      margin: 16px auto 48px;
      padding: 0 16px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 12px;
      align-items:start;
    }

    .card{
      background: linear-gradient(to bottom, rgba(255,255,255,.04), rgba(255,255,255,.015));
      border:1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      border-radius: var(--r);
      overflow:hidden;
      position:relative;
    }
    .card .hdr{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 10px 8px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.20);
    }
    .card .hdr .left{
      display:flex; align-items:baseline; gap:10px; min-width:0;
    }
    .tag{
      font-family: var(--mono);
      font-size:10px;
      color: rgba(233,237,244,.78);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      padding:3px 6px;
      border-radius: var(--r);
      text-transform:lowercase;
      white-space:nowrap;
    }
    .card .hdr .name{
      font-family: var(--mono);
      font-size:11px;
      color: rgba(233,237,244,.85);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 220px;
    }
    .card .hdr .right{
      display:flex; gap:8px; align-items:center;
    }
    .mini{
      font-family: var(--mono);
      font-size:10px;
      padding:4px 6px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: rgba(233,237,244,.8);
      cursor:pointer;
      border-radius: var(--r);
    }
    .mini:hover{ border-color: rgba(255,255,255,.26); }
    .mini.danger{ background: rgba(255,90,90,.10); }

    .body{
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    label{
      font-family: var(--mono);
      font-size:10px;
      color: rgba(233,237,244,.55);
      text-transform:lowercase;
      letter-spacing:.03em;
      display:block;
      margin:0 0 4px;
    }
    input[type="text"], textarea{
      width:100%;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.24);
      color: rgba(233,237,244,.90);
      border-radius: var(--r);
      padding:8px 9px;
      font-family: var(--mono);
      font-size:11px;
      outline:none;
    }
    textarea{ resize: vertical; min-height: 92px; }
    input[type="text"]:focus, textarea:focus{
      border-color: rgba(120,180,255,.55);
      box-shadow: 0 0 0 2px rgba(120,180,255,.12) inset;
    }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }

    .shot{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding:8px;
      border-radius: var(--r);
    }
    .shot .drop{
      border:1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.03);
      padding:10px;
      border-radius: var(--r);
      min-height: 120px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      color: rgba(233,237,244,.55);
      font-family: var(--mono);
      font-size:10px;
      cursor:pointer;
      position:relative;
      overflow:hidden;
    }
    .shot .drop:hover{ border-color: rgba(255,255,255,.30); }
    .shot img{
      max-width:100%;
      display:block;
      border:1px solid rgba(255,255,255,.10);
    }
    .shot .tools{
      margin-top:8px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-start;
      align-items:center;
    }
    .hint{
      font-family: var(--mono);
      font-size:10px;
      color: rgba(233,237,244,.45);
    }

    .foot{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-top: 10px;
      padding-top: 10px;
      border-top:1px solid rgba(255,255,255,.08);
    }
    .count{
      font-family: var(--mono);
      font-size:10px;
      color: rgba(233,237,244,.45);
    }

    /* Modal */
    .modal{
      position:fixed; inset:0; z-index:100;
      display:none;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(6px);
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .modal.show{ display:flex; }
    .modal .panel{
      width:min(980px, 100%);
      background: rgba(10,13,18,.95);
      border:1px solid rgba(255,255,255,.12);
      border-radius: var(--r);
      box-shadow: 0 30px 90px rgba(0,0,0,.65);
      overflow:hidden;
    }
    .modal .panel .mhdr{
      display:flex; justify-content:space-between; align-items:center; gap:12px;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.25);
    }
    .modal .panel .mhdr .mttl{
      font-family: var(--mono);
      font-size:11px;
      color: rgba(233,237,244,.85);
      text-transform:lowercase;
      letter-spacing:.03em;
    }
    .modal .panel .mbody{
      padding:12px;
    }
    .modal textarea{
      min-height: 420px;
      font-family: var(--mono);
      font-size:11px;
      line-height:1.35;
    }
    .pill{
      font-family: var(--mono);
      font-size:10px;
      padding:6px 8px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      border-radius: var(--r);
      color: rgba(233,237,244,.7);
    }
    .divider{ width:1px; height:24px; background: rgba(255,255,255,.10); }

    @media (max-width: 740px){
      .brand{ min-width: auto; }
      .row2{ grid-template-columns: 1fr; }
      .card .hdr .name{ max-width: 160px; }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="title">KETADATA // INTERFACE COMPARER</div>
        <div class="sub">Input up to 9 interfaces. Title + link + screenshot + HTML + notes. Export as prompts. Export/import JSON. Local-first.</div>
      </div>
      <div class="controls">
        <button class="btn primary" id="btnAdd">add interface</button>
        <span class="pill" id="cap">0/9</span>
        <span class="divider"></span>
        <button class="btn" id="btnExportPrompts">export prompts</button>
        <button class="btn" id="btnCopyPrompts">copy prompts</button>
        <button class="btn" id="btnExportJSON">export.json</button>
        <button class="btn" id="btnImportJSON">import.json</button>
        <button class="btn danger" id="btnResetAll">reset</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid" id="grid"></div>
  </div>

  <!-- hidden file inputs -->
  <input type="file" id="jsonFile" accept="application/json" style="display:none"/>
  <input type="file" id="imgFile" accept="image/*" style="display:none"/>

  <!-- modal -->
  <div class="modal" id="modal">
    <div class="panel">
      <div class="mhdr">
        <div class="mttl">export prompts</div>
        <div style="display:flex; gap:8px; align-items:center;">
          <span class="pill" id="promptStats">0 chars</span>
          <button class="btn" id="btnDownloadPrompts">download.txt</button>
          <button class="btn" id="btnCloseModal">close (esc)</button>
        </div>
      </div>
      <div class="mbody">
        <textarea id="promptOut" spellcheck="false"></textarea>
      </div>
    </div>
  </div>

<script>
(() => {
  const MAX = 9;
  const LS_KEY = "ketadata_interface_comparer_v1";

  const $ = (id) => document.getElementById(id);

  const state = load() || { items: [] };

  const grid = $("grid");
  const cap = $("cap");

  const modal = $("modal");
  const promptOut = $("promptOut");
  const promptStats = $("promptStats");

  function uid(){
    return Math.random().toString(16).slice(2) + Date.now().toString(16);
  }

  function load(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return null;
      return JSON.parse(raw);
    }catch(e){ return null; }
  }

  function save(){
    try{
      localStorage.setItem(LS_KEY, JSON.stringify(state));
    }catch(e){}
    renderCap();
  }

  function renderCap(){
    cap.textContent = `${state.items.length}/${MAX}`;
    $("btnAdd").disabled = state.items.length >= MAX;
    $("btnAdd").style.opacity = state.items.length >= MAX ? .5 : 1;
    $("btnAdd").style.cursor = state.items.length >= MAX ? "not-allowed" : "pointer";
  }

  function addItem(){
    if(state.items.length >= MAX) return;
    state.items.push({
      id: uid(),
      title: "",
      link: "",
      html: "",
      notes: "",
      screenshotDataUrl: "",
      screenshotName: ""
    });
    save();
    render();
  }

  function removeItem(id){
    state.items = state.items.filter(x => x.id !== id);
    save();
    render();
  }

  function setField(id, key, val){
    const it = state.items.find(x => x.id === id);
    if(!it) return;
    it[key] = val;
    save();
  }

  function openModalWith(text){
    promptOut.value = text;
    promptStats.textContent = `${text.length} chars`;
    modal.classList.add("show");
    promptOut.focus();
    promptOut.setSelectionRange(0,0);
  }
  function closeModal(){
    modal.classList.remove("show");
  }

  function escapeTripleBackticks(s){
    return (s || "").replace(/```/g, "``\\`");
  }

  function buildPrompts(){
    const blocks = state.items.map((it, idx) => {
      const n = idx + 1;
      const title = (it.title || "").trim();
      const link = (it.link || "").trim();
      const notes = (it.notes || "").trim();
      const html = (it.html || "").trim();

      const head = `INTERFACE ${n}\nTITLE: ${title || "[untitled]"}\nLINK: ${link || "[no link]"}\n`;
      const shot = it.screenshotName ? `SCREENSHOT: ${it.screenshotName}\n` : `SCREENSHOT: [not provided]\n`;

      const htmlBlock = html
        ? `HTML:\n\`\`\`html\n${escapeTripleBackticks(html)}\n\`\`\`\n`
        : `HTML: [not provided]\n`;

      const notesBlock = `NOTES:\n${notes || "[none]"}\n`;

      return head + shot + htmlBlock + notesBlock + `---\n`;
    });

    // prompt header that tells the model what to do with the data
    const pre = [
      "KETADATA LAB // INTERFACE COMPARER EXPORT",
      "Task: Compare these interfaces. Extract patterns, bugs, and reusable primitives. Propose consolidated design rules + implementation plan.",
      "Output constraints: Be direct. Avoid fluff. Provide a numbered list of findings, then recommended actions.",
      "---",
      ""
    ].join("\n");

    return pre + blocks.join("");
  }

  async function copyText(text){
    try{
      await navigator.clipboard.writeText(text);
      return true;
    }catch(e){
      // fallback
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand("copy"); }catch(_){}
      ta.remove();
      return true;
    }
  }

  function download(filename, content, mime="text/plain"){
    const blob = new Blob([content], { type: mime });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(a.href), 5000);
  }

  function exportJSON(){
    const payload = {
      version: 1,
      exported_at: new Date().toISOString(),
      items: state.items
    };
    download("interfaces.export.json", JSON.stringify(payload, null, 2), "application/json");
  }

  function importJSONFile(file){
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const data = JSON.parse(reader.result);
        const items = data.items || data;
        if(!Array.isArray(items)) throw new Error("Bad format");
        // normalize + cap to MAX
        state.items = items.slice(0, MAX).map(x => ({
          id: x.id || uid(),
          title: x.title || "",
          link: x.link || "",
          html: x.html || "",
          notes: x.notes || "",
          screenshotDataUrl: x.screenshotDataUrl || "",
          screenshotName: x.screenshotName || ""
        }));
        save();
        render();
      }catch(e){
        alert("Import failed: invalid JSON.");
      }
    };
    reader.readAsText(file);
  }

  function openImagePicker(forId){
    const inp = $("imgFile");
    inp.value = "";
    inp.onchange = () => {
      const f = inp.files && inp.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        setField(forId, "screenshotDataUrl", reader.result);
        setField(forId, "screenshotName", f.name || "screenshot");
        render();
      };
      reader.readAsDataURL(f);
    };
    inp.click();
  }

  function clearScreenshot(id){
    setField(id, "screenshotDataUrl", "");
    setField(id, "screenshotName", "");
    render();
  }

  function bindDrop(dropEl, id){
    dropEl.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropEl.style.borderColor = "rgba(120,180,255,.55)";
    });
    dropEl.addEventListener("dragleave", () => {
      dropEl.style.borderColor = "rgba(255,255,255,.18)";
    });
    dropEl.addEventListener("drop", (e) => {
      e.preventDefault();
      dropEl.style.borderColor = "rgba(255,255,255,.18)";
      const f = e.dataTransfer.files && e.dataTransfer.files[0];
      if(!f) return;
      if(!f.type.startsWith("image/")) return;
      const reader = new FileReader();
      reader.onload = () => {
        setField(id, "screenshotDataUrl", reader.result);
        setField(id, "screenshotName", f.name || "screenshot");
        render();
      };
      reader.readAsDataURL(f);
    });
  }

  function render(){
    grid.innerHTML = "";
    renderCap();

    if(state.items.length === 0){
      const empty = document.createElement("div");
      empty.className = "card";
      empty.innerHTML = `
        <div class="hdr">
          <div class="left">
            <span class="tag">empty</span>
            <div class="name">no interfaces yet</div>
          </div>
        </div>
        <div class="body">
          <div class="hint">Add an interface. You can paste link + HTML, and drag-drop a screenshot.</div>
          <button class="btn primary" id="emptyAdd">add interface</button>
        </div>
      `;
      grid.appendChild(empty);
      empty.querySelector("#emptyAdd").onclick = addItem;
      return;
    }

    state.items.forEach((it, idx) => {
      const card = document.createElement("div");
      card.className = "card";

      const displayName = (it.title || "").trim() || `interface ${idx+1}`;
      const htmlChars = (it.html || "").length;
      const notesChars = (it.notes || "").length;

      card.innerHTML = `
        <div class="hdr">
          <div class="left">
            <span class="tag">#${idx+1}</span>
            <div class="name" title="${escapeHtml(displayName)}">${escapeHtml(displayName)}</div>
          </div>
          <div class="right">
            <span class="pill">${htmlChars} html chars</span>
            <span class="pill">${notesChars} note chars</span>
            <button class="mini danger" data-act="remove">remove</button>
          </div>
        </div>

        <div class="body">
          <div class="row2">
            <div>
              <label>title</label>
              <input type="text" data-k="title" placeholder="e.g. Constellation Notes v3" value="${escapeAttr(it.title)}"/>
            </div>
            <div>
              <label>link</label>
              <input type="text" data-k="link" placeholder="e.g. https://ketadata.com/system.html" value="${escapeAttr(it.link)}"/>
            </div>
          </div>

          <div class="shot">
            <label>screenshot</label>
            <div class="drop" data-act="pickshot">
              ${
                it.screenshotDataUrl
                  ? `<img alt="screenshot" src="${it.screenshotDataUrl}"/>`
                  : `<div>drag image here<br/>or click to upload</div>`
              }
            </div>
            <div class="tools">
              <button class="mini" data-act="pickshot">upload</button>
              <button class="mini" data-act="clearshot">clear</button>
              <span class="hint">${it.screenshotName ? escapeHtml(it.screenshotName) : "no screenshot"}</span>
            </div>
          </div>

          <div>
            <label>html code (optional)</label>
            <textarea data-k="html" placeholder="paste html here…" spellcheck="false">${escapeHtml(it.html)}</textarea>
          </div>

          <div>
            <label>notes (likes / dislikes / features / bugs / primitives)</label>
            <textarea data-k="notes" placeholder="what works / what fails / what to keep / what to consolidate…" spellcheck="false">${escapeHtml(it.notes)}</textarea>
          </div>

          <div class="foot">
            <div class="count">autosaves locally · export prompts for model ingestion</div>
            <div style="display:flex; gap:8px;">
              <button class="mini" data-act="exportOne">export this → prompt</button>
            </div>
          </div>
        </div>
      `;

      // actions
      card.querySelector('[data-act="remove"]').onclick = () => removeItem(it.id);

      // bind inputs
      card.querySelectorAll("[data-k]").forEach(el => {
        const k = el.getAttribute("data-k");
        el.addEventListener("input", () => setField(it.id, k, el.value));
      });

      // screenshot picker/drop
      const drop = card.querySelector(".drop");
      bindDrop(drop, it.id);
      drop.addEventListener("click", () => openImagePicker(it.id));
      card.querySelectorAll('[data-act="pickshot"]').forEach(btn => {
        btn.onclick = () => openImagePicker(it.id);
      });
      card.querySelector('[data-act="clearshot"]').onclick = () => clearScreenshot(it.id);

      // export single interface prompt
      card.querySelector('[data-act="exportOne"]').onclick = async () => {
        const single = {
          version: 1,
          items: [it]
        };
        const text = [
          "KETADATA LAB // SINGLE INTERFACE EXPORT",
          "Task: Analyze this interface. Extract design primitives + issues + consolidation opportunities. Provide actionable fixes.",
          "---",
          buildPromptsFromItems([it]),
        ].join("\n");
        openModalWith(text);
        await copyText(text);
      };

      grid.appendChild(card);
    });
  }

  function buildPromptsFromItems(items){
    return items.map((it, idx) => {
      const title = (it.title || "").trim();
      const link = (it.link || "").trim();
      const notes = (it.notes || "").trim();
      const html = (it.html || "").trim();
      const shot = it.screenshotName ? it.screenshotName : "";

      const head = `INTERFACE\nTITLE: ${title || "[untitled]"}\nLINK: ${link || "[no link]"}\nSCREENSHOT: ${shot || "[not provided]"}\n`;
      const htmlBlock = html ? `HTML:\n\`\`\`html\n${escapeTripleBackticks(html)}\n\`\`\`\n` : `HTML: [not provided]\n`;
      const notesBlock = `NOTES:\n${notes || "[none]"}\n---\n`;
      return head + htmlBlock + notesBlock;
    }).join("");
  }

  function escapeHtml(s){
    return (s || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }
  function escapeAttr(s){
    return (s || "")
      .replaceAll("&","&amp;")
      .replaceAll('"',"&quot;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }

  // top controls
  $("btnAdd").onclick = addItem;

  $("btnExportPrompts").onclick = () => {
    const text = buildPrompts();
    openModalWith(text);
  };

  $("btnCopyPrompts").onclick = async () => {
    const text = buildPrompts();
    await copyText(text);
    // small, non-intrusive signal
    $("btnCopyPrompts").textContent = "copied";
    setTimeout(() => $("btnCopyPrompts").textContent = "copy prompts", 900);
  };

  $("btnDownloadPrompts").onclick = () => {
    const text = promptOut.value || buildPrompts();
    download("interfaces.prompts.txt", text, "text/plain");
  };

  $("btnExportJSON").onclick = exportJSON;

  $("btnImportJSON").onclick = () => $("jsonFile").click();
  $("jsonFile").onchange = () => {
    const f = $("jsonFile").files && $("jsonFile").files[0];
    if(f) importJSONFile(f);
  };

  $("btnResetAll").onclick = () => {
    const ok = confirm("Reset all interfaces? This clears local state.");
    if(!ok) return;
    state.items = [];
    save();
    render();
  };

  $("btnCloseModal").onclick = closeModal;
  modal.addEventListener("click", (e) => {
    if(e.target === modal) closeModal();
  });
  window.addEventListener("keydown", (e) => {
    if(e.key === "Escape") closeModal();
  });

  // initial
  renderCap();
  render();

})();
</script>
</body>
</html>
