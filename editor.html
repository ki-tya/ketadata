<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KETADATA Photo Editor</title>
<style>
  body {
    background: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem;
  }

  h1 { margin-bottom: 1rem; }

  #image-grid {
    display: grid;
    gap: 10px;
    margin-top: 1rem;
  }

  canvas {
    border: 1px solid #555;
    max-width: 100%;
    display: block;
  }

  select, button, input {
    margin: 0.5rem;
  }

  #overlay-controls {
    margin-top: 1rem;
  }
</style>
</head>
<body>

<h1>KETADATA Photo Editor</h1>

<input type="file" id="imageUpload" accept="image/*" multiple>
<select id="effectSelect">
  <option value="none">No Effect</option>
  <option value="invert">Color Inversion</option>
  <option value="xray">X-Ray</option>
  <option value="chromatic">Chromatographic</option>
  <option value="sonar">Sonar</option>
  <option value="wireframe">Wireframe</option>
  <option value="lofi">Lo-Fi</option>
  <option value="crunchy">Crunchy</option>
  <option value="fried">Fried</option>
  <option value="infrared">Infra-Red</option>
  <option value="nightvision">Night Vision</option>
  <option value="surveillance">Surveillance Cam</option>
</select>
<button id="applyEffect">Apply Effect</button>

<div id="overlay-controls">
  <label>Overlay Image 1 Index: <input type="number" id="overlay1" min="1" max="16"></label>
  <label>Overlay Image 2 Index: <input type="number" id="overlay2" min="1" max="16"></label>
  <button id="applyOverlay">Apply Overlay</button>
</div>

<button id="downloadAll">Download All Images</button>

<div id="image-grid"></div>

<script>
const MAX_IMAGES = 16;
const imageGrid = document.getElementById('image-grid');
let canvases = [];

document.getElementById('imageUpload').addEventListener('change', (e) => {
  imageGrid.innerHTML = '';
  canvases = [];
  const files = Array.from(e.target.files).slice(0, MAX_IMAGES);

  // Adjust grid layout dynamically
  const gridCols = Math.ceil(Math.sqrt(files.length));
  imageGrid.style.gridTemplateColumns = `repeat(${gridCols}, 1fr)`;

  files.forEach((file, index) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.onload = () => {
      canvas.width = 300;
      canvas.height = (img.height / img.width) * 300;
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    }
    img.src = URL.createObjectURL(file);
    imageGrid.appendChild(canvas);
    canvases.push(canvas);
  });
});

// Effect Functions
function applyEffectToCanvas(canvas, effect) {
  const ctx = canvas.getContext('2d');
  const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
  const data = imgData.data;

  for(let i=0;i<data.length;i+=4){
    let r=data[i],g=data[i+1],b=data[i+2];

    switch(effect){
      case 'invert':
        data[i]=255-r; data[i+1]=255-g; data[i+2]=255-b;
        break;
      case 'xray':
        const gray=(r+g+b)/3; data[i]=data[i+1]=data[i+2]=255-gray;
        break;
      case 'chromatic':
        data[i]=b; data[i+1]=r; data[i+2]=g; break;
      case 'sonar':
        const sonar= r*0.3 + g*0.59 + b*0.11;
        data[i]=data[i+1]=data[i+2]=sonar>128?255:0; break;
      case 'wireframe':
        const avg=(r+g+b)/3; data[i]=data[i+1]=data[i+2]=avg; break;
      case 'lofi':
        data[i]=r*0.8; data[i+1]=g*0.7; data[i+2]=b*0.6; break;
      case 'crunchy':
        data[i]=Math.min(255,r*1.5); data[i+1]=Math.min(255,g*1.5); data[i+2]=Math.min(255,b*1.5); break;
      case 'fried':
        data[i]=r*2>255?255:r*2; data[i+1]=g*2>255?255:g*2; data[i+2]=b*2>255?255:b*2; break;
      case 'infrared':
        data[i]=r; data[i+1]=0; data[i+2]=b; break;
      case 'nightvision':
        const nv=(r+g+b)/3; data[i]=0; data[i+1]=nv; data[i+2]=0; break;
      case 'surveillance':
        const sv=(r+g+b)/3; data[i]=data[i+1]=data[i+2]=sv; break;
    }
  }

  ctx.putImageData(imgData,0,0);
}

// Apply effect button
document.getElementById('applyEffect').addEventListener('click', () => {
  const effect = document.getElementById('effectSelect').value;
  canvases.forEach(c => applyEffectToCanvas(c, effect));
});

// Overlay function
document.getElementById('applyOverlay').addEventListener('click', () => {
  const idx1 = parseInt(document.getElementById('overlay1').value) -1;
  const idx2 = parseInt(document.getElementById('overlay2').value) -1;
  if(canvases[idx1] && canvases[idx2]){
    const c1=canvases[idx1];
    const c2=canvases[idx2];
    const ctx = c1.getContext('2d');
    ctx.globalAlpha=0.5;
    ctx.drawImage(c2,0,0,c1.width,c1.height);
    ctx.globalAlpha=1;
  }
});

// Download all
document.getElementById('downloadAll').addEventListener('click', () => {
  canvases.forEach((c,i)=>{
    const link=document.createElement('a');
    link.download=`ketadata_image_${i+1}.png`;
    link.href=c.toDataURL();
    link.click();
  });
});
</script>
</body>
</html>
