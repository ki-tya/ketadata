<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KETA_RED // TARGET_FIELD</title>
<style>
  :root{
    color-scheme: dark;
    --bg:#000;
    --ink:rgba(255,255,255,.86);
    --muted:rgba(255,255,255,.52);
    --line:rgba(255,255,255,.14);

    /* core */
    --red: 236;                 /* 0..255 */
    --paper: rgba(255,255,255,.92);

    /* intensity */
    --motion: 1;                /* 0/1 */
    --speed: 0.70;              /* 0..2 */
    --pulse: 0.72;              /* 0..1 */
    --warp:  0.55;              /* 0..1 */
    --strobe:0.15;              /* 0..1 */
    --grain: 0.22;              /* 0..1 */
    --scan:  0.35;              /* 0..1 */

    /* layout */
    --top:44px;
    --bot:34px;
    --pad:10px;
    --r:0px;

    --drawerW: 320px;

    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    --sans: Arial, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{background:var(--bg);color:var(--ink);font:12px/1.35 var(--sans);overflow:hidden}
  #root{position:fixed;inset:0}

  /* bars */
  .bar{
    position:fixed;left:0;right:0;height:var(--top);
    display:flex;align-items:center;gap:8px;
    padding:0 var(--pad);
    background:rgba(0,0,0,.78);
    border-bottom:1px solid var(--line);
    z-index:80;
  }
  .bar.bot{
    top:auto;bottom:0;height:var(--bot);
    border-bottom:0;border-top:1px solid var(--line);
  }
  .brand{font-family:var(--mono);letter-spacing:.06em;opacity:.9;white-space:nowrap}
  .tiny{opacity:.65}
  .sp{flex:1}
  .chip{
    font-family:var(--mono);
    padding:4px 8px;
    border:1px solid var(--line);
    background:rgba(0,0,0,.35);
    border-radius:var(--r);
    cursor:pointer;user-select:none;
    opacity:.9;
  }
  .chip:active{transform:translateY(1px)}
  .chip.on{opacity:1;border-color:rgba(255,255,255,.28)}

  /* canvas */
  .canvas{
    position:fixed;left:0;right:0;top:var(--top);bottom:var(--bot);
    overflow:hidden;
    display:flex;align-items:center;justify-content:center;
  }

  /* main plate */
  #plate{
    width:min(820px,94vw);
    height:min(640px,78vh);
    border:1px solid var(--line);
    background:rgba(0,0,0,.22);
    position:relative;
    overflow:hidden;
  }

  /* 2x2 grid */
  #grid{
    position:absolute;inset:0;
    display:grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    gap:0;
  }
  .cell{
    position:relative;
    overflow:hidden;
    border-right:1px solid rgba(255,255,255,.08);
    border-bottom:1px solid rgba(255,255,255,.08);
  }
  .cell:nth-child(2), .cell:nth-child(4){border-right:0}
  .cell:nth-child(3), .cell:nth-child(4){border-bottom:0}

  /* target */
  .target{
    position:absolute;left:50%;top:50%;
    width: min(360px, 44vmin);
    aspect-ratio: 1 / 1;
    transform: translate(-50%,-50%);
    border-radius:50%;
    /* paint: alternating rings */
    background:
      radial-gradient(circle at 50% 50%,
        var(--paper) 0 10%,
        rgba(var(--red),0,0,1) 10% 20%,
        var(--paper) 20% 30%,
        rgba(var(--red),0,0,1) 30% 40%,
        var(--paper) 40% 50%,
        rgba(var(--red),0,0,1) 50% 60%,
        var(--paper) 60% 70%,
        rgba(var(--red),0,0,1) 70% 80%,
        var(--paper) 80% 90%,
        rgba(var(--red),0,0,1) 90% 100%
      );
    filter:
      saturate(1.1)
      contrast(1.15)
      brightness(1.05);
    box-shadow:
      0 0 0 1px rgba(255,255,255,.10) inset,
      0 0 22px rgba(var(--red),0,0,.28);
    will-change: transform, filter;
  }

  /* corner braces like the reference */
  .braces{
    position:absolute;inset:0;pointer-events:none;
    background:
      linear-gradient(to right, rgba(var(--red),0,0,1) 0 0) 0 0/0 0 no-repeat;
  }
  .braces:before, .braces:after{
    content:"";
    position:absolute;inset:10px;
    pointer-events:none;
    background:
      linear-gradient(rgba(var(--red),0,0,1), rgba(var(--red),0,0,1)) left top/34px 6px no-repeat,
      linear-gradient(rgba(var(--red),0,0,1), rgba(var(--red),0,0,1)) left top/6px 34px no-repeat,

      linear-gradient(rgba(var(--red),0,0,1), rgba(var(--red),0,0,1)) right top/34px 6px no-repeat,
      linear-gradient(rgba(var(--red),0,0,1), rgba(var(--red),0,0,1)) right top/6px 34px no-repeat,

      linear-gradient(rgba(var(--red),0,0,1), rgba(var(--red),0,0,1)) left bottom/34px 6px no-repeat,
      linear-gradient(rgba(var(--red),0,0,1), rgba(var(--red),0,0,1)) left bottom/6px 34px no-repeat,

      linear-gradient(rgba(var(--red),0,0,1), rgba(var(--red),0,0,1)) right bottom/34px 6px no-repeat,
      linear-gradient(rgba(var(--red),0,0,1), rgba(var(--red),0,0,1)) right bottom/6px 34px no-repeat;
    opacity:.95;
    mix-blend-mode:screen;
    filter: blur(.0px);
  }

  /* overlays */
  .layer{position:absolute;inset:0;pointer-events:none}
  #scan{
    background:
      repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,0) 0px,
        rgba(255,255,255,0) 8px,
        rgba(255,255,255,calc(.03 + var(--scan)*.10)) 9px
      );
    mix-blend-mode:overlay;
    opacity:calc(.06 + var(--scan)*.55);
    animation: scanMove calc(1000ms / max(.35, var(--speed))) linear infinite;
  }
  @keyframes scanMove{
    0%{transform:translateY(-16px)}
    100%{transform:translateY(16px)}
  }
  #grain{
    opacity:calc(.05 + var(--grain)*.55);
    mix-blend-mode:overlay;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.33'/%3E%3C/svg%3E");
    background-size:220px 220px;
    animation: grainJit 420ms steps(2,end) infinite;
  }
  @keyframes grainJit{
    0%{transform:translate3d(0,0,0)}
    25%{transform:translate3d(-1px,1px,0)}
    50%{transform:translate3d(1px,-1px,0)}
    75%{transform:translate3d(1px,1px,0)}
    100%{transform:translate3d(0,0,0)}
  }
  #vignette{
    background: radial-gradient(ellipse at 50% 50%, rgba(0,0,0,0) 0%, rgba(0,0,0,.55) 70%, rgba(0,0,0,.92) 100%);
  }

  /* NULL chrome mode */
  #root.null .bar, #root.null .bar.bot{display:none}
  #root.null .canvas{top:0;bottom:0}
  #root.null #drawer{top:0;bottom:0}

  /* drawer (right) */
  #drawer{
    position:fixed;top:var(--top);bottom:var(--bot);right:0;
    width:var(--drawerW);
    background:rgba(0,0,0,.92);
    border-left:1px solid var(--line);
    transform:translateX(102%);
    transition:transform 160ms linear;
    z-index:90;
    padding:10px;
    overflow:auto;
  }
  #drawer.open{transform:translateX(0)}
  .hr{height:1px;background:var(--line);margin:8px 0}
  .ctl{display:grid;grid-template-columns:120px 1fr 54px;gap:8px;align-items:center;margin:6px 0}
  input[type="range"]{width:100%}
  .val{font-family:var(--mono);opacity:.8;text-align:right}

  /* tiny signature */
  #sig{font-family:var(--mono);opacity:.7;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:70vw}

  /* motion off */
  #root.still .target,
  #root.still #scan,
  #root.still #grain{animation:none !important}
</style>
</head>
<body>
<div id="root">
  <div class="bar">
    <div class="brand">KETA_RED</div>
    <div class="brand tiny">TARGET_FIELD</div>
    <div class="sp"></div>
    <div id="motionBtn" class="chip on">MOTION</div>
    <div id="nullBtn" class="chip">NULL</div>
    <div id="sysBtn" class="chip">SYSTEM</div>
  </div>

  <div class="canvas">
    <div id="plate" title="CLICK = reseed phase • SPACE = motion • N = NULL">
      <div id="grid">
        <div class="cell"><div class="braces"></div><div class="target" data-i="0"></div></div>
        <div class="cell"><div class="braces"></div><div class="target" data-i="1"></div></div>
        <div class="cell"><div class="braces"></div><div class="target" data-i="2"></div></div>
        <div class="cell"><div class="braces"></div><div class="target" data-i="3"></div></div>
      </div>
      <div id="scan" class="layer"></div>
      <div id="grain" class="layer"></div>
      <div id="vignette" class="layer"></div>
    </div>
  </div>

  <div class="bar bot">
    <div id="sig">CLICK PLATE = RESEED • SPACE = MOTION • N = NULL • S = SYSTEM</div>
    <div class="sp"></div>
    <div class="brand tiny">LOCAL</div>
  </div>

  <div id="drawer" role="dialog" aria-label="system drawer">
    <div class="brand">SYSTEM</div>
    <div class="hr"></div>

    <div class="ctl">
      <div class="brand tiny">SPEED</div>
      <input id="speed" type="range" min="0" max="200" value="70"/>
      <div class="val" id="speedV">70</div>
    </div>
    <div class="ctl">
      <div class="brand tiny">PULSE</div>
      <input id="pulse" type="range" min="0" max="100" value="72"/>
      <div class="val" id="pulseV">72</div>
    </div>
    <div class="ctl">
      <div class="brand tiny">WARP</div>
      <input id="warp" type="range" min="0" max="100" value="55"/>
      <div class="val" id="warpV">55</div>
    </div>
    <div class="ctl">
      <div class="brand tiny">STROBE</div>
      <input id="strobe" type="range" min="0" max="100" value="15"/>
      <div class="val" id="strobeV">15</div>
    </div>
    <div class="ctl">
      <div class="brand tiny">SCAN</div>
      <input id="scanCtl" type="range" min="0" max="100" value="35"/>
      <div class="val" id="scanV">35</div>
    </div>
    <div class="ctl">
      <div class="brand tiny">GRAIN</div>
      <input id="grainCtl" type="range" min="0" max="100" value="22"/>
      <div class="val" id="grainV">22</div>
    </div>

    <div class="hr"></div>
    <div class="brand tiny">HOTKEYS: SPACE MOTION • N NULL • S SYSTEM • R RESEED</div>
  </div>
</div>

<script>
(() => {
  "use strict";
  const $ = (id)=>document.getElementById(id);
  const root = $("root");
  const plate = $("plate");
  const drawer = $("drawer");

  const FILE_ID = "KETA_RED_TARGET_FIELD_v1";
  const LS_KEY = "KETA_RED_TARGET_FIELD_STATE::" + FILE_ID;

  const DEFAULT = {
    motion: 1,
    null: 0,
    drawer: 0,
    seed: rand(8),
    speed: 70,
    pulse: 72,
    warp: 55,
    strobe: 15,
    scan: 35,
    grain: 22
  };

  let S = {...DEFAULT};

  function rand(n){
    const a = new Uint8Array(n);
    crypto.getRandomValues(a);
    return Array.from(a).map(b => (b%36).toString(36)).join("");
  }

  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  function load(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return false;
      const o = JSON.parse(raw);
      if(!o) return false;
      S = { ...DEFAULT, ...o };
      return true;
    }catch(e){ return false; }
  }

  function save(){
    try{ localStorage.setItem(LS_KEY, JSON.stringify(S)); }catch(e){}
    renderSig();
  }

  function css(name, val){
    document.documentElement.style.setProperty(name, String(val));
  }

  function render(){
    root.classList.toggle("null", !!S.null);
    drawer.classList.toggle("open", !!S.drawer);
    root.classList.toggle("still", !S.motion);

    $("motionBtn").classList.toggle("on", !!S.motion);
    $("nullBtn").classList.toggle("on", !!S.null);

    css("--speed", (clamp(S.speed,0,200)/100).toFixed(2));
    css("--pulse", (clamp(S.pulse,0,100)/100).toFixed(2));
    css("--warp",  (clamp(S.warp,0,100)/100).toFixed(2));
    css("--strobe",(clamp(S.strobe,0,100)/100).toFixed(2));
    css("--scan",  (clamp(S.scan,0,100)/100).toFixed(2));
    css("--grain", (clamp(S.grain,0,100)/100).toFixed(2));

    setCtl("speed", S.speed);
    setCtl("pulse", S.pulse);
    setCtl("warp", S.warp);
    setCtl("strobe", S.strobe);
    setCtl("scanCtl", S.scan);
    setCtl("grainCtl", S.grain);

    seedAnimations(S.seed);
    renderSig();
  }

  function setCtl(id, v){
    const el = $(id);
    if(el && String(el.value) !== String(v)) el.value = String(v);
    const ve = $(id.replace("Ctl","") + "V");
    if(ve) ve.textContent = String(v);
  }

  function renderSig(){
    $("sig").textContent =
      "FILE_ID=" + FILE_ID +
      " | SEED=" + S.seed +
      " | SPEED=" + S.speed +
      " | PULSE=" + S.pulse +
      " | WARP=" + S.warp +
      " | STROBE=" + S.strobe;
  }

  // per-cell motion using CSS animations injected w/ unique keyframes per seed
  let styleEl = null;
  function seedAnimations(seed){
    const sp = Math.max(0.25, clamp(S.speed,0,200)/100);
    const p  = clamp(S.pulse,0,100)/100;
    const w  = clamp(S.warp,0,100)/100;
    const s  = clamp(S.strobe,0,100)/100;

    const r = mulberry32(hash(seed));
    const targets = document.querySelectorAll(".target");

    if(styleEl) styleEl.remove();
    styleEl = document.createElement("style");
    let cssText = "";

    targets.forEach((t, i) => {
      const a = (r()*Math.PI*2);
      const b = (r()*Math.PI*2);
      const c = (r()*Math.PI*2);

      const drift = (6 + r()*18) * w;            // px
      const wob   = (0.8 + r()*2.2) * w;         // deg
      const z     = (0.02 + r()*0.08) * w;       // scale variance
      const beat  = (900 + r()*1400) / sp;       // ms
      const beat2 = (600 + r()*1200) / sp;       // ms

      const k1 = `kf_drift_${i}`;
      const k2 = `kf_pulse_${i}`;
      const k3 = `kf_strobe_${i}`;

      cssText += `
@keyframes ${k1}{
  0%{ transform: translate(-50%,-50%) translate(${Math.cos(a)*drift}px, ${Math.sin(a)*drift}px) rotate(${Math.cos(b)*wob}deg) scale(${(1-z).toFixed(3)}) }
  50%{ transform: translate(-50%,-50%) translate(${Math.cos(a+2.1)*drift}px, ${Math.sin(a+2.1)*drift}px) rotate(${Math.cos(b+2.0)*wob}deg) scale(${(1+z).toFixed(3)}) }
  100%{ transform: translate(-50%,-50%) translate(${Math.cos(a+4.2)*drift}px, ${Math.sin(a+4.2)*drift}px) rotate(${Math.cos(b+4.0)*wob}deg) scale(${(1-z*0.7).toFixed(3)}) }
}
@keyframes ${k2}{
  0%,100%{ filter: saturate(1.08) contrast(1.12) brightness(${(1.02 + p*0.06).toFixed(3)}) blur(0px) }
  50%{ filter: saturate(1.18) contrast(1.22) brightness(${(1.06 + p*0.10).toFixed(3)}) blur(${(p*0.6).toFixed(2)}px) }
}
@keyframes ${k3}{
  0%, 92%, 100%{ opacity: 1 }
  93%{ opacity: ${Math.max(0.25, 1 - s*0.85).toFixed(3)} }
  95%{ opacity: 1 }
  97%{ opacity: ${Math.max(0.18, 1 - s*0.92).toFixed(3)} }
}
      `.trim() + "\n";

      t.style.animation = (S.motion ? `${k1} ${Math.round(beat)}ms ease-in-out infinite, ${k2} ${Math.round(beat2)}ms ease-in-out infinite, ${k3} ${Math.round(900/sp)}ms steps(1,end) infinite` : "none");
      t.style.willChange = "transform, filter, opacity";
    });

    styleEl.textContent = cssText;
    document.head.appendChild(styleEl);

    // plate strobe tint (global) by toggling a CSS filter via animation on scan layer
    const scan = $("scan");
    scan.style.animationDuration = `${Math.round(1000 / sp)}ms`;
    scan.style.opacity = (0.06 + (clamp(S.scan,0,100)/100)*0.55).toFixed(3);

    // global strobe (very slight) via body filter toggles
    root.style.filter = S.motion && s > 0.001
      ? `contrast(${(1 + s*0.18).toFixed(3)}) saturate(${(1 + s*0.22).toFixed(3)})`
      : `contrast(1) saturate(1)`;
  }

  function hash(str){
    let h = 2166136261 >>> 0;
    for(let i=0;i<str.length;i++){
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return h >>> 0;
  }

  function mulberry32(a){
    return function(){
      let t = a += 0x6D2B79F5;
      t = Math.imul(t ^ (t >>> 15), t | 1);
      t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    };
  }

  function reseed(){
    S.seed = rand(8);
    save();
    render();
  }

  // wiring
  $("sysBtn").addEventListener("click", () => { S.drawer = !S.drawer; save(); render(); });
  $("motionBtn").addEventListener("click", () => { S.motion = S.motion ? 0 : 1; save(); render(); });
  $("nullBtn").addEventListener("click", () => { S.null = S.null ? 0 : 1; save(); render(); });

  $("speed").addEventListener("input", e=>{ S.speed = +e.target.value; save(); render(); });
  $("pulse").addEventListener("input", e=>{ S.pulse = +e.target.value; save(); render(); });
  $("warp").addEventListener("input", e=>{ S.warp = +e.target.value; save(); render(); });
  $("strobe").addEventListener("input", e=>{ S.strobe = +e.target.value; save(); render(); });
  $("scanCtl").addEventListener("input", e=>{ S.scan = +e.target.value; save(); render(); });
  $("grainCtl").addEventListener("input", e=>{ S.grain = +e.target.value; save(); render(); });

  plate.addEventListener("click", reseed);

  window.addEventListener("keydown", (e) => {
    const k = e.key;
    if(k === " "){ e.preventDefault(); S.motion = S.motion ? 0 : 1; save(); render(); }
    if(k === "n" || k === "N"){ S.null = S.null ? 0 : 1; save(); render(); }
    if(k === "s" || k === "S"){ S.drawer = !S.drawer; save(); render(); }
    if(k === "r" || k === "R"){ reseed(); }
    if(k === "Escape" && S.drawer){ S.drawer = 0; save(); render(); }
  }, {passive:false});

  // boot
  load();
  if(!localStorage.getItem(LS_KEY)) save();
  render();
})();
</script>

<!--
AE::KETA_RED
EE::TARGET_FIELD_2x2 + INTENSITY_CONTROLS + NULL_MODE + LOCAL_FIRST_STATE
WB::NO_NETWORK / NO_EXTERNAL_DEPS
FILE_ID::KETA_RED_TARGET_FIELD
ROOM_ID::KETA_RED
VERSION::v1
UPDATED_AT::2026-01-09
CHANGELOG::init; 2x2 target grid; pulsing/warp/strobe; right drawer; NULL; local save
-->
</body>
</html>
