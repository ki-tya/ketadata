<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>k-desktop</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #6b6b6b; height: 100vh; overflow: hidden; }
        .menu-bar { background: rgba(40, 40, 40, 0.95); backdrop-filter: blur(20px); height: 24px; display: flex; align-items: center; padding: 0 12px; color: white; font-size: 13px; z-index: 1000; border-bottom: 1px solid rgba(0, 0, 0, 0.3); }
        .menu-bar-left { display: flex; gap: 20px; flex: 1; }
        .menu-bar-right { display: flex; gap: 12px; font-size: 12px; }
        .menu-item { cursor: pointer; padding: 2px 8px; transition: background 0.2s; }
        .menu-item:hover { background: rgba(255, 255, 255, 0.1); border-radius: 3px; }
        .menu-item.word-change { font-weight: 500; }
        .desktop { height: calc(100vh - 24px); position: relative; padding: 20px; }
        .folder, .drive { width: 100px; text-align: center; cursor: pointer; position: absolute; user-select: none; }
        .folder-icon { width: 70px; height: 60px; margin: 0 auto 5px; background: #1a1a1a; position: relative; border-radius: 4px; }
        .folder-icon::before { content: ''; position: absolute; top: -8px; left: 0; width: 30px; height: 12px; background: #1a1a1a; border-radius: 4px 4px 0 0; }
        .folder-icon::after { content: ''; position: absolute; inset: 0; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.2) 2px, rgba(0,0,0,0.2) 4px), repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,0,0,0.2) 2px, rgba(0,0,0,0.2) 4px); }
        .folder-name { color: white; font-size: 12px; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8); word-wrap: break-word; padding: 0 5px; }
        .folder:hover .folder-icon, .folder:hover .folder-icon::before { background: #2a2a2a; }
        .drive-icon { width: 70px; height: 60px; margin: 0 auto 5px; background: linear-gradient(180deg, #e8e8e8 0%, #d0d0d0 100%); position: relative; border-radius: 4px; border: 1px solid #999; box-shadow: inset 0 1px 2px rgba(255,255,255,0.5); }
        .drive-icon::after { content: ''; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 30px; height: 3px; background: #666; border-radius: 1px; }
        .drive:hover .drive-icon { background: linear-gradient(180deg, #f0f0f0 0%, #d8d8d8 100%); }
        .apple-menu { position: relative; }
        .apple-menu-dropdown { position: absolute; top: 100%; left: 0; background: rgba(40, 40, 40, 0.98); backdrop-filter: blur(20px); border-radius: 6px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6); min-width: 240px; padding: 6px 0; display: none; z-index: 2000; margin-top: 4px; border: 1px solid rgba(255, 255, 255, 0.1); pointer-events: auto; }
        .apple-menu-dropdown.active { display: block; }
        .apple-menu-item { padding: 8px 20px; color: rgba(255, 255, 255, 0.85); font-size: 13px; cursor: pointer; transition: background 0.1s; pointer-events: auto; user-select: none; }
        .apple-menu-item:hover { background: rgba(255, 255, 255, 0.1); }
        .apple-menu-item:active { background: rgba(255, 255, 255, 0.2); }
        .preview-overlay, .content-preview-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; display: none; }
        .preview-overlay.active, .content-preview-overlay.active { display: block; }
        .content-preview-overlay { z-index: 3000; }
        .content-preview-overlay.cv-mode { background: #000; }
        .preview-window { background: rgba(40, 40, 40, 0.95); border-radius: 12px; box-shadow: 0 30px 90px rgba(0, 0, 0, 0.8); width: 700px; height: 600px; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); display: flex; overflow: hidden; }
        .preview-sidebar { width: 180px; background: rgba(30, 30, 30, 0.98); border-right: 1px solid rgba(0, 0, 0, 0.3); display: flex; flex-direction: column; }
        .preview-sidebar-header { padding: 15px; border-bottom: 1px solid rgba(0, 0, 0, 0.3); }
        .preview-close-btn { color: rgba(255, 255, 255, 0.6); font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 5px; padding: 5px; border-radius: 4px; transition: all 0.2s; }
        .preview-close-btn:hover { background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); }
        .preview-folders { flex: 1; overflow-y: auto; padding: 10px 0; }
        .preview-folder-item { color: rgba(255, 255, 255, 0.75); font-size: 12px; padding: 6px 15px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: background 0.2s; }
        .preview-folder-item:hover { background: rgba(255, 255, 255, 0.1); }
        .preview-folder-item.active { background: rgba(255, 255, 255, 0.15); color: rgba(255, 255, 255, 0.95); }
        .preview-folder-icon { width: 14px; height: 14px; background: white; border-radius: 2px; opacity: 0.8; }
        .preview-main { flex: 1; display: flex; flex-direction: column; }
        .preview-header { background: rgba(60, 60, 60, 0.95); padding: 12px 20px; border-bottom: 1px solid rgba(0, 0, 0, 0.3); }
        .preview-title { color: rgba(255, 255, 255, 0.9); font-size: 13px; font-weight: 500; }
        .preview-content { flex: 1; padding: 30px; overflow-y: auto; color: white; }
        .preview-file-item { padding: 10px; margin-bottom: 8px; background: rgba(255, 255, 255, 0.05); border-radius: 6px; cursor: pointer; transition: all 0.2s; color: rgba(255, 255, 255, 0.85); font-size: 13px; }
        .preview-file-item:hover { background: rgba(255, 255, 255, 0.1); }
        .content-preview-window { background: #000; border-radius: 12px; box-shadow: 0 30px 90px rgba(0, 0, 0, 0.8); width: 600px; height: 500px; position: absolute; left: 55%; top: 45%; transform: translate(-50%, -50%); display: flex; flex-direction: column; overflow: hidden; }
        .content-preview-window.resizing,
        .content-preview-window.resizing * {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .content-preview-header { background: rgba(60, 60, 60, 0.95); padding: 12px 20px; display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .content-preview-title { color: rgba(255, 255, 255, 0.9); font-size: 13px; font-weight: 500; }
        .content-preview-close { color: rgba(255, 255, 255, 0.6); font-size: 20px; cursor: pointer; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: all 0.2s; }
        .content-preview-close:hover { background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); }
        .content-preview-body { flex: 1; padding: 30px; overflow-y: auto; color: white; }
        .content-preview-body.cv-display { display: flex; justify-content: center; padding: 60px 20px; }
        .content-preview-body.cv-display > div { max-width: 800px; width: 100%; }
        .content-preview-body h1 { font-size: 28px; margin-bottom: 16px; font-weight: 300; }
        .content-preview-body h2 { font-size: 22px; margin: 24px 0 12px; font-weight: 300; }
        .content-preview-body h3 { font-size: 18px; margin: 20px 0 10px; font-weight: 400; }
        .content-preview-body p { font-size: 14px; line-height: 2; margin-bottom: 14px; }
        .content-preview-body img { max-width: 100%; height: auto; display: block; margin: 20px 0; border-radius: 4px; }
        .loading { color: rgba(255, 255, 255, 0.5); text-align: center; padding: 30px; }
        .resize-handle { position: absolute; background: transparent; }
        .resize-handle.corner-se { width: 20px; height: 20px; bottom: 0; right: 0; cursor: nwse-resize; }
        .resize-handle.edge-e { width: 5px; height: 100%; top: 0; right: 0; cursor: ew-resize; }
        .resize-handle.edge-s { width: 100%; height: 5px; bottom: 0; left: 0; cursor: ns-resize; }
    </style>
</head>
<body>
    <div class="menu-bar">
        <div class="menu-bar-left">
            <div class="menu-item">k - 1</div>
            <div class="menu-item" onclick="openCVFile()">cv</div>
            <div class="menu-item word-change" onclick="sortFolders('n')">nx</div>
            <div class="menu-item word-change" onclick="sortFolders('t')">tx</div>
            <div class="menu-item word-change" onclick="sortFolders('p')">p</div>
            <div class="menu-item word-change" onclick="sortFolders('q')">q</div>
        </div>
        <div class="menu-bar-right"><span>thu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jan&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11:55 pm</span></div>
    </div>
    <div class="desktop" id="desktop"></div>
    <div class="preview-overlay" id="previewOverlay">
        <div class="preview-window">
            <div class="preview-sidebar">
                <div class="preview-sidebar-header"><div class="preview-close-btn" onclick="closePreview()">← Close</div></div>
                <div class="preview-folders" id="previewFolderList"></div>
            </div>
            <div class="preview-main">
                <div class="preview-header"><div class="preview-title" id="previewTitle">Select a folder</div></div>
                <div class="preview-content" id="previewContent"></div>
            </div>
        </div>
    </div>
    <div class="content-preview-overlay" id="contentPreviewOverlay">
        <div class="content-preview-window" id="contentPreviewWindow">
            <div class="content-preview-header">
                <div class="content-preview-title" id="contentPreviewTitle">File</div>
                <div class="content-preview-close" onclick="closeContentPreview()">×</div>
            </div>
            <div class="content-preview-body" id="contentPreviewBody"></div>
            <div class="resize-handle edge-e"></div>
            <div class="resize-handle edge-s"></div>
            <div class="resize-handle corner-se"></div>
        </div>
    </div>
    <script>
        const folderPositions = [{x:170,y:520},{x:260,y:190},{x:520,y:190},{x:420,y:435},{x:520,y:680},{x:970,y:110},{x:950,y:350},{x:1230,y:350},{x:70,y:760}];
        const chronologicalPositions=[{x:100,y:400},{x:250,y:400},{x:400,y:400},{x:550,y:400},{x:700,y:400},{x:850,y:400},{x:1000,y:400},{x:1150,y:400},{x:1300,y:400}];
        const geographicPositions=[{x:1150,y:80},{x:1280,y:160},{x:700,y:200},{x:550,y:340},{x:150,y:280},{x:200,y:420},{x:1050,y:420},{x:1200,y:650},{x:80,y:680}];
        
        const portfolioData = {
            'off-screen 2018/19': {
                files: [
                    {type: 'markdown', name: 'forecast.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/offscreen/forecast.md'},
                    {type: 'markdown', name: 'kat vs culture.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/offscreen/kat%20vs%20culture.md'},
                    {type: 'markdown', name: 'months.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/offscreen/months.md'},
                    {type: 'markdown', name: 'yearbook.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/offscreen/yearbook.md'}
                ]
            },
            'academic writing 2018-21': {
                files: [
                    { type: 'markdown', name: 'anne sexton female trauma.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/anne%20sexton%20female%20trauma.md' },
                    { type: 'markdown', name: 'bo burnham & his double.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/bo%20burnham%20%26%20his%20double.md' },
                    { type: 'markdown', name: 'can a woman have it all?.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/can%20a%20woman%20have%20it%20all%3F.md' },
                    { type: 'markdown', name: 'deconstructing the pattern (final thesis).md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/deconstructing%20the%20pattern%20%28final%20thesis%29.md' },
                    { type: 'markdown', name: 'drag: the neo-real self.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/drag%3A%20the%20neo-real%20self.md' },
                    { type: 'markdown', name: 'driving forces.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/driving%20forces.md' },
                    { type: 'markdown', name: 'drugs 2030.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/drugs%202030.md' },
                    { type: 'markdown', name: 'easy riders, raging bulls.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/easy%20riders%2C%20raging%20bulls.md' },
                    { type: 'markdown', name: 'helmut newton book review.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/helmut%20newton%20book%20review.md' },
                    { type: 'markdown', name: 'mad genius & its discontents.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/mad%20genius%20%26%20its%20discontents.md' },
                    { type: 'markdown', name: 'podcast medium analysis.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/podcast%20medium%20analysis.md' },
                    { type: 'markdown', name: 'sensory cinema.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/sensory%20cinema.md' },
                    { type: 'markdown', name: 'the sublime.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/the%20sublime.md' },
                    { type: 'markdown', name: 'tiktok - the implications of sound.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/tiktok%20-%20the%20implications%20of%20sound.md' },
                    { type: 'markdown', name: 'celebrity identity crisis.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/celebrity%20identity%20crisis.md' },
                    { type: 'markdown', name: 'dramatic imaginary of trisha paytas.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/dramatic%20imaginary%20of%20trisha%20paytas.md' },
                    { type: 'markdown', name: 'media research design.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/media%20research%20design.md' },
                    { type: 'markdown', name: 'music interface analysis.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/music%20interface%20analysis.md' },
                    { type: 'markdown', name: 'visual rhetoric.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/academic/visual%20rhetoric.md' }
                ]
            },
            'post-grad research 2021-25': {
                files: [
                    { type: 'markdown', name: 'ai mechanical emotives.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/post-grad/ai%20mechanical%20emotives.md' },
                    { type: 'markdown', name: 'bitcoin basics.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/post-grad/bitcoin%20basics.md' },
                    { type: 'markdown', name: 'bitcoin maximalism.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/post-grad/bitcoin%20maximalism.md' },
                    { type: 'markdown', name: 'casey rodarmor provenance interview.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/post-grad/casey%20rodarmor%20provenance%20interview.md' },
                    { type: 'markdown', name: 'coin colonoscopy.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/post-grad/coin%20colonoscopy.md' },
                    { type: 'markdown', name: 'nft research.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/post-grad/nft%20research.md' },
                    { type: 'markdown', name: 'ordinals: dna for inscriptions.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/post-grad/ordinals%3A%20dna%20for%20inscriptions.md' },
                    { type: 'markdown', name: 'rentier assets.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/post-grad/rentier%20assets.md' },
                    { type: 'markdown', name: "who's afraid of web3?.md", url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/post-grad/who%27s%20afraid%20of%20web3%3F.md' }
                ]
            },
            'presentations': {
                files: [
                    { type: 'markdown', name: 'beaver mills.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/presentations/beaver%20mills.md' },
                    { type: 'markdown', name: 'drugs 2030.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/presentations/drugs%202030.md' },
                    { type: 'markdown', name: 'hilma af klint.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/presentations/hilma%20af%20klint.md' },
                    { type: 'markdown', name: 'main character mentality.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/presentations/main%20character%20mentality.md' },
                    { type: 'markdown', name: 'objective knowledge.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/presentations/objective%20knowledge.md' },
                    { type: 'markdown', name: 'plato.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/presentations/plato.md' },
                    { type: 'markdown', name: 'trisha paytas.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/presentations/trisha%20paytas.md' },
                    { type: 'markdown', name: 'virtual language.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/presentations/virtual%20language.md' },
                    { type: 'markdown', name: 'woman.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/presentations/woman.md' }
                ]
            },
            'warehouse management 2021/22': {
                files: [
                    { type: 'markdown', name: 'gpu specifications.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/warehouse/gpu%20specifications.md' },
                    { type: 'markdown', name: 'inventory totals.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/warehouse/inventory%20totals.md' },
                    { type: 'markdown', name: 'miners breakdown.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/warehouse/miners%20breakdown.md' }
                ]
            },
            'web 3 projects 2021-24': {
                files: [
                    { type: 'markdown', name: 'L15 board notes.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/L15%20board%20notes.md' },
                    { type: 'markdown', name: 'L15 contents.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/L15%20contents.md' },
                    { type: 'markdown', name: 'L15 readme.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/L15%20readme.md' },
                    { type: 'markdown', name: 'L15 stable summary.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/L15%20stable%20summary.md' },
                    { type: 'markdown', name: 'L15 trust model.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/L15%20trust%20model.md' },
                    { type: 'markdown', name: 'L15.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/L15.md' },
                    { type: 'markdown', name: 'L15SR economics.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/L15SR%20economics.md' },
                    { type: 'markdown', name: 'UTXORD aesthetics.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/UTXORD%20aesthetics.md' },
                    { type: 'markdown', name: 'UTXORD ama session script.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/UTXORD%20ama%20session%20script.md' },
                    { type: 'markdown', name: 'UTXORD branding.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/UTXORD%20branding.md' },
                    { type: 'markdown', name: 'UTXORD marketplace tweets.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/UTXORD%20marketplace%20tweets.md' },
                    { type: 'markdown', name: 'UTXORD plug-in wallet.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/UTXORD%20plug-in%20wallet.md' },
                    { type: 'markdown', name: 'UTXORD report.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/UTXORD%20report.md' },
                    { type: 'markdown', name: 'UTXORD twitter & pr.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/UTXORD%20twitter%20%26%20pr.md' },
                    { type: 'markdown', name: 'genetic provenance.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/web%203/genetic%20provenance.md' }
                ]
            },
            'freelance & consulting 2019-25': {
                files: [
                    { type: 'markdown', name: 'librif-ai.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/freelance%20%26%20consulting/librif-ai.md' },
                    { type: 'markdown', name: 'magic people love funeral.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/freelance%20%26%20consulting/magic%20people%20love%20funeral.md' },
                    { type: 'markdown', name: 'magic people studio.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/freelance%20%26%20consulting/magic%20people%20studio.md' },
                    { type: 'markdown', name: 'magic people vision.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/freelance%20%26%20consulting/magic%20people%20vision.md' }
                ]
            },
            'miscellaneous gigs 2022-25': {
                files: [
                    { type: 'markdown', name: 'astrology texts.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/miscellaneous%20gigs/astrology%20texts.md' },
                    { type: 'markdown', name: 'basic cleaning.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/miscellaneous%20gigs/basic%20cleaning.md' },
                    { type: 'markdown', name: 'cirque du soleil.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/miscellaneous%20gigs/cirque%20du%20soleil.md' },
                    { type: 'markdown', name: 'cold emails.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/miscellaneous%20gigs/cold%20emails.md' },
                    { type: 'markdown', name: 'csi moscow.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/miscellaneous%20gigs/csi%20moscow.md' },
                    { type: 'markdown', name: 'recommendation letter.md', url: 'https://raw.githubusercontent.com/ki-tya/ketadata/main/content/miscellaneous%20gigs/recommendation%20letter.md' }
                ]
            },
            'k-2': {
                files: []
            }
        };
        
       const folderNames=Object.keys(portfolioData),desktop=document.getElementById('desktop');
        let currentFolder=null,perpetualMotion=null;
        
        function getCirclePositions(){
            const cx=window.innerWidth/2,cy=(window.innerHeight-24)/2+12,r=Math.min(cx,cy)*0.7,positions=[],angleStep=(2*Math.PI)/folderNames.length;
            for(let i=0;i<folderNames.length;i++){
                const angle=i*angleStep-Math.PI/2;
                positions.push({x:cx+r*Math.cos(angle)-50,y:cy+r*Math.sin(angle)-50});
            }
            return positions;
        }
        
        function createFolders(){
            desktop.innerHTML='';
            const ketadataDrive=document.createElement('div');
            ketadataDrive.className='drive';
            ketadataDrive.style.cssText='position:absolute;left:60px;bottom:40px';
            ketadataDrive.innerHTML='<div class="drive-icon"></div><div class="folder-name">k-drive</div>';
            ketadataDrive.onclick=()=>{stopPerpetualMotion();openKetadataDrive();};
            desktop.appendChild(ketadataDrive);
            folderNames.forEach((name,i)=>{
                const folderEl=document.createElement('div');
                folderEl.className='folder';
                folderEl.style.cssText=`position:absolute;left:${folderPositions[i].x}px;top:${folderPositions[i].y}px`;
                folderEl.innerHTML=`<div class="folder-icon"></div><div class="folder-name">${name}</div>`;
                folderEl.onclick=()=>{stopPerpetualMotion();openFolder(name);};
                desktop.appendChild(folderEl);
            });
        }
        
        function sortFolders(letter){
            stopPerpetualMotion();
            if(letter==='q'){startPerpetualMotion();return;}
            const folderElements=document.querySelectorAll('.folder');
            let positions=letter==='n'?chronologicalPositions:letter==='t'?getCirclePositions():geographicPositions;
            folderElements.forEach((el,i)=>{
                el.style.transition='all 0.5s ease';
                el.style.left=positions[i].x+'px';
                el.style.top=positions[i].y+'px';
            });
        }
        
        function startPerpetualMotion(){
            const folderElements=document.querySelectorAll('.folder');
            function animate(){
                folderElements.forEach((el)=>{
                    el.style.transition='all 3s ease-in-out';
                    el.style.left=Math.random()*(window.innerWidth-150)+'px';
                    el.style.top=Math.random()*(window.innerHeight-150)+'px';
                });
            }
            animate();
            perpetualMotion=setInterval(animate,3000);
        }
        
        function stopPerpetualMotion(){
            if(perpetualMotion){clearInterval(perpetualMotion);perpetualMotion=null;}
        }
        
        function openFolder(folderName){
            currentFolder=folderName;
            document.getElementById('previewOverlay').classList.add('active');
            renderPreviewFolders();
            loadFolderInPreview(folderName);
        }
        
        function closePreview(){
            document.getElementById('previewOverlay').classList.remove('active');
            currentFolder=null;
        }
        
        function renderPreviewFolders(){
            const folderList=document.getElementById('previewFolderList');
            folderList.innerHTML='';
            folderNames.forEach(name=>{
                const item=document.createElement('div');
                item.className='preview-folder-item';
                if(name===currentFolder)item.classList.add('active');
                item.innerHTML=`<div class="preview-folder-icon"></div><span>${name}</span>`;
                item.onclick=()=>loadFolderInPreview(name);
                folderList.appendChild(item);
            });
        }
        
        function loadFolderInPreview(folderName){
            currentFolder=folderName;
            renderPreviewFolders();
            const previewTitle=document.getElementById('previewTitle'),previewContent=document.getElementById('previewContent'),folder=portfolioData[folderName];
            previewTitle.textContent=folderName;
            if(!folder.files||folder.files.length===0){
                previewContent.innerHTML='<div style="padding:30px;color:rgba(255,255,255,0.4);text-align:center">This folder is empty</div>';
                return;
            }
            let fileListHTML='<div class="preview-file-list">';
            folder.files.forEach((file,i)=>{
                fileListHTML+=`<div class="preview-file-item" data-folder="${folderName}" data-index="${i}">${file.name}</div>`;
            });
            fileListHTML+='</div>';
            previewContent.innerHTML=fileListHTML;
            previewContent.querySelectorAll('.preview-file-item').forEach(item=>{
                item.addEventListener('click',function(){
                    openFileInPreview(this.getAttribute('data-folder'),parseInt(this.getAttribute('data-index')));
                });
            });
        }
        
        async function openFileInPreview(folderName,fileIndex){
            const file=portfolioData[folderName].files[fileIndex];
            const overlay=document.getElementById('contentPreviewOverlay'),title=document.getElementById('contentPreviewTitle'),body=document.getElementById('contentPreviewBody');
            title.textContent=file.name;
            body.innerHTML='<div class="loading">Loading...</div>';
            overlay.classList.add('active');
            try{
                const response=await fetch(file.url),markdown=await response.text();
                body.innerHTML=parseMarkdown(markdown);
            }catch(error){
                body.innerHTML='<div style="color:rgba(255,0,0,0.7);padding:20px">Error loading file</div>';
            }
        }
        
        function parseMarkdown(md){
            let html='',lines=md.split('\n'),inP=false;
            for(let line of lines){
                line=line.trim();
                if(line===''){if(inP){html+='</p>';inP=false;}continue;}
                
                // Handle images
                const imgMatch = line.match(/!\[([^\]]*)\]\(([^)]+)\)/);
                if(imgMatch) {
                    if(inP){html+='</p>';inP=false;}
                    html+=`<img src="${imgMatch[2]}" alt="${imgMatch[1]}">`;
                    continue;
                }
                
                if(line.startsWith('### ')){if(inP){html+='</p>';inP=false;}html+='<h3>'+line.substring(4)+'</h3>';}
                else if(line.startsWith('## ')){if(inP){html+='</p>';inP=false;}html+='<h2>'+line.substring(3)+'</h2>';}
                else if(line.startsWith('# ')){if(inP){html+='</p>';inP=false;}html+='<h1>'+line.substring(2)+'</h1>';}
                else{
                    if(!inP){html+='<p>';inP=true;}else{html+=' ';}
                    line=line.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\*(.+?)\*/g,'<em>$1</em>').replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" target="_blank" style="color:#6ba4ff">$1</a>');
                    html+=line;
                }
            }
            if(inP)html+='</p>';
            return html;
        }
        
        function closeContentPreview(){
            const overlay=document.getElementById('contentPreviewOverlay');
            const win=document.getElementById('contentPreviewWindow');
            const body=document.getElementById('contentPreviewBody');
            overlay.classList.remove('active');
            overlay.classList.remove('cv-mode');
            body.classList.remove('cv-display');
            win.style.cssText='';
        }
        
        function openCVFile(){
            document.getElementById('previewOverlay').classList.remove('active');
            
            const overlay=document.getElementById('contentPreviewOverlay');
            const title=document.getElementById('contentPreviewTitle');
            const body=document.getElementById('contentPreviewBody');
            const win=document.getElementById('contentPreviewWindow');
            
            win.style.cssText = '';
            overlay.className = 'content-preview-overlay cv-mode active';
            body.className = 'content-preview-body cv-display';
            
            win.style.width='100vw';
            win.style.height='100vh';
            win.style.left='0';
            win.style.top='0';
            win.style.transform='none';
            win.style.borderRadius='0';
            win.style.background='#000';
            
            title.textContent='katgolubev_cv.md';
            body.innerHTML='<div class="loading">Loading...</div>';
            
            fetch('https://raw.githubusercontent.com/ki-tya/ketadata/main/content/katgolubev_cv.md')
                .then(r=>r.text())
                .then(md=>{body.innerHTML='<div>'+parseMarkdown(md)+'</div>';})
                .catch(()=>{body.innerHTML='<div style="color:rgba(255,0,0,0.7);padding:20px">Error loading CV</div>';});
        }
        
        function openKetadataDrive(){
            const overlay=document.getElementById('contentPreviewOverlay'),title=document.getElementById('contentPreviewTitle'),body=document.getElementById('contentPreviewBody'),win=document.getElementById('contentPreviewWindow');
            overlay.classList.remove('cv-mode');
            win.style.width='600px';
            win.style.height='500px';
            win.style.left='50%';
            win.style.top='50%';
            win.style.transform='translate(-50%,-50%)';
            win.style.background='rgba(40,40,40,0.95)';
            win.style.borderRadius='12px';
            title.textContent='ketadata - README.md';
            body.innerHTML='<div class="loading">Loading...</div>';
            overlay.classList.add('active');
            fetch('https://raw.githubusercontent.com/ki-tya/ketadata/main/README.md').then(r=>r.text()).then(md=>{body.innerHTML=parseMarkdown(md);}).catch(()=>{body.innerHTML='<div style="color:rgba(255,0,0,0.7);padding:20px">Error loading README</div>';});
        }
        
        function toggleAppleMenu(){
            document.getElementById('appleMenu').classList.toggle('active');
        }
        
        document.addEventListener('click',(e)=>{
            const appleMenu=document.querySelector('.apple-menu'),dropdown=document.getElementById('appleMenu');
            if(!appleMenu.contains(e.target))dropdown.classList.remove('active');
        });
        
        let isDragging = false, isResizing = false, resizeType = '';
        let startX = 0, startY = 0, startWidth = 0, startHeight = 0, startLeft = 0, startTop = 0;
        
        const contentWin = document.getElementById('contentPreviewWindow');
        const contentHeader = contentWin.querySelector('.content-preview-header');
        
        contentHeader.addEventListener('mousedown', (e) => {
            const overlay = document.getElementById('contentPreviewOverlay');
            if(overlay.classList.contains('cv-mode')) return;
            if(e.target.classList.contains('content-preview-close')) return;
            isDragging = true;
            startX = e.clientX - contentWin.offsetLeft;
            startY = e.clientY - contentWin.offsetTop;
            contentWin.style.transform = 'none';
        });
        
        document.querySelectorAll('.resize-handle').forEach(handle => {
            handle.addEventListener('mousedown', (e) => {
                const overlay = document.getElementById('contentPreviewOverlay');
                if(overlay.classList.contains('cv-mode')) return;
                e.stopPropagation();
                isResizing = true;
                contentWin.classList.add('resizing');
                resizeType = handle.classList.contains('corner-se') ? 'corner' : 
                            handle.classList.contains('edge-e') ? 'e' : 's';
                startX = e.clientX;
                startY = e.clientY;
                startWidth = contentWin.offsetWidth;
                startHeight = contentWin.offsetHeight;
                startLeft = contentWin.offsetLeft;
                startTop = contentWin.offsetTop;
            });
        });
        
        document.addEventListener('mousemove', (e) => {
            if(isDragging) {
                const newLeft = e.clientX - startX;
                const newTop = e.clientY - startY;
                contentWin.style.left = newLeft + 'px';
                contentWin.style.top = newTop + 'px';
            }
            if(isResizing) {
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                
                if(resizeType === 'corner' || resizeType === 'e') {
                    const newWidth = Math.max(400, startWidth + dx);
                    contentWin.style.width = newWidth + 'px';
                }
                if(resizeType === 'corner' || resizeType === 's') {
                    const newHeight = Math.max(300, startHeight + dy);
                    contentWin.style.height = newHeight + 'px';
                }
            }
        });
        
        document.addEventListener('mouseup', () => {
            isDragging = false;
            isResizing = false;
            contentWin.classList.remove('resizing');
        });
        
        createFolders();
    </script>
</body>
</html>
