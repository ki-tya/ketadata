<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KETADATA // PHOTOBOOTH</title>
<style>
:root{
  --bg:#000;
  --ink:rgba(255,255,255,.86);
  --muted:rgba(255,255,255,.45);
  --line:rgba(255,255,255,.14);
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  --top:44px; --bot:34px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:#000;color:var(--ink);overflow:hidden}
#root{position:fixed;inset:0;background:#000}

/* layers */
#stage{position:absolute;inset:0}
video,canvas{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;background:#000}
#fx{pointer-events:none}

/* chrome */
#topbar{
  position:absolute;left:0;right:0;top:0;height:var(--top);
  display:flex;align-items:center;gap:10px;padding:0 10px;
  background:linear-gradient(#000, rgba(0,0,0,.6));
  font-family:var(--mono);font-size:12px
}
#bottombar{
  position:absolute;left:0;right:0;bottom:0;height:var(--bot);
  display:flex;align-items:center;gap:8px;padding:0 10px;
  background:linear-gradient(rgba(0,0,0,.6), #000);
  font-family:var(--mono);font-size:12px
}
.btn{
  border:1px solid var(--line);background:#000;color:var(--ink);
  padding:4px 8px;cursor:pointer
}
.btn.on{background:#111}
.sep{opacity:.3}
.label{opacity:.6}
.spacer{flex:1}

/* blackout */
#root.null #topbar,
#root.null #bottombar{display:none}
#root.null #fx{opacity:0}

/* strobe */
#strobe{position:absolute;inset:0;background:#fff;opacity:0;pointer-events:none}

/* grain */
.grain:before{
  content:"";position:absolute;inset:0;pointer-events:none;
  background:
    repeating-radial-gradient(circle at 20% 30%, rgba(255,255,255,.04), rgba(255,255,255,.04) 1px, transparent 1px, transparent 2px),
    repeating-linear-gradient(0deg, rgba(0,0,0,.08), rgba(0,0,0,.08) 1px, transparent 1px, transparent 2px);
  mix-blend-mode:overlay
}
</style>
</head>
<body>
<div id="root">
  <div id="stage">
    <video id="cam" autoplay playsinline muted></video>
    <canvas id="fx"></canvas>
    <canvas id="shot"></canvas>
    <div id="strobe"></div>
  </div>

  <div id="topbar">
    <span class="label">KETADATA // PHOTOBOOTH</span>
    <span class="sep">|</span>
    <span id="status" class="label">IDLE</span>
    <div class="spacer"></div>
    <button class="btn" id="btnFS">FULLSCREEN (F)</button>
    <button class="btn" id="btnNULL">NULL (N)</button>
  </div>

  <div id="bottombar">
    <button class="btn" id="bInv">INVERT (I)</button>
    <button class="btn" id="bGrain">GRAIN (G)</button>
    <button class="btn" id="bRGB">RGB (R)</button>
    <button class="btn" id="bBlur">BLUR (B)</button>
    <button class="btn" id="bEdge">EDGE (E)</button>
    <button class="btn" id="bMirror">MIRROR (M)</button>
    <span class="sep">|</span>
    <span class="label">INT</span>
    <button class="btn" data-i="1">1</button>
    <button class="btn" data-i="2">2</button>
    <button class="btn" data-i="3">3</button>
    <button class="btn" data-i="4">4</button>
    <button class="btn" data-i="5">5</button>
    <button class="btn" data-i="6">6</button>
    <span class="sep">|</span>
    <button class="btn" id="bCap">CAPTURE (C)</button>
    <button class="btn" id="bSave">SAVE (S)</button>
    <div class="spacer"></div>
    <span class="label">SPACE = STROBE</span>
  </div>
</div>

<script>
const $=id=>document.getElementById(id);
const root=$("root"), cam=$("cam"), fx=$("fx"), shot=$("shot");
const ctx=fx.getContext("2d"), sctx=shot.getContext("2d");
const strobe=$("strobe"), status=$("status");

const FX={
  invert:false, grain:false, rgb:false, blur:false, edge:false, mirror:false,
  intensity:3
};

function resize(){
  fx.width=shot.width=window.innerWidth;
  fx.height=shot.height=window.innerHeight;
}
window.addEventListener("resize",resize);

async function startCam(){
  const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:false});
  cam.srcObject=stream;
  await cam.play();
  resize();
  status.textContent="LIVE";
}
startCam().catch(e=>status.textContent="NO CAMERA");

function pulse(){
  strobe.style.opacity=1;
  setTimeout(()=>strobe.style.opacity=0,60);
}

function draw(){
  requestAnimationFrame(draw);
  ctx.save();
  ctx.clearRect(0,0,fx.width,fx.height);

  if(FX.mirror){
    ctx.translate(fx.width,0); ctx.scale(-1,1);
  }

  ctx.filter = `
    ${FX.blur?`blur(${FX.intensity*1.2}px)`:``}
    ${FX.invert?`invert(1)`:``}
    contrast(${1+FX.intensity*0.08})
    saturate(${1+FX.intensity*0.15})
  `;

  ctx.drawImage(cam,0,0,fx.width,fx.height);
  ctx.restore();

  // RGB split
  if(FX.rgb){
    const o=FX.intensity*2;
    ctx.globalCompositeOperation="screen";
    ctx.drawImage(fx,-o,0);
    ctx.drawImage(fx,o,0);
    ctx.globalCompositeOperation="source-over";
  }

  // edge
  if(FX.edge){
    const img=ctx.getImageData(0,0,fx.width,fx.height);
    const d=img.data, w=fx.width;
    for(let i=0;i<d.length;i+=4){
      const x=(i/4)%w;
      const y=((i/4)/w)|0;
      if(x<w-1 && y<fx.height-1){
        const j=i+4;
        const k=i+w*4;
        const v=Math.abs(d[i]-d[j])+Math.abs(d[i]-d[k]);
        d[i]=d[i+1]=d[i+2]=v*FX.intensity;
      }
    }
    ctx.putImageData(img,0,0);
  }
}
draw();

function capture(){
  pulse();
  sctx.drawImage(fx,0,0,shot.width,shot.height);
  status.textContent="CAPTURED";
}

function save(){
  const a=document.createElement("a");
  a.download=`KETADATA_PHOTO_${Date.now()}.png`;
  a.href=shot.toDataURL("image/png");
  a.click();
  status.textContent="SAVED";
}

/* UI bindings */
$("bInv").onclick=()=>toggle("invert","bInv");
$("bGrain").onclick=()=>{toggle("grain","bGrain"); root.classList.toggle("grain",FX.grain)};
$("bRGB").onclick=()=>toggle("rgb","bRGB");
$("bBlur").onclick=()=>toggle("blur","bBlur");
$("bEdge").onclick=()=>toggle("edge","bEdge");
$("bMirror").onclick=()=>toggle("mirror","bMirror");
$("bCap").onclick=capture;
$("bSave").onclick=save;

document.querySelectorAll("[data-i]").forEach(b=>{
  b.onclick=()=>{FX.intensity=+b.dataset.i; flash(b)};
});

$("btnFS").onclick=()=>toggleFS();
$("btnNULL").onclick=()=>root.classList.toggle("null");

function toggle(k,id){ FX[k]=!FX[k]; $(id).classList.toggle("on",FX[k]); }
function flash(b){ b.classList.add("on"); setTimeout(()=>b.classList.remove("on"),120); }

function toggleFS(){
  if(!document.fullscreenElement) root.requestFullscreen();
  else document.exitFullscreen();
}

/* keys */
window.addEventListener("keydown",e=>{
  if(e.repeat) return;
  const k=e.key.toLowerCase();
  if(k==="c") capture();
  if(k==="s") save();
  if(k==="i") $("bInv").click();
  if(k==="g") $("bGrain").click();
  if(k==="r") $("bRGB").click();
  if(k==="b") $("bBlur").click();
  if(k==="e") $("bEdge").click();
  if(k==="m") $("bMirror").click();
  if(k==="f") toggleFS();
  if(k==="n") root.classList.toggle("null");
  if(e.code==="Space"){ e.preventDefault(); pulse(); }
  const n=+e.key; if(n>=1&&n<=6) FX.intensity=n;
});
</script>

<!-- AE/EE/WB SERIALIZATION STAMP :: AE=KETADATA_PHOTOBOOTH :: EE=LOCAL_FIRST_WEBCAM :: WB=CANVAS_FX_STACK :: FILE_ID=KETA_PHOTO_001 :: ROOM_ID=BASE :: VERSION=v1 :: UPDATED_AT=2026-01-07 :: CHANGELOG=FULLSCREEN_PHOTOBOOTH;STACKABLE_FX;KEYBOARD_FIRST -->
</body>
</html>
