<!DOCTYPE html>
<html>
<head>
    <title>KETADATA_PULSE_DEMO</title>
    <style>
        body { background: #000; color: #fff; font-family: monospace; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        #visualizer { transition: all 0.1s ease; border: 1px solid #333; }
        #status { position: fixed; top: 20px; left: 20px; font-size: 10px; color: #555; }
        #note-stream { position: fixed; bottom: 20px; right: 20px; color: #00ff00; font-size: 12px; }
    </style>
</head>
<body>
    <div id="status">WAITING FOR PULSE...</div>
    <div id="visualizer"></div>
    <div id="note-stream"></div>

    <script>
        const viz = document.getElementById('visualizer');
        const status = document.getElementById('status');
        const note = document.getElementById('note-stream');

        // THE LISTENER
        window.addEventListener('storage', (e) => {
            if (e.key === 'KETA_SHARED_PULSE') {
                const state = JSON.parse(e.newValue);
                renderPulse(state);
            }
        });

        function renderPulse(state) {
            // 1. Literal State Mapping
            const cellCount = Object.keys(state.data).length;
            const size = 100 + (cellCount * 10);
            
            // 2. Map data to Visuals (The Intensity Layer)
            viz.style.width = size + 'px';
            viz.style.height = size + 'px';
            viz.style.borderRadius = (cellCount % 2 === 0) ? '0%' : '50%';
            viz.style.borderColor = `hsl(${cellCount * 20}, 100%, 50%)`;
            viz.style.boxShadow = `0 0 ${cellCount * 5}px ${viz.style.borderColor}`;

            // 3. Update Note Stream
            status.innerText = `PULSE ACTIVE: ${state.id} | UPDATED: ${state.lastUpdate}`;
            note.innerText = `>> ${state.ketaNote || ''}`;
        }
    </script>
</body>
</html>
