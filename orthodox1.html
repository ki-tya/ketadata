<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KETA_MONO // ICON FIELD</title>
<style>
:root{
  --bg:#000;
  --ink:rgba(255,255,255,.86);
  --muted:rgba(255,255,255,.52);
  --line:rgba(255,255,255,.14);
  --line2:rgba(255,255,255,.26);

  /* mono+gold only */
  --gold: 44, 34, 12; /* warm gold hue (as rgb multipliers) */

  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  --sans: Arial, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

  --top:44px;
  --bot:34px;
  --pad:10px;

  /* intensifiers (0..1) */
  --I_GOLD: .70;    /* gold leaf brightness */
  --I_RAYS: .28;    /* radial rays */
  --I_CRACK: .26;   /* craquelure */
  --I_GRAIN: .22;   /* grain */
  --I_VIGN: .52;    /* vignette */
  --I_AURA: .20;    /* halo/aura */

  --motion: 1;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{background:var(--bg); color:var(--ink); font-family:var(--sans); overflow:hidden}
button,input,textarea{font:inherit}
a{color:inherit}

#root{position:fixed; inset:0; user-select:none}
#root.invert{filter:invert(1) hue-rotate(180deg)}
#root.null .bar, #root.null #botbar, #root.null #sig{display:none}
#root.null #stage{inset:0}

.bar{
  position:fixed; left:0; right:0; top:0;
  height:var(--top);
  display:flex; align-items:center;
  padding:0 var(--pad);
  background:rgba(0,0,0,.72);
  border-bottom:1px solid var(--line);
  z-index:40;
}
#botbar{
  position:fixed; left:0; right:0; bottom:0;
  height:var(--bot);
  display:flex; align-items:center;
  padding:0 var(--pad);
  background:rgba(0,0,0,.72);
  border-top:1px solid var(--line);
  z-index:40;
}
.left,.mid,.right{display:flex; align-items:center; gap:10px}
.left{min-width:420px}
.mid{flex:1; justify-content:center; overflow:hidden}
.right{min-width:420px; justify-content:flex-end}

.pip{width:10px; height:10px; border:1px solid var(--line2); background:rgba(255,255,255,.04)}
.brand{display:flex; flex-direction:column; line-height:1.05}
.brand div{font-family:var(--mono); font-size:11px; letter-spacing:.10em}
.brand .sub{opacity:.55}

.sep{width:1px; height:18px; background:var(--line)}

.btn{
  border:1px solid var(--line2);
  background:rgba(255,255,255,.04);
  color:var(--ink);
  font-family:var(--mono);
  font-size:11px;
  letter-spacing:.10em;
  padding:6px 8px;
  cursor:pointer;
}
.btn:active{transform:translateY(1px)}
.btn.tog.on{border-color:rgba(255,255,255,.46); box-shadow:0 0 0 1px rgba(255,255,255,.10) inset}

.kv{display:flex; align-items:center; gap:8px; font-family:var(--mono); font-size:11px; letter-spacing:.10em}
.kv .k{opacity:.55}
.kv .v{opacity:.92}

#stage{
  position:fixed;
  inset: var(--top) 0 var(--bot) 0;
  overflow:hidden;
}

/* panel */
#panel{
  position:absolute; inset:14px;
  border:1px solid var(--line);
  display:grid;
  grid-template-columns: 1.2fr .8fr;
  gap:14px;
  padding:14px;
  background:rgba(0,0,0,.40);
}

/* icon field */
#icon{
  position:relative;
  border:1px solid var(--line);
  overflow:hidden;
  background:#000;
}
#icon svg{position:absolute; inset:0; width:100%; height:100%}

/* side */
#side{
  position:relative;
  border:1px solid var(--line);
  background:rgba(0,0,0,.46);
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.block{
  border:1px solid var(--line);
  background:rgba(255,255,255,.03);
  padding:10px;
}
.block .h{
  display:flex; justify-content:space-between; gap:10px;
  font-family:var(--mono);
  font-size:11px;
  letter-spacing:.10em;
  opacity:.78;
  margin-bottom:8px;
}
.block .h .sub{opacity:.55}
.row{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  font-family:var(--mono);
  font-size:11px;
  letter-spacing:.10em;
}
.row span{opacity:.62}
.row input[type="range"]{width:180px}

textarea{
  width:100%;
  min-height:140px;
  resize:vertical;
  background:rgba(0,0,0,.55);
  color:rgba(255,255,255,.84);
  border:1px solid var(--line2);
  outline:none;
  font-family:var(--mono);
  font-size:11px;
  letter-spacing:.06em;
  line-height:1.35;
  padding:10px;
}

.small{
  font-family:var(--mono);
  font-size:11px;
  letter-spacing:.10em;
  opacity:.66;
  line-height:1.35;
  white-space:pre-wrap;
}

/* floating signature */
#sig{
  position:fixed;
  left:10px;
  bottom: calc(var(--bot) + 10px);
  font-family:var(--mono);
  font-size:11px;
  letter-spacing:.10em;
  opacity:.58;
  z-index:60;
  pointer-events:none;
}

/* motion */
@keyframes shimmer{0%,100%{filter:brightness(1) contrast(1)} 50%{filter:brightness(1.08) contrast(1.05)}}
@keyframes drift{0%,100%{transform:translate3d(0,0,0)} 50%{transform:translate3d(0,-8px,0)}}
#root.motion #icon{animation:drift 14s ease-in-out infinite}
#root.motion #icon svg{animation:shimmer 7s ease-in-out infinite}
</style>
</head>
<body>
<div id="root">
  <div class="bar">
    <div class="left">
      <div class="pip"></div>
      <div class="brand">
        <div>KETA_MONO // ICON FIELD</div>
        <div class="sub">LOCAL · SINGLE-FILE · NO NETWORK</div>
      </div>
      <div class="sep"></div>
      <button class="btn tog" id="invertBtn" title="Shift+I">INVERT</button>
      <button class="btn tog" id="nullBtn" title="Shift+N">NULL</button>
      <button class="btn tog on" id="motionBtn">MOTION</button>
    </div>

    <div class="mid">
      <div class="kv"><span class="k">GOLD</span><span class="v" id="gLab">70</span></div>
      <div class="sep"></div>
      <div class="kv"><span class="k">RAYS</span><span class="v" id="rLab">28</span></div>
      <div class="sep"></div>
      <div class="kv"><span class="k">CRACK</span><span class="v" id="cLab">26</span></div>
      <div class="sep"></div>
      <div class="kv"><span class="k">VIGN</span><span class="v" id="vLab">52</span></div>
    </div>

    <div class="right">
      <button class="btn" id="reinkBtn">RE-INK</button>
      <button class="btn" id="saveBtn">SAVE</button>
      <button class="btn" id="exportBtn">EXPORT TXT</button>
    </div>
  </div>

  <div id="stage">
    <div id="panel">
      <div id="icon" aria-label="Icon-inspired keta mono field">
        <!-- SVG: icon-like composition (stylized, mono+gold) -->
        <svg viewBox="0 0 1000 1000" role="img" aria-label="Keta mono icon field">
          <defs>
            <!-- gold leaf field -->
            <radialGradient id="goldField" cx="50%" cy="42%" r="80%">
              <stop offset="0" stop-color="rgba(255,255,255,.08)"/>
              <stop offset="0.55" stop-color="rgba(255,255,255,.04)"/>
              <stop offset="1" stop-color="rgba(0,0,0,0)"/>
            </radialGradient>

            <filter id="soft" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur stdDeviation="1.8" result="b"/>
              <feMerge>
                <feMergeNode in="b"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>

            <pattern id="grain" width="6" height="6" patternUnits="userSpaceOnUse">
              <circle cx="1" cy="1" r="1" fill="rgba(255,255,255,.06)"/>
              <circle cx="5" cy="2" r="1" fill="rgba(255,255,255,.04)"/>
              <circle cx="3" cy="5" r="1" fill="rgba(255,255,255,.03)"/>
            </pattern>

            <pattern id="crackle" width="48" height="48" patternUnits="userSpaceOnUse">
              <path d="M3 8 L40 2" stroke="rgba(0,0,0,.35)" stroke-width="2"/>
              <path d="M8 44 L44 10" stroke="rgba(0,0,0,.28)" stroke-width="2"/>
              <path d="M2 26 L26 46" stroke="rgba(0,0,0,.22)" stroke-width="2"/>
              <path d="M20 6 L46 32" stroke="rgba(0,0,0,.20)" stroke-width="2"/>
            </pattern>

            <mask id="vignMask">
              <rect width="1000" height="1000" fill="white"/>
              <radialGradient id="vignGrad" cx="50%" cy="48%" r="60%">
                <stop offset="0.62" stop-color="white"/>
                <stop offset="0.82" stop-color="rgba(255,255,255,.35)"/>
                <stop offset="1" stop-color="rgba(255,255,255,0)"/>
              </radialGradient>
              <rect width="1000" height="1000" fill="url(#vignGrad)"/>
            </mask>

            <style>
              .ink{ fill: rgba(255,255,255,.12); stroke: rgba(255,255,255,.26); stroke-width:2; }
              .ink2{ fill: rgba(0,0,0,.22); stroke: rgba(255,255,255,.18); stroke-width:2; }
              .line{ stroke: rgba(255,255,255,.26); stroke-width:2; fill:none; }
              .goldStroke{ stroke: rgba(255,255,255,.32); stroke-width:2; fill:none; }
              .txt{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
                    font-size: 22px; letter-spacing: 6px; fill: rgba(0,0,0,.55); }
              .txt2{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
                    font-size: 18px; letter-spacing: 6px; fill: rgba(0,0,0,.45); }
            </style>
          </defs>

          <!-- background gold leaf (implemented as mono field + gold tint via CSS vars in JS) -->
          <rect x="0" y="0" width="1000" height="1000" fill="rgb(18,14,6)"/>
          <rect x="-20" y="-20" width="1040" height="1040" id="goldRect" opacity="0.9"/>

          <!-- rays -->
          <g id="rays" opacity="0.9">
            <g transform="translate(500 420)">
              <!-- 48 rays -->
              <script type="application/ecmascript"><![CDATA[
                // intentionally empty (no inline script in svg; rays drawn below)
              ]]></script>
            </g>
            <!-- draw rays as paths (static) -->
            <g transform="translate(500 420)">
              <!-- repeated by hand-friendly loop substitute -->
              <!-- (thin wedges) -->
              <!-- 0..47 -->
              <!-- Using many lines for deterministic look -->
              <g id="rayLines"></g>
            </g>
          </g>

          <!-- inner frame -->
          <rect x="38" y="38" width="924" height="924" fill="rgba(0,0,0,.12)" stroke="rgba(0,0,0,.35)" stroke-width="8"/>
          <rect x="66" y="66" width="868" height="868" fill="rgba(255,255,255,.05)" stroke="rgba(0,0,0,.35)" stroke-width="6"/>

          <!-- corner inscription bands -->
          <g opacity="0.85">
            <rect x="86" y="92" width="300" height="84" fill="rgba(0,0,0,.10)" stroke="rgba(0,0,0,.35)" stroke-width="4"/>
            <rect x="614" y="92" width="300" height="84" fill="rgba(0,0,0,.10)" stroke="rgba(0,0,0,.35)" stroke-width="4"/>
            <text x="106" y="146" class="txt">KETA</text>
            <text x="634" y="146" class="txt">MONO</text>
            <text x="106" y="168" class="txt2">// DATA</text>
            <text x="634" y="168" class="txt2">FIELD</text>
          </g>

          <!-- halos / aura (stylized discs) -->
          <g filter="url(#soft)" opacity="0.95" id="aura">
            <circle cx="440" cy="430" r="210" fill="rgba(255,255,255,.08)"/>
            <circle cx="590" cy="520" r="150" fill="rgba(255,255,255,.06)"/>
            <circle cx="440" cy="430" r="170" fill="rgba(0,0,0,.18)"/>
            <circle cx="590" cy="520" r="120" fill="rgba(0,0,0,.18)"/>
          </g>

          <!-- main silhouettes (icon-like geometry, not a copy) -->
          <g id="fig" opacity="0.98">
            <!-- left figure cloak -->
            <path d="M170 860
                     Q140 700 200 610
                     Q255 530 330 510
                     Q365 460 390 420
                     Q420 368 470 345
                     Q530 318 592 350
                     Q660 384 690 460
                     Q714 520 720 600
                     Q728 720 700 860 Z"
                  class="ink2"/>

            <!-- inner garment -->
            <path d="M250 860
                     Q230 730 270 650
                     Q312 566 390 540
                     Q430 515 470 468
                     Q500 430 540 430
                     Q600 430 632 485
                     Q670 552 668 650
                     Q665 740 630 860 Z"
                  class="ink"/>

            <!-- head 1 -->
            <ellipse cx="440" cy="430" rx="105" ry="130" class="ink"/>
            <ellipse cx="440" cy="430" rx="78" ry="102" fill="rgba(0,0,0,.22)" stroke="rgba(255,255,255,.16)" stroke-width="2"/>

            <!-- head 2 -->
            <ellipse cx="590" cy="520" rx="78" ry="96" class="ink"/>
            <ellipse cx="590" cy="520" rx="56" ry="74" fill="rgba(0,0,0,.22)" stroke="rgba(255,255,255,.16)" stroke-width="2"/>

            <!-- faces minimal -->
            <g opacity="0.9">
              <ellipse cx="408" cy="430" rx="14" ry="10" fill="rgba(255,255,255,.62)"/>
              <ellipse cx="472" cy="430" rx="14" ry="10" fill="rgba(255,255,255,.62)"/>
              <circle cx="408" cy="431" r="5.5" fill="rgba(0,0,0,.86)"/>
              <circle cx="472" cy="431" r="5.5" fill="rgba(0,0,0,.86)"/>
              <path d="M440 442 L430 478 L450 478" class="line"/>
              <path d="M410 504 Q440 520 470 504" class="line"/>

              <ellipse cx="566" cy="520" rx="11" ry="8" fill="rgba(255,255,255,.58)"/>
              <ellipse cx="614" cy="520" rx="11" ry="8" fill="rgba(255,255,255,.58)"/>
              <circle cx="566" cy="521" r="4.8" fill="rgba(0,0,0,.86)"/>
              <circle cx="614" cy="521" r="4.8" fill="rgba(0,0,0,.86)"/>
              <path d="M590 530 L583 556 L597 556" class="line"/>
              <path d="M568 574 Q590 586 612 574" class="line"/>
            </g>

            <!-- abstract hand geometry -->
            <path d="M355 610
                     Q420 575 480 585
                     Q535 595 595 635
                     Q610 646 610 666
                     Q610 690 588 694
                     Q520 708 468 690
                     Q410 670 350 646 Z"
                  fill="rgba(0,0,0,.18)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>

            <!-- lower seal band -->
            <rect x="120" y="806" width="760" height="110" fill="rgba(0,0,0,.12)" stroke="rgba(0,0,0,.35)" stroke-width="4"/>
            <path d="M140 848 H860" stroke="rgba(0,0,0,.35)" stroke-width="3"/>
            <text x="500" y="888"
              text-anchor="middle"
              font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace"
              font-size="22"
              letter-spacing="6"
              fill="rgba(0,0,0,.55)">KETA // MONO // ICON</text>
          </g>

          <!-- grain + crackle overlays -->
          <rect x="66" y="66" width="868" height="868" fill="url(#grain)" id="grainRect" opacity="0.25"/>
          <rect x="66" y="66" width="868" height="868" fill="url(#crackle)" id="crackRect" opacity="0.22"/>

          <!-- vignette -->
          <rect x="0" y="0" width="1000" height="1000" fill="rgba(0,0,0,.86)" mask="url(#vignMask)" id="vignRect" opacity="0.55"/>
        </svg>
      </div>

      <div id="side">
        <div class="block">
          <div class="h"><span>INTENSIFIERS</span><span class="sub">0..100</span></div>
          <div class="row"><span>GOLD</span><input id="goldR" type="range" min="0" max="100" value="70"></div>
          <div class="row"><span>RAYS</span><input id="raysR" type="range" min="0" max="100" value="28"></div>
          <div class="row"><span>CRACK</span><input id="crackR" type="range" min="0" max="100" value="26"></div>
          <div class="row"><span>GRAIN</span><input id="grainR" type="range" min="0" max="100" value="22"></div>
          <div class="row"><span>VIGN</span><input id="vignR" type="range" min="0" max="100" value="52"></div>
          <div class="row"><span>AURA</span><input id="auraR" type="range" min="0" max="100" value="20"></div>
        </div>

        <div class="block">
          <div class="h"><span>KETA_NOTE</span><span class="sub">local</span></div>
          <textarea id="note" spellcheck="false"></textarea>
          <div class="small">Shift+I invert · Shift+N null · Shift+F fullscreen · keys 1–6 set LIGHT</div>
        </div>

        <div class="block">
          <div class="h"><span>STATUS</span><span class="sub" id="stSub">ready</span></div>
          <div class="small" id="st"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="botbar">
    <div class="left">
      <div class="kv"><span class="k">FILE</span><span class="v" id="fileId"></span></div>
      <div class="sep"></div>
      <div class="kv"><span class="k">UPDATED</span><span class="v" id="updatedAt"></span></div>
    </div>
    <div class="mid">
      <div class="kv"><span class="k">LIGHT</span><span class="v" id="lightLab">1</span></div>
      <div class="sep"></div>
      <div class="kv"><span class="k">MODE</span><span class="v">ICON</span></div>
    </div>
    <div class="right">
      <button class="btn" id="lDown">L-</button>
      <button class="btn" id="lUp">L+</button>
      <div class="sep"></div>
      <button class="btn" id="resetBtn">RESET</button>
    </div>
  </div>

  <div id="sig"></div>
</div>

<script>
/* KETA_MONO // ICON FIELD (local-first) */

const $ = (id)=>document.getElementById(id);
const clamp01 = (n)=>Math.max(0, Math.min(1, n));

const FILE_ID = (() => {
  const k="KETA_MONO_ICON_FILE_ID_v1";
  let v=localStorage.getItem(k);
  if(!v){
    v="KETA-ICON-"+Math.random().toString(16).slice(2,10).toUpperCase();
    localStorage.setItem(k,v);
  }
  return v;
})();

const LS_KEY = "KETA_MONO_ICON_STATE_v1::"+FILE_ID;

const DEFAULT = {
  ui:{ invert:false, null:false, fullscreen:false, motion:true, light:1 },
  intens:{ gold:.70, rays:.28, crack:.26, grain:.22, vign:.52, aura:.20 },
  note:"",
  meta:{ createdAt:new Date().toISOString(), updatedAt:new Date().toISOString(), version:"v1" }
};

let STATE = load();

function load(){
  try{
    const raw=localStorage.getItem(LS_KEY);
    if(!raw) return structuredClone(DEFAULT);
    const p=JSON.parse(raw);
    return deepFill(structuredClone(DEFAULT), p);
  }catch(e){
    return structuredClone(DEFAULT);
  }
}
function deepFill(base, inc){
  if(!inc || typeof inc!=="object") return base;
  for(const k of Object.keys(inc)){
    if(!(k in base)){ base[k]=inc[k]; continue; }
    if(base[k] && typeof base[k]==="object" && !Array.isArray(base[k]) &&
       inc[k] && typeof inc[k]==="object" && !Array.isArray(inc[k])){
      base[k]=deepFill(base[k], inc[k]);
    }else base[k]=inc[k];
  }
  return base;
}

function isoShort(s){
  try{
    const d=new Date(s);
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,"0");
    const da=String(d.getDate()).padStart(2,"0");
    const hh=String(d.getHours()).padStart(2,"0");
    const mm=String(d.getMinutes()).padStart(2,"0");
    return `${y}-${m}-${da} ${hh}:${mm}`;
  }catch(e){ return String(s||""); }
}

function sigLine(){
  const updated = isoShort(STATE.meta.updatedAt);
  return `AE/EE/WB · FILE_ID=${FILE_ID} · ROOM_ID=KETA_MONO_ICON_FIELD · VERSION=${STATE.meta.version} · UPDATED_AT=${updated} · CHANGELOG=mono+gold icon field`;
}

function setStatus(msg){
  $("stSub").textContent = msg;
  $("st").textContent =
`LS_KEY: ${LS_KEY}
INVERT: ${STATE.ui.invert?"ON":"OFF"} · NULL: ${STATE.ui.null?"ON":"OFF"} · MOTION: ${STATE.ui.motion?"ON":"OFF"} · LIGHT: ${STATE.ui.light}
INTENS: gold=${STATE.intens.gold.toFixed(2)} rays=${STATE.intens.rays.toFixed(2)} crack=${STATE.intens.crack.toFixed(2)} grain=${STATE.intens.grain.toFixed(2)} vign=${STATE.intens.vign.toFixed(2)} aura=${STATE.intens.aura.toFixed(2)}
STAMP: ${sigLine()}`;
  clearTimeout(setStatus._t);
  setStatus._t=setTimeout(()=>{$("stSub").textContent="ready";}, 900);
}

function save(reason="save"){
  STATE.meta.updatedAt=new Date().toISOString();
  localStorage.setItem(LS_KEY, JSON.stringify(STATE));
  render();
  setStatus(`saved (${reason})`);
}

function applyIntens(){
  const r=document.documentElement.style;
  r.setProperty("--I_GOLD", String(clamp01(STATE.intens.gold)));
  r.setProperty("--I_RAYS", String(clamp01(STATE.intens.rays)));
  r.setProperty("--I_CRACK", String(clamp01(STATE.intens.crack)));
  r.setProperty("--I_GRAIN", String(clamp01(STATE.intens.grain)));
  r.setProperty("--I_VIGN", String(clamp01(STATE.intens.vign)));
  r.setProperty("--I_AURA", String(clamp01(STATE.intens.aura)));

  // gold tint render (keep it mono; just tint the "goldRect")
  const gold = $("goldRect");
  const g = clamp01(STATE.intens.gold);

  // warm gold base: multiply into rgb-ish
  const R = Math.round(210 + 35*g);
  const G = Math.round(170 + 55*g);
  const B = Math.round(70  + 40*g);
  gold.setAttribute("fill", `rgb(${R},${G},${B})`);
  gold.setAttribute("opacity", String(0.25 + 0.65*g));

  $("grainRect").setAttribute("opacity", String(0.06 + 0.55*STATE.intens.grain));
  $("crackRect").setAttribute("opacity", String(0.04 + 0.55*STATE.intens.crack));
  $("vignRect").setAttribute("opacity",  String(0.10 + 0.90*STATE.intens.vign));

  const aura = $("aura");
  aura.setAttribute("opacity", String(0.15 + 0.85*STATE.intens.aura));

  // rays as lines (generated once, opacity controlled here)
  $("rays").setAttribute("opacity", String(0.02 + 0.98*STATE.intens.rays));

  $("gLab").textContent = String(Math.round(STATE.intens.gold*100));
  $("rLab").textContent = String(Math.round(STATE.intens.rays*100));
  $("cLab").textContent = String(Math.round(STATE.intens.crack*100));
  $("vLab").textContent = String(Math.round(STATE.intens.vign*100));
}

function render(){
  const root=$("root");
  root.classList.toggle("invert", !!STATE.ui.invert);
  root.classList.toggle("null", !!STATE.ui.null);
  root.classList.toggle("motion", !!STATE.ui.motion);

  $("invertBtn").classList.toggle("on", !!STATE.ui.invert);
  $("nullBtn").classList.toggle("on", !!STATE.ui.null);
  $("motionBtn").classList.toggle("on", !!STATE.ui.motion);

  $("fileId").textContent = FILE_ID;
  $("updatedAt").textContent = isoShort(STATE.meta.updatedAt);
  $("lightLab").textContent = String(STATE.ui.light||1);
  $("sig").textContent = sigLine();

  $("note").value = STATE.note || "";

  // sliders
  $("goldR").value = String(Math.round(STATE.intens.gold*100));
  $("raysR").value = String(Math.round(STATE.intens.rays*100));
  $("crackR").value = String(Math.round(STATE.intens.crack*100));
  $("grainR").value = String(Math.round(STATE.intens.grain*100));
  $("vignR").value = String(Math.round(STATE.intens.vign*100));
  $("auraR").value = String(Math.round(STATE.intens.aura*100));

  applyIntens();
}

function reink(){
  const j=(v,a)=>clamp01(v + (Math.random()*2-1)*a);
  STATE.intens.gold  = j(STATE.intens.gold,  0.10);
  STATE.intens.rays  = j(STATE.intens.rays,  0.14);
  STATE.intens.crack = j(STATE.intens.crack, 0.10);
  STATE.intens.grain = j(STATE.intens.grain, 0.10);
  STATE.intens.vign  = j(STATE.intens.vign,  0.08);
  STATE.intens.aura  = j(STATE.intens.aura,  0.10);
  save("re-ink");
}

function downloadText(filename, text){
  const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download=filename;
  document.body.appendChild(a);
  a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 500);
}

function toggleFullscreen(){
  const el=document.documentElement;
  if(!document.fullscreenElement){
    el.requestFullscreen?.();
    STATE.ui.fullscreen=true;
  }else{
    document.exitFullscreen?.();
    STATE.ui.fullscreen=false;
  }
  save("fullscreen");
}

/* ray lines generation (deterministic) */
function buildRays(){
  const g = document.getElementById("rayLines");
  if(!g) return;
  // clear
  while(g.firstChild) g.removeChild(g.firstChild);

  const N=56;
  const inner=220;
  const outer=420;
  for(let i=0;i<N;i++){
    const a = (Math.PI*2) * (i/N) + 0.22;
    const x1 = Math.cos(a)*inner;
    const y1 = Math.sin(a)*inner;
    const x2 = Math.cos(a)*outer;
    const y2 = Math.sin(a)*outer;

    const ln = document.createElementNS("http://www.w3.org/2000/svg","line");
    ln.setAttribute("x1", x1.toFixed(2));
    ln.setAttribute("y1", y1.toFixed(2));
    ln.setAttribute("x2", x2.toFixed(2));
    ln.setAttribute("y2", y2.toFixed(2));
    ln.setAttribute("stroke", "rgba(0,0,0,.30)");
    ln.setAttribute("stroke-width", (i%2? 3:2));
    ln.setAttribute("opacity", (i%7===0? 0.55:0.35));
    g.appendChild(ln);
  }
}

/* bindings */
let noteDeb=null;
function bind(){
  $("invertBtn").onclick=()=>{ STATE.ui.invert=!STATE.ui.invert; save("invert"); };
  $("nullBtn").onclick=()=>{ STATE.ui.null=!STATE.ui.null; save("null"); };
  $("motionBtn").onclick=()=>{ STATE.ui.motion=!STATE.ui.motion; save("motion"); };
  $("reinkBtn").onclick=()=>reink();
  $("saveBtn").onclick=()=>save("manual");

  $("exportBtn").onclick=()=>{
    const txt =
`KETA_MONO // ICON FIELD EXPORT
FILE_ID: ${FILE_ID}
UPDATED_AT: ${STATE.meta.updatedAt}

NOTE:
${STATE.note || ""}

STAMP:
${sigLine()}
`;
    downloadText(`KETA_MONO_ICON_${FILE_ID}.txt`, txt);
    setStatus("exported");
  };

  $("resetBtn").onclick=()=>{
    const keepLight = STATE.ui.light||1;
    const keepMotion = !!STATE.ui.motion;
    STATE = structuredClone(DEFAULT);
    STATE.ui.light = keepLight;
    STATE.ui.motion = keepMotion;
    save("reset");
  };

  const bindR=(id,key)=>{
    $(id).addEventListener("input",(e)=>{
      STATE.intens[key]=clamp01(Number(e.target.value)/100);
      render();
    });
    $(id).addEventListener("change",()=>save("intensity"));
  };
  bindR("goldR","gold");
  bindR("raysR","rays");
  bindR("crackR","crack");
  bindR("grainR","grain");
  bindR("vignR","vign");
  bindR("auraR","aura");

  $("note").addEventListener("input",(e)=>{
    STATE.note=e.target.value||"";
    clearTimeout(noteDeb);
    noteDeb=setTimeout(()=>save("note"), 420);
  });

  $("lDown").onclick=()=>{ STATE.ui.light=Math.max(1,(STATE.ui.light||1)-1); save("light"); };
  $("lUp").onclick=()=>{ STATE.ui.light=Math.min(6,(STATE.ui.light||1)+1); save("light"); };

  window.addEventListener("keydown",(e)=>{
    const tag=(e.target && e.target.tagName||"").toLowerCase();
    const typing=(tag==="textarea"||tag==="input");
    if(e.shiftKey && e.key.toLowerCase()==="i"){
      e.preventDefault(); STATE.ui.invert=!STATE.ui.invert; save("invert(hk)"); return;
    }
    if(e.shiftKey && e.key.toLowerCase()==="n"){
      e.preventDefault(); STATE.ui.null=!STATE.ui.null; save("null(hk)"); return;
    }
    if(e.shiftKey && e.key.toLowerCase()==="f"){
      e.preventDefault(); toggleFullscreen(); return;
    }
    if(e.key>="1" && e.key<="6"){
      STATE.ui.light=Number(e.key); save("light(hk)"); return;
    }
    if(!typing && e.code==="Space"){
      e.preventDefault();
      STATE.ui.motion=!STATE.ui.motion; save("motion(space)");
      return;
    }
  });
}

/* init */
(function init(){
  buildRays();
  bind();
  render();
  setStatus("ready");
})();
</script>

<!--
AE/EE/WB · FILE_ID=KETA_MONO_ICON_FILE_ID_v1 · ROOM_ID=KETA_MONO_ICON_FIELD · VERSION=v1 · UPDATED_AT=local · CHANGELOG=mono+gold icon field
-->
</body>
</html>
