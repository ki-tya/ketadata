<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="theme-color" content="#000000" />
<title>KETADATA // MOB_PLAYER</title>

<style>
:root{
  --bg:#000;
  --fg:rgba(255,255,255,.86);
  --muted:rgba(255,255,255,.52);
  --line:rgba(255,255,255,.12);
  --line2:rgba(255,255,255,.22);

  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  --sans: Arial, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

  --header-h: 44px;
  --footer-h: 44px;
  --touch-min: 44px;
}

*{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
html,body{height:100%; margin:0; overflow:hidden}
body{
  background:var(--bg);
  color:var(--fg);
  font-family:var(--mono);
  font-size:12px;
  letter-spacing:.06em;
  touch-action:manipulation;
  overscroll-behavior:none;
}

/* LAYOUT */
#root{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  background:#000;
}

/* HEADER */
.header{
  height:var(--header-h);
  border-bottom:1px solid var(--line);
  background:linear-gradient(180deg,#070707,#000);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 10px;
  flex-shrink:0;
  z-index:100;
}
.brand{
  font-size:12px;
  letter-spacing:.10em;
  text-transform:uppercase;
  display:flex;
  align-items:center;
  gap:8px;
  user-select:none;
  -webkit-user-select:none;
}
.brand .sq{
  width:10px; height:10px;
  border:1px solid rgba(255,255,255,.86);
  background:#000;
}
.brand .stack{
  display:flex;
  flex-direction:column;
  line-height:1.05;
}
.brand .stack .muted{color:var(--muted)}
.header-actions{
  display:flex;
  gap:8px;
  align-items:center;
}
.btn,
.icon-btn{
  min-height:var(--touch-min);
  height:var(--touch-min);
  border:1px solid var(--line2);
  background:#000;
  color:var(--fg);
  font-family:var(--mono);
  font-size:12px;
  letter-spacing:.08em;
  text-transform:uppercase;
  padding:0 12px;
  cursor:pointer;
  user-select:none;
  -webkit-user-select:none;
}
.icon-btn{
  width:var(--touch-min);
  padding:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
}
.btn:active,
.icon-btn:active{transform:translateY(1px); border-color:rgba(255,255,255,.86)}
.btn:disabled{opacity:.35; cursor:default; transform:none}

/* MAIN */
.main{
  flex:1;
  overflow:hidden;
  position:relative;
}

/* SURFACE PLAYER (always the main surface) */
#surfaceFrame{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:0;
  background:#000;
  display:block;
}

/* PRESETS DRAWER (collapsible) */
.drawer{
  position:absolute;
  left:0;
  right:0;
  bottom:0;
  height:52vh;
  max-height:520px;
  background:rgba(0,0,0,.92);
  border-top:1px solid var(--line);
  z-index:200;
  transform:translateY(calc(100% - 54px));
  transition:transform 140ms linear;
  display:flex;
  flex-direction:column;
}
.drawer.open{ transform:translateY(0); }
.drawer-handle{
  height:54px;
  flex-shrink:0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 10px;
  border-bottom:1px solid var(--line);
  user-select:none;
  -webkit-user-select:none;
}
.drawer-title{
  font-size:11px;
  letter-spacing:.10em;
  text-transform:uppercase;
  color:var(--muted);
}
.drawer-now{
  flex:1;
  text-align:right;
  padding-left:10px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  font-size:11px;
  letter-spacing:.08em;
  text-transform:uppercase;
}
.drawer-body{
  flex:1;
  overflow:auto;
  -webkit-overflow-scrolling:touch;
  padding:10px;
}

/* pills + grid */
.row{
  display:flex;
  gap:8px;
  margin-bottom:10px;
}
.row .btn{flex:1; padding:0 10px}
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:8px;
}
.preset{
  min-height:var(--touch-min);
  border:1px solid var(--line2);
  background:#000;
  color:var(--fg);
  font-family:var(--mono);
  font-size:12px;
  letter-spacing:.06em;
  text-transform:uppercase;
  padding:10px;
  cursor:pointer;
  user-select:none;
  -webkit-user-select:none;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.preset:active{transform:translateY(1px); border-color:rgba(255,255,255,.86); background:rgba(255,255,255,.08)}
.preset .name{flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
.preset .tag{color:var(--muted); font-size:11px; letter-spacing:.10em}

/* FOOTER NAV (minimal) */
.footer{
  height:var(--footer-h);
  border-top:1px solid var(--line);
  background:linear-gradient(0deg,#070707,#000);
  display:flex;
  align-items:stretch;
  flex-shrink:0;
  z-index:100;
}
.nav-btn{
  flex:1;
  border:0;
  border-right:1px solid var(--line);
  background:transparent;
  color:var(--muted);
  font-family:var(--mono);
  font-size:11px;
  letter-spacing:.10em;
  text-transform:uppercase;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.nav-btn:last-child{border-right:0}
.nav-btn.active{color:var(--fg); background:rgba(255,255,255,.05)}
.nav-btn:active{background:rgba(255,255,255,.10)}

/* STAGE (light effects) */
#stage{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:999;
  background:#000;
  display:none;
}
#stage.active{display:block}

/* TOAST */
.toast{
  position:fixed;
  top:calc(var(--header-h) + 10px + env(safe-area-inset-top));
  left:50%;
  transform:translateX(-50%);
  padding:10px 12px;
  background:rgba(0,0,0,.95);
  border:1px solid rgba(255,255,255,.86);
  font-size:11px;
  letter-spacing:.08em;
  text-transform:uppercase;
  z-index:9999;
  display:none;
  white-space:nowrap;
}

/* NULL + INVERT (mobile hotkeys as UI) */
#nullSquare{
  position:fixed;
  right:10px;
  bottom:calc(10px + env(safe-area-inset-bottom));
  width:22px;
  height:22px;
  border:1px solid rgba(255,255,255,.86);
  background:transparent;
  z-index:10000;
  cursor:pointer;
}
#nullSquare:active{transform:translateY(1px)}
body.invert{filter:invert(1)}
body.null .header,
body.null .footer,
body.null .drawer,
body.null .toast{display:none !important}
/* keep stage + surface alive in NULL */
body.null #surfaceFrame{display:block !important}
body.null #nullSquare{display:block !important}

/* safe areas */
.header{padding-top:env(safe-area-inset-top)}
.drawer{padding-bottom:env(safe-area-inset-bottom)}
.footer{padding-bottom:env(safe-area-inset-bottom)}
</style>
</head>

<body>
<div id="root">
  <!-- HEADER (LONG PRESS BRAND = INVERT) -->
  <div class="header">
    <div class="brand" id="brandHold" title="LONG PRESS = INVERT">
      <span class="sq"></span>
      <span class="stack">
        <span>SHELL8 // KERNEL</span>
        <span class="muted">MOB_PLAYER</span>
      </span>
    </div>
    <div class="header-actions">
      <button class="icon-btn" id="btnPrev" title="PREV">◀</button>
      <button class="icon-btn" id="btnNext" title="NEXT">▶</button>
      <button class="icon-btn" id="btnDrawer" title="PRESETS">▤</button>
    </div>
  </div>

  <!-- MAIN -->
  <div class="main">
    <iframe id="surfaceFrame" title="SURFACE"></iframe>

    <!-- PRESETS DRAWER -->
    <div class="drawer" id="drawer">
      <div class="drawer-handle" id="drawerHandle">
        <div class="drawer-title">PRESETS</div>
        <div class="drawer-now" id="nowLabel">—</div>
      </div>
      <div class="drawer-body">
        <div class="row">
          <button class="btn" id="btnStop">STOP</button>
          <button class="btn" id="btnReload">RELOAD</button>
          <button class="btn" id="btnRunLight">RUN LIGHT</button>
        </div>
        <div class="grid" id="presetGrid"></div>
      </div>
    </div>
  </div>

  <!-- FOOTER (minimal: invert/null) -->
  <div class="footer">
    <button class="nav-btn" id="btnInvert">INVERT</button>
    <button class="nav-btn" id="btnNull">NULL</button>
    <button class="nav-btn" id="btnLights">LIGHTS</button>
  </div>

  <!-- STAGE -->
  <div id="stage"></div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <!-- NULL CONTROL -->
  <div id="nullSquare" title="NULL"></div>
</div>

<script>
/* ===== UTIL ===== */
const $=(id)=>document.getElementById(id);
function toast(msg,dur=900){
  const t=$("toast");
  t.textContent=String(msg||"");
  t.style.display="block";
  clearTimeout(t._t);
  t._t=setTimeout(()=>{t.style.display="none";},dur);
}
function hash8(str){
  const s=String(str||"");
  let h=2166136261;
  for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h=Math.imul(h,16777619);}
  return (h>>>0).toString(16).slice(0,8);
}

/* ===== PRESETS (TOY ONES) ===== */
const PRESETS = [
  {name:"CATBALL", url:"catball.html", tag:"TOY"},
  {name:"CATBALL1", url:"catball1.html", tag:"TOY"},
  {name:"KTBALL", url:"ktball.html", tag:"TOY"},
  {name:"KTBALL1", url:"ktball1.html", tag:"TOY"},
  {name:"SERVE", url:"serve.html", tag:"TOY"},
  {name:"SERVE1", url:"serve1.html", tag:"TOY"},
  {name:"SERVE2", url:"serve2.html", tag:"TOY"},
  {name:"TBALL", url:"tball.html", tag:"TOY"},
  {name:"TBALL1", url:"tball1.html", tag:"TOY"},
  {name:"TBALL2", url:"tball2.html", tag:"TOY"},
  {name:"TBALL3", url:"tball3.html", tag:"TOY"},
  {name:"TBALL4", url:"tball4.html", tag:"TOY"},
  {name:"TBALL5", url:"tball5.html", tag:"TOY"},
  {name:"TBALL6", url:"tball6.html", tag:"TOY"},
  {name:"TBALL7", url:"tball7.html", tag:"TOY"},
  {name:"TENNISBALL", url:"tennisball.html", tag:"TOY"},
  {name:"TENNISBALL0", url:"tennisball0.html", tag:"TOY"},
  {name:"TENNISBALL2", url:"tennisball2.html", tag:"TOY"},
  {name:"TENNISBALL3", url:"tennisball3.html", tag:"TOY"},
  {name:"TENNISBALL4", url:"tennisball4.html", tag:"TOY"},
  {name:"TENNISBALL5", url:"tennisball5.html", tag:"TOY"},
  {name:"TENNISBALL6", url:"tennisball6.html", tag:"TOY"},
  {name:"TENNISBALL7", url:"tennisball7.html", tag:"TOY"},
  {name:"TENNISBALL8", url:"tennisball8.html", tag:"TOY"},
  {name:"TENNISBALL9", url:"tennisball9.html", tag:"TOY"},
  {name:"TENNISBALL10", url:"tennisball10.html", tag:"TOY"},
  {name:"TENNISBALL11", url:"tennisball11.html", tag:"TOY"},
  {name:"TENNISBALL12", url:"tennisball12.html", tag:"TOY"},
  {name:"TENNISBALL13", url:"tennisball13.html", tag:"TOY"},
  {name:"TENNISBALL14", url:"tennisball14.html", tag:"TOY"},
  {name:"TENNISBALL15", url:"tennisball15.html", tag:"TOY"},
  {name:"TENNISBALL16", url:"tennisball16.html", tag:"TOY"},
  {name:"TENNISBALL91", url:"tennisball91.html", tag:"TOY"},
  {name:"TENNISBALL666", url:"tennisball666.html", tag:"TOY"},
  {name:"TENNISCOURT", url:"tenniscourt.html", tag:"TOY"},
];

/* ===== STATE ===== */
const PAGE_ID="MOB_PLAYER_v1";
const STORAGE_KEY="KDT::MOB_PLAYER::"+hash8(location.pathname+"|"+PAGE_ID)+"::STATE";
let STATE={
  idx:0,
  url:"",
  name:"",
  invert:false,
  null:false,
  drawerOpen:false,
  lightPreset:1,
  lightRunning:false
};

function loadState(){
  try{
    const raw=localStorage.getItem(STORAGE_KEY);
    if(raw){
      const loaded=JSON.parse(raw);
      STATE={...STATE,...loaded};
    }
  }catch(e){}
}
function saveState(){
  try{ localStorage.setItem(STORAGE_KEY,JSON.stringify(STATE)); }catch(e){}
}

/* ===== MODES ===== */
function applyModes(){
  document.body.classList.toggle("invert", !!STATE.invert);
  document.body.classList.toggle("null", !!STATE.null);
  $("drawer").classList.toggle("open", !!STATE.drawerOpen);
}
function toggleInvert(){
  STATE.invert=!STATE.invert;
  saveState(); applyModes();
  toast(STATE.invert ? "INVERT" : "NORMAL");
}
function toggleNull(){
  STATE.null=!STATE.null;
  saveState(); applyModes();
  toast(STATE.null ? "NULL" : "RETURN");
}

/* long press brand = invert */
(function bindLongPress(){
  const el=$("brandHold");
  let t=null;
  const LONG=520;
  const clear=()=>{ if(t){clearTimeout(t); t=null;} };
  el.addEventListener("pointerdown",(ev)=>{
    if(ev.pointerType!=="touch") return;
    clear();
    t=setTimeout(()=>{ toggleInvert(); }, LONG);
  },{passive:true});
  el.addEventListener("pointerup", clear, {passive:true});
  el.addEventListener("pointercancel", clear, {passive:true});
})();

/* ===== PLAYER ===== */
function setNow(p){
  $("nowLabel").textContent = (p && p.name) ? p.name : "—";
}
function loadPreset(i){
  const idx = Math.max(0, Math.min(PRESETS.length-1, i|0));
  const p = PRESETS[idx];
  STATE.idx = idx;
  STATE.url = p.url;
  STATE.name = p.name;

  const frame = $("surfaceFrame");
  frame.src = p.url;

  setNow(p);
  saveState();
  toast(p.name);
}
function prev(){ loadPreset((STATE.idx-1+PRESETS.length)%PRESETS.length); }
function next(){ loadPreset((STATE.idx+1)%PRESETS.length); }
function reload(){
  const frame=$("surfaceFrame");
  const u=STATE.url || (PRESETS[STATE.idx] && PRESETS[STATE.idx].url) || "";
  if(!u) return;
  frame.src="about:blank";
  setTimeout(()=>{ frame.src=u; }, 20);
  toast("RELOAD");
}
function stop(){
  const frame=$("surfaceFrame");
  frame.src="about:blank";
  toast("STOP");
}

/* ===== DRAWER ===== */
function toggleDrawer(){
  STATE.drawerOpen = !STATE.drawerOpen;
  saveState(); applyModes();
}

/* ===== LIGHTS ===== */
let lightInterval=null;
function stopLight(){
  if(lightInterval){ clearInterval(lightInterval); lightInterval=null; }
  STATE.lightRunning=false;
  const stage=$("stage");
  stage.classList.remove("active");
  stage.style.backgroundColor="#000";
  stage.style.filter="none";
  saveState();
}
function startLight(preset=1){
  stopLight();
  STATE.lightPreset = Number(preset)||1;
  STATE.lightRunning=true;
  const stage=$("stage");
  stage.classList.add("active");

  const p=STATE.lightPreset;

  if(p===1){
    lightInterval=setInterval(()=>{
      const curr=stage.style.backgroundColor||"black";
      stage.style.backgroundColor=(curr==="black"||curr==="rgb(0, 0, 0)")?"white":"black";
    },50);
  }else if(p===2){
    let hue=0,wave=0;
    lightInterval=setInterval(()=>{
      hue=(hue+24)%360;
      wave+=0.35;
      const l=38+Math.sin(wave)*24;
      stage.style.backgroundColor=`hsl(${hue},100%,${l}%)`;
    },16);
  }else if(p===3){
    let c=0;
    lightInterval=setInterval(()=>{
      c++;
      const beat=c%16;
      if(beat===0||beat===1){ stage.style.backgroundColor="#fff"; stage.style.filter="invert(1) contrast(3)"; }
      else if(beat===2){ stage.style.backgroundColor="#000"; stage.style.filter="invert(1) contrast(2)"; }
      else if(beat===3){ stage.style.backgroundColor="#111"; stage.style.filter="contrast(3)"; }
      else if(beat<8){ stage.style.backgroundColor="#fff"; stage.style.filter="contrast(1.6) invert(.2)"; }
      else{ stage.style.backgroundColor="#000"; stage.style.filter="contrast(2.2) invert(.1)"; }
    },30);
  }else{
    // keep 1 as default if unknown
    startLight(1);
    return;
  }

  saveState();
  toast("LIGHT RUN");
}
function toggleLight(){
  if(STATE.lightRunning){ stopLight(); toast("LIGHT STOP"); }
  else startLight(STATE.lightPreset||1);
}

/* Lights run on DOUBLE TAP anywhere */
let lastTapAt=0;
const DBL_MS=280;
document.addEventListener("pointerdown",(ev)=>{
  if(ev.pointerType!=="touch") return;
  const now=performance.now();
  if(now-lastTapAt < DBL_MS){
    ev.preventDefault();
    toggleLight();
    lastTapAt = 0;
  }else{
    lastTapAt = now;
  }
},{passive:false});

/* ===== BUILD PRESET GRID ===== */
function buildGrid(){
  const grid=$("presetGrid");
  grid.innerHTML="";
  PRESETS.forEach((p,i)=>{
    const b=document.createElement("button");
    b.className="preset";
    b.innerHTML=`<span class="name">${p.name}</span><span class="tag">${p.tag||""}</span>`;
    b.onclick=()=>loadPreset(i);
    grid.appendChild(b);
  });
}

/* ===== BINDINGS ===== */
$("btnPrev").onclick=prev;
$("btnNext").onclick=next;
$("btnDrawer").onclick=toggleDrawer;
$("drawerHandle").onclick=toggleDrawer;

$("btnStop").onclick=stop;
$("btnReload").onclick=reload;
$("btnRunLight").onclick=toggleLight;

$("btnInvert").onclick=toggleInvert;
$("btnNull").onclick=toggleNull;
$("btnLights").onclick=toggleLight;
$("nullSquare").onclick=toggleNull;

/* ===== INIT ===== */
(function init(){
  loadState();
  buildGrid();

  // default: load first preset if none
  if(!STATE.url){
    STATE.idx=0;
    STATE.url=PRESETS[0].url;
    STATE.name=PRESETS[0].name;
  }
  applyModes();
  loadPreset(STATE.idx);

  // if user had drawer open, keep it
  $("drawer").classList.toggle("open", !!STATE.drawerOpen);

  // keep surface alive in NULL (already)
})();
</script>

<!--
AE:
- PLAYER-FIRST. NO LINKS UI.
- PRESETS DRAWER COLLAPSIBLE. SURFACE IS FULL VIEWPORT.
- NULL: hides chrome; surface + stage continue.
- INVERT: long-press top-left brand.

EE:
- PREV/NEXT + PRESETS GRID.
- DOUBLE TAP ANYWHERE TO TOGGLE LIGHT RUN (preset=1 default).
- RUN LIGHT button also toggles.
- NULL square bottom-right.

WB:
FILE_ID: mob_player_v1.html
ROOM_ID: MOB_PLAYER
VERSION: v1.0.0
UPDATED_AT: 2026-01-15
CHANGELOG:
- Converted links UI into preset-based player for toy surfaces.
- Added double-tap to toggle lights run.
-->
</body>
</html>
