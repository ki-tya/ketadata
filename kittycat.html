<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KETADATA // KITTY CAT</title>
  <style>
    :root{
      --bg:#0b0c0f;
      --fg:#e9edf2;
      --muted:rgba(233,237,242,.55);
      --hair:rgba(233,237,242,.14);
      --panel:rgba(0,0,0,.35);
      --panel2:rgba(0,0,0,.55);
      --light:0;
      --invert:0;
      --motion:1;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      background:var(--bg);
      color:var(--fg);
      font:12px/1.25 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      overflow:hidden;
      user-select:none;
    }

    /* INVERT + NULL */
    body.invert{ filter: invert(1) hue-rotate(180deg); background:#fff; }
    body.nullmode .chrome{display:none}
    body.nullmode #hud{opacity:.0; pointer-events:none}

    /* FIELD */
    #field{
      position:absolute; inset:0;
      background:
        radial-gradient(1200px 800px at 50% 38%, rgba(150,170,210,.16), rgba(0,0,0,0) 60%),
        radial-gradient(900px 700px at 28% 78%, rgba(210,150,200,.09), rgba(0,0,0,0) 55%),
        radial-gradient(900px 800px at 78% 70%, rgba(160,220,200,.07), rgba(0,0,0,0) 58%),
        linear-gradient(180deg, rgba(233,237,242,.03), rgba(0,0,0,0) 42%),
        linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.30));
    }
    canvas{position:absolute; inset:0; width:100%; height:100%}

    /* LIGHTS (1–6) */
    #lights{
      position:absolute; inset:0;
      pointer-events:none;
      opacity: calc(var(--light) / 6);
      mix-blend-mode: screen;
      background:
        radial-gradient(900px 700px at 22% 30%, rgba(120,200,255,.14), rgba(0,0,0,0) 55%),
        radial-gradient(700px 600px at 82% 35%, rgba(255,140,200,.10), rgba(0,0,0,0) 55%),
        radial-gradient(900px 800px at 50% 86%, rgba(140,255,200,.08), rgba(0,0,0,0) 55%);
    }

    /* CHROME */
    .chrome{position:absolute; inset:0; pointer-events:none}
    #frame{position:absolute; inset:8px; border:1px solid rgba(233,237,242,.08); pointer-events:none}

    #hud{
      position:absolute;
      top:10px; left:10px;
      width: 360px;
      border:1px solid var(--hair);
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
      pointer-events:auto;
    }
    #hud .bar{
      display:flex; align-items:center; justify-content:space-between;
      padding:8px 8px;
      border-bottom:1px solid var(--hair);
      background: linear-gradient(180deg, rgba(233,237,242,.06), rgba(0,0,0,0));
    }
    #hud .bar .title{opacity:.9}
    #hud .bar .meta{opacity:.55}
    #hud .body{padding:8px; display:grid; gap:8px}
    .row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .btn, .pill, input[type="range"]{font:inherit; color:inherit}
    .btn{
      border:1px solid var(--hair);
      background:rgba(233,237,242,.04);
      padding:6px 8px;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{background:rgba(233,237,242,.07)}
    .btn:active{transform: translateY(1px)}
    .pill{
      border:1px solid var(--hair);
      padding:6px 8px;
      background:rgba(0,0,0,.18);
      opacity:.85;
    }
    input[type="range"]{width:140px; accent-color: var(--fg)}
    .label{opacity:.7}
    .mini{opacity:.55}
    .sep{height:1px;background:var(--hair);margin:2px 0}

    /* NOTE (ANGULAR) */
    #note{
      position:absolute;
      right:10px; top:10px;
      width: 360px; height: 220px;
      border:1px solid var(--hair);
      background:rgba(0,0,0,.55);
      pointer-events:auto;
      display:none;
    }
    #note.open{display:block}
    #note .bar{
      display:flex; align-items:center; justify-content:space-between;
      padding:8px 8px;
      border-bottom:1px solid var(--hair);
      background: linear-gradient(180deg, rgba(233,237,242,.06), rgba(0,0,0,0));
      cursor:move;
      user-select:none;
    }
    #note textarea{
      width:100%; height: calc(100% - 34px);
      border:0; outline:none; resize:none;
      background:transparent;
      color:var(--fg);
      font:inherit;
      padding:8px;
      user-select:text;
    }

    /* SENSES (CIRCULAR) */
    #cornerDots{position:absolute; left:10px; bottom:10px; display:flex; gap:6px; pointer-events:none; opacity:.6}
    .dot{width:10px; height:10px; border-radius:50%; border:1px solid var(--hair); background:rgba(233,237,242,.06)}

    #statusLine{
      position:absolute; right:10px; bottom:10px;
      border:1px solid var(--hair);
      background:rgba(0,0,0,.25);
      padding:6px 8px;
      opacity:.75;
      pointer-events:none;
      max-width: 60vw;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
  </style>
</head>
<body>
  <div id="field">
    <canvas id="c"></canvas>
    <div id="lights"></div>
  </div>

  <div class="chrome">
    <div id="frame"></div>

    <div id="hud">
      <div class="bar">
        <div class="title">KETADATA // KITTY CAT</div>
        <div class="meta" id="meta">LIGHT 0 · INVERT 0 · NULL 0</div>
      </div>

      <div class="body">
        <div class="row">
          <div class="pill"><span class="label">HOTKEYS</span> <span class="mini">SHIFT+I INVERT · 1–6 LIGHT · SHIFT+N NULL · SHIFT+F FULLSCREEN · SHIFT+K NOTE · SPACE POUNCE</span></div>
        </div>

        <div class="sep"></div>

        <div class="row">
          <button class="btn" id="btnNote">NOTE</button>
          <button class="btn" id="btnInvert">INVERT</button>
          <button class="btn" id="btnNull">NULL</button>
          <button class="btn" id="btnFull">FULL</button>
          <span class="label">LIGHT</span>
          <input type="range" id="rngLight" min="0" max="6" step="1" value="0" />
          <span class="label">MOTION</span>
          <button class="btn" id="btnMotion">ON</button>
        </div>

        <div class="row">
          <span class="label">SIZE</span>
          <input type="range" id="rngSize" min="60" max="150" step="1" value="105" />
          <span class="label">SPEED</span>
          <input type="range" id="rngSpeed" min="0" max="100" step="1" value="36" />
          <span class="label">TAIL</span>
          <input type="range" id="rngTail" min="0" max="100" step="1" value="70" />
        </div>

        <div class="row">
          <span class="label">TRAIL</span>
          <input type="range" id="rngTrail" min="0" max="100" step="1" value="72" />
          <span class="label">RESEED</span>
          <button class="btn" id="btnSeed">GO</button>
        </div>
      </div>
    </div>

    <div id="note">
      <div class="bar">
        <div>KETA_NOTE</div>
        <div class="mini">SHIFT+K TO TOGGLE</div>
      </div>
      <textarea id="noteText" spellcheck="false" placeholder="KETA_NOTE — optional, movable, non-interfering."></textarea>
    </div>

    <div id="cornerDots" aria-hidden="true">
      <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>

    <div id="statusLine">READY</div>
  </div>

<script>
/* EE: local-first state */
const FILE_ID = "KETADATA_KITTY_CAT_V1";
const LS_KEY = "KETADATA::" + FILE_ID + "::STATE";
const $ = (id)=>document.getElementById(id);

const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const lerp=(a,b,t)=>a+(b-a)*t;

const state = {
  light:0, invert:false, nullMode:false, fullscreen:false, motion:true,
  size:1.05, speed:0.36, tail:0.70, trail:0.72,
  seed:(Math.random()*1e9)>>>0,

  noteOpen:false, notePos:{x:null,y:null}, noteText:""
};

function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);
    if(!s || typeof s!=="object") return;
    Object.assign(state, s);
  }catch(_){}
}
function saveState(){ try{ localStorage.setItem(LS_KEY, JSON.stringify(state)); }catch(_){ } }

function status(t){ $("statusLine").textContent = t; }

function applyState(){
  document.body.classList.toggle("invert", !!state.invert);
  document.body.classList.toggle("nullmode", !!state.nullMode);
  document.documentElement.style.setProperty("--light", String(state.light));
  document.documentElement.style.setProperty("--motion", state.motion ? "1" : "0");

  $("rngLight").value = String(state.light);
  $("rngSize").value = String(Math.round(state.size*100));
  $("rngSpeed").value = String(Math.round(state.speed*100));
  $("rngTail").value = String(Math.round(state.tail*100));
  $("rngTrail").value = String(Math.round(state.trail*100));
  $("btnMotion").textContent = state.motion ? "ON" : "OFF";
  $("meta").textContent = `LIGHT ${state.light} · INVERT ${state.invert?1:0} · NULL ${state.nullMode?1:0}`;

  $("noteText").value = state.noteText || "";
  $("note").classList.toggle("open", !!state.noteOpen);
  if(state.notePos && state.notePos.x!=null && state.notePos.y!=null){
    $("note").style.left = state.notePos.x + "px";
    $("note").style.top = state.notePos.y + "px";
    $("note").style.right = "auto";
  }

  status(`SIZE ${Math.round(state.size*100)} · SPEED ${Math.round(state.speed*100)} · TAIL ${Math.round(state.tail*100)} · SEED ${state.seed}`);
}

/* canvas */
const canvas = $("c");
const ctx = canvas.getContext("2d", { alpha:true });
let W=0,H=0,DPR=1;

function resize(){
  DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  W = Math.floor(window.innerWidth * DPR);
  H = Math.floor(window.innerHeight * DPR);
  canvas.width = W;
  canvas.height = H;
}
addEventListener("resize", resize);

/* deterministic rng */
function mulberry32(a){
  return function(){
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}

/* Kitty: procedural line-cat (minimal, sleek) */
let rng = mulberry32(state.seed);
function reseedRng(){ rng = mulberry32(state.seed); }

const kitty = {
  x: 0.52, y: 0.62,   // normalized
  vx: 0, vy: 0,
  ang: 0,
  target:{x:0.52,y:0.62},
  tNext: 0,
  pounce: 0
};

function pickTarget(){
  kitty.target.x = clamp(0.12 + Math.random()*0.76, 0.06, 0.94);
  kitty.target.y = clamp(0.18 + Math.random()*0.70, 0.10, 0.92);
  kitty.tNext = performance.now() + (700 + Math.random()*1400);
}

function drawCat(cx,cy,scale,ang,t){
  // Cat is mostly angular (mind) + a few circular accents (senses)
  const inv = document.body.classList.contains("invert");
  const stroke = inv ? "rgba(10,12,15,.72)" : "rgba(233,237,242,.72)";
  const hair   = inv ? "rgba(10,12,15,.18)" : "rgba(233,237,242,.18)";
  const fill   = inv ? "rgba(10,12,15,.05)" : "rgba(233,237,242,.05)";

  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(ang);

  const wob = state.motion ? Math.sin(t*0.006 + kitty.pounce*4) * (0.06 + 0.10*state.speed) : 0;
  const s = scale;

  ctx.lineWidth = 2*DPR;
  ctx.strokeStyle = stroke;
  ctx.fillStyle = fill;

  // body capsule-ish (still angular)
  ctx.beginPath();
  ctx.moveTo(-0.35*s, -0.08*s);
  ctx.lineTo( 0.25*s, -0.08*s);
  ctx.lineTo( 0.35*s,  0.00*s);
  ctx.lineTo( 0.25*s,  0.08*s);
  ctx.lineTo(-0.35*s,  0.08*s);
  ctx.closePath();
  ctx.fill();
  ctx.stroke();

  // head (slightly rounded square)
  ctx.lineWidth = 2*DPR;
  ctx.beginPath();
  const hx = 0.40*s, hy = -0.02*s;
  const hr = 0.14*s;
  // rounded square path
  const r = 0.05*s;
  ctx.moveTo(hx-hr+r, hy-hr);
  ctx.lineTo(hx+hr-r, hy-hr);
  ctx.quadraticCurveTo(hx+hr, hy-hr, hx+hr, hy-hr+r);
  ctx.lineTo(hx+hr, hy+hr-r);
  ctx.quadraticCurveTo(hx+hr, hy+hr, hx+hr-r, hy+hr);
  ctx.lineTo(hx-hr+r, hy+hr);
  ctx.quadraticCurveTo(hx-hr, hy+hr, hx-hr, hy+hr-r);
  ctx.lineTo(hx-hr, hy-hr+r);
  ctx.quadraticCurveTo(hx-hr, hy-hr, hx-hr+r, hy-hr);
  ctx.closePath();
  ctx.fill();
  ctx.stroke();

  // ears (triangles)
  ctx.fillStyle = fill;
  ctx.strokeStyle = stroke;
  ctx.beginPath();
  ctx.moveTo(hx-0.10*s, hy-0.16*s);
  ctx.lineTo(hx-0.02*s, hy-0.30*s);
  ctx.lineTo(hx+0.02*s, hy-0.14*s);
  ctx.closePath();
  ctx.fill(); ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(hx+0.10*s, hy-0.16*s);
  ctx.lineTo(hx+0.02*s, hy-0.30*s);
  ctx.lineTo(hx-0.02*s, hy-0.14*s);
  ctx.closePath();
  ctx.fill(); ctx.stroke();

  // eyes (circular senses)
  ctx.fillStyle = hair;
  ctx.beginPath();
  ctx.arc(hx-0.05*s, hy-0.04*s, 0.018*s, 0, Math.PI*2);
  ctx.arc(hx+0.05*s, hy-0.04*s, 0.018*s, 0, Math.PI*2);
  ctx.fill();

  // whiskers (3 lines each)
  ctx.strokeStyle = hair;
  ctx.lineWidth = 1*DPR;
  for(let k=-1;k<=1;k++){
    ctx.beginPath();
    ctx.moveTo(hx-0.02*s, hy+0.02*s + k*0.02*s);
    ctx.lineTo(hx-0.18*s, hy+0.02*s + k*0.02*s + wob*0.02*s);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(hx+0.02*s, hy+0.02*s + k*0.02*s);
    ctx.lineTo(hx+0.18*s, hy+0.02*s + k*0.02*s - wob*0.02*s);
    ctx.stroke();
  }

  // tail (sine spline)
  const tail = state.tail;
  ctx.strokeStyle = stroke;
  ctx.lineWidth = 2*DPR;
  ctx.beginPath();
  const tx0 = -0.36*s, ty0 = 0.02*s;
  ctx.moveTo(tx0, ty0);
  const segs = 18;
  for(let i=1;i<=segs;i++){
    const tt = i/segs;
    const x = tx0 - tt*(0.40 + 0.25*tail)*s;
    const y = ty0 + Math.sin(tt*3.4*Math.PI + t*0.004)* (0.06 + 0.10*tail)*s + wob*0.03*s;
    ctx.lineTo(x,y);
  }
  ctx.stroke();

  // paws (tiny angular marks)
  ctx.strokeStyle = hair;
  ctx.lineWidth = 2*DPR;
  const pawY = 0.10*s;
  const pawX = [-0.18*s, -0.02*s, 0.12*s, 0.28*s];
  for(const px of pawX){
    ctx.beginPath();
    ctx.moveTo(px-0.03*s, pawY);
    ctx.lineTo(px+0.03*s, pawY);
    ctx.stroke();
  }

  ctx.restore();
}

/* render loop */
function step(t){
  const motion = state.motion;

  // trail persistence (higher trail => less clearing)
  const alpha = motion ? (0.26 - 0.20*state.trail) : 1.0;
  ctx.fillStyle = `rgba(0,0,0,${clamp(alpha, 0.03, 1)})`;
  ctx.fillRect(0,0,W,H);

  // subtle scan drift
  ctx.strokeStyle = "rgba(233,237,242,.024)";
  ctx.lineWidth = 1*DPR;
  const grid = 78*DPR;
  const ox = ((t*0.01*DPR) % grid);
  for(let x=ox; x < W; x += grid){
    ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke();
  }

  // movement
  if(t > kitty.tNext) pickTarget();

  const dx = kitty.target.x - kitty.x;
  const dy = kitty.target.y - kitty.y;
  const dist = Math.hypot(dx,dy) + 1e-6;

  const sp = state.speed;
  const accel = 0.0009 + sp*0.0040 + kitty.pounce*0.006;
  const maxV  = 0.0022 + sp*0.013 + kitty.pounce*0.014;

  const wob = 0.0010 * (0.2 + sp);
  kitty.vx += (dx/dist)*accel + Math.sin(t*0.0018)*wob;
  kitty.vy += (dy/dist)*accel + Math.cos(t*0.0012)*wob;

  // damping
  kitty.vx *= 0.985;
  kitty.vy *= 0.985;
  kitty.pounce *= 0.93;

  const vmag = Math.hypot(kitty.vx, kitty.vy);
  if(vmag > maxV){
    kitty.vx = (kitty.vx/vmag)*maxV;
    kitty.vy = (kitty.vy/vmag)*maxV;
  }

  kitty.x = clamp(kitty.x + kitty.vx, 0.06, 0.94);
  kitty.y = clamp(kitty.y + kitty.vy, 0.10, 0.92);

  // orientation follows velocity
  const ang = Math.atan2(kitty.vy, kitty.vx);
  if(isFinite(ang)) kitty.ang = ang;

  // draw kitty
  const cx = kitty.x * W;
  const cy = kitty.y * H;
  const scale = Math.min(W,H) * 0.18 * state.size;

  drawCat(cx, cy, scale, kitty.ang, t);

  // subtle inner frame
  ctx.strokeStyle = "rgba(233,237,242,.06)";
  ctx.lineWidth = 1*DPR;
  ctx.strokeRect(10*DPR, 10*DPR, W-20*DPR, H-20*DPR);

  requestAnimationFrame(step);
}

/* NOTE drag */
(function noteDrag(){
  const el = $("note");
  const bar = el.querySelector(".bar");
  let dragging=false, ox=0, oy=0;

  bar.addEventListener("mousedown",(e)=>{
    dragging=true;
    const r = el.getBoundingClientRect();
    ox = e.clientX - r.left;
    oy = e.clientY - r.top;
    e.preventDefault();
  });
  window.addEventListener("mousemove",(e)=>{
    if(!dragging) return;
    const x = Math.max(10, Math.min(window.innerWidth - 10 - el.offsetWidth, e.clientX - ox));
    const y = Math.max(10, Math.min(window.innerHeight - 10 - el.offsetHeight, e.clientY - oy));
    el.style.left = x + "px";
    el.style.top = y + "px";
    el.style.right = "auto";
    state.notePos = { x, y };
  });
  window.addEventListener("mouseup",()=>{
    if(!dragging) return;
    dragging=false;
    saveState();
  });
})();

/* controls */
function toggleNote(){ state.noteOpen=!state.noteOpen; saveState(); applyState(); }
function toggleInvert(){ state.invert=!state.invert; saveState(); applyState(); }
function toggleNull(){ state.nullMode=!state.nullMode; saveState(); applyState(); }
async function toggleFullscreen(){
  try{
    if(!document.fullscreenElement){ await document.documentElement.requestFullscreen(); state.fullscreen=true; }
    else { await document.exitFullscreen(); state.fullscreen=false; }
  }catch(_){}
  saveState(); applyState();
}
function reseed(){
  state.seed = (Math.random()*1e9)>>>0;
  reseedRng();
  pickTarget();
  saveState(); applyState();
}
function pounce(){
  // SPACE: short burst + new target
  kitty.pounce = 1.0;
  pickTarget();
}

$("btnNote").addEventListener("click", toggleNote);
$("btnInvert").addEventListener("click", toggleInvert);
$("btnNull").addEventListener("click", toggleNull);
$("btnFull").addEventListener("click", toggleFullscreen);
$("btnSeed").addEventListener("click", reseed);

$("rngLight").addEventListener("input",(e)=>{ state.light = parseInt(e.target.value,10)||0; saveState(); applyState(); });
$("btnMotion").addEventListener("click",()=>{ state.motion=!state.motion; saveState(); applyState(); });

$("rngSize").addEventListener("input",(e)=>{ state.size = clamp((parseInt(e.target.value,10)||105)/100, 0.60, 1.50); saveState(); applyState(); });
$("rngSpeed").addEventListener("input",(e)=>{ state.speed = clamp((parseInt(e.target.value,10)||36)/100, 0, 1); saveState(); applyState(); });
$("rngTail").addEventListener("input",(e)=>{ state.tail = clamp((parseInt(e.target.value,10)||70)/100, 0, 1); saveState(); applyState(); });
$("rngTrail").addEventListener("input",(e)=>{ state.trail = clamp((parseInt(e.target.value,10)||72)/100, 0, 1); saveState(); applyState(); });

$("noteText").addEventListener("input",(e)=>{ state.noteText = e.target.value || ""; saveState(); });

/* hotkeys */
function isTypingTarget(t){
  if(!t) return false;
  const tag = (t.tagName||"").toLowerCase();
  return tag==="textarea" || tag==="input" || t.isContentEditable;
}
window.addEventListener("keydown",(e)=>{
  const typing = isTypingTarget(e.target);

  if(e.shiftKey && e.key.toLowerCase()==="i"){ e.preventDefault(); toggleInvert(); return; }
  if(e.shiftKey && e.key.toLowerCase()==="n"){ e.preventDefault(); toggleNull(); return; }
  if(e.shiftKey && e.key.toLowerCase()==="f"){ e.preventDefault(); toggleFullscreen(); return; }
  if(e.shiftKey && e.key.toLowerCase()==="k"){ e.preventDefault(); toggleNote(); return; }

  if(!e.shiftKey && !e.ctrlKey && !e.metaKey){
    const k = e.key;
    if(k>="1" && k<="6"){ state.light = parseInt(k,10); saveState(); applyState(); return; }
    if(k==="0"){ state.light = 0; saveState(); applyState(); return; }
  }

  if(e.code==="Space" && !typing){
    e.preventDefault();
    pounce();
    return;
  }
}, { passive:false });

/* boot */
loadState();
resize();
applyState();
reseedRng();
pickTarget();
requestAnimationFrame(step);
</script>

<!--
AE: VISUAL (PROCEDURAL KITTY CAT, FISHTANK-STYLE CHROME + LIGHTS)
EE: ENGINE (ROAMING TARGET STEER + POUNCE, LOCAL-FIRST STATE, HOTKEYS, NOTE, FULLSCREEN/INVERT/NULL)
WB: WIRING BRIDGE (APPLY STATE TO DOM, CONTROLS)
FILE_ID: "KETADATA_KITTY_CAT_V1"
ROOM_ID: "K_KITTY_CAT"
VERSION: "V1"
UPDATED_AT: "2026-01-06T00:00:00.000-05:00"
CHANGELOG:
- V1: Kitty cat roams the field; SPACE pounces; size/speed/tail/trail controls; fishtank chrome; system lights 1–6; invert/null/fullscreen; local-first persistence.
-->
</body>
</html>
