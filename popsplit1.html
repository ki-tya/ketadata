<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>KETADATA — SPLIT POP (FRICTIONLESS)</title>
  <style>
    :root{
      --bg:#000; --fg:#f2f2f2; --muted:#9a9a9a; --line:#2a2a2a;
      --hud:rgba(255,255,255,0.03);
      --font:12px/1.15 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --r:12px;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:var(--font);overflow:hidden;}
    *{box-sizing:border-box;}
    button,input{font:var(--font);color:var(--fg);}
    input{
      height:28px;width:100%;
      background:rgba(0,0,0,0.28);
      border:1px solid var(--line);
      border-radius:10px;
      padding:6px 8px;
      outline:none;
      min-width:0;
    }
    button{
      height:28px;padding:0 10px;border:1px solid var(--line);
      background:transparent;border-radius:10px;cursor:pointer;
    }
    button:active{transform:translateY(1px);}
    button.on{background:rgba(255,255,255,0.06);}
    .pill{border:1px solid var(--line);border-radius:999px;padding:3px 6px;color:var(--muted);background:rgba(0,0,0,0.14);white-space:nowrap;}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    .sp{flex:1;}
    .sep{height:1px;background:rgba(255,255,255,0.06);margin:8px 0;}
    .card{border:1px solid var(--line);border-radius:var(--r);background:rgba(255,255,255,0.02);padding:8px;}
    .k{color:var(--muted);}
    html.invert #app{filter: invert(1) hue-rotate(180deg);}
    html.null #bar, html.null #panel{display:none;}

    #app{position:fixed;inset:0;padding:10px;display:flex;flex-direction:column;gap:10px;}
    #bar{
      border:1px solid var(--line);border-radius:var(--r);
      background:var(--hud);backdrop-filter: blur(6px);
      padding:8px;user-select:none;
    }
    #panel{flex:1;min-height:0;display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .mini{height:26px;padding:0 8px;border-radius:999px;}
    .danger{border-color:rgba(255,255,255,0.18);}
    .danger:hover{border-color:rgba(255,255,255,0.35);}
    .badge{border:1px solid rgba(255,255,255,0.10);border-radius:999px;padding:3px 6px;color:var(--muted);}
    .tight{gap:6px;}
  </style>
</head>
<body>
<div id="app">
  <div id="bar" class="row">
    <span class="pill">KETADATA SPLIT POP</span>
    <span class="pill">SHIFT+O OPEN+DOCK</span>
    <span class="pill">SHIFT+G GO BOTH</span>
    <span class="pill">SHIFT+1 / SHIFT+2 FOCUS</span>
    <span class="pill">SHIFT+S SWAP</span>
    <span class="pill">SHIFT+I INVERT</span>
    <span class="pill">SHIFT+N NULL</span>
    <span class="pill">SHIFT+F FULL</span>
    <span class="sp"></span>
    <span class="pill" id="filePill"></span>
  </div>

  <div class="card">
    <div class="row tight">
      <button id="openDockBoth" class="on">OPEN+DOCK BOTH</button>
      <button id="goBoth">GO BOTH</button>
      <button id="swap">SWAP</button>
      <button id="focusL" class="mini">FOCUS L</button>
      <button id="focusR" class="mini">FOCUS R</button>
      <button id="closeBoth" class="danger">CLOSE</button>
      <span class="sp"></span>
      <span class="badge" id="stL">L: CLOSED</span>
      <span class="badge" id="stR">R: CLOSED</span>
    </div>
  </div>

  <div id="panel">
    <div class="card">
      <div class="row">
        <span class="k">LEFT URL (ENTER = OPEN/GO)</span>
        <span class="sp"></span>
        <span class="pill">DOCK LEFT</span>
      </div>
      <div class="sep"></div>
      <input id="urlL" spellcheck="false" placeholder="https://chat.openai.com/"/>
      <div class="sep"></div>
      <div class="row tight">
        <button id="openL">OPEN</button>
        <button id="goL">GO</button>
        <button id="dockL">DOCK</button>
        <button id="closeL" class="danger">CLOSE</button>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <span class="k">RIGHT URL (ENTER = OPEN/GO)</span>
        <span class="sp"></span>
        <span class="pill">DOCK RIGHT</span>
      </div>
      <div class="sep"></div>
      <input id="urlR" spellcheck="false" placeholder="https://github.com/"/>
      <div class="sep"></div>
      <div class="row tight">
        <button id="openR">OPEN</button>
        <button id="goR">GO</button>
        <button id="dockR">DOCK</button>
        <button id="closeR" class="danger">CLOSE</button>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const FILE_ID = "KD_SPLIT_POP_FAST_V1";
  const STORE_KEY = "KD_STATE__" + FILE_ID;
  const $ = (id)=>document.getElementById(id);
  $("filePill").textContent = "FILE_ID: " + FILE_ID;

  let winL=null, winR=null;

  const nowISO=()=>new Date().toISOString();
  const defaultState = () => ({
    meta:{ fileId: FILE_ID, updatedAt: nowISO() },
    ui:{ invert:false, nullMode:false },
    panes:{
      L:{ url:"https://chat.openai.com/" },
      R:{ url:"https://github.com/" }
    }
  });

  let state = load();
  const urlL = $("urlL");
  const urlR = $("urlR");
  const stL = $("stL");
  const stR = $("stR");

  urlL.value = state.panes.L.url || "";
  urlR.value = state.panes.R.url || "";

  applyUI();
  tick();

  let saveT=null;
  function scheduleSave(){ if(saveT) clearTimeout(saveT); saveT=setTimeout(save, 180); }
  function save(){ try{ state.meta.updatedAt = nowISO(); localStorage.setItem(STORE_KEY, JSON.stringify(state)); }catch{} }
  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY);
      if(!raw) return defaultState();
      const p = JSON.parse(raw);
      if(!p || typeof p!=="object") return defaultState();
      if(!p.meta) p.meta={};
      if(!p.ui) p.ui={};
      if(!p.panes) p.panes={L:{},R:{}};
      if(!p.panes.L) p.panes.L={};
      if(!p.panes.R) p.panes.R={};
      const d = defaultState();
      p.meta.fileId = FILE_ID;
      p.ui.invert = !!p.ui.invert;
      p.ui.nullMode = !!p.ui.nullMode;
      p.panes.L.url = p.panes.L.url || d.panes.L.url;
      p.panes.R.url = p.panes.R.url || d.panes.R.url;
      return p;
    }catch{ return defaultState(); }
  }

  function applyUI(){
    document.documentElement.classList.toggle("invert", !!state.ui.invert);
    document.documentElement.classList.toggle("null", !!state.ui.nullMode);
    scheduleSave();
  }

  function normUrl(u){
    u = String(u||"").trim();
    if(!u) return "";
    if(!/^https?:\/\//i.test(u) && !/^about:/i.test(u)) u = "https://" + u;
    return u;
  }

  function screenDims(){
    const sw = window.screen.availWidth || window.innerWidth;
    const sh = window.screen.availHeight || window.innerHeight;
    const w = Math.floor(sw * 0.50);
    const h = Math.floor(sh * 0.96);
    return {sw,sh,w,h};
  }

  function openOrGo(side){
    const isL = side==="L";
    const u = normUrl(isL ? urlL.value : urlR.value);
    if(!u) return;

    if(isL) state.panes.L.url = u; else state.panes.R.url = u;
    scheduleSave();

    const {sw, w, h} = screenDims();
    const x = isL ? 0 : Math.max(0, sw - w);
    const y = 0;

    const features = [
      "popup=yes","resizable=yes","scrollbars=yes","toolbar=yes","location=yes",
      "width="+w,"height="+h,"left="+x,"top="+y
    ].join(",");

    const win = (isL ? winL : winR);

    if(win && !win.closed){
      try{ win.location.href = u; win.focus(); }catch{}
      return;
    }

    const opened = window.open(u, "KD_POP_"+side, features);
    if(!opened){
      // popup blocked: you must click OPEN+DOCK BOTH once to grant permission
      return;
    }
    if(isL) winL = opened; else winR = opened;
  }

  function dock(side){
    const isL = side==="L";
    const win = isL ? winL : winR;
    const {sw, w, h} = screenDims();
    const x = isL ? 0 : Math.max(0, sw - w);
    const y = 0;

    if(win && !win.closed){
      try{ win.moveTo(x,y); win.resizeTo(w,h); win.focus(); }catch{}
      return;
    }
    openOrGo(side);
  }

  function openDockBoth(){
    // one gesture -> opens popups and docks them immediately
    openOrGo("L");
    openOrGo("R");
    setTimeout(()=>{ dock("L"); dock("R"); }, 60);
  }

  function goBoth(){
    openOrGo("L");
    openOrGo("R");
  }

  function swap(){
    const a = urlL.value;
    urlL.value = urlR.value;
    urlR.value = a;
    state.panes.L.url = normUrl(urlL.value) || "";
    state.panes.R.url = normUrl(urlR.value) || "";
    scheduleSave();
  }

  function focus(side){
    const win = side==="L" ? winL : winR;
    if(win && !win.closed){ try{ win.focus(); }catch{} }
  }

  function close(side){
    const isL = side==="L";
    const win = isL ? winL : winR;
    if(win && !win.closed){ try{ win.close(); }catch{} }
    if(isL) winL=null; else winR=null;
    tick();
  }

  function tick(){
    stL.textContent = "L: " + ((winL && !winL.closed) ? "OPEN" : "CLOSED");
    stR.textContent = "R: " + ((winR && !winR.closed) ? "OPEN" : "CLOSED");
  }
  setInterval(tick, 600);

  // UI wiring
  $("openDockBoth").onclick = openDockBoth;
  $("goBoth").onclick = goBoth;
  $("swap").onclick = swap;
  $("focusL").onclick = ()=>focus("L");
  $("focusR").onclick = ()=>focus("R");
  $("closeBoth").onclick = ()=>{ close("L"); close("R"); };

  $("openL").onclick = ()=>openOrGo("L");
  $("goL").onclick = ()=>openOrGo("L");
  $("dockL").onclick = ()=>dock("L");
  $("closeL").onclick = ()=>close("L");

  $("openR").onclick = ()=>openOrGo("R");
  $("goR").onclick = ()=>openOrGo("R");
  $("dockR").onclick = ()=>dock("R");
  $("closeR").onclick = ()=>close("R");

  // Enter = open/go (single action, no extra clicks)
  urlL.addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ e.preventDefault(); openOrGo("L"); }});
  urlR.addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ e.preventDefault(); openOrGo("R"); }});

  // keep state current with minimal friction
  urlL.addEventListener("input",()=>{ state.panes.L.url = normUrl(urlL.value) || ""; scheduleSave(); });
  urlR.addEventListener("input",()=>{ state.panes.R.url = normUrl(urlR.value) || ""; scheduleSave(); });

  function toggleFull(){
    if(!document.fullscreenElement) document.documentElement.requestFullscreen?.();
    else document.exitFullscreen?.();
  }

  // Hotkeys: all shift-only, fast, no menus
  window.addEventListener("keydown",(e)=>{
    const tag=(document.activeElement && document.activeElement.tagName || "").toLowerCase();
    const typing=(tag==="input"||tag==="textarea");

    if(e.shiftKey && (e.key==="O"||e.key==="o")){ e.preventDefault(); openDockBoth(); }
    if(e.shiftKey && (e.key==="G"||e.key==="g")){ e.preventDefault(); goBoth(); }
    if(e.shiftKey && (e.key==="S"||e.key==="s")){ e.preventDefault(); swap(); }
    if(!typing && e.shiftKey && e.key==="1"){ e.preventDefault(); focus("L"); }
    if(!typing && e.shiftKey && e.key==="2"){ e.preventDefault(); focus("R"); }

    if(e.shiftKey && (e.key==="I"||e.key==="i")){ e.preventDefault(); state.ui.invert=!state.ui.invert; applyUI(); }
    if(e.shiftKey && (e.key==="N"||e.key==="n")){ e.preventDefault(); state.ui.nullMode=!state.ui.nullMode; applyUI(); }
    if(e.shiftKey && (e.key==="F"||e.key==="f")){ e.preventDefault(); toggleFull(); }
    if(e.key==="Escape" && state.ui.nullMode){ state.ui.nullMode=false; applyUI(); }
  });

  save();
})();
</script>

<!--
AE / EE / WB — KETADATA SERIALIZATION STAMP (MANDATORY)
AE: BLACK DEFAULT • UNIFORM TEXT SIZE • ONE-LINE CONTROL • NO DRAGGABLE UI • INVERT GLOBAL • NULL HIDES CHROME
EE: SINGLE ACTION = ENTER OPENS/GO • OPEN+DOCK BOTH (ONE CLICK) • GO BOTH • SWAP • FOCUS HOTKEYS
WB: LOCAL-FIRST URL + UI TOGGLES

FILE_ID: "KD_SPLIT_POP_FAST_V1"
ROOM_ID: "K_CORE_UTIL"
VERSION_ID: "V1"
UPDATED_AT: "2026-01-04T00:00:00.000-05:00"
CHANGELOG:
- V1: Frictionless popup controller. Enter opens/go. One-click OPEN+DOCK BOTH. Shift hotkeys.
-->
</body>
</html>
