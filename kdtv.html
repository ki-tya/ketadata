<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KDTV // CINEMA</title>
  <style>
    :root{
      --bg:#000;
      --panel:#070707;
      --panel2:#0a0a0a;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.16);
      --text:rgba(255,255,255,.86);
      --muted:rgba(255,255,255,.52);
      --muted2:rgba(255,255,255,.38);
      --shadow: 0 22px 70px rgba(0,0,0,.55);
      --r:10px;         /* slight rounding */
      --r2:12px;
      --gap:12px;
      --red:#ff2a2a;    /* minimal YT nod */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Arial, Helvetica, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x:hidden;
    }

    /* subtle cinematic grain + vignette, very light */
    .fx{
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(60% 55% at 50% 40%, rgba(255,255,255,.05) 0%, rgba(0,0,0,0) 55%),
        radial-gradient(120% 80% at 50% 50%, rgba(0,0,0,.0) 0%, rgba(0,0,0,.85) 70%);
      mix-blend-mode: normal;
      opacity:.9;
    }

    header{
      position:sticky; top:0; z-index:20;
      background: linear-gradient(to bottom, rgba(0,0,0,.92), rgba(0,0,0,.78));
      border-bottom:1px solid var(--line);
      backdrop-filter: blur(10px);
    }
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding: 14px 16px;
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:baseline; gap:10px;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-size:12px;
      color:var(--muted);
      user-select:none;
    }
    .brand strong{
      color:rgba(255,255,255,.88);
      letter-spacing:.24em;
      font-weight:700;
      font-size:12px;
    }
    .brand .slash{opacity:.55}
    .controls{
      display:flex; gap:10px; align-items:center;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
    }
    .search{
      width:min(520px, 48vw);
      display:flex;
      align-items:center;
      border:1px solid var(--line);
      background: rgba(255,255,255,.02);
      border-radius:999px;
      padding:8px 10px;
      gap:8px;
    }
    .search input{
      flex:1;
      border:0;
      outline:0;
      background:transparent;
      color:var(--text);
      font-size:12px;
      letter-spacing:.02em;
    }
    .search .k{
      padding:2px 8px;
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted2);
      font-size:11px;
    }
    .btn{
      cursor:pointer;
      user-select:none;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      letter-spacing:.06em;
      text-transform:uppercase;
    }
    .btn:hover{border-color:var(--line2); color:rgba(255,255,255,.75)}
    .btn:active{transform:translateY(1px)}

    main{
      max-width:1200px;
      margin: 0 auto;
      padding: 18px 16px 46px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .search{width:55vw}
    }
    @media (max-width: 640px){
      .controls{flex-wrap:wrap; justify-content:flex-end}
      .search{width:100%}
    }

    /* sections */
    .section{
      border:1px solid var(--line);
      border-radius: var(--r2);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .section .hd{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      padding: 14px 14px 12px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.35);
    }
    .section .hd .title{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .section .hd h2{
      margin:0;
      font-size:12px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color:rgba(255,255,255,.84);
    }
    .section .hd p{
      margin:0;
      font-size:12px;
      color:var(--muted);
      line-height:1.25;
      max-width: 62ch;
    }

    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .tab{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.02);
      color:var(--muted);
      font-size:11px;
      letter-spacing:.06em;
      text-transform:uppercase;
      cursor:pointer;
    }
    .tab.active{
      color:rgba(255,255,255,.80);
      border-color:var(--line2);
      background: rgba(255,255,255,.04);
    }

    /* cards */
    .cards{
      padding: 14px;
      display:grid;
      gap: 12px;
    }
    .card{
      border:1px solid var(--line);
      border-radius: var(--r);
      background: rgba(0,0,0,.38);
      overflow:hidden;
    }
    .card .row{
      display:grid;
      grid-template-columns: 220px 1fr;
      gap: 12px;
      align-items:stretch;
    }
    @media (max-width: 820px){
      .card .row{grid-template-columns:1fr}
    }

    .thumb{
      position:relative;
      min-height: 132px;
      background: linear-gradient(135deg, rgba(255,255,255,.05), rgba(255,255,255,.01));
      border-right:1px solid var(--line);
    }
    @media (max-width: 820px){
      .thumb{border-right:0; border-bottom:1px solid var(--line)}
    }
    .thumb iframe{
      width:100%;
      height:100%;
      display:block;
      border:0;
      background:#000;
    }
    .meta{
      padding: 12px 12px 12px 0;
      display:flex;
      flex-direction:column;
      gap: 10px;
      min-width:0;
    }
    @media (max-width: 820px){
      .meta{padding:12px}
    }
    .metaTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .meta h3{
      margin:0;
      font-size:13px;
      font-weight:700;
      letter-spacing:.04em;
      color:rgba(255,255,255,.88);
      line-height:1.25;
      min-width:0;
    }
    .meta .sub{
      margin:6px 0 0;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
      max-width: 75ch;
    }

    /* minimal YT nod: a tiny red data bracket */
    .ytbox{
      flex:0 0 auto;
      padding:6px 8px;
      border:1px solid rgba(255,42,42,.85);
      box-shadow: 0 0 0 1px rgba(255,42,42,.08) inset;
      border-radius: 8px;
      background: rgba(255,42,42,.06);
      color: rgba(255,255,255,.78);
      font-size:11px;
      letter-spacing:.08em;
      text-transform:uppercase;
      line-height:1.1;
      min-width: 98px;
      text-align:right;
    }
    .ytbox .k{opacity:.75; display:block; font-size:10px; letter-spacing:.14em}
    .ytbox .v{display:block; margin-top:2px; font-weight:700; letter-spacing:.12em}

    .tags{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .tag{
      border:1px solid var(--line);
      border-radius:999px;
      padding:5px 9px;
      font-size:11px;
      color:var(--muted);
      background: rgba(255,255,255,.02);
      letter-spacing:.05em;
      text-transform:uppercase;
    }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      padding-top:2px;
      border-top:1px solid rgba(255,255,255,.06);
      margin-top:2px;
    }
    .link{
      color:rgba(255,255,255,.72);
      text-decoration:none;
      font-size:12px;
      letter-spacing:.03em;
      border-bottom:1px solid rgba(255,255,255,.14);
      padding-bottom:1px;
    }
    .link:hover{color:rgba(255,255,255,.90); border-bottom-color:rgba(255,255,255,.25)}
    .small{
      color:var(--muted2);
      font-size:11px;
      letter-spacing:.03em;
    }

    /* right rail */
    .rail{
      display:grid;
      gap:16px;
      position:sticky;
      top:72px;
    }
    @media (max-width: 980px){
      .rail{position:static}
    }

    .panel{
      border:1px solid var(--line);
      border-radius: var(--r2);
      background: rgba(255,255,255,.02);
      overflow:hidden;
      box-shadow: var(--shadow);
    }
    .panel .ph{
      padding: 12px 14px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.35);
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
    }
    .panel .ph h3{
      margin:0;
      font-size:12px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color:rgba(255,255,255,.82);
    }
    .panel .ph span{
      font-size:11px;
      color:var(--muted2);
      letter-spacing:.06em;
      text-transform:uppercase;
    }
    .panel .pb{
      padding: 12px 14px 14px;
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
    }
    .list{
      margin:0;
      padding:0;
      list-style:none;
      display:grid;
      gap:8px;
    }
    .list li{
      display:flex;
      gap:10px;
      align-items:flex-start;
      border-top:1px solid rgba(255,255,255,.05);
      padding-top:8px;
    }
    .list li:first-child{border-top:0; padding-top:0}
    .dot{
      width:6px; height:6px;
      border-radius:999px;
      background: rgba(255,255,255,.22);
      margin-top:6px;
      flex:0 0 auto;
    }
    .mono{
      font-family: Arial, Helvetica, sans-serif; /* keep Arial per your rule */
      letter-spacing:.03em;
    }

    .footer{
      margin-top:16px;
      border:1px solid var(--line);
      border-radius: var(--r2);
      background: rgba(255,255,255,.015);
      padding: 14px;
      color:var(--muted2);
      font-size:11px;
      line-height:1.45;
      letter-spacing:.03em;
    }

    /* modal */
    .modal{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background: rgba(0,0,0,.78);
      z-index:50;
      padding:16px;
    }
    .modal.on{display:flex}
    .modal .box{
      width:min(1040px, 100%);
      border:1px solid var(--line2);
      border-radius: 14px;
      background: rgba(5,5,5,.96);
      box-shadow: 0 30px 110px rgba(0,0,0,.75);
      overflow:hidden;
    }
    .modal .mh{
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background: rgba(0,0,0,.45);
    }
    .modal .mh .t{
      font-size:12px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color:rgba(255,255,255,.82);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .modal .mh button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      border-radius:999px;
      padding:8px 10px;
      cursor:pointer;
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .modal .mh button:hover{border-color:var(--line2); color:rgba(255,255,255,.75)}
    .modal .mb{
      aspect-ratio: 16 / 9;
      background:#000;
    }
    .modal iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
    }
  </style>
</head>
<body>
  <div class="fx"></div>

  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="brand" title="KDTV Cinema">
          <strong>KDTV</strong><span class="slash">//</span><span>CINEMA</span>
          <span style="margin-left:10px; opacity:.45;">curated feed + featured lens</span>
        </div>

        <div class="controls">
          <div class="search" title="Search titles/tags (client-side)">
            <span style="opacity:.55; font-size:12px;">⌕</span>
            <input id="q" type="text" placeholder="search: title / tag / channel" />
            <span class="k">/</span>
          </div>
          <button class="btn" id="shuffleBtn" title="Shuffle within current section">shuffle</button>
          <button class="btn" id="exportBtn" title="Export list as JSON">export</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="grid">

      <!-- LEFT: MAIN FEED -->
      <div style="display:grid; gap:16px;">
        <!-- FEATURED -->
        <section class="section" id="featured">
          <div class="hd">
            <div class="title">
              <h2>Featured</h2>
              <p>Primary lens. Fewer items. Higher signal. Designed for intentional viewing rather than infinite scroll.</p>
            </div>
            <div class="tabs" aria-label="Featured filters">
              <div class="tab active" data-filter="all" data-scope="featured">all</div>
              <div class="tab" data-filter="world" data-scope="featured">world</div>
              <div class="tab" data-filter="systems" data-scope="featured">systems</div>
              <div class="tab" data-filter="cinema" data-scope="featured">cinema</div>
            </div>
          </div>
          <div class="cards" id="featuredCards"></div>
        </section>

        <!-- CURATED -->
        <section class="section" id="curated">
          <div class="hd">
            <div class="title">
              <h2>Curated</h2>
              <p>Library layer. More items. Still curated. Queue-first. Nothing autoplayed. No noise by default.</p>
            </div>
            <div class="tabs" aria-label="Curated filters">
              <div class="tab active" data-filter="all" data-scope="curated">all</div>
              <div class="tab" data-filter="music" data-scope="curated">music</div>
              <div class="tab" data-filter="theory" data-scope="curated">theory</div>
              <div class="tab" data-filter="archive" data-scope="curated">archive</div>
            </div>
          </div>
          <div class="cards" id="curatedCards"></div>
        </section>

        <div class="footer">
          KDTV is a lens, not a feed. It should feel deliberate: minimal UI, high fidelity curation, visible metadata, no kitsch finance, no dopamine traps by default.
        </div>
      </div>

      <!-- RIGHT: RAIL -->
      <aside class="rail">
        <div class="panel">
          <div class="ph">
            <h3>Queue</h3>
            <span id="queueCount">0 items</span>
          </div>
          <div class="pb">
            <ul class="list" id="queue"></ul>
            <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
              <button class="btn" id="playQueueBtn">play next</button>
              <button class="btn" id="clearQueueBtn">clear</button>
            </div>
            <div class="small" style="margin-top:10px;">
              Queue is local-only (browser). Nothing forced. You decide the sequence.
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="ph">
            <h3>Values</h3>
            <span>cinema law</span>
          </div>
          <div class="pb">
            <ul class="list">
              <li><span class="dot"></span><span>Finite sections. Intentional pacing. No endless scroll mandate.</span></li>
              <li><span class="dot"></span><span>Metadata visible, minimal. Red box is a quiet nod, not branding theater.</span></li>
              <li><span class="dot"></span><span>Curate by tags, not vibes. Signal stays legible.</span></li>
              <li><span class="dot"></span><span>Playback is a choice (click / queue). No autoplay.</span></li>
            </ul>
          </div>
        </div>

        <div class="panel">
          <div class="ph">
            <h3>Admin</h3>
            <span>edit list</span>
          </div>
          <div class="pb">
            <div class="small" style="margin-bottom:10px;">
              Replace the sample items in the <span class="mono">DATA</span> arrays (top of script). Keep tags terse.
            </div>
            <div class="small">
              Minimal structure: <span class="mono">id, title, channel, tags[], note, yt, dur, year</span>.
            </div>
          </div>
        </div>
      </aside>

    </div>
  </main>

  <!-- Player Modal -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="Video player">
    <div class="box">
      <div class="mh">
        <div class="t" id="modalTitle">PLAYER</div>
        <button id="closeModal">close</button>
      </div>
      <div class="mb">
        <iframe id="modalFrame" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <script>
    // -----------------------------
    // DATA (replace with your list)
    // -----------------------------
    const FEATURED = [
      {
        id:"f1",
        title:"World-view signal → pattern extraction",
        channel:"KDTV",
        tags:["world","systems"],
        note:"Abstract world signals into readable patterns. No punditry.",
        yt:"dQw4w9WgXcQ",
        dur:"12:08",
        year:"2025"
      },
      {
        id:"f2",
        title:"Cinema as interface: the lens layer",
        channel:"KDTV",
        tags:["cinema","theory"],
        note:"How the viewing surface shapes meaning, attention, memory.",
        yt:"M7lc1UVf-VE",
        dur:"18:42",
        year:"2024"
      },
      {
        id:"f3",
        title:"Systems thinking for cultural debris",
        channel:"KDTV",
        tags:["systems","world"],
        note:"Structure without kitsch. Clean instrumentation.",
        yt:"ysz5S6PUM-U",
        dur:"09:55",
        year:"2023"
      }
    ];

    const CURATED = [
      {
        id:"c1",
        title:"Archive pull: strange internet artifacts",
        channel:"KDTV",
        tags:["archive","theory"],
        note:"Curated fragments. Context minimal, interpretation open.",
        yt:"aqz-KE-bpKQ",
        dur:"31:10",
        year:"2022"
      },
      {
        id:"c2",
        title:"Music / rhythm / structure (study)",
        channel:"KDTV",
        tags:["music"],
        note:"Use to calibrate pacing + editing instincts.",
        yt:"hTWKbfoikeg",
        dur:"04:39",
        year:"1991"
      },
      {
        id:"c3",
        title:"Media theory primer (clean cut)",
        channel:"KDTV",
        tags:["theory"],
        note:"Concepts as tools. No sermon.",
        yt:"E7wJTI-1dvQ",
        dur:"22:05",
        year:"2020"
      }
    ];

    // -----------------------------
    // RENDER
    // -----------------------------
    const elFeatured = document.getElementById('featuredCards');
    const elCurated  = document.getElementById('curatedCards');
    const qInput     = document.getElementById('q');

    const queueEl = document.getElementById('queue');
    const queueCountEl = document.getElementById('queueCount');
    let QUEUE = [];

    const modal = document.getElementById('modal');
    const modalFrame = document.getElementById('modalFrame');
    const modalTitle = document.getElementById('modalTitle');

    function ytSrc(id){
      return `https://www.youtube.com/embed/${id}?rel=0&modestbranding=1&controls=1&iv_load_policy=3`;
    }

    function cardHTML(item){
      const dataBox = `
        <div class="ytbox" title="minimal YT nod: red data bracket">
          <span class="k">YT DATA</span>
          <span class="v">${item.dur || "—"} · ${item.year || "—"}</span>
        </div>
      `;

      const tags = (item.tags||[]).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join('');

      return `
        <div class="card" data-id="${escapeAttr(item.id)}" data-tags="${escapeAttr((item.tags||[]).join(' '))}" data-title="${escapeAttr(item.title)}" data-channel="${escapeAttr(item.channel||'')}">
          <div class="row">
            <div class="thumb">
              <iframe loading="lazy" src="${ytSrc(item.yt)}" title="${escapeAttr(item.title)}"></iframe>
            </div>
            <div class="meta">
              <div class="metaTop">
                <div style="min-width:0;">
                  <h3>${escapeHtml(item.title)}</h3>
                  <div class="small" style="margin-top:6px;">${escapeHtml(item.channel || "—")}</div>
                </div>
                ${dataBox}
              </div>

              <div class="sub">${escapeHtml(item.note || "")}</div>

              <div class="tags">${tags}</div>

              <div class="actions">
                <a class="link" href="https://www.youtube.com/watch?v=${encodeURIComponent(item.yt)}" target="_blank" rel="noreferrer">open on youtube</a>
                <span class="small">·</span>
                <a class="link" href="#" data-action="play" data-yt="${escapeAttr(item.yt)}" data-title="${escapeAttr(item.title)}">play here</a>
                <span class="small">·</span>
                <a class="link" href="#" data-action="queue" data-id="${escapeAttr(item.id)}">add to queue</a>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function render(){
      elFeatured.innerHTML = FEATURED.map(cardHTML).join('');
      elCurated.innerHTML  = CURATED.map(cardHTML).join('');
      bindCardActions();
      applyFilters();
    }

    function bindCardActions(){
      document.querySelectorAll('[data-action="play"]').forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          openModal(e.currentTarget.dataset.yt, e.currentTarget.dataset.title);
        });
      });

      document.querySelectorAll('[data-action="queue"]').forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          const id = e.currentTarget.dataset.id;
          const item = [...FEATURED, ...CURATED].find(x=>x.id===id);
          if(!item) return;
          QUEUE.push(item);
          renderQueue();
        });
      });
    }

    function renderQueue(){
      queueEl.innerHTML = QUEUE.map((it, idx)=>`
        <li>
          <span class="dot"></span>
          <div style="min-width:0;">
            <div style="color:rgba(255,255,255,.78); font-size:12px; letter-spacing:.02em; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
              ${escapeHtml(it.title)}
            </div>
            <div class="small">${escapeHtml(it.channel||"—")} · ${escapeHtml(it.dur||"—")}</div>
            <div style="margin-top:6px; display:flex; gap:10px; flex-wrap:wrap;">
              <a class="link" href="#" data-qplay="${idx}">play</a>
              <a class="link" href="#" data-qrm="${idx}">remove</a>
            </div>
          </div>
        </li>
      `).join('');

      queueCountEl.textContent = `${QUEUE.length} item${QUEUE.length===1?'':'s'}`;

      queueEl.querySelectorAll('[data-qplay]').forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          const idx = Number(e.currentTarget.dataset.qplay);
          const it = QUEUE[idx];
          if(it) openModal(it.yt, it.title);
        });
      });

      queueEl.querySelectorAll('[data-qrm]').forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          const idx = Number(e.currentTarget.dataset.qrm);
          QUEUE.splice(idx, 1);
          renderQueue();
        });
      });
    }

    function openModal(ytId, title){
      modalTitle.textContent = title || 'PLAYER';
      modalFrame.src = ytSrc(ytId) + '&autoplay=1';
      modal.classList.add('on');
    }
    function closeModal(){
      modal.classList.remove('on');
      modalFrame.src = '';
    }

    document.getElementById('closeModal').addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

    // -----------------------------
    // FILTERS + SEARCH
    // -----------------------------
    const tabs = document.querySelectorAll('.tab');
    const activeFilters = { featured:'all', curated:'all' };

    tabs.forEach(t=>{
      t.addEventListener('click', ()=>{
        const scope = t.dataset.scope;
        const filter = t.dataset.filter;

        document.querySelectorAll(`.tab[data-scope="${scope}"]`).forEach(x=>x.classList.remove('active'));
        t.classList.add('active');

        activeFilters[scope] = filter;
        applyFilters();
      });
    });

    function applyFilters(){
      const q = (qInput.value || '').trim().toLowerCase();

      filterScope('featured', elFeatured, activeFilters.featured, q);
      filterScope('curated',  elCurated,  activeFilters.curated,  q);
    }

    function filterScope(scope, rootEl, tag, q){
      const cards = rootEl.querySelectorAll('.card');
      cards.forEach(card=>{
        const tags = (card.dataset.tags || '').toLowerCase();
        const title = (card.dataset.title || '').toLowerCase();
        const channel = (card.dataset.channel || '').toLowerCase();

        const tagOK = (tag === 'all') ? true : tags.includes(tag);
        const qOK = (!q) ? true : (title.includes(q) || tags.includes(q) || channel.includes(q));

        card.style.display = (tagOK && qOK) ? '' : 'none';
      });
    }

    qInput.addEventListener('input', applyFilters);

    // -----------------------------
    // SHUFFLE + EXPORT
    // -----------------------------
    document.getElementById('shuffleBtn').addEventListener('click', ()=>{
      // shuffle within both lists, preserving separation
      shuffleInPlace(FEATURED);
      shuffleInPlace(CURATED);
      render();
    });

    document.getElementById('clearQueueBtn').addEventListener('click', ()=>{
      QUEUE = [];
      renderQueue();
    });

    document.getElementById('playQueueBtn').addEventListener('click', ()=>{
      const it = QUEUE.shift();
      renderQueue();
      if(it) openModal(it.yt, it.title);
    });

    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const payload = {
        exported_at: new Date().toISOString(),
        featured: FEATURED,
        curated: CURATED,
        queue: QUEUE
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'kdtv_cinema_export.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(a.href);
    });

    function shuffleInPlace(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    // -----------------------------
    // Small utilities
    // -----------------------------
    function escapeHtml(s){
      return String(s ?? '').replace(/[&<>"']/g, c=>({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[c]));
    }
    function escapeAttr(s){
      return escapeHtml(s).replace(/`/g,'&#96;');
    }

    // init
    render();
    renderQueue();

    // focus search with "/"
    window.addEventListener('keydown', (e)=>{
      if(e.key === '/' && document.activeElement !== qInput){
        e.preventDefault();
        qInput.focus();
      }
    });
  </script>
</body>
</html>
