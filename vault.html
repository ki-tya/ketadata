<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>KETADATA // LIBRARY</title>

  <style>
    :root{
      --bg:#000;
      --fg:#fff;

      --inkA: rgba(255,255,255,.86);
      --inkB: rgba(255,255,255,.62);
      --inkC: rgba(255,255,255,.42);

      --hair: rgba(255,255,255,.14);
      --hair2: rgba(255,255,255,.09);
      --panel: rgba(0,0,0,.30);
      --panel2: rgba(0,0,0,.42);

      --grid: rgba(255,255,255,.06);

      --ui: Arial, Helvetica, sans-serif;

      --pad: 14px;
      --topH: 38px;
      --botH: 26px;

      --colsLeft: 62vw;
      --colsRight: 38vw;

      --noteW: 420px;
      --noteH: 220px;

      /* library has NO red; everything white/grey */
      --accent:#fff;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font-family:var(--ui);
      overflow:hidden;
    }

    /* ===== AE: field + grid ===== */
    #field{
      position:fixed; inset:0;
      z-index:0;
      background:
        radial-gradient(1100px 680px at 22% 18%, rgba(255,255,255,.05), transparent 70%),
        radial-gradient(1100px 680px at 78% 72%, rgba(255,255,255,.05), transparent 72%),
        linear-gradient(180deg, #000, #030303 55%, #000);
      filter: saturate(1);
    }
    #field::after{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(var(--grid) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid) 1px, transparent 1px);
      background-size: 52px 52px;
      opacity:.95;
      pointer-events:none;
      mix-blend-mode: overlay;
    }

    /* ===== AE: lights behind the interface ===== */
    #lights{
      position:fixed; inset:0;
      z-index:1;
      pointer-events:none;
      opacity:0;
    }
    #lights.on{ opacity:1; }
    #lights::before{
      content:"";
      position:absolute; inset:-20%;
      background: radial-gradient(closest-side at 50% 50%, rgba(255,255,255,.16), transparent 70%);
      transform: rotate(8deg);
      opacity:.55;
    }
    @keyframes strobe1 { 0%,49%{opacity:0} 50%,100%{opacity:1} }
    @keyframes strobe2 { 0%,24%{opacity:0} 25%,49%{opacity:1} 50%,74%{opacity:0} 75%,100%{opacity:1} }
    @keyframes strobe3 { 0%,14%{opacity:0} 15%,29%{opacity:1} 30%,44%{opacity:0} 45%,59%{opacity:1} 60%,74%{opacity:0} 75%,100%{opacity:1} }
    @keyframes strobe4 { 0%,9%{opacity:0} 10%,19%{opacity:1} 20%,29%{opacity:0} 30%,39%{opacity:1} 40%,49%{opacity:0} 50%,59%{opacity:1} 60%,69%{opacity:0} 70%,79%{opacity:1} 80%,89%{opacity:0} 90%,100%{opacity:1} }
    @keyframes strobe5 { 0%,7%{opacity:0} 8%,15%{opacity:1} 16%,23%{opacity:0} 24%,31%{opacity:1} 32%,39%{opacity:0} 40%,47%{opacity:1} 48%,55%{opacity:0} 56%,63%{opacity:1} 64%,71%{opacity:0} 72%,79%{opacity:1} 80%,87%{opacity:0} 88%,95%{opacity:1} 96%,100%{opacity:0} }
    @keyframes strobe6 { 0%,3%{opacity:0} 4%,7%{opacity:1} 8%,11%{opacity:0} 12%,15%{opacity:1} 16%,19%{opacity:0} 20%,23%{opacity:1} 24%,27%{opacity:0} 28%,31%{opacity:1} 32%,35%{opacity:0} 36%,39%{opacity:1} 40%,43%{opacity:0} 44%,47%{opacity:1} 48%,51%{opacity:0} 52%,55%{opacity:1} 56%,59%{opacity:0} 60%,63%{opacity:1} 64%,67%{opacity:0} 68%,71%{opacity:1} 72%,75%{opacity:0} 76%,79%{opacity:1} 80%,83%{opacity:0} 84%,87%{opacity:1} 88%,91%{opacity:0} 92%,95%{opacity:1} 96%,100%{opacity:0} }

    /* ===== WB: system bars ===== */
    .topbar{
      position:fixed; left:0; right:0; top:0;
      z-index:40;
      height:var(--topH);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 12px;
      border-bottom:1px solid var(--hair);
      background: rgba(0,0,0,.26);
      backdrop-filter: blur(6px);
      user-select:none;
    }
    .brandMini{
      display:flex; align-items:center; gap:10px;
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: rgba(255,255,255,.85);
    }

    /* Global KETA_NOTE icon (anchor) */
    .noteIcon{
      width:12px; height:12px;
      display:inline-block;
      border:1px solid #fff;
      background: #fff; /* default: note collapsed = filled */
      cursor:pointer;
    }
    .noteIcon.outlined{
      background: transparent; /* note open = outline only */
    }

    .topRight{
      display:flex; align-items:center; gap:10px;
    }
    .btn{
      font-family:var(--ui);
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: rgba(255,255,255,.82);
      background: rgba(0,0,0,.22);
      border:1px solid var(--hair);
      padding:6px 10px;
      cursor:pointer;
    }
    .btn:hover{ border-color: rgba(255,255,255,.28); color:#fff; }
    .btn:active{ transform: translateY(1px); }

    .footer{
      position:fixed; left:0; right:0; bottom:0;
      z-index:40;
      height:var(--botH);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 10px;
      border-top:1px solid var(--hair);
      background: rgba(0,0,0,.26);
      backdrop-filter: blur(6px);
      font-size:10px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color: rgba(255,255,255,.70);
      user-select:none;
    }
    .footer b{ color:#fff; font-weight:900; }
    .muted{ color: rgba(255,255,255,.55); }

    /* ===== layout ===== */
    .wrap{
      position:fixed; inset:0;
      z-index:10;
      padding-top: var(--topH);
      padding-bottom: var(--botH);
    }
    .grid{
      height:100%;
      display:grid;
      grid-template-columns: var(--colsLeft) var(--colsRight);
      gap: 0;
    }

    /* left: search + tag filters + cards */
    .left{
      border-right:1px solid var(--hair2);
      display:flex;
      flex-direction:column;
      min-width: 420px;
    }
    .searchBlock{
      padding: var(--pad);
      border-bottom:1px solid var(--hair2);
      background: rgba(0,0,0,.18);
    }
    .searchRow{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .searchRow input{
      width:100%;
      background: rgba(0,0,0,.40);
      border:1px solid var(--hair);
      color:#fff;
      font-family:var(--ui);
      font-size:12px;
      letter-spacing:.10em;
      padding:10px 10px;
      outline:none;
    }
    .searchRow input:focus{ border-color: rgba(255,255,255,.35); }

    .tagRow{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .tag{
      padding:6px 10px;
      border:1px solid var(--hair);
      background: rgba(0,0,0,.30);
      color: rgba(255,255,255,.70);
      font-size:10px;
      letter-spacing:.18em;
      text-transform:uppercase;
      cursor:pointer;
      user-select:none;
    }
    .tag:hover{ border-color: rgba(255,255,255,.28); color:#fff; }
    .tag.active{
      background:#fff;
      color:#000;
      border-color:#fff;
    }

    .list{
      flex:1;
      overflow:auto;
      padding: var(--pad);
    }
    .cards{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 12px;
    }
    .card{
      border:1px solid var(--hair);
      background: rgba(0,0,0,.28);
      padding: 12px 12px 10px 12px;
      cursor:pointer;
      transition: transform .10s linear, border-color .10s linear;
    }
    .card:hover{
      border-color: rgba(255,255,255,.30);
      transform: translateY(-1px);
    }
    .card.selected{
      border-color:#fff;
      background: rgba(255,255,255,.06);
    }
    .title{
      font-size: 12.5px;
      letter-spacing:.06em;
      font-weight:900;
      text-transform:uppercase;
      color: rgba(255,255,255,.92);
      line-height:1.35;
    }
    .meta{
      margin-top:8px;
      font-size:11px;
      letter-spacing:.08em;
      color: rgba(255,255,255,.56);
      line-height:1.45;
    }
    .tagMini{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .pill{
      border:1px solid var(--hair2);
      padding:3px 7px;
      font-size:9px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color: rgba(255,255,255,.55);
      background: rgba(0,0,0,.26);
    }

    /* right: document overview */
    .right{
      display:flex;
      flex-direction:column;
      min-width: 360px;
    }
    .docHead{
      padding: var(--pad);
      border-bottom:1px solid var(--hair2);
      background: rgba(0,0,0,.18);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }
    .docTitle{
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.14em;
      font-size: 12px;
      line-height:1.25;
      color: rgba(255,255,255,.92);
    }
    .docSub{
      margin-top:8px;
      font-size:11px;
      letter-spacing:.08em;
      color: rgba(255,255,255,.58);
      line-height:1.45;
    }
    .docBody{
      flex:1;
      overflow:auto;
      padding: var(--pad);
    }
    .block{
      border:1px solid var(--hair);
      background: rgba(0,0,0,.28);
      padding: 12px;
      margin-bottom: 12px;
    }
    .block h3{
      margin:0 0 10px 0;
      font-size:10px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color: rgba(255,255,255,.78);
      font-weight:900;
      padding-bottom:8px;
      border-bottom:1px solid var(--hair2);
    }
    .block p{
      margin:0;
      font-size:12px;
      color: rgba(255,255,255,.62);
      line-height:1.55;
      letter-spacing:.02em;
    }
    .kv{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap: 8px 12px;
      font-size: 11px;
      letter-spacing:.08em;
      color: rgba(255,255,255,.62);
    }
    .kv div:nth-child(odd){
      color: rgba(255,255,255,.50);
      text-transform:uppercase;
      letter-spacing:.18em;
      font-size:10px;
    }

    .emptyState{
      border:1px dashed var(--hair);
      background: rgba(0,0,0,.22);
      padding: 14px;
      color: rgba(255,255,255,.60);
      letter-spacing:.10em;
      font-size:12px;
      line-height:1.55;
    }

    /* ===== KETA_NOTE panel (draggable, collapsible to icon) ===== */
    #note{
      position:fixed;
      top: 64px;
      left: 16px;
      z-index:45;
      width: min(var(--noteW), 92vw);
      height: var(--noteH);
      border:1px solid var(--hair);
      background: rgba(0,0,0,.34);
      backdrop-filter: blur(8px);
      display:none; /* default collapsed */
      box-shadow: 0 22px 80px rgba(0,0,0,.55);
    }
    #note.open{ display:block; }
    #noteHead{
      height: 34px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 0 10px;
      border-bottom:1px solid var(--hair2);
      cursor:move;
      user-select:none;
    }
    #noteHead .label{
      font-size:11px;
      letter-spacing:.22em;
      text-transform:uppercase;
      font-weight:900;
      color: rgba(255,255,255,.86);
    }
    #noteHead .mini{
      display:flex; gap:8px; align-items:center;
    }
    .miniBtn{
      width: 26px;
      height: 22px;
      display:flex;
      align-items:center;
      justify-content:center;
      border:1px solid var(--hair);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.85);
      cursor:pointer;
      font-weight:900;
      user-select:none;
    }
    .miniBtn:hover{ border-color: rgba(255,255,255,.28); color:#fff; }
    #noteArea{
      width:100%;
      height: calc(100% - 34px);
      border:0;
      resize:none;
      outline:none;
      padding: 10px 10px;
      background: transparent;
      color:#fff;
      font-family: var(--ui);
      font-size: 12px;
      letter-spacing:.06em;
      line-height:1.45;
    }

    /* ===== null mode: hide system chrome + note ONLY (content remains) ===== */
    body.null .topbar,
    body.null .footer,
    body.null #note{
      display:none !important;
    }

    /* ===== invert ===== */
    body.invert{
      filter: invert(1) hue-rotate(180deg);
    }

    /* scrollbars minimal */
    .list::-webkit-scrollbar,
    .docBody::-webkit-scrollbar{
      width: 10px;
    }
    .list::-webkit-scrollbar-thumb,
    .docBody::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.10);
    }
  </style>
</head>

<body>
  <div id="field" aria-hidden="true"></div>
  <div id="lights" aria-hidden="true"></div>

  <!-- WB: system chrome -->
  <div class="topbar" id="topbar">
    <div class="brandMini">
      <span style="display:inline-block;width:10px;height:10px;border:1px solid #fff;"></span>
      <span>KETADATA // LIBRARY</span>
    </div>
    <div class="topRight">
      <button class="btn" id="goSystem">SYSTEM</button>
      <span class="noteIcon" id="ketaNoteIcon" title="KETA_NOTE" aria-label="KETA_NOTE"></span>
      <button class="btn" id="goHome">HOME</button>
      <button class="btn" id="goLanding">LAND</button>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <div class="left">
        <div class="searchBlock">
          <div class="searchRow">
            <input id="searchInput" type="text" spellcheck="false" autocomplete="off"
              placeholder="SEARCH: TITLE / AUTHOR / TAG" />
          </div>
          <div class="tagRow" id="tagRow"></div>
        </div>
        <div class="list">
          <div class="cards" id="cards"></div>
          <div class="emptyState" id="noResults" style="display:none; margin-top:12px;">
            NO MATCHES. CLEAR FILTERS OR BROADEN SEARCH.
          </div>
        </div>
      </div>

      <div class="right">
        <div class="docHead">
          <div>
            <div class="docTitle" id="docTitle">NO SELECTION</div>
            <div class="docSub" id="docSub">SELECT A MODULE TO EXPAND A DOCUMENT OVERVIEW.</div>
          </div>
          <div style="display:flex; gap:10px; align-items:center;">
            <button class="btn" id="clearSelection">CLEAR</button>
          </div>
        </div>
        <div class="docBody" id="docBody">
          <div class="emptyState">
            THIS IS A LIBRARY INDEX, NOT A CHECKOUT PIPELINE. CLICK A CARD TO OPEN AN OVERVIEW PANEL.
            WE WILL FILL THE CONTENT LATER.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- KETA_NOTE (collapses into global icon; draggable always) -->
  <div id="note" aria-label="KETA_NOTE">
    <div id="noteHead">
      <div class="label">KETA_NOTE</div>
      <div class="mini">
        <div class="miniBtn" id="noteCollapse" title="collapse">–</div>
      </div>
    </div>
    <textarea id="noteArea" placeholder="KETA_NOTE (GLOBAL)"></textarea>
  </div>

  <div class="footer" id="footer">
    <div>
      <span class="muted">NULL:</span> <b id="nullStatus">OFF</b> ·
      <span class="muted">INVERT:</span> <b id="invStatus">OFF</b> ·
      <span class="muted">LIGHT:</span> <b id="lightStatus">0</b>
    </div>
    <div>
      <span class="muted">LIBRARY MODE:</span> <b>OVERVIEW</b>
    </div>
  </div>

  <script>
    /* =========================================================
       CONTINUITY LINKS
       - You said shell is in system.html
       - Landing page is index11.html
    ========================================================= */
    const SHELL_HOME_URL = "system.html";
    const LANDING_URL = "index11.html";

    /* =========================================================
       GLOBAL KETA_NOTE SYNC
       Problem observed: pages not sharing the same note content.
       Fix: read from multiple likely keys; write to all of them.
    ========================================================= */
    const NOTE_KEYS = [
      "KETADATA_GLOBAL_KETA_NOTE_V1",
      "KETADATA_GLOBAL_KETA_NOTE",
      "KETA_NOTE",
      "SHELL8_KETA_NOTE",
      "KETADATA_SHELL8_KETA_NOTE"
    ];

    function readGlobalNote(){
      for(const k of NOTE_KEYS){
        const v = localStorage.getItem(k);
        if(v && v.trim().length) return v;
      }
      return "";
    }
    function writeGlobalNote(v){
      for(const k of NOTE_KEYS){
        localStorage.setItem(k, v);
      }
    }

    /* =========================================================
       DATA (your existing list preserved from the prior library)
       NOTE: no checkout/cart logic; selection only.
       Source originated from your existing library HTML. :contentReference[oaicite:0]{index=0}
    ========================================================= */
    const library = [
            // 2024 READING LIST
            { title: "Vile Bodies", author: "Evelyn Waugh", year: "1930", tags: ["current-reading", "priority", "fiction"] },
            { title: "Film Theory and Criticism", author: "Leo Braudy, Marshall Cohen", year: "2009", tags: ["current-reading", "priority", "film-studies"] },
            { title: "A Genealogy of Nihilism", author: "Michael Allen Gillespie", year: "2002", tags: ["current-reading", "priority", "philosophy"] },
            { title: "Phenomenology of Spirit", author: "G.W.F. Hegel", year: "2018", tags: ["current-reading", "priority", "philosophy"] },
            { title: "Trainspotting", author: "Irvine Welsh", year: "1993", tags: ["current-reading", "priority", "fiction"] },
            { title: "Über Coca", author: "Sigmund Freud", year: "1984", tags: ["current-reading", "priority", "drugs"] },
            { title: "Writing on Drugs", author: "Sadie Plant", year: "1999", tags: ["current-reading", "priority", "drugs"] },

            // AESTHETICS
            { title: "Double Standards of Aesthetic Capital", author: "Outi Sarpila", year: "2020", tags: ["theory", "visual-culture", "aesthetics"] },
            { title: "Sappho and Aesthetic Relativity", author: "Ernst Zellner", year: "2007", tags: ["theory", "aesthetics"] },
            { title: "The Hegemonic Aesthetic", author: "Filiault & Drummond", year: "2007", tags: ["theory", "aesthetics"] },
            { title: "Aesthetic Injustice", author: "Gustavo Dalaqua", year: "2020", tags: ["theory", "aesthetics"] },
            { title: "Aesthetic Disinterestedness", author: "Norman Kreitman", year: "2006", tags: ["theory", "aesthetics"] },
            { title: "Art and Money", author: "Max Haiven", year: "2015", tags: ["art-theory", "aesthetics"] },
            { title: "Schopenhauer on Aesthetics", author: "Sandra Shapshay", year: "2012", tags: ["philosophy", "aesthetics"] },
            { title: "Fashion and GLBTQ", author: "Shaun Cole", year: "2015", tags: ["fashion", "queer-theory"] },
            { title: "Components of Aesthetic Experience", author: "Slobodan Markovic", year: "2012", tags: ["theory", "aesthetics"] },
            { title: "Fashion Figures Thesis", author: "Paul Jobling", year: "1998", tags: ["fashion", "theory"] },

            // AFFECTIVE POLITICS
            { title: "Affective Politics in Digital Media", author: "Boler & Davis", year: "2021", tags: ["politics", "affect-theory", "digital-culture"] },
            { title: "Infinitely Demanding", author: "Simon Critchley", year: "2007", tags: ["politics", "philosophy"] },

            // ART
            { title: "Art and Homosexuality", author: "James Smalls Reed", year: "2011", tags: ["art-history", "queer-theory"] },
            { title: "Art Since 1900", author: "Foster et al", year: "", tags: ["art-history", "contemporary-art"] },
            { title: "The Artist's Way", author: "Julia Cameron", year: "1992", tags: ["art-theory", "self-help"] },
            { title: "Complete Etchings", author: "Francisco Goya", year: "1964", tags: ["art-history"] },
            { title: "Jackson Pollock: Representing the Unconscious", author: "Michael Leja", year: "1990", tags: ["art-history"] },
            { title: "Preserving Media Art", author: "Sanneke Huisman", year: "2013", tags: ["contemporary-art", "media-theory"] },
            { title: "SCUM Manifesto", author: "Valerie Solanas", year: "1967", tags: ["feminism", "avant-garde"] },
            { title: "Financialization of Art", author: "Noah Horowitz", year: "2011", tags: ["art-theory", "capitalism"] },
            { title: "A Thing Like You And Me", author: "Hito Steyerl", year: "2010", tags: ["contemporary-art", "theory"] },
            { title: "Dada Manifesto", author: "Tristan Tzara", year: "1918", tags: ["avant-garde", "manifestos"] },

            // BLOCKCHAIN & CRYPTO
            { title: "Blockchain Manufacturing", author: "Westerkamp", year: "2020", tags: ["blockchain", "tech"] },
            { title: "Privacy Laws, Genomic Data, and NFTs", author: "Uribe & Waters", year: "2020", tags: ["blockchain", "nft", "privacy"] },
            { title: "Architecture for Blockchain Applications", author: "Xu, Weber, Staples", year: "2019", tags: ["blockchain", "tech"] },
            { title: "FTX Ponzi Report", author: "LeClair & Rule", year: "2022", tags: ["cryptocurrency", "fintech"] },
            { title: "Blockchain Startups and Prospectus Regulation", author: "Boreiko, Ferrarini, Giudici", year: "2019", tags: ["blockchain", "fintech"] },
            { title: "Crypto Anarchist Manifesto", author: "Timothy C. May", year: "1992", tags: ["cryptocurrency", "anarchism"] },
            { title: "Blind Signatures for Untraceable Payments", author: "David Chaum", year: "1983", tags: ["cryptocurrency", "cryptography"] },
            { title: "Security Without Identification", author: "David Chaum", year: "1985", tags: ["cryptocurrency", "privacy"] },
            { title: "Contemporary Art, Capitalization, and Blockchain", author: "Laura Lotti", year: "2016", tags: ["blockchain", "art-theory", "nft"] },
            { title: "Decentralised Internet of Things", author: "Khan et al", year: "2023", tags: ["blockchain", "tech"] },
            { title: "Deploying Metadata on Blockchain", author: "Garcia & Sicilia", year: "2017", tags: ["blockchain", "tech"] },
            { title: "Digital Art as Monetised Graphics", author: "Martin Zeilinger", year: "2016", tags: ["nft", "art-theory"] },
            { title: "Hashcash: Denial of Service", author: "Adam Back", year: "2002", tags: ["cryptocurrency", "cryptography"] },
            { title: "Hyperreal Finance", author: "Elton G. McGoun", year: "1997", tags: ["fintech", "philosophy"] },
            { title: "Protocols for Public Key Cryptosystems", author: "Ralph Merkle", year: "1980", tags: ["cryptography"] },
            { title: "How to Share a Secret", author: "Adi Shamir", year: "1979", tags: ["cryptography"] },
            { title: "Cryptocurrencies and Blockchains", author: "Quinn DuPont", year: "2019", tags: ["cryptocurrency", "blockchain"] },
            { title: "The Age of Cryptocurrency", author: "Vigna & Casey", year: "2015", tags: ["cryptocurrency"] },

            // CYBERNETICS
            { title: "Object-Oriented Thought Process", author: "Matt Weisfeld", year: "2013", tags: ["programming", "cybernetics"] },
            { title: "OOP: Learn Object Oriented Thinking", author: "Rudolf Pecinovsky", year: "2013", tags: ["programming", "cybernetics"] },
            { title: "Cybernetics", author: "Norbert Wiener", year: "1948", tags: ["cybernetics", "systems-theory"] },
            { title: "The Human Use of Human Beings", author: "Norbert Wiener", year: "1950", tags: ["cybernetics", "philosophy"] },
            { title: "The Dissensus Protocol", author: "Brekke et al", year: "2021", tags: ["cybernetics", "blockchain"] },
            { title: "Programming and Metaprogramming the Human Biocomputer", author: "John C. Lilly", year: "1972", tags: ["cybernetics", "consciousness"] },
            { title: "The Cybernetic Brain", author: "Andrew Pickering", year: "2010", tags: ["cybernetics", "history"] },
            { title: "Blockchain and IoT", author: "Zhu, Gai, Li", year: "2019", tags: ["blockchain", "tech"] },

            // DRUGS
            { title: "Drug Booklet: AI Poster L'Ardua Sentenza", author: "InFoPusher AUSL", year: "2023", tags: ["drug-culture", "harm-reduction"] },
            { title: "Epistemological Questions on Drugs", author: "Waters", year: "1972", tags: ["drug-culture", "philosophy"] },
            { title: "Motivated Behaviors and Addiction Syllabus", author: "Antoine Bechara", year: "2017", tags: ["addiction", "neuroscience"] },
            { title: "Cocaine Handbook", author: "David Lee", year: "1983", tags: ["drug-culture", "psychopharmacology"] },

            // ACCELERATIONISM
            { title: "Nova Express", author: "William S. Burroughs", year: "1964", tags: ["fiction", "cyberpunk"] },
            { title: "The Adding Machine: Selected Essays", author: "William S. Burroughs", year: "1986", tags: ["essays", "counterculture"] },
            { title: "Accelerando", author: "Charles Stross", year: "2005", tags: ["fiction", "accelerationism", "sci-fi"] },
            { title: "Postscript on Control Societies", author: "Gilles Deleuze", year: "1992", tags: ["philosophy", "tech-philosophy"] },
            { title: "The Use of Knowledge in Society", author: "Friedrich Hayek", year: "1945", tags: ["economics", "libertarianism"] },
            { title: "Man and Technics", author: "Oswald Spengler", year: "1932", tags: ["philosophy", "tech-philosophy"] },
            { title: "Fragment on Machines", author: "Karl Marx", year: "1858", tags: ["philosophy", "capitalism"] },
            { title: "Ouroboros: Mechanical Extension", author: "Garet Garrett", year: "1922", tags: ["tech-philosophy"] },
            { title: "Simulacra and Simulation", author: "Jean Baudrillard", year: "1981", tags: ["philosophy", "postmodernism"] },
            { title: "Society Against the State", author: "Pierre Clastres", year: "1989", tags: ["anthropology", "anarchism"] },
            { title: "The Conspiracy Against the Human Race", author: "Thomas Ligotti", year: "2010", tags: ["philosophy", "pessimism"] },
            { title: "Thus Spoke Zarathustra", author: "Friedrich Nietzsche", year: "2006", tags: ["philosophy", "existentialism"] },
            { title: "War in the Age of Intelligent Machines", author: "Manuel DeLanda", year: "1991", tags: ["philosophy", "tech"] },
            { title: "Subcolloquial Evaluation in American English", author: "Elena Merkulova", year: "2013", tags: ["linguistics"] },
            { title: "Bronze Age Mindset", author: "Bronze Age Pervert", year: "2018", tags: ["edgelord", "dark-enlightenment"] },
            { title: "The Culture of Narcissism", author: "Christopher Lasch", year: "1979", tags: ["sociology", "psychology"] },
            { title: "Capitalist Realism", author: "Mark Fisher", year: "2009", tags: ["philosophy", "capitalism"] },
            { title: "The Accelerationist Reader", author: "Various", year: "", tags: ["accelerationism", "anthology"] },

            // FICTION
            { title: "Naked Lunch", author: "William S. Burroughs", year: "1959", tags: ["fiction", "transgressive"] },
            { title: "Complete Stories", author: "Franz Kafka", year: "1971", tags: ["fiction", "short-stories"] },
            { title: "The Dharma Bums", author: "Jack Kerouac", year: "1958", tags: ["fiction", "beat-generation"] },
            { title: "Third from the Sun", author: "Richard Matheson", year: "1950", tags: ["fiction", "sci-fi"] },
            { title: "My Year of Rest and Relaxation", author: "Ottessa Moshfegh", year: "2018", tags: ["fiction", "contemporary"] },
            { title: "Portnoy's Complaint", author: "Philip Roth", year: "1969", tags: ["fiction"] },
            { title: "The Crying of Lot 49", author: "Thomas Pynchon", year: "1966", tags: ["fiction", "postmodern"] },
            { title: "Nine Stories", author: "J.D. Salinger", year: "1953", tags: ["fiction", "short-stories"] },
            { title: "Strange Case of Dr Jekyll and Mr Hyde", author: "Robert Louis Stevenson", year: "1886", tags: ["fiction", "classic"] },
            { title: "The Secret History", author: "Donna Tartt", year: "1992", tags: ["fiction", "mystery"] },
            { title: "Veronika Decides to Die", author: "Paulo Coelho", year: "1998", tags: ["fiction", "philosophy"] },
            { title: "The Bonfire of the Vanities", author: "Tom Wolfe", year: "1987", tags: ["fiction", "satire"] },

            // FILM THEORY
            { title: "An Anagram of Ideas on Art, Form and Film", author: "Maya Deren", year: "1946", tags: ["film-studies", "theory"] },
            { title: "Carnal Thoughts", author: "Vivian Sobchack", year: "2004", tags: ["film-studies", "phenomenology"] },
            { title: "Film Manifestoes and Global Cinema Cultures", author: "Scott MacKenzie", year: "2014", tags: ["film-studies", "manifestos"] },
            { title: "The Black List", author: "Unknown", year: "2021", tags: ["film-studies", "screenwriting"] },

            // GONZO
            { title: "The Great Shark Hunt", author: "Hunter S. Thompson", year: "1979", tags: ["journalism", "gonzo"] },

            // INTERNATIONAL RELATIONS
            { title: "Fifty Key Thinkers in International Relations", author: "Martin Griffiths", year: "1999", tags: ["IR", "political-theory"] },
            { title: "International Relations Theory and Philosophy", author: "Moore & Farrands", year: "2010", tags: ["IR", "philosophy"] },

            // UK CRIME MEMOIRS
            { title: "A Way of Life", author: "Reg Kray", year: "2016", tags: ["memoir", "true-crime"] },
            { title: "Born Fighter", author: "Reg Kray", year: "2011", tags: ["memoir", "true-crime"] },
            { title: "All I Need Is Love", author: "Klaus Kinski", year: "1988", tags: ["memoir", "film"] },
            { title: "It's Me, Eddie", author: "Eduard Limonov", year: "2013", tags: ["memoir", "Russian-lit"] },
            { title: "Our Story", author: "Fred Dineage", year: "2015", tags: ["memoir", "true-crime"] },

            // MEDIA THEORY
            { title: "The Rise of the Network Society", author: "Manuel Castells", year: "", tags: ["media-studies", "sociology"] },
            { title: "Media Archaeology", author: "Various", year: "", tags: ["media-studies", "theory"] },

            // MEMOIR
            { title: "Beautiful Things", author: "Hunter Biden", year: "2021", tags: ["memoir", "addiction"] },
            { title: "Paris: The Memoir", author: "Paris Hilton", year: "2023", tags: ["memoir", "celebrity"] },
            { title: "How to Murder Your Life", author: "Cat Marnell", year: "2017", tags: ["memoir", "addiction"] },
            { title: "The Center Cannot Hold", author: "Elyn Saks", year: "2007", tags: ["memoir", "mental-health"] },
            { title: "Memoirs of My Nervous Illness", author: "Daniel Paul Schreber", year: "1903", tags: ["memoir", "psychiatry"] },
            { title: "Prozac Nation", author: "Elizabeth Wurtzel", year: "1994", tags: ["memoir", "mental-health"] },

            // MYTHOLOGY
            { title: "The Tibetan Book of the Dead", author: "Graham Coleman", year: "2005", tags: ["spirituality", "Buddhism"] },
            { title: "The Epic of Gilgamesh", author: "N.K. Sanders", year: "", tags: ["mythology", "ancient-texts"] },

            // SELF-HELP
            { title: "Homo Deus", author: "Yuval Noah Harari", year: "2017", tags: ["philosophy", "futurism"] },
            { title: "The 48 Laws of Power", author: "Robert Greene", year: "1998", tags: ["self-help", "strategy"] },
            { title: "The Art of Seduction", author: "Robert Greene", year: "2001", tags: ["self-help", "psychology"] },
            { title: "The Creative Act: A Way of Being", author: "Rick Rubin", year: "2023", tags: ["self-help", "creativity"] },
            { title: "Daily Rituals: How Artists Work", author: "Mason Currey", year: "2013", tags: ["self-help", "creativity"] },

            // PHILOSOPHY
            { title: "Meditations", author: "Marcus Aurelius", year: "180", tags: ["philosophy", "stoicism"] },
            { title: "Intercourse", author: "Andrea Dworkin", year: "1987", tags: ["feminism", "philosophy"] },
            { title: "Madness and Civilization", author: "Michel Foucault", year: "1961", tags: ["philosophy", "psychiatry"] },
            { title: "Queer Theory", author: "Annamarie Jagose", year: "1996", tags: ["queer-theory", "philosophy"] },
            { title: "Technological Slavery", author: "Theodore Kaczynski", year: "", tags: ["philosophy", "anarchism"] },
            { title: "Do You Believe in Reality?", author: "Bruno Latour", year: "", tags: ["philosophy", "science"] },
            { title: "One-Dimensional Man", author: "Herbert Marcuse", year: "1964", tags: ["philosophy", "critical-theory"] },
            { title: "Dissensus: On Politics and Aesthetics", author: "Jacques Rancière", year: "", tags: ["philosophy", "aesthetics"] },

            // PHOTOGRAPHY
            { title: "On Photography", author: "Susan Sontag", year: "2001", tags: ["photography", "visual-culture"] },
            { title: "On Photography", author: "Walter Benjamin", year: "2015", tags: ["photography", "theory"] },

            // PSYCHOLOGY
            { title: "DSM-5: Diagnostic and Statistical Manual", author: "APA", year: "2013", tags: ["psychiatry", "psychology"] },
            { title: "The Emperor's New Mind", author: "Roger Penrose", year: "1989", tags: ["psychology", "AI"] },
            { title: "Emotional Intelligence", author: "Daniel Goleman", year: "1995", tags: ["psychology", "self-help"] },
            { title: "Emotional Intelligence 2.0", author: "Bradberry & Greaves", year: "2009", tags: ["psychology", "self-help"] },
            { title: "Psychoanalysis and Film", author: "Glen O. Gabbard", year: "2001", tags: ["psychoanalysis", "film-studies"] },
            { title: "The Monstrous-Feminine", author: "Barbara Creed", year: "1993", tags: ["psychoanalysis", "film-studies"] },
            { title: "Twenty-First Century Psychoanalysis", author: "Thomas Svolos", year: "", tags: ["psychoanalysis"] },

            // PESSOA COLLECTION
            { title: "The Anarchist Banker", author: "Fernando Pessoa", year: "", tags: ["Portuguese-literature", "fiction"] },
            { title: "The Book of Disquiet", author: "Fernando Pessoa", year: "", tags: ["Portuguese-literature", "philosophy"] },
            { title: "A Centenary Pessoa", author: "Fernando Pessoa", year: "", tags: ["Portuguese-literature", "poetry"] },
            { title: "Collected Poems of Álvaro de Campos", author: "Fernando Pessoa", year: "", tags: ["Portuguese-literature", "poetry"] },

            // PSYCHOGEOGRAPHY
            { title: "Articles on Psychogeography", author: "Hephaestus Books", year: "2011", tags: ["psychogeography", "urbanism"] },
            { title: "Psychogeography", author: "Merlin Coverley", year: "2006", tags: ["psychogeography", "theory"] },
            { title: "Revolutionary Time and the Avant-Garde", author: "John Roberts", year: "2015", tags: ["avant-garde", "theory"] },
            { title: "Surrealism and the Art of Crime", author: "Jonathan P. Eburne", year: "", tags: ["surrealism", "avant-garde"] },
            { title: "The Magnetic Fields", author: "André Breton", year: "2020", tags: ["surrealism", "poetry"] },
            { title: "Nadja", author: "André Breton", year: "1966", tags: ["surrealism", "fiction"] },
            { title: "The Work of Art in the Age of Mechanical Reproduction", author: "Walter Benjamin", year: "1936", tags: ["theory", "art-history"] },
            { title: "Daoism, Dandyism and Political Correctness", author: "Thorsten Botz-Bornstein", year: "2023", tags: ["philosophy", "cultural-studies"] },
            { title: "Veils, Nudity and Tattoos", author: "Thorsten Botz-Bornstein", year: "2015", tags: ["philosophy", "cultural-studies"] },
            { title: "Dust Book Draft", author: "Jussi Parikka", year: "2012", tags: ["media-theory"] },
            { title: "Mémoires", author: "Guy Debord", year: "1959", tags: ["situationism", "avant-garde"] },// RUSSIAN LITERATURE
        { title: "The Cherry Orchard", author: "Anton Chekhov", year: "1904", tags: ["Russian-lit", "drama"] },
        { title: "Blue Lard", author: "Vladimir Sorokin", year: "1999", tags: ["Russian-lit", "transgressive"] },

        // SEXUALITY STUDIES
        { title: "Asexual Manifesto", author: "Angela Orlando", year: "1972", tags: ["sexuality", "queer-theory"] },
        { title: "Imagination, Fantasy and Sexual Desire", author: "Stephanie Todd", year: "2012", tags: ["sexuality", "psychology"] },
        { title: "Pleasures All Mine", author: "Julie Peakman", year: "2021", tags: ["sexuality", "history"] },
        { title: "Psychology of Sex", author: "Havelock Ellis", year: "1933", tags: ["sexuality", "psychology"] },
        { title: "Sex Attraction Across Age", author: "Whyte et al", year: "2021", tags: ["sexuality", "research"] },
        { title: "Evolution of Sexual Preference", author: "R.A. Fisher", year: "1930", tags: ["sexuality", "biology"] },

        // MISCELLANEOUS
        { title: "A Class of Models with the Potential to Represent Fundamental Physics", author: "Stephen Wolfram", year: "2004", tags: ["physics", "computation"] },
        { title: "The Plasticity of ChatGPT's Mentalizing Abilities", author: "Hadar, Shoval, Elyoseph, Lvovsky", year: "2023", tags: ["AI", "research"] },
        { title: "Facebook Dangerous Individuals and Organizations List", author: "Unknown", year: "2021", tags: ["tech", "politics"] },
        { title: "The Journey Is the Destination", author: "Dan Eldon", year: "", tags: ["memoir", "photography"] },
        { title: "Maps From The Mind", author: "Charles Stein", year: "", tags: ["poetry", "philosophy"] },
        { title: "My First Book", author: "Honor Levy", year: "2024", tags: ["fiction", "contemporary"] },
        { title: "The Doors of Perception and Heaven and Hell", author: "Aldous Huxley", year: "1956", tags: ["drugs", "consciousness", "philosophy"] }
    ];


    /* =========================================================
       UI STATE
    ========================================================= */
    let activeTags = [];
    let searchTerm = "";
    let selectedIndex = -1;

    const cardsEl = document.getElementById('cards');
    const noResultsEl = document.getElementById('noResults');
    const tagRowEl = document.getElementById('tagRow');
    const searchEl = document.getElementById('searchInput');

    const docTitleEl = document.getElementById('docTitle');
    const docSubEl = document.getElementById('docSub');
    const docBodyEl = document.getElementById('docBody');

    /* =========================================================
       TAGS
    ========================================================= */
    const allTags = [...new Set(library.flatMap(b => (b.tags || [])))].sort();

    function renderTags(){
      tagRowEl.innerHTML = allTags.map(tag => {
        const el = document.createElement('div');
        el.className = 'tag';
        el.textContent = tag;
        el.onclick = () => toggleTag(tag);
        return el.outerHTML;
      }).join('');
    }

    function toggleTag(tag){
      const i = activeTags.indexOf(tag);
      if(i >= 0) activeTags.splice(i,1);
      else activeTags.push(tag);
      updateTagUI();
      renderCards();
    }

    function updateTagUI(){
      document.querySelectorAll('.tagRow .tag').forEach(el=>{
        el.classList.toggle('active', activeTags.includes(el.textContent));
      });
    }

    /* =========================================================
       FILTER
    ========================================================= */
    function matches(book){
      const t = (searchTerm || "").trim().toLowerCase();
      const hay = [
        book.title || "",
        book.author || "",
        (book.year || ""),
        ...(book.tags || [])
      ].join(" ").toLowerCase();

      const okSearch = !t || hay.includes(t);
      const okTags = activeTags.length === 0 || activeTags.every(x => (book.tags||[]).includes(x));
      return okSearch && okTags;
    }

    function filtered(){
      return library
        .map((b, idx) => ({...b, __idx: idx}))
        .filter(b => matches(b));
    }

    /* =========================================================
       CARDS + SELECTION -> DOC OVERVIEW (replaces checkout)
    ========================================================= */
    function renderCards(){
      const items = filtered();
      noResultsEl.style.display = items.length ? 'none' : 'block';

      cardsEl.innerHTML = items.map(b => {
        const isSel = (b.__idx === selectedIndex);
        return `
          <div class="card ${isSel ? 'selected' : ''}" data-idx="${b.__idx}">
            <div class="title">${escapeHtml(b.title || "UNTITLED")}</div>
            <div class="meta">${escapeHtml(b.author || "UNKNOWN")}${b.year ? " · " + escapeHtml(b.year) : ""}</div>
            <div class="tagMini">
              ${(b.tags||[]).slice(0,6).map(t => `<span class="pill">${escapeHtml(t)}</span>`).join('')}
            </div>
          </div>
        `;
      }).join('');

      document.querySelectorAll('.card').forEach(el=>{
        el.addEventListener('click', ()=>{
          const idx = Number(el.getAttribute('data-idx'));
          select(idx);
        });
      });
    }

    function select(idx){
      selectedIndex = idx;
      renderCards();

      const b = library[idx];
      if(!b){ clearSelection(); return; }

      docTitleEl.textContent = (b.title || "UNTITLED").toUpperCase();
      docSubEl.textContent = `${b.author || "UNKNOWN"}${b.year ? " · " + b.year : ""}`;

      docBodyEl.innerHTML = `
        <div class="block">
          <h3>METADATA</h3>
          <div class="kv">
            <div>TITLE</div><div>${escapeHtml(b.title || "")}</div>
            <div>AUTHOR</div><div>${escapeHtml(b.author || "")}</div>
            <div>YEAR</div><div>${escapeHtml(b.year || "")}</div>
            <div>TAGS</div><div>${escapeHtml((b.tags||[]).join(", "))}</div>
            <div>STATUS</div><div>INDEXED</div>
            <div>ACCESS</div><div>PLACEHOLDER</div>
          </div>
        </div>

        <div class="block">
          <h3>OVERVIEW</h3>
          <p>DOCUMENT OVERVIEW PLACEHOLDER. WE FILL THIS LATER (ABSTRACT / WHY IT MATTERS / WHERE IT CONNECTS).</p>
        </div>

        <div class="block">
          <h3>NOTES</h3>
          <p>OPTIONAL: USE GLOBAL KETA_NOTE (TOP RIGHT ICON) FOR SESSION NOTES.</p>
        </div>

        <div class="block">
          <h3>LINKS</h3>
          <p>PLACEHOLDER FOR PDF / URL / SOURCE POINTERS.</p>
        </div>
      `;
    }

    function clearSelection(){
      selectedIndex = -1;
      renderCards();
      docTitleEl.textContent = "NO SELECTION";
      docSubEl.textContent = "SELECT A MODULE TO EXPAND A DOCUMENT OVERVIEW.";
      docBodyEl.innerHTML = `<div class="emptyState">THIS IS A LIBRARY INDEX, NOT A CHECKOUT PIPELINE. CLICK A CARD TO OPEN AN OVERVIEW PANEL.</div>`;
    }
    document.getElementById('clearSelection').addEventListener('click', clearSelection);

    /* =========================================================
       GLOBAL KETA_NOTE (icon fill logic: collapsed=filled, open=outline)
    ========================================================= */
    const note = document.getElementById('note');
    const noteArea = document.getElementById('noteArea');
    const noteIcon = document.getElementById('ketaNoteIcon');
    const noteCollapse = document.getElementById('noteCollapse');

    function setNoteOpen(open){
      note.classList.toggle('open', open);
      noteIcon.classList.toggle('outlined', open); // open => outline only
    }

    // default: collapsed => filled icon
    setNoteOpen(false);

    // load existing global note text
    noteArea.value = readGlobalNote();

    // save on input (debounced)
    let saveT = null;
    noteArea.addEventListener('input', ()=>{
      clearTimeout(saveT);
      saveT = setTimeout(()=> writeGlobalNote(noteArea.value), 180);
    });

    noteIcon.addEventListener('click', ()=>{
      const open = !note.classList.contains('open');
      if(open){
        // refresh in case another page wrote to note
        noteArea.value = readGlobalNote();
      }
      setNoteOpen(open);
    });

    noteCollapse.addEventListener('click', ()=>{
      setNoteOpen(false);
    });

    // draggable note
    (function drag(){
      const head = document.getElementById('noteHead');
      let down=false, sx=0, sy=0, ox=0, oy=0;

      head.addEventListener('mousedown', (e)=>{
        down=true;
        sx=e.clientX; sy=e.clientY;
        const r = note.getBoundingClientRect();
        ox=r.left; oy=r.top;
      });

      window.addEventListener('mousemove', (e)=>{
        if(!down) return;
        const nx = ox + (e.clientX - sx);
        const ny = oy + (e.clientY - sy);
        note.style.left = Math.max(8, Math.min(window.innerWidth - 220, nx)) + 'px';
        note.style.top  = Math.max(46, Math.min(window.innerHeight - 80, ny)) + 'px';
        note.style.right = 'auto';
      });

      window.addEventListener('mouseup', ()=> down=false);
    })();

    /* =========================================================
       SYSTEM NAV
    ========================================================= */
    document.getElementById('goSystem').addEventListener('click', ()=> location.href = SHELL_HOME_URL);
    document.getElementById('goHome').addEventListener('click', ()=> location.href = SHELL_HOME_URL);
    document.getElementById('goLanding').addEventListener('click', ()=> location.href = LANDING_URL);

    /* =========================================================
       SYSTEM UNIVERSALS
       - ESC: exit null
       - N: toggle null
       - SHIFT+I: invert
       - SHIFT+B: home (system.html)
       - SHIFT+K: landing (index11.html)
       - 1–6: lights behind interface
    ========================================================= */
    const nullStatus = document.getElementById('nullStatus');
    const invStatus = document.getElementById('invStatus');
    const lightStatus = document.getElementById('lightStatus');
    const lights = document.getElementById('lights');

    let nullMode = false;
    let invert = false;
    let lightMode = 0;

    function setNull(on){
      nullMode = on;
      document.body.classList.toggle('null', on);
      nullStatus.textContent = on ? "ON" : "OFF";
    }
    function setInvert(on){
      invert = on;
      document.body.classList.toggle('invert', on);
      invStatus.textContent = on ? "ON" : "OFF";
    }

    function setLight(n){
      lightMode = n;
      lightStatus.textContent = String(n);
      lights.classList.toggle('on', n !== 0);

      // stop any prior animation
      lights.style.animation = "none";
      void lights.offsetHeight;

      if(n === 0){
        lights.style.animation = "none";
        return;
      }
      const map = {
        1: "strobe1 1s linear infinite",
        2: "strobe2 1s linear infinite",
        3: "strobe3 1s linear infinite",
        4: "strobe4 1s linear infinite",
        5: "strobe5 1s linear infinite",
        6: "strobe6 1s linear infinite"
      };
      lights.style.animation = map[n] || "strobe1 1s linear infinite";
    }

    window.addEventListener('keydown', (e)=>{
      // prevent accidental page transforms by staying off +/-
      if(e.key === "Escape"){ setNull(false); return; }

      if(e.key.toLowerCase() === "n"){
        setNull(!nullMode);
        return;
      }

      if(e.shiftKey && e.key.toLowerCase() === "i"){
        setInvert(!invert);
        return;
      }

      if(e.shiftKey && e.key.toLowerCase() === "b"){
        location.href = SHELL_HOME_URL;
        return;
      }

      if(e.shiftKey && e.key.toLowerCase() === "k"){
        location.href = LANDING_URL;
        return;
      }

      // lights 1-6
      if(!e.shiftKey && !e.ctrlKey && !e.metaKey){
        const n = Number(e.key);
        if([1,2,3,4,5,6].includes(n)){
          setLight(n);
        }
      }
    });

    /* =========================================================
       INIT
    ========================================================= */
    searchEl.addEventListener('input', (e)=>{
      searchTerm = e.target.value || "";
      renderCards();
    });

    renderTags();
    updateTagUI();
    renderCards();
    clearSelection();

    /* =========================================================
       Utils
    ========================================================= */
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (m)=>({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }
  </script>

  <!-- ============================================================
  KETADATA HTML SERIALIZATION STAMP
  AE/EE/WB: WB
  FILE_ID: KETADATA_LIBRARY
  ROOM_ID: LIBRARY
  VERSION: library.v2
  UPDATED_AT: 2025-12-24T00:00:00-05:00
  CHANGELOG:
  - REMOVED CHECKOUT/CART/REQUEST PIPELINE (SIMPLIFIED TO INDEX + OVERVIEW)
  - ALL PRIOR RED ACCENTS REMOVED; LIBRARY IS WHITE/GRAY ONLY
  - GLOBAL KETA_NOTE ICON ANCHORED TOP RIGHT (WHITE SQUARE)
  - ICON FILL LOGIC: COLLAPSED=FILLED WHITE, OPEN=OUTLINE ONLY
  - KETA_NOTE IS DRAGGABLE AND COLLAPSES INTO ICON
  - GLOBAL NOTE SYNC: READ/WRITE MULTIPLE KEYS TO MATCH SYSTEM/OTHER ROOMS
  - SYSTEM UNIVERSALS: ESC (EXIT NULL), N (NULL TOGGLE), SHIFT+I (INVERT),
    SHIFT+B (HOME), SHIFT+K (LANDING), 1–6 (LIGHTS BEHIND UI)
  ============================================================ -->
</body>
</html>
