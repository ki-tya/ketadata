import React, { useState, useEffect } from 'react';
import { Heart, Users, Sparkles, Waves, Sun } from 'lucide-react';

export default function MDMAExperience() {
  const [phase, setPhase] = useState('anticipation');
  const [intensity, setIntensity] = useState(0);
  const [touchActive, setTouchActive] = useState(false);
  const [pulseScale, setPulseScale] = useState(1);

  useEffect(() => {
    const phaseTimer = setInterval(() => {
      if (phase === 'anticipation' && intensity < 30) {
        setIntensity(prev => Math.min(prev + 1, 30));
      } else if (phase === 'anticipation' && intensity >= 30) {
        setPhase('comeup');
        setIntensity(30);
      } else if (phase === 'comeup' && intensity < 100) {
        setIntensity(prev => Math.min(prev + 2, 100));
      } else if (phase === 'comeup' && intensity >= 100) {
        setPhase('peak');
      } else if (phase === 'peak' && intensity < 95) {
        setIntensity(prev => Math.max(prev - 0.3, 85));
      }
    }, 100);

    return () => clearInterval(phaseTimer);
  }, [phase, intensity]);

  useEffect(() => {
    const pulseTimer = setInterval(() => {
      setPulseScale(prev => prev === 1 ? 1.05 : 1);
    }, phase === 'peak' ? 300 : 600);

    return () => clearInterval(pulseTimer);
  }, [phase]);

  const getBackgroundGradient = () => {
    if (phase === 'anticipation') {
      return 'from-slate-900 via-purple-900/20 to-slate-900';
    } else if (phase === 'comeup') {
      return 'from-purple-900 via-pink-800 to-orange-700';
    } else {
      return 'from-pink-500 via-rose-400 to-amber-300';
    }
  };

  const getTextColor = () => {
    if (phase === 'peak') return 'text-white';
    if (phase === 'comeup') return 'text-pink-100';
    return 'text-gray-400';
  };

  const messages = {
    anticipation: [
      "waiting",
      "subtle warmth",
      "awareness beginning",
      "the edge of something"
    ],
    comeup: [
      "waves building",
      "heart opening",
      "everything softening",
      "boundary dissolving",
      "connection emerging"
    ],
    peak: [
      "pure love",
      "we are all connected",
      "this is beautiful",
      "i understand everything",
      "boundless empathy",
      "infinite present",
      "touch is everything",
      "music is the universe"
    ]
  };

  return (
    <div 
      className={`min-h-screen bg-gradient-to-br ${getBackgroundGradient()} transition-all duration-1000 flex flex-col items-center justify-center p-8 relative overflow-hidden`}
      onMouseMove={() => phase === 'peak' && setTouchActive(true)}
      onMouseLeave={() => setTouchActive(false)}
    >
      {/* Floating particles */}
      {phase !== 'anticipation' && (
        <div className="absolute inset-0 overflow-hidden pointer-events-none">
          {[...Array(phase === 'peak' ? 30 : 15)].map((_, i) => (
            <div
              key={i}
              className={`absolute rounded-full ${phase === 'peak' ? 'bg-white/40' : 'bg-pink-300/30'} blur-sm`}
              style={{
                width: `${Math.random() * 8 + 4}px`,
                height: `${Math.random() * 8 + 4}px`,
                left: `${Math.random() * 100}%`,
                top: `${Math.random() * 100}%`,
                animation: `float ${Math.random() * 10 + 10}s infinite ease-in-out`,
                animationDelay: `${Math.random() * 5}s`
              }}
            />
          ))}
        </div>
      )}

      {/* Central heart pulse */}
      <div 
        className="relative mb-12"
        style={{
          transform: `scale(${pulseScale})`,
          transition: 'transform 0.3s ease-out'
        }}
      >
        <Heart 
          className={`${getTextColor()} transition-all duration-1000`}
          size={phase === 'peak' ? 120 : phase === 'comeup' ? 80 : 60}
          fill={phase === 'peak' ? 'currentColor' : phase === 'comeup' ? 'rgba(255,255,255,0.3)' : 'none'}
          strokeWidth={phase === 'anticipation' ? 1.5 : 1}
        />
        
        {phase === 'peak' && (
          <div className="absolute inset-0 animate-ping opacity-30">
            <Heart size={120} fill="white" className="text-white" />
          </div>
        )}
      </div>

      {/* Phase indicator */}
      <div className={`text-center mb-8 ${getTextColor()} transition-all duration-1000`}>
        <h1 className={`font-light tracking-widest uppercase mb-4 ${
          phase === 'peak' ? 'text-5xl' : phase === 'comeup' ? 'text-3xl' : 'text-xl'
        }`}>
          {phase === 'peak' ? 'âˆž' : phase.replace('_', ' ')}
        </h1>
        
        {/* Intensity bar */}
        <div className="w-64 h-1 bg-white/20 rounded-full overflow-hidden mx-auto">
          <div 
            className={`h-full ${phase === 'peak' ? 'bg-white' : 'bg-pink-400'} transition-all duration-300 rounded-full`}
            style={{ width: `${intensity}%` }}
          />
        </div>
      </div>

      {/* Emotional messages */}
      <div className={`text-center ${getTextColor()} transition-all duration-1000 max-w-2xl space-y-4`}>
        {messages[phase].map((msg, i) => (
          <p 
            key={i}
            className={`${
              phase === 'peak' ? 'text-2xl font-light' : 
              phase === 'comeup' ? 'text-lg' : 
              'text-sm'
            } opacity-${phase === 'peak' ? '100' : '70'} tracking-wide`}
            style={{
              animationDelay: `${i * 0.5}s`,
              animation: phase === 'peak' ? 'pulse 3s infinite' : 'none'
            }}
          >
            {msg}
          </p>
        ))}
      </div>

      {/* Bottom icons - connection symbols */}
      {phase !== 'anticipation' && (
        <div className={`absolute bottom-12 flex gap-8 ${getTextColor()} transition-all duration-1000`}>
          <Users 
            size={phase === 'peak' ? 40 : 32} 
            className={phase === 'peak' ? 'animate-pulse' : ''}
            strokeWidth={1}
          />
          <Sparkles 
            size={phase === 'peak' ? 40 : 32}
            className={phase === 'peak' ? 'animate-pulse' : ''}
            strokeWidth={1}
          />
          <Waves 
            size={phase === 'peak' ? 40 : 32}
            className={phase === 'peak' ? 'animate-pulse' : ''}
            strokeWidth={1}
          />
          {phase === 'peak' && (
            <Sun 
              size={40}
              className="animate-spin"
              style={{ animationDuration: '20s' }}
              strokeWidth={1}
            />
          )}
        </div>
      )}

      {/* Touch trail effect */}
      {touchActive && phase === 'peak' && (
        <div className="absolute inset-0 bg-gradient-radial from-white/10 to-transparent pointer-events-none" />
      )}

      <style jsx>{`
        @keyframes float {
          0%, 100% { transform: translateY(0) translateX(0); }
          25% { transform: translateY(-20px) translateX(10px); }
          50% { transform: translateY(-40px) translateX(-10px); }
          75% { transform: translateY(-20px) translateX(5px); }
        }
      `}</style>
    </div>
  );
}
