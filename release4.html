<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>k-word (4)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }

        #input {
            position: fixed;
            opacity: 0;
            pointer-events: auto;
            width: 100%;
            height: 100%;
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .fragment {
            position: absolute;
            color: #fff;
            font-size: 20px;
            pointer-events: none;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <input type="text" id="input" autofocus placeholder="">
    <div id="canvas"></div>

    <script>
        const input = document.getElementById('input');
        const canvas = document.getElementById('canvas');
        const columnWidth = 20;
        const columns = Math.floor(window.innerWidth / columnWidth);

        input.addEventListener('keypress', function(e) {
            if (e.key.length === 1) {
                fragmentText(e.key);
            }
        });

        function fragmentText(text) {
            const chars = [text];
            
            // Phase 1: MASSIVE Echo multiplication - create vertical lines everywhere
            const echoCount = 80;
            const echoDelay = 15;
            const allFragments = [];
            const rows = Math.floor(window.innerHeight / columnWidth);
            
            for (let echo = 0; echo < echoCount; echo++) {
                setTimeout(function() {
                    chars.forEach(function(char, i) {
                        // Pick random column
                        const randomCol = Math.floor(Math.random() * columns);
                        const colX = randomCol * columnWidth;
                        
                        // Create entire vertical line for this character
                        for (let row = 0; row < rows; row++) {
                            const fragment = document.createElement('div');
                            fragment.className = 'fragment';
                            fragment.textContent = char;
                            
                            const posX = colX;
                            const posY = row * columnWidth;
                            
                            fragment.style.left = posX + 'px';
                            fragment.style.top = posY + 'px';
                            fragment.style.opacity = 0.95 - (echo * 0.01);
                            
                            canvas.appendChild(fragment);
                            
                            allFragments.push({
                                element: fragment,
                                x: posX,
                                y: posY
                            });
                        }
                    });
                }, echo * echoDelay);
            }
            
            // Phase 2: Wait for all echoes, then shatter ALL fragments at once
            setTimeout(function() {
                allFragments.forEach(function(frag) {
                    let posX = frag.x;
                    let posY = frag.y;
                    let velocityX = (Math.random() - 0.5) * 20;
                    let velocityY = (Math.random() - 0.5) * 20;
                    let rotation = Math.random() * 360;
                    let rotationSpeed = (Math.random() - 0.5) * 30;
                    let opacity = parseFloat(frag.element.style.opacity);
                    let scale = 1;
                    
                    function animateFrame() {
                        // Glass shatter physics with gravity
                        velocityY += 1.2;
                        posX += velocityX;
                        posY += velocityY;
                        rotation += rotationSpeed;
                        
                        opacity -= 0.008;
                        scale -= 0.006;
                        
                        frag.element.style.left = posX + 'px';
                        frag.element.style.top = posY + 'px';
                        frag.element.style.opacity = opacity;
                        frag.element.style.transform = 'rotate(' + rotation + 'deg) scale(' + scale + ')';
                        
                        if (opacity > 0 && posY < window.innerHeight + 100) {
                            requestAnimationFrame(animateFrame);
                        } else {
                            frag.element.remove();
                        }
                    }
                    
                    requestAnimationFrame(animateFrame);
                });
            }, echoCount * echoDelay + 300);
        }

        input.focus();
    </script>
</body>
</html>
