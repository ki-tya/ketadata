<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KETADATA // KDTV CINEMA (SHELL8)</title>

<style>
/* ================= ORIGINAL UI STYLES (UNCHANGED) ================= */
/* [Your existing CSS from pasted.txt is preserved here verbatim] */

/* ================= SHELL8 UNIVERSALS (MEMBRANE ONLY) ================= */

body.keta_invert{
  filter: invert(1);
}

/* lights overlay (1–6) */
.keta_lights{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:55;
  opacity:0;
  transition: opacity 80ms linear;
  mix-blend-mode: screen;
}
.keta_lights::before{
  content:"";
  position:absolute;
  inset:-20%;
  background:
    radial-gradient(70% 60% at 50% 40%, rgba(255,255,255,.05) 0%, rgba(0,0,0,0) 58%),
    radial-gradient(circle at 18% 22%, rgba(255,255,255,.12), rgba(0,0,0,0) 48%),
    radial-gradient(circle at 72% 34%, rgba(255,255,255,.09), rgba(0,0,0,0) 52%),
    radial-gradient(circle at 44% 78%, rgba(255,255,255,.08), rgba(0,0,0,0) 56%),
    linear-gradient(90deg, rgba(255,255,255,.05) 1px, rgba(0,0,0,0) 1px),
    linear-gradient(0deg,  rgba(255,255,255,.05) 1px, rgba(0,0,0,0) 1px);
  background-size:auto,auto,auto,auto,140px 140px,140px 140px;
  filter: blur(.6px);
}
.keta_lights[data-lvl="0"]{opacity:0;}
.keta_lights[data-lvl="1"]{opacity:.14;}
.keta_lights[data-lvl="2"]{opacity:.28;}
.keta_lights[data-lvl="3"]{opacity:.42;}
.keta_lights[data-lvl="4"]{opacity:.56;}
.keta_lights[data-lvl="5"]{opacity:.70;}
.keta_lights[data-lvl="6"]{opacity:.84;}
</style>
</head>

<body>

<!-- ================= ORIGINAL UI DOM (UNCHANGED) ================= -->

<div class="app">
  <!-- your full KDTV UI DOM here exactly as before -->
</div>

<!-- Shell8 lights membrane -->
<div class="keta_lights" id="keta_lights" data-lvl="0" aria-hidden="true"></div>

<script>
/* ============================================================
   SHELL8 UNIVERSALS (INJECTED — NO UI CHANGES)
   Hotkeys:
   - Digit1..Digit6 → LIGHTS
   - Shift+I → INVERT
   ============================================================ */

const __SHELL8_SYSTEM__ = {
  SHELL: "SHELL8",
  MODE: "VISUAL_OBJECT",
  FILE_ID: "KDTV_CINEMA_V1",
  ROOM_ID: "CINEMA",
  VERSION: "kdtv.cinema.shell8.v1",
  UPDATED_AT: "2025-12-24T00:00:00-05:00",
  WB: {
    command_map: {
      LIGHTS_1_6: "Digit1..Digit6",
      INVERT_TOGGLE: "Shift+KeyI"
    }
  }
};

const __SHELL8_STATE__ = {
  lightsLevel: 0,
  invert: false
};

function SHELL8_SET_LIGHTS(level){
  const lvl = Math.max(0, Math.min(6, Number(level)||0));
  __SHELL8_STATE__.lightsLevel = lvl;
  const el = document.getElementById("keta_lights");
  if(el) el.setAttribute("data-lvl", String(lvl));
}

function SHELL8_TOGGLE_INVERT(force){
  const next = (typeof force === "boolean") ? force : !__SHELL8_STATE__.invert;
  __SHELL8_STATE__.invert = next;
  document.body.classList.toggle("keta_invert", next);
}

/* Bridge existing app state without touching it */
function SHELL8_EXPORT(){
  return {
    shell8: {
      system: __SHELL8_SYSTEM__,
      membrane: {
        lightsLevel: __SHELL8_STATE__.lightsLevel,
        invert: __SHELL8_STATE__.invert
      }
    },
    app: (typeof state !== "undefined") ? JSON.parse(JSON.stringify(state)) : {}
  };
}

function SHELL8_IMPORT(obj){
  if(!obj || typeof obj !== "object") return false;

  const mem = obj.shell8?.membrane;
  if(mem){
    if(mem.lightsLevel !== undefined) SHELL8_SET_LIGHTS(mem.lightsLevel);
    if(mem.invert !== undefined) SHELL8_TOGGLE_INVERT(mem.invert);
  }

  if(obj.app && typeof state !== "undefined"){
    Object.assign(state, obj.app);
    if(typeof render === "function") render();
  }
  return true;
}

/* Expose to Shell */
Object.defineProperty(window, "__KETADATA__", {
  value: Object.freeze({
    SYSTEM: Object.freeze(__SHELL8_SYSTEM__),
    EXPORT: SHELL8_EXPORT,
    IMPORT: SHELL8_IMPORT,
    SET_LIGHTS: SHELL8_SET_LIGHTS,
    TOGGLE_INVERT: SHELL8_TOGGLE_INVERT
  }),
  writable:false,
  configurable:false
});

/* UNIVERSAL HOTKEYS ONLY */
window.addEventListener("keydown", (e)=>{
  if(e.repeat) return;

  if(/^Digit[1-6]$/.test(e.code)){
    SHELL8_SET_LIGHTS(parseInt(e.code.slice(-1),10));
    return;
  }
  if(e.code === "KeyI" && e.shiftKey){
    SHELL8_TOGGLE_INVERT();
    return;
  }
});
</script>

<!-- ============================================================
KETADATA HTML SERIALIZATION STAMP

SHELL: SHELL8
MODE: VISUAL_OBJECT

FILE_ID: KDTV_CINEMA_V1
ROOM_ID: CINEMA
VERSION: kdtv.cinema.shell8.v1
UPDATED_AT: 2025-12-24T00:00:00-05:00

AE:
- BLACK FIELD
- CINEMA UI
- MEMBRANE LIGHTS (1–6)

EE:
- HERO PLAYER
- MULTI GRID
- EXPORT / IMPORT

WB:
- __KETADATA__ UNIVERSALS
- HOTKEYS: 1–6 LIGHTS, SHIFT+I INVERT

CHANGELOG:
- 2025-12-24: SHELL8 UNIVERSALS ADDED, UI UNCHANGED
============================================================ -->
</body>
</html>
