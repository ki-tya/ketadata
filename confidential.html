<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KETADATA CLUSTERS — PUBLIC / PRIVATE</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#111111; --muted:#7a7a7a; --line:#cfcfcf;
      --panel:#f2f2f2; --panel2:#e8e8e8;
      --font:12px/1.15 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:var(--font);overflow:hidden;}
    *{box-sizing:border-box;}
    .invert{
      --bg:#0b0b0b; --fg:#f2f2f2; --muted:#a0a0a0; --line:#3a3a3a;
      --panel:#111111; --panel2:#161616;
    }
    .null #hud, .null #side, .null #corner{display:none;}
    #root{position:fixed;inset:0;display:flex;}
    #hud{
      position:fixed;left:10px;top:10px;z-index:50;
      background:var(--panel);border:1px solid var(--line);
      padding:8px;width:520px;user-select:none;
    }
    #hud .row{display:flex;gap:6px;flex-wrap:wrap;align-items:center;}
    #hud .row + .row{margin-top:6px;}
    #hud button{
      font:var(--font);padding:4px 6px;background:var(--bg);
      border:1px solid var(--line);color:var(--fg);cursor:pointer;
    }
    #hud input[type="text"]{
      font:var(--font);padding:4px 6px;background:var(--bg);
      border:1px solid var(--line);color:var(--fg);width:220px;
    }
    #hud select{
      font:var(--font);padding:4px 6px;background:var(--bg);
      border:1px solid var(--line);color:var(--fg);
    }
    #hud .pill{display:inline-block;padding:3px 6px;border:1px solid var(--line);background:var(--bg);color:var(--muted);}
    #hud .label{color:var(--muted);}
    #hud .sp{flex:1;}
    #gridWrap{
      position:absolute;inset:0;
      padding:68px 10px 10px 10px;
      overflow:auto;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
      gap:10px;
      align-items:start;
    }
    .cluster{
      background:var(--panel);
      border:1px solid var(--line);
      padding:8px;
      position:relative;
    }
    .clusterHeader{
      display:flex;gap:8px;align-items:center;justify-content:space-between;
      margin-bottom:6px;
    }
    .clusterTitle{
      display:flex;gap:8px;align-items:center;
      min-width:0;
    }
    .clusterTitle .name{
      color:var(--fg);
      font-weight:700;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .clusterTitle .count{color:var(--muted);}
    .clusterTools{display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end;}
    .clusterTools button{padding:3px 6px;}
    .list{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .item{
      background:var(--bg);
      border:1px solid var(--line);
      padding:6px;
      display:flex;
      gap:8px;
      align-items:center;
      min-height:28px;
    }
    .item .left{
      display:flex;gap:8px;align-items:center;min-width:0;flex:1;
    }
    .item .path{
      color:var(--fg);
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      flex:1;
    }
    .item .meta{
      color:var(--muted);
      white-space:nowrap;
    }
    .item .btn{
      font:var(--font);
      padding:3px 6px;background:var(--panel2);
      border:1px solid var(--line);cursor:pointer;color:var(--fg);
    }
    .tag{
      display:inline-block;
      padding:1px 6px;
      border:1px solid var(--line);
      background:var(--panel2);
      color:var(--muted);
    }
    .tag.pub{color:var(--fg);}
    .tag.priv{color:var(--muted);}
    #side{
      position:fixed;right:10px;top:10px;z-index:60;
      width:420px;max-height:calc(100vh - 20px);
      background:var(--panel);border:1px solid var(--line);
      padding:8px;overflow:auto;display:none;
    }
    #side .t{color:var(--muted);}
    #side .a{color:var(--fg);word-break:break-all;}
    #side .btns{margin-top:6px;display:flex;gap:6px;flex-wrap:wrap;}
    #side button{font:var(--font);padding:4px 6px;background:var(--bg);border:1px solid var(--line);cursor:pointer;}
    #corner{
      position:fixed;left:10px;bottom:10px;color:var(--muted);
      user-select:none;z-index:40;
    }
  </style>
</head>
<body>
<div id="root">
  <div id="hud">
    <div class="row">
      <span class="pill">CLUSTERS / PUBLIC-PRIVATE</span>
      <span class="sp"></span>
      <span class="pill" id="pillSaved">LOCAL</span>
    </div>
    <div class="row">
      <span class="label">FILTER</span>
      <input id="q" type="text" placeholder="search filename..." />
      <span class="label">SHOW</span>
      <select id="visFilter">
        <option value="ALL">ALL</option>
        <option value="PUBLIC">PUBLIC</option>
        <option value="PRIVATE">PRIVATE</option>
        <option value="UNSET">UNSET</option>
      </select>
      <span class="label">CLUSTER</span>
      <select id="clusterFilter">
        <option value="ALL">ALL</option>
      </select>
    </div>
    <div class="row">
      <button id="btnExportPublic">EXPORT PUBLIC JSON</button>
      <button id="btnExportAll">EXPORT ALL JSON</button>
      <button id="btnImport">IMPORT JSON</button>
      <button id="btnReset">RESET VISIBILITY</button>
      <button id="btnNull">NULL (SHIFT+N)</button>
      <button id="btnInvert">INVERT (SHIFT+I)</button>
      <button id="btnFull">FULL (SHIFT+F)</button>
    </div>
  </div>

  <div id="gridWrap">
    <div class="grid" id="grid"></div>
  </div>

  <div id="side">
    <div class="t">SELECTED</div>
    <div class="a" id="selPath"></div>
    <div class="t" style="margin-top:6px;">URL</div>
    <div class="a" id="selUrl"></div>
    <div class="t" style="margin-top:6px;">VISIBILITY</div>
    <div class="a" id="selVis"></div>
    <div class="btns">
      <button id="openHere">OPEN</button>
      <button id="openNew">OPEN NEW TAB</button>
      <button id="copyUrl">COPY URL</button>
      <button id="toggleVis">TOGGLE PUBLIC/PRIVATE</button>
      <button id="closeSide">CLOSE</button>
    </div>
  </div>

  <div id="corner">KETADATA CLUSTERS — MARK PUBLIC/PRIVATE — LOCAL-FIRST</div>
</div>

<input id="filePick" type="file" accept="application/json" style="display:none" />

<script>
(() => {
  const BASE_URL = "https://ki-tya.github.io/ketadata/";

  // ========= CLUSTERS + LINKS (exactly from your consolidated map) =========
  const CLUSTERS = [
    { name:"KETA-CORE", links:["based_diva9.html","elevator3.html","index.html","index013.html","index11.html","map.html","room.html"]},
    { name:"BLEAK-TECH", links:["ball.html","beatball.html","blacklotus2.html","bleak.html","chakra.html","memofesto.html"]},
    { name:"SCREENS", links:["cctv1.html","crunch1.html","darkroom1.html","kdtv1.html","obscura.html"]},
    { name:"EXPERIMENTS", links:[
      "003.html","aniversary1111.html","artaud.html","bataille1.html","borges.html","burroughs.html","capture.html",
      "capturegpt.html","capturegpt2.html","capturegpt3.html","capturegpt4.html","capturegpt5.html","capturegpt6.html",
      "capturegpt7.html","capturegpt8.html","christmas25.html","chroma.html","coffee.html","coffee1.html","cp1.html",
      "cube.html","cube1.html","debord.html","deleuze.html","dmt.html","dmt2.html","dmt3.html","dmt4.html","dmtzoom.html",
      "etal.html","funnel.html","funnel1.html","funnel2.html","funnel3.html","funnel4.html","goffman.html","gptsubject.html",
      "holzer.html","hyperstition.html","hyperstition1.html","hyperstition2.html","hyperstition3.html","hyperstition5.html",
      "index0.html","index001.html","index002.html","index003.html","index004.html","index005.html","index006.html","index007.html",
      "index008.html","index009.html","index01.html","index011.html","index012.html","index014.html","index015.html","index02.html",
      "index03.html","index04.html","index05.html","index06.html","index07.html","index08.html","index09.html","infinity.html","jung.html",
      "kitty.html","kmas.html","land.html","mandala.html","mandala2.html","mandala3.html","mandalagpt.html","mandalagpt2.html",
      "mandalagpt3.html","mandalagpt4.html","matrix.html","matryoshka.html","mcluhan.html","mdma.html","mdma2.html","mdmagpt.html",
      "mdmagpt2.html","misc.html","misc2.html","misc3.html","misc4.html","misc5.html","misc6.html","misc7.html","misc8.html",
      "molecule.html","newtrap.html","newtrap2.html","newtrap3.html","polka1.html","polka2.html","polkadot.html","pool.html","pool3.html",
      "pool4.html","pool5.html","pool6.html","release.html","release2.html","release3.html","release4.html","ripple.html","ripple2.html",
      "ripple3.html","ripplegpt.html","sg.html","sg1.html","slopstream2.html","slopstream3.html","slopstream4.html","slopstream6.html",
      "snakes.html","sovereignty.html","subgpt2.html","subgpt3.html","subgpt4.html","subgpt5.html","sublime.html","substance.html",
      "substrate.html","substrate1.html","substrate3.html","teleo.html","teleo1.html","temple.html","temple1.html"
    ]},
    { name:"CONCEPTUAL ALIGNMENT", links:["2812.html","claude_cl3.html","concept_cl4.html","cp.html","depth.html","drugprotocol.html","fivethirtysix.html","intra.html","reading.html","widefield.html"]},
    { name:"BASE", links:["based_diva3.html","based_diva8.html","based_diva98.html","based_diva98x.html","based_diva9a.html","based_diva9b.html","based_diva9c.html","based_diva9d.html","based_diva9e.html","based_diva9f.html","based_diva9g.html","based_diva9h.html","based_diva9i.html","based_diva9ii.html","based_diva9iii.html","bbd1.html","bbd2.html","bbd3.html","diva.html","divabased4.html","re_diva9.html","systemkill.html"]},
    { name:"SYSTEM", links:["backbone.html","backbone1.html","backbone2.html","backend.html","claude_mockup.html","claude.html","contract.html","memofesto1.html","memofesto2.html","mockups.html","mockups1.html","mockups2.html","nav.html","pads.html","page.html"]},
    { name:"SYS-UTIL", links:["arranger.html","bugtest.html","debug.html","diagnostic.html","inspector.html","inspector1.html","linklist.html","linkorg4.html","main3.html","manifest.html","master2.html","mastergpt.html","monitor.html","primitive.html","primitive1.html","primitive2.html","primitive3.html","pulse.html","quota.html","reg.html","regv3.html","regv4.html","screenplane.html","screenplane1.html","storage.html","storage1.html","storagemanager.html","system8.html","version.html","videomanager.html"]},
    { name:"SYS-PR", links:["cashapp1.html","cashapp3.html","funding.html","shop.html","submit.html"]},
    { name:"TESTERS", links:["anniversary1.html","anniversary11.html","anniversary111.html","concept_cl.html","concept_cl1.html","concept_cl2.html","darkroom.html","doc5.html","index_copy.html","index_prev1.html","index01_tester.html","lib_cl.html","mandala88.html","master.html","master1.html","redroom.html","to-do.html","to-do1.html","vape-drive.html","vault.html","video.html","video2.html"]},
    { name:"SECRET", links:["67.html","page2.html"]},
    { name:"CORE", links:["deprecated.html","design1.html","lab.html","lab1.html","labyrinth.html","lib_gpt.html","linksv3.html","main2.html","sensory3.html","studiofront.html","studiov2.html","studiov3.html","tester3.html","tester31.html"]},
    { name:"CORE-UTIL", links:["acid_doc.html","artifact.html","board.html","board1.html","board2.html","board3.html","calendar1.html","controller.html","controller1.html","controller2.html","controller3.html","display1.html","doc2.html","manifest5.html","modern.html","pdf2jpeg7.html","sheets.html","studio.html","to-do2.html"]},
    { name:"DESIGN-UTIL", links:["color1.html","color3.html","font.html"]},
    { name:"PHOTOG-UTIL", links:["editor.html","studiov1.html"]},
    { name:"DATA-UTIL", links:["pdf2jpeg8.html"]},
    { name:"META-COG", links:["circle.html","libra.html"]},
    { name:"LLM-UTIL", links:["compiler.html","contextifier.html","d2.html","prompt.html","prompt1.html","prompt3.html","prompter.html"]},
    { name:"HTML-UTIL", links:["classifier.html","classifier1.html","forge3.html","forge4.html","forge5.html","forge7.html","html.html","metadata.html","metadata1.html","unifier.html"]},
    { name:"UI-UTIL", links:["color5.html","interfacer.html","interfacer1.html","interfacer2.html","lab3.html","lab9.html","system6.html"]},
  ];

  const STORE_KEY = "KD_PUBLIC_PRIVATE_V1";

  const els = {
    grid: document.getElementById("grid"),
    q: document.getElementById("q"),
    visFilter: document.getElementById("visFilter"),
    clusterFilter: document.getElementById("clusterFilter"),
    pillSaved: document.getElementById("pillSaved"),
    btnExportPublic: document.getElementById("btnExportPublic"),
    btnExportAll: document.getElementById("btnExportAll"),
    btnImport: document.getElementById("btnImport"),
    btnReset: document.getElementById("btnReset"),
    btnNull: document.getElementById("btnNull"),
    btnInvert: document.getElementById("btnInvert"),
    btnFull: document.getElementById("btnFull"),
    side: document.getElementById("side"),
    selPath: document.getElementById("selPath"),
    selUrl: document.getElementById("selUrl"),
    selVis: document.getElementById("selVis"),
    openHere: document.getElementById("openHere"),
    openNew: document.getElementById("openNew"),
    copyUrl: document.getElementById("copyUrl"),
    toggleVis: document.getElementById("toggleVis"),
    closeSide: document.getElementById("closeSide"),
    filePick: document.getElementById("filePick"),
  };

  // Build a flat index for stable IDs
  const index = [];
  const byId = new Map();
  const clusterNames = CLUSTERS.map(c => c.name);

  function makeUrl(path){ return /^https?:\/\//i.test(path) ? path : (BASE_URL + path.replace(/^\//,'')); }
  function makeId(cluster, path){ return `${cluster}::${path}`; }

  CLUSTERS.forEach(c => {
    c.links.forEach(path => {
      const id = makeId(c.name, path);
      const rec = { id, cluster:c.name, path, url: makeUrl(path) };
      index.push(rec);
      byId.set(id, rec);
    });
  });

  // visibility store: id -> "PUBLIC" | "PRIVATE" | "UNSET"
  let vis = {};
  let selectedId = null;

  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY);
      if(!raw) return;
      const parsed = JSON.parse(raw);
      if(parsed && typeof parsed === "object" && parsed.vis){
        vis = parsed.vis || {};
      }
    }catch{}
  }
  function save(){
    try{
      const payload = { version:"KD_PUBLIC_PRIVATE_V1", updatedAt:new Date().toISOString(), vis };
      localStorage.setItem(STORE_KEY, JSON.stringify(payload));
      els.pillSaved.textContent = "SAVED";
      setTimeout(()=>els.pillSaved.textContent="LOCAL", 600);
    }catch{}
  }

  function getVis(id){
    const v = vis[id];
    if(v==="PUBLIC" || v==="PRIVATE") return v;
    return "UNSET";
  }
  function setVis(id, v){
    if(v==="UNSET") delete vis[id];
    else vis[id] = v;
    save();
  }
  function toggleVis(id){
    const cur = getVis(id);
    const next = (cur==="PUBLIC") ? "PRIVATE" : "PUBLIC";
    setVis(id, next);
  }

  function buildClusterFilter(){
    els.clusterFilter.innerHTML = `<option value="ALL">ALL</option>` + clusterNames.map(n=>`<option value="${escapeHtml(n)}">${escapeHtml(n)}</option>`).join("");
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  function matchFilters(rec){
    const q = els.q.value.trim().toLowerCase();
    if(q){
      const hay = (rec.path + " " + rec.cluster).toLowerCase();
      if(!hay.includes(q)) return false;
    }
    const vf = els.visFilter.value;
    const v = getVis(rec.id);
    if(vf !== "ALL" && v !== vf) return false;

    const cf = els.clusterFilter.value;
    if(cf !== "ALL" && rec.cluster !== cf) return false;
    return true;
  }

  function render(){
    // render clusters as modules, with items filtered
    els.grid.innerHTML = "";

    CLUSTERS.forEach(c => {
      if(els.clusterFilter.value !== "ALL" && c.name !== els.clusterFilter.value) return;

      // build filtered items
      const items = c.links.map(path => byId.get(makeId(c.name, path))).filter(matchFilters);

      // If global filters would show nothing, still show cluster card but empty? Keep it visible if no query/vis filter? Minimal rule: show if it has something OR filters are default.
      const defaultFilters =
        els.q.value.trim()==="" &&
        els.visFilter.value==="ALL" &&
        els.clusterFilter.value==="ALL";

      if(items.length === 0 && !defaultFilters) return;

      const card = document.createElement("div");
      card.className = "cluster";

      const header = document.createElement("div");
      header.className = "clusterHeader";

      const left = document.createElement("div");
      left.className = "clusterTitle";
      left.innerHTML = `<span class="name">${escapeHtml(c.name)}</span><span class="count">(${c.links.length})</span>`;

      const tools = document.createElement("div");
      tools.className = "clusterTools";

      const btnAllPub = document.createElement("button");
      btnAllPub.textContent = "ALL PUBLIC";
      btnAllPub.onclick = () => { c.links.forEach(p => setVis(makeId(c.name,p), "PUBLIC")); render(); };

      const btnAllPriv = document.createElement("button");
      btnAllPriv.textContent = "ALL PRIVATE";
      btnAllPriv.onclick = () => { c.links.forEach(p => setVis(makeId(c.name,p), "PRIVATE")); render(); };

      const btnClear = document.createElement("button");
      btnClear.textContent = "CLEAR";
      btnClear.onclick = () => { c.links.forEach(p => setVis(makeId(c.name,p), "UNSET")); render(); };

      tools.appendChild(btnAllPub);
      tools.appendChild(btnAllPriv);
      tools.appendChild(btnClear);

      header.appendChild(left);
      header.appendChild(tools);

      const list = document.createElement("div");
      list.className = "list";

      const useItems = defaultFilters ? c.links.map(p => byId.get(makeId(c.name,p))) : items;

      useItems.forEach(rec => {
        const row = document.createElement("div");
        row.className = "item";

        const v = getVis(rec.id);
        const tagClass = (v==="PUBLIC") ? "pub" : (v==="PRIVATE" ? "priv" : "");
        const tagText = (v==="UNSET") ? "UNSET" : v;

        row.innerHTML = `
          <div class="left">
            <span class="tag ${tagClass}">${escapeHtml(tagText)}</span>
            <span class="path" title="${escapeHtml(rec.path)}">${escapeHtml(rec.path)}</span>
            <span class="meta" title="${escapeHtml(rec.cluster)}">${escapeHtml(rec.cluster)}</span>
          </div>
          <button class="btn" data-act="toggle">TOGGLE</button>
          <button class="btn" data-act="open">OPEN</button>
        `;

        row.querySelector('[data-act="toggle"]').onclick = () => { toggleVis(rec.id); render(); };
        row.querySelector('[data-act="open"]').onclick = () => { select(rec.id); open(rec.id, true); };
        row.onclick = (e) => {
          // avoid double triggers
          if(e.target && e.target.closest("button")) return;
          select(rec.id);
        };

        list.appendChild(row);
      });

      card.appendChild(header);
      card.appendChild(list);
      els.grid.appendChild(card);
    });
  }

  function select(id){
    selectedId = id;
    const rec = byId.get(id);
    if(!rec){ els.side.style.display="none"; return; }
    els.side.style.display = "block";
    els.selPath.textContent = `${rec.cluster} / ${rec.path}`;
    els.selUrl.textContent = rec.url;
    els.selVis.textContent = getVis(id);
  }

  function open(id, newTab){
    const rec = byId.get(id);
    if(!rec) return;
    if(newTab) window.open(rec.url, "_blank", "noopener,noreferrer");
    else window.location.href = rec.url;
  }

  function download(filename, text){
    const blob = new Blob([text], { type:"application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 800);
  }

  function exportJSON(onlyPublic){
    const out = {
      fileId: "KETADATA_CLUSTER_VISIBILITY_V1",
      updatedAt: new Date().toISOString(),
      baseUrl: BASE_URL,
      onlyPublic: !!onlyPublic,
      clusters: {}
    };
    CLUSTERS.forEach(c => {
      const arr = [];
      c.links.forEach(p => {
        const id = makeId(c.name,p);
        const v = getVis(id);
        if(onlyPublic && v !== "PUBLIC") return;
        arr.push({ path:p, url: makeUrl(p), visibility: v });
      });
      out.clusters[c.name] = arr;
    });
    return JSON.stringify(out, null, 2);
  }

  // Import format:
  // {
  //   version?, vis: { "CLUSTER::file.html": "PUBLIC"|"PRIVATE" }
  // }
  function importJSON(text){
    let parsed;
    try{ parsed = JSON.parse(text); }catch{ return; }
    if(!parsed || typeof parsed !== "object") return;

    // Accept either {vis:{...}} or {clusters:{...}} structure
    if(parsed.vis && typeof parsed.vis === "object"){
      const next = {};
      for(const k in parsed.vis){
        const v = parsed.vis[k];
        if(!byId.has(k)) continue;
        if(v==="PUBLIC" || v==="PRIVATE") next[k]=v;
      }
      vis = next;
      save();
      render();
      return;
    }
    if(parsed.clusters && typeof parsed.clusters === "object"){
      const next = {};
      // clusters: { NAME: [{path, visibility}] }
      for(const cname in parsed.clusters){
        const items = parsed.clusters[cname];
        if(!Array.isArray(items)) continue;
        items.forEach(it => {
          const p = it?.path;
          const v = it?.visibility;
          if(typeof p !== "string") return;
          const id = makeId(cname, p);
          if(!byId.has(id)) return;
          if(v==="PUBLIC" || v==="PRIVATE") next[id]=v;
        });
      }
      vis = next;
      save();
      render();
    }
  }

  // ========= UI WIRING =========
  buildClusterFilter();
  load();
  render();

  els.q.addEventListener("input", render);
  els.visFilter.addEventListener("change", render);
  els.clusterFilter.addEventListener("change", render);

  els.btnExportPublic.onclick = () => {
    download("KD_public_links.json", exportJSON(true));
  };
  els.btnExportAll.onclick = () => {
    const payload = { version:"KD_PUBLIC_PRIVATE_V1", updatedAt:new Date().toISOString(), vis };
    download("KD_visibility_map.json", JSON.stringify(payload, null, 2));
  };
  els.btnImport.onclick = () => { els.filePick.click(); };
  els.filePick.addEventListener("change", async () => {
    const f = els.filePick.files && els.filePick.files[0];
    if(!f) return;
    const text = await f.text();
    importJSON(text);
    els.filePick.value = "";
  });

  els.btnReset.onclick = () => {
    vis = {};
    save();
    render();
  };

  els.openHere.onclick = () => selectedId && open(selectedId, false);
  els.openNew.onclick = () => selectedId && open(selectedId, true);
  els.copyUrl.onclick = async () => {
    if(!selectedId) return;
    const rec = byId.get(selectedId);
    if(!rec) return;
    try{ await navigator.clipboard.writeText(rec.url); }catch{}
  };
  els.toggleVis.onclick = () => {
    if(!selectedId) return;
    toggleVis(selectedId);
    select(selectedId);
    render();
  };
  els.closeSide.onclick = () => { els.side.style.display="none"; selectedId=null; };

  function toggleNull(){ document.body.classList.toggle("null"); }
  function toggleInvert(){ document.body.classList.toggle("invert"); }
  function toggleFull(){
    if(!document.fullscreenElement) document.documentElement.requestFullscreen?.();
    else document.exitFullscreen?.();
  }
  els.btnNull.onclick = toggleNull;
  els.btnInvert.onclick = toggleInvert;
  els.btnFull.onclick = toggleFull;

  // Hotkeys (system universals)
  window.addEventListener("keydown", (e) => {
    if(e.shiftKey && (e.key==="I"||e.key==="i")){ e.preventDefault(); toggleInvert(); return; }
    if(e.shiftKey && (e.key==="N"||e.key==="n")){ e.preventDefault(); toggleNull(); return; }
    if(e.shiftKey && (e.key==="F"||e.key==="f")){ e.preventDefault(); toggleFull(); return; }
    if(e.key==="Escape"){ els.side.style.display="none"; selectedId=null; }
  });
})();
</script>

<!--
AE / EE / WB — KETADATA SERIALIZATION STAMP (MANDATORY)
AE: BRUTAL MINIMAL CLUSTER GRID / MONOCHROME / NO-BLOAT TEXT
EE: PUBLIC/PRIVATE TOGGLES PER LINK + BULK PER CLUSTER + FILTERS + EXPORT/IMPORT
WB: LOCAL-FIRST (localStorage) + SYSTEM UNIVERSALS (SHIFT+I, SHIFT+N, SHIFT+F)

FILE_ID: "KETADATA_CLUSTER_VISIBILITY_GRID"
ROOM_ID: "K_CLUSTER"
VERSION_ID: "V1"
UPDATED_AT: "2026-01-04T00:00:00.000-05:00"
CHANGELOG:
- V1: CLUSTER MODULES + LINK ROWS + PUBLIC/PRIVATE/UNSET FLAGS, BULK ACTIONS, FILTERS, EXPORT/IMPORT
-->
</body>
</html>
